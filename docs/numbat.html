<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.5.0"/>
    <title>numbat API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>


            <h2>Contents</h2>
            <ul>
  <li><a href="#license">License</a></li>
  <li><a href="#requirements">Requirements</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#how-do-i">How do I...</a>
  <ul>
    <li><a href="#create-named-tensors">...create named tensors?</a></li>
    <li><a href="#manipulate-named-tensors">...manipulate named tensors?</a></li>
    <li><a href="#do-inneroutermatrixtensor-products-or-einstein-summation">...do inner/outer/matrix/tensor products or einstein summation?</a></li>
    <li><a href="#do-standard-scalar-operations">...do standard scalar operations?</a></li>
    <li><a href="#do-standard-pairwise-operations">...do standard pairwise operations?</a></li>
    <li><a href="#do-standard-reductions">...do standard reductions?</a></li>
    <li><a href="#use-standard-jax-functions">...use standard jax functions?</a></li>
    <li><a href="#do-linear-algebra">...do linear algebra?</a></li>
    <li><a href="#index-arrays">...index arrays?</a></li>
    <li><a href="#take-gradients">...take gradients?</a></li>
    <li><a href="#do-batchedvmapped-operations">...do batched/vmapped operations?</a></li>
    <li><a href="#get-a-plain-numpy-array">...get a plain numpy array?</a></li>
    <li><a href="#do-signal-processing">...do signal processing?</a></li>
  </ul></li>
  <li><a href="#key-features">Key features</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Axis">Axis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Axis.__init__">Axis</a>
                        </li>
                        <li>
                                <a class="function" href="#Axis.__getitem__">__getitem__</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ntensor">ntensor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ntensor.__init__">ntensor</a>
                        </li>
                        <li>
                                <a class="variable" href="#ntensor.dtype">dtype</a>
                        </li>
                        <li>
                                <a class="variable" href="#ntensor.axes">axes</a>
                        </li>
                        <li>
                                <a class="variable" href="#ntensor.ndim">ndim</a>
                        </li>
                        <li>
                                <a class="variable" href="#ntensor.shape">shape</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.numpy_broadcasted">numpy_broadcasted</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.numpy">numpy</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.__add__">__add__</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.__sub__">__sub__</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.__mul__">__mul__</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.__truediv__">__truediv__</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.__pow__">__pow__</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.__matmul__">__matmul__</a>
                        </li>
                        <li>
                                <a class="function" href="#ntensor.__call__">__call__</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#concatenate">concatenate</a>
            </li>
            <li>
                    <a class="function" href="#stack">stack</a>
            </li>
            <li>
                    <a class="function" href="#dot">dot</a>
            </li>
            <li>
                    <a class="function" href="#axes">axes</a>
            </li>
            <li>
                    <a class="function" href="#allclose">allclose</a>
            </li>
            <li>
                    <a class="function" href="#ones">ones</a>
            </li>
            <li>
                    <a class="function" href="#zeros">zeros</a>
            </li>
            <li>
                    <a class="function" href="#randn">randn</a>
            </li>
            <li>
                    <a class="function" href="#vmap">vmap</a>
            </li>
            <li>
                    <a class="function" href="#batch">batch</a>
            </li>
            <li>
                    <a class="function" href="#wrap">wrap</a>
            </li>
            <li>
                    <a class="function" href="#scan">scan</a>
            </li>
            <li>
                    <a class="function" href="#lift">lift</a>
            </li>
            <li>
                    <a class="function" href="#lower">lower</a>
            </li>
            <li>
                    <a class="function" href="#abs">abs</a>
            </li>
            <li>
                    <a class="function" href="#acos">acos</a>
            </li>
            <li>
                    <a class="function" href="#acosh">acosh</a>
            </li>
            <li>
                    <a class="function" href="#arccos">arccos</a>
            </li>
            <li>
                    <a class="function" href="#arccosh">arccosh</a>
            </li>
            <li>
                    <a class="function" href="#arcsin">arcsin</a>
            </li>
            <li>
                    <a class="function" href="#arcsinh">arcsinh</a>
            </li>
            <li>
                    <a class="function" href="#arctan">arctan</a>
            </li>
            <li>
                    <a class="function" href="#arctanh">arctanh</a>
            </li>
            <li>
                    <a class="function" href="#asin">asin</a>
            </li>
            <li>
                    <a class="function" href="#asinh">asinh</a>
            </li>
            <li>
                    <a class="function" href="#atan">atan</a>
            </li>
            <li>
                    <a class="function" href="#atanh">atanh</a>
            </li>
            <li>
                    <a class="function" href="#ceil">ceil</a>
            </li>
            <li>
                    <a class="function" href="#conj">conj</a>
            </li>
            <li>
                    <a class="function" href="#cos">cos</a>
            </li>
            <li>
                    <a class="function" href="#cosh">cosh</a>
            </li>
            <li>
                    <a class="function" href="#deg2rad">deg2rad</a>
            </li>
            <li>
                    <a class="function" href="#exp">exp</a>
            </li>
            <li>
                    <a class="function" href="#exp2">exp2</a>
            </li>
            <li>
                    <a class="function" href="#expm1">expm1</a>
            </li>
            <li>
                    <a class="function" href="#i0">i0</a>
            </li>
            <li>
                    <a class="function" href="#imag">imag</a>
            </li>
            <li>
                    <a class="function" href="#log">log</a>
            </li>
            <li>
                    <a class="function" href="#log10">log10</a>
            </li>
            <li>
                    <a class="function" href="#log1p">log1p</a>
            </li>
            <li>
                    <a class="function" href="#log2">log2</a>
            </li>
            <li>
                    <a class="function" href="#rad2deg">rad2deg</a>
            </li>
            <li>
                    <a class="function" href="#real">real</a>
            </li>
            <li>
                    <a class="function" href="#reciprocal">reciprocal</a>
            </li>
            <li>
                    <a class="function" href="#rint">rint</a>
            </li>
            <li>
                    <a class="function" href="#round">round</a>
            </li>
            <li>
                    <a class="function" href="#sign">sign</a>
            </li>
            <li>
                    <a class="function" href="#sin">sin</a>
            </li>
            <li>
                    <a class="function" href="#sinc">sinc</a>
            </li>
            <li>
                    <a class="function" href="#sinh">sinh</a>
            </li>
            <li>
                    <a class="function" href="#sqrt">sqrt</a>
            </li>
            <li>
                    <a class="function" href="#square">square</a>
            </li>
            <li>
                    <a class="function" href="#tan">tan</a>
            </li>
            <li>
                    <a class="function" href="#tanh">tanh</a>
            </li>
            <li>
                    <a class="function" href="#trunc">trunc</a>
            </li>
            <li>
                    <a class="function" href="#relu">relu</a>
            </li>
            <li>
                    <a class="function" href="#add">add</a>
            </li>
            <li>
                    <a class="function" href="#arctan2">arctan2</a>
            </li>
            <li>
                    <a class="function" href="#atan2">atan2</a>
            </li>
            <li>
                    <a class="function" href="#divide">divide</a>
            </li>
            <li>
                    <a class="function" href="#divmod">divmod</a>
            </li>
            <li>
                    <a class="function" href="#equal">equal</a>
            </li>
            <li>
                    <a class="function" href="#floor_divide">floor_divide</a>
            </li>
            <li>
                    <a class="function" href="#gcd">gcd</a>
            </li>
            <li>
                    <a class="function" href="#greater">greater</a>
            </li>
            <li>
                    <a class="function" href="#greater_equal">greater_equal</a>
            </li>
            <li>
                    <a class="function" href="#heaviside">heaviside</a>
            </li>
            <li>
                    <a class="function" href="#hypot">hypot</a>
            </li>
            <li>
                    <a class="function" href="#lcm">lcm</a>
            </li>
            <li>
                    <a class="function" href="#ldexp">ldexp</a>
            </li>
            <li>
                    <a class="function" href="#less">less</a>
            </li>
            <li>
                    <a class="function" href="#less_equal">less_equal</a>
            </li>
            <li>
                    <a class="function" href="#logaddexp">logaddexp</a>
            </li>
            <li>
                    <a class="function" href="#logaddexp2">logaddexp2</a>
            </li>
            <li>
                    <a class="function" href="#maximum">maximum</a>
            </li>
            <li>
                    <a class="function" href="#minimum">minimum</a>
            </li>
            <li>
                    <a class="function" href="#multiply">multiply</a>
            </li>
            <li>
                    <a class="function" href="#mod">mod</a>
            </li>
            <li>
                    <a class="function" href="#nextafter">nextafter</a>
            </li>
            <li>
                    <a class="function" href="#not_equal">not_equal</a>
            </li>
            <li>
                    <a class="function" href="#polyadd">polyadd</a>
            </li>
            <li>
                    <a class="function" href="#polymul">polymul</a>
            </li>
            <li>
                    <a class="function" href="#polysub">polysub</a>
            </li>
            <li>
                    <a class="function" href="#polyval">polyval</a>
            </li>
            <li>
                    <a class="function" href="#pow">pow</a>
            </li>
            <li>
                    <a class="function" href="#power">power</a>
            </li>
            <li>
                    <a class="function" href="#remainder">remainder</a>
            </li>
            <li>
                    <a class="function" href="#subtract">subtract</a>
            </li>
            <li>
                    <a class="function" href="#true_divide">true_divide</a>
            </li>
            <li>
                    <a class="function" href="#all">all</a>
            </li>
            <li>
                    <a class="function" href="#any">any</a>
            </li>
            <li>
                    <a class="function" href="#logsumexp">logsumexp</a>
            </li>
            <li>
                    <a class="function" href="#max">max</a>
            </li>
            <li>
                    <a class="function" href="#mean">mean</a>
            </li>
            <li>
                    <a class="function" href="#median">median</a>
            </li>
            <li>
                    <a class="function" href="#min">min</a>
            </li>
            <li>
                    <a class="function" href="#prod">prod</a>
            </li>
            <li>
                    <a class="function" href="#sum">sum</a>
            </li>
            <li>
                    <a class="function" href="#std">std</a>
            </li>
            <li>
                    <a class="function" href="#var">var</a>
            </li>
            <li>
                    <a class="function" href="#grad">grad</a>
            </li>
            <li>
                    <a class="function" href="#value_and_grad">value_and_grad</a>
            </li>
            <li>
                    <a class="function" href="#solve">solve</a>
            </li>
            <li>
                    <a class="function" href="#inv">inv</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
numbat    </h1>

                        <div class="docstring"><p><code><a href="">numbat</a></code>: NumPy+Jax with named axes and an uncompromising attitude</p>

<h1 id="license">License</h1>

<p>Copyright (C) 2025 Justin Domke - All Rights Reserved</p>

<p>Licensed under the GNU Affero General Public License, Version 3.0 (the "License"); you may not
use this file except in compliance with the License. You may obtain a copy of the License at
<a href="https://www.gnu.org/licenses/agpl-3.0.en.html">https://www.gnu.org/licenses/agpl-3.0.en.html</a></p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

<h1 id="requirements">Requirements</h1>

<ul>
<li>Python 3.10+</li>
<li>Numpy</li>
<li>Jax</li>
<li><a href="https://github.com/pwwang/python-varname">varname</a> (Optional: For magical axis naming.)</li>
</ul>

<h1 id="installation">Installation</h1>

<ol>
<li>It's a single file.</li>
<li>Download it and put it in a directory.</li>
<li>Done!</li>
</ol>

<h1 id="how-do-i">How do I...</h1>

<h2 id="create-named-tensors">...create named tensors?</h2>

<p>See <code><a href="#ntensor.__init__">ntensor.__init__</a></code>, <code><a href="#ones">ones</a></code>, <code><a href="#zeros">zeros</a></code>, <code><a href="#randn">randn</a></code>.</p>

<p>TODO: add rand, others?</p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3} [0 1 2]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ones</span><span class="p">(</span><span class="n">cats</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dogs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">&lt;ntensor {cats:2, dogs:3}</span>
<span class="go">[[1. 1. 1.]</span>
<span class="go"> [1. 1. 1.]]&gt;</span>
</code></pre>
</div>

<h2 id="manipulate-named-tensors">...manipulate named tensors?</h2>

<p>See <code><a href="#concatenate">concatenate</a></code>, <code><a href="#stack">stack</a></code></p>

<h2 id="do-inneroutermatrixtensor-products-or-einstein-summation">...do inner/outer/matrix/tensor products or einstein summation?</h2>

<p>See <code><a href="#dot">dot</a></code>. It does it all. This is the only function you need. Or, equivalently, use the <code>@</code> operator which
will call <code><a href="#dot">dot</a></code> for you.</p>

<h6 id="examples-2">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:2} [9 5]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:2} [9 5]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">@</span> <span class="n">B</span>
<span class="go">&lt;ntensor {i:2} [9 5]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">@</span> <span class="n">A</span>
<span class="go">&lt;ntensor {i:2} [9 5]&gt;</span>
</code></pre>
</div>

<h2 id="do-standard-scalar-operations">...do standard scalar operations?</h2>

<p>See <code><a href="#abs">abs</a></code>, <code><a href="#acos">acos</a></code>, <code><a href="#acosh">acosh</a></code>, ..., <code><a href="#relu">relu</a></code>.</p>

<h6 id="examples-3">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;dog&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="go">&lt;ntensor {dog:3} [3 0 3]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">relu</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="go">&lt;ntensor {dog:3} [0 0 3]&gt;</span>
</code></pre>
</div>

<h2 id="do-standard-pairwise-operations">...do standard pairwise operations?</h2>

<p>See <code><a href="#add">add</a></code>, <code><a href="#arctan2">arctan2</a></code>, ..., <code><a href="#true_divide">true_divide</a></code>. Or use operator overloading.</p>

<h6 id="examples-4">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3} [10 11 12]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">+</span><span class="n">B</span>
<span class="go">&lt;ntensor {i:3} [10 11 12]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">/</span><span class="n">C</span>
<span class="go">&lt;ntensor {i:3, j:2}</span>
<span class="go">[[0.   0.  ]</span>
<span class="go"> [0.1  0.05]</span>
<span class="go"> [0.2  0.1 ]]&gt;</span>
</code></pre>
</div>

<h2 id="do-standard-reductions">...do standard reductions?</h2>

<p>See <code><a href="#all">all</a></code>, <code><a href="#any">any</a></code>, ..., <code><a href="#var">var</a></code></p>

<h6 id="examples-5">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">]],</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">all</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="go">&lt;ntensor {} False&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">all</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">})</span>
<span class="go">&lt;ntensor {} False&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">all</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {j:3} [ True False  True]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">all</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:2} [ True False]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">})</span>
<span class="go">&lt;ntensor {j:3} [8. 8. 8.]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;j&#39;</span><span class="p">})</span>
<span class="go">&lt;ntensor {j:3} [8. 8. 8.]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">])</span>
<span class="go">&lt;ntensor {i:2, j:3}</span>
<span class="go">[[4. 4. 4.]</span>
<span class="go"> [4. 4. 4.]]&gt;</span>
</code></pre>
</div>

<h2 id="use-standard-jax-functions">...use standard jax functions?</h2>

<p>See <code><a href="#lift">lift</a></code>.</p>

<h6 id="examples-6">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">fun</span> <span class="o">=</span> <span class="n">lift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">,</span> <span class="s1">&#39;i j, k-&gt;l&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]],</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fun</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="go">&lt;ntensor {l:2} [0.5  0.25]&gt;</span>
</code></pre>
</div>

<h2 id="do-linear-algebra">...do linear algebra?</h2>

<p>See <code><a href="#inv">inv</a></code>, <code><a href="#solve">solve</a></code>. Or use <code><a href="#lift">lift</a></code>.</p>

<h2 id="index-arrays">...index arrays?</h2>

<p>See <code><a href="#ntensor.__call__">ntensor.__call__</a></code>, which is achieved with <em>parentheses</em>, not square brackets.</p>

<h6 id="examples-7">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">dog</span> <span class="o">=</span> <span class="n">axes</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span><span class="s1">&#39;dog&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">dog</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;ntensor {} 30&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">dog</span><span class="o">=</span><span class="n">dog</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
<span class="go">&lt;ntensor {dog:2} [20 40]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">axes</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=10, k=30)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=10)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=5, j=10, k=15)</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">axes</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;l&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;l&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i_index</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j_index</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_index</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(l=3, m=2, n=4)</span>
</code></pre>
</div>

<h2 id="take-gradients">...take gradients?</h2>

<p>See <code><a href="#grad">grad</a></code> and <code><a href="#value_and_grad">value_and_grad</a></code></p>

<h6 id="examples-8">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grad</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="mi">0</span><span class="p">)(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3} [4. 5. 6.]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grad</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="mi">1</span><span class="p">)(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3} [1. 2. 3.]&gt;</span>
</code></pre>
</div>

<h2 id="do-batchedvmapped-operations">...do batched/vmapped operations?</h2>

<p>See <code><a href="#batch">batch</a></code>, <code><a href="#vmap">vmap</a></code>, <code><a href="#wrap">wrap</a></code>, <code><a href="#scan">scan</a></code>.</p>

<h2 id="get-a-plain-numpy-array">...get a plain numpy array?</h2>

<p>See <code><a href="#ntensor.numpy">ntensor.numpy</a></code></p>

<h2 id="do-signal-processing">...do signal processing?</h2>

<p>See <code>convolve</code></p>

<h1 id="key-features">Key features</h1>

<ol>
<li><p>Numpy provides a huge number of "dot"-type routines, each with their own conventions.
There's <a href="https://numpy.org/doc/stable/reference/generated/numpy.dot.html#numpy.dot"><code>np.dot</code></a>, <a href="https://numpy.org/doc/stable/reference/generated/numpy.inner.html#numpy.inner"><code>np.inner</code></a>, <a href="https://numpy.org/doc/stable/reference/generated/numpy.outer.html#numpy.outer"><code>np.outer</code></a>,
<a href="https://numpy.org/doc/stable/reference/generated/numpy.matmul.html#numpy.matmul"><code>np.matmul</code></a>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.multi_dot.html#numpy
.linalg.multi_dot"><code>np.linalg.multi_dot</code></a>,
<a href="https://numpy.org/doc/stable/reference/generated/numpy.tensordot.html#numpy.tensordot"><code>np.tensordot</code></a>, and
<a href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum"><code>np.einsum</code></a>.
Each of these has their own dimensional ordering conventions. What does <code>np.dot(a,b)</code> do when <code>a</code> and
<code>b</code> are high-dimensional? Does anyone remember?</p>

<p>In ntensor, there's only one function, <code><a href="#dot">dot</a></code>, and only one (fairly simple) rule to remember.</p></li>
<li><p>Numpy indexing is comically complex. You've got "basic" indexing, "advanced boolean" indexing,
"advanced vectorized" indexing and "advanced mixed" indexing. And "advanced" indexing has
some confusing special cases that few people understand.</p>

<p>If you only use slices, integers, and <code>None</code> (aka <code>np.newaxis</code>), it's <em>relatively</em> simple. Writing <code>x[
17, None, 3, ..., 2:29:2, None]</code> is fine. But  what if you want to take the <code>k</code>th element from the
<code>n</code>th axis? You're left writing something like</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">x</span><span class="p">[</span><span class="o">*</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span> <span class="k">else</span> <span class="n">k</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ndim</span><span class="p">)]]</span> <span class="c1"># eek</span>
</code></pre>
</div>

<p>And advanced indexing is really crazy. I mean, look at this:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],:,:]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 70, 80)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],:,[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],:]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 60, 80)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],:,:,[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 60, 70)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],:]</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># !?</span>
<span class="go">(50, 3, 80)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],:,[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 50, 70)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[:,:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># !?</span>
<span class="go">(50, 60, 3)</span>
</code></pre>
</div>

<p>Yes, that is what happens. <em>This is Numpy behaving <strong>as designed</strong>.</em></p>

<p>Also, Numpy doesn't (<a href="https://numpy.org/neps/nep-0021-advanced-indexing.html">currently</a>) support
"outer" indexing, where you'd (say) get each combination of the 2nd/4th/5th rows and 1st/5th columns.
You can achieve this using utilities
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ix_.html"><code>np.ix_</code></a> and
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ogrid.html"><code>np.ogrid</code></a> and
<a href="https://numpy.org/doc/stable/reference/generated/numpy.mgrid.html"><code>np.mgrid</code></a>, but that
that's even more complexity.</p>

<p>In ntensor, you don't need any of this stuff. There is just one indexing rule. It's <em>sort</em> of like
always using numpy advanced indexing all the time, except (1) it's really easy because all the axes are
named, and (2) it's much easier because you don't have to worry about the order and (3) you don't need
all these crazy utility functions. You can probably understand it just from looking at these examples:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">axes</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=10, j=20, l=40)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(j=20, l=40)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=10, j=20, m=3, l=40)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=3, j=3, k=30, l=40)</span>
</code></pre>
</div></li>
<li><p>Manually batching everything is incredibly tedious and error-prone. Need to remember what axis
corresponds to what meaning. Gets out of control with complex cases.</p></li>
</ol>
</div>

                        <input id="mod-numbat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-numbat-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">`numbat`: NumPy+Jax with named axes and an uncompromising attitude</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd"># License</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">Copyright (C) 2025 Justin Domke - All Rights Reserved</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">Licensed under the GNU Affero General Public License, Version 3.0 (the &quot;License&quot;); you may not</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">use this file except in compliance with the License. You may obtain a copy of the License at</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">https://www.gnu.org/licenses/agpl-3.0.en.html</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd"># Requirements</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">* Python 3.10+</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">* Numpy</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">* Jax</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">* [varname](https://github.com/pwwang/python-varname) (Optional: For magical axis naming.)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd"># Installation</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">1. It&#39;s a single file.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">2. Download it and put it in a directory.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">3. Done!</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd"># How do I...</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">## ...create named tensors?</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">See `ntensor.__init__`, `ones`, `zeros`, `randn`.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">TODO: add rand, others?</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">Examples</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">--------</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">&gt;&gt;&gt; ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">&lt;ntensor {i:3} [0 1 2]&gt;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">&gt;&gt;&gt; ones(cats=2, dogs=3)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">&lt;ntensor {cats:2, dogs:3}</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">[[1. 1. 1.]</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd"> [1. 1. 1.]]&gt;</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">## ...manipulate named tensors?</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">See `concatenate`, `stack`</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">## ...do inner/outer/matrix/tensor products or einstein summation?</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">See `dot`. It does it all. This is the only function you need. Or, equivalently, use the `@` operator which</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">will call `dot` for you.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">Examples</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">--------</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">&gt;&gt;&gt; A = ntensor([[0,1],[1, 0]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">&gt;&gt;&gt; B = ntensor([5,9],&#39;j&#39;)</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">&gt;&gt;&gt; dot(A,B)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">&lt;ntensor {i:2} [9 5]&gt;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">&gt;&gt;&gt; dot(B,A)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">&lt;ntensor {i:2} [9 5]&gt;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">&gt;&gt;&gt; A @ B</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">&lt;ntensor {i:2} [9 5]&gt;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">&gt;&gt;&gt; B @ A</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">&lt;ntensor {i:2} [9 5]&gt;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">## ...do standard scalar operations?</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">See `abs`, `acos`, `acosh`, ..., `relu`.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">Examples</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">--------</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">&gt;&gt;&gt; A = ntensor([-3,0,3],&#39;dog&#39;)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">&gt;&gt;&gt; abs(A)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">&lt;ntensor {dog:3} [3 0 3]&gt;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">&gt;&gt;&gt; relu(A)</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">&lt;ntensor {dog:3} [0 0 3]&gt;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">## ...do standard pairwise operations?</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">See `add`, `arctan2`, ..., `true_divide`. Or use operator overloading.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">Examples</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">--------</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">&gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">&gt;&gt;&gt; B = ntensor(10)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">&gt;&gt;&gt; C = ntensor([10, 20],&#39;j&#39;)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">&gt;&gt;&gt; add(A, B)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">&lt;ntensor {i:3} [10 11 12]&gt;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">&gt;&gt;&gt; A+B</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">&lt;ntensor {i:3} [10 11 12]&gt;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">&gt;&gt;&gt; A/C</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">&lt;ntensor {i:3, j:2}</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">[[0.   0.  ]</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd"> [0.1  0.05]</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd"> [0.2  0.1 ]]&gt;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">## ...do standard reductions?</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">See `all`, `any`, ..., `var`</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">Examples</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">--------</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">&gt;&gt;&gt; A = ntensor([[True, True, True],[True,False,True]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">&gt;&gt;&gt; all(A)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">&lt;ntensor {} False&gt;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">&gt;&gt;&gt; all(A, axes={&#39;i&#39;,&#39;j&#39;})</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">&lt;ntensor {} False&gt;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">&gt;&gt;&gt; all(A,axes=&#39;i&#39;)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">&lt;ntensor {j:3} [ True False  True]&gt;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">&gt;&gt;&gt; all(A,axes=&#39;j&#39;)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">&lt;ntensor {i:2} [ True False]&gt;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">&gt;&gt;&gt; B = ones(i=2, j=3, k=4)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">&gt;&gt;&gt; sum(B, axes={&#39;i&#39;,&#39;k&#39;})</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">&lt;ntensor {j:3} [8. 8. 8.]&gt;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">&gt;&gt;&gt; sum(B, vmap={&#39;j&#39;})</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">&lt;ntensor {j:3} [8. 8. 8.]&gt;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">&gt;&gt;&gt; sum(B, vmap=[&#39;i&#39;,&#39;j&#39;])</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">&lt;ntensor {i:2, j:3}</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">[[4. 4. 4.]</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd"> [4. 4. 4.]]&gt;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">## ...use standard jax functions?</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">See `lift`.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">Examples</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">--------</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">&gt;&gt;&gt; fun = lift(jnp.linalg.solve, &#39;i j, k-&gt;l&#39;)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">&gt;&gt;&gt; A = ntensor([[2,0],[0,4]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">&gt;&gt;&gt; x = ntensor([1, 1], &#39;k&#39;)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">&gt;&gt;&gt; fun(A, x)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">&lt;ntensor {l:2} [0.5  0.25]&gt;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">## ...do linear algebra?</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">See `inv`, `solve`. Or use `lift`.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">## ...index arrays?</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">See `ntensor.__call__`, which is achieved with *parentheses*, not square brackets.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">Examples</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">--------</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">&gt;&gt;&gt; dog = axes()</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">&gt;&gt;&gt; A = ntensor([10, 20, 30, 40, 50],&#39;dog&#39;)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">&gt;&gt;&gt; A(dog=2)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">&lt;ntensor {} 30&gt;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">&gt;&gt;&gt; A(dog=dog[1::2])</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">&lt;ntensor {dog:2} [20 40]&gt;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">&gt;&gt;&gt; i, j, k = axes()</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">&gt;&gt;&gt; A = randn(i=10, j=20, k=30)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">&gt;&gt;&gt; A(j=5).shape</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">ShapeDict(i=10, k=30)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">&gt;&gt;&gt; A(j=5, k=3).shape</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">ShapeDict(i=10)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">&gt;&gt;&gt; A(j=j[::2], i=i[::2], k=k[::2]).shape</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">ShapeDict(i=5, j=10, k=15)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">&gt;&gt;&gt; i, j, k = axes()</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">&gt;&gt;&gt; A = randn(i=10, j=20, k=30)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">&gt;&gt;&gt; i_index = ntensor([0, 1, 2], &#39;l&#39;)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">&gt;&gt;&gt; j_index = ntensor([0, 1, 2], &#39;l&#39;)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">&gt;&gt;&gt; k_index = ntensor([[0, 1, 2, 3],[4, 5, 6, 7]], &#39;m&#39;, &#39;n&#39;)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">&gt;&gt;&gt; A(i=i_index, j=j_index, k=k_index).shape</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">ShapeDict(l=3, m=2, n=4)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">## ...take gradients?</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">See `grad` and `value_and_grad`</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">Examples</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">--------</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">&gt;&gt;&gt; A = ntensor([1., 2., 3.],&#39;i&#39;)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">&gt;&gt;&gt; B = ntensor([4., 5., 6.],&#39;i&#39;)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">&gt;&gt;&gt; grad(dot, 0)(A, B)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">&lt;ntensor {i:3} [4. 5. 6.]&gt;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">&gt;&gt;&gt; grad(dot, 1)(A, B)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">&lt;ntensor {i:3} [1. 2. 3.]&gt;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">## ...do batched/vmapped operations?</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">See `batch`, `vmap`, `wrap`, `scan`.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">## ...get a plain numpy array?</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">See `ntensor.numpy`</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">## ...do signal processing?</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">See `convolve`</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd"># Key features</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">1. Numpy provides a huge number of &quot;dot&quot;-type routines, each with their own conventions.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">There&#39;s [`np.dot`](https://numpy.org/doc/stable/reference/generated/numpy.dot.html#numpy.dot), [`np.inner`](</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">https://numpy.org/doc/stable/reference/generated/numpy.inner.html#numpy.inner), [`np.outer`](</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">https://numpy.org/doc/stable/reference/generated/numpy.outer.html#numpy.outer),</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">[`np.matmul`](https://numpy.org/doc/stable/reference/generated/numpy.matmul.html#numpy.matmul)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">[`np.linalg.multi_dot`](https://numpy.org/doc/stable/reference/generated/numpy.linalg.multi_dot.html#numpy</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">.linalg.multi_dot),</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">[`np.tensordot`](https://numpy.org/doc/stable/reference/generated/numpy.tensordot.html#numpy.tensordot), and</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">[`np.einsum`](https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum).</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">Each of these has their own dimensional ordering conventions. What does `np.dot(a,b)` do when `a` and</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">`b` are high-dimensional? Does anyone remember?</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">   In ntensor, there&#39;s only one function, `dot`, and only one (fairly simple) rule to remember.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">2. Numpy indexing is comically complex. You&#39;ve got &quot;basic&quot; indexing, &quot;advanced boolean&quot; indexing,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">&quot;advanced vectorized&quot; indexing and &quot;advanced mixed&quot; indexing. And &quot;advanced&quot; indexing has</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">some confusing special cases that few people understand.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">    If you only use slices, integers, and `None` (aka `np.newaxis`), it&#39;s *relatively* simple. Writing `x[</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">    17, None, 3, ..., 2:29:2, None]` is fine. But  what if you want to take the `k`th element from the</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">    `n`th axis? You&#39;re left writing something like</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">    ```python</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">    x[*[slice(None) if i != n else k for i in range(x.ndim)]] # eek</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">    ```</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">     And advanced indexing is really crazy. I mean, look at this:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">    &gt;&gt;&gt; a = onp.ones((50, 60, 70, 80))</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">    &gt;&gt;&gt; a[[0,1,2],[3,4,5],:,:].shape</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">    (3, 70, 80)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">    &gt;&gt;&gt; a[[0,1,2],:,[3,4,5],:].shape</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">    (3, 60, 80)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">    &gt;&gt;&gt; a[[0,1,2],:,:,[3,4,5]].shape</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">    (3, 60, 70)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">    &gt;&gt;&gt; a[:,[0,1,2],[3,4,5],:].shape # !?</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">    (50, 3, 80)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">    &gt;&gt;&gt; a[:,[0,1,2],:,[3,4,5]].shape</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">    (3, 50, 70)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">    &gt;&gt;&gt; a[:,:,[0,1,2],[3,4,5]].shape # !?</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">    (50, 60, 3)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">    Yes, that is what happens. *This is Numpy behaving **as designed**.*</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">    Also, Numpy doesn&#39;t ([currently](https://numpy.org/neps/nep-0021-advanced-indexing.html)) support</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">    &quot;outer&quot; indexing, where you&#39;d (say) get each combination of the 2nd/4th/5th rows and 1st/5th columns.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">    You can achieve this using utilities</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">    [`np.ix_`](https://numpy.org/doc/stable/reference/generated/numpy.ix_.html) and</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">    [`np.ogrid`](https://numpy.org/doc/stable/reference/generated/numpy.ogrid.html) and</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">    [`np.mgrid`](https://numpy.org/doc/stable/reference/generated/numpy.mgrid.html), but that</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">    that&#39;s even more complexity.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">    In ntensor, you don&#39;t need any of this stuff. There is just one indexing rule. It&#39;s *sort* of like</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">    always using numpy advanced indexing all the time, except (1) it&#39;s really easy because all the axes are</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">    named, and (2) it&#39;s much easier because you don&#39;t have to worry about the order and (3) you don&#39;t need</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">    all these crazy utility functions. You can probably understand it just from looking at these examples:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">    &gt;&gt;&gt; i, j, k, l, m = axes()</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">    &gt;&gt;&gt; a = randn(i=10, j=20, k=30, l=40)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">    &gt;&gt;&gt; a(k=2).shape</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">    ShapeDict(i=10, j=20, l=40)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">    &gt;&gt;&gt; a(k=2, i=5).shape</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">    ShapeDict(j=20, l=40)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">    &gt;&gt;&gt; idx = ntensor([0,1,2],m)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">    &gt;&gt;&gt; a(k=idx).shape</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">    ShapeDict(i=10, j=20, m=3, l=40)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">    &gt;&gt;&gt; a(i=i[0,1,2], j=j[0,1,2]).shape</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">    ShapeDict(i=3, j=3, k=30, l=40)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">3. Manually batching everything is incredibly tedious and error-prone. Need to remember what axis</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">corresponds to what meaning. Gets out of control with complex cases.</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;numpy&#39;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="kn">import</span> <span class="nn">jax</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">jnp</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">onp</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">ArrayLike</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Self</span><span class="p">,</span> <span class="n">Type</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">abc</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="kn">import</span> <span class="nn">builtins</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="kn">from</span> <span class="nn">pangolin.util</span> <span class="kn">import</span> <span class="n">WriteOnceDict</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="n">_fundamental_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Axis&#39;</span><span class="p">,</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">]</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="n">_qol_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="s1">&#39;allclose&#39;</span><span class="p">]</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="n">_creation_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ones&#39;</span><span class="p">,</span> <span class="s1">&#39;zeros&#39;</span><span class="p">,</span> <span class="s1">&#39;randn&#39;</span><span class="p">]</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="n">_batching_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vmap&#39;</span><span class="p">,</span> <span class="s1">&#39;batch&#39;</span><span class="p">,</span> <span class="s1">&#39;wrap&#39;</span><span class="p">,</span> <span class="s1">&#39;scan&#39;</span><span class="p">]</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="n">_lifting_and_lowering_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lift&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">]</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="n">_manipulation_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;concatenate&#39;</span><span class="p">,</span><span class="s1">&#39;stack&#39;</span><span class="p">]</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="n">_elementwise_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;abs&#39;</span><span class="p">,</span> <span class="s1">&#39;acos&#39;</span><span class="p">,</span> <span class="s1">&#39;acosh&#39;</span><span class="p">,</span> <span class="s1">&#39;arccos&#39;</span><span class="p">,</span> <span class="s1">&#39;arccosh&#39;</span><span class="p">,</span> <span class="s1">&#39;arcsin&#39;</span><span class="p">,</span> <span class="s1">&#39;arcsinh&#39;</span><span class="p">,</span> <span class="s1">&#39;arctan&#39;</span><span class="p">,</span> <span class="s1">&#39;arctanh&#39;</span><span class="p">,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                      <span class="s1">&#39;asin&#39;</span><span class="p">,</span> <span class="s1">&#39;asinh&#39;</span><span class="p">,</span> <span class="s1">&#39;atan&#39;</span><span class="p">,</span> <span class="s1">&#39;atanh&#39;</span><span class="p">,</span> <span class="s1">&#39;ceil&#39;</span><span class="p">,</span> <span class="s1">&#39;conj&#39;</span><span class="p">,</span> <span class="s1">&#39;cos&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">,</span> <span class="s1">&#39;deg2rad&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                      <span class="s1">&#39;exp2&#39;</span><span class="p">,</span> <span class="s1">&#39;expm1&#39;</span><span class="p">,</span> <span class="s1">&#39;i0&#39;</span><span class="p">,</span> <span class="s1">&#39;imag&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;log10&#39;</span><span class="p">,</span> <span class="s1">&#39;log1p&#39;</span><span class="p">,</span> <span class="s1">&#39;log2&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2deg&#39;</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">,</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                      <span class="s1">&#39;reciprocal&#39;</span><span class="p">,</span> <span class="s1">&#39;rint&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;sign&#39;</span><span class="p">,</span> <span class="s1">&#39;sin&#39;</span><span class="p">,</span> <span class="s1">&#39;sinc&#39;</span><span class="p">,</span> <span class="s1">&#39;sinh&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;tan&#39;</span><span class="p">,</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                      <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="s1">&#39;trunc&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">]</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="n">_pairwise_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;arctan2&#39;</span><span class="p">,</span> <span class="s1">&#39;atan2&#39;</span><span class="p">,</span> <span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="s1">&#39;divmod&#39;</span><span class="p">,</span> <span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;floor_divide&#39;</span><span class="p">,</span> <span class="s1">&#39;gcd&#39;</span><span class="p">,</span> <span class="s1">&#39;greater&#39;</span><span class="p">,</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                   <span class="s1">&#39;greater_equal&#39;</span><span class="p">,</span> <span class="s1">&#39;heaviside&#39;</span><span class="p">,</span> <span class="s1">&#39;hypot&#39;</span><span class="p">,</span> <span class="s1">&#39;lcm&#39;</span><span class="p">,</span> <span class="s1">&#39;ldexp&#39;</span><span class="p">,</span> <span class="s1">&#39;less&#39;</span><span class="p">,</span> <span class="s1">&#39;less_equal&#39;</span><span class="p">,</span> <span class="s1">&#39;logaddexp&#39;</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>                   <span class="s1">&#39;logaddexp2&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="s1">&#39;nextafter&#39;</span><span class="p">,</span> <span class="s1">&#39;not_equal&#39;</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>                   <span class="s1">&#39;polyadd&#39;</span><span class="p">,</span> <span class="s1">&#39;polymul&#39;</span><span class="p">,</span> <span class="s1">&#39;polysub&#39;</span><span class="p">,</span> <span class="s1">&#39;polyval&#39;</span><span class="p">,</span> <span class="s1">&#39;pow&#39;</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;remainder&#39;</span><span class="p">,</span> <span class="s1">&#39;subtract&#39;</span><span class="p">,</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>                   <span class="s1">&#39;true_divide&#39;</span><span class="p">]</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="n">_linalg_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;solve&#39;</span><span class="p">,</span><span class="s1">&#39;inv&#39;</span><span class="p">]</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="n">_gradient_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grad&#39;</span><span class="p">,</span><span class="s1">&#39;value_and_grad&#39;</span><span class="p">]</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="n">_reductions_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="s1">&#39;logsumexp&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span>  <span class="s1">&#39;prod&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="n">_other_stuff</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dot&#39;</span><span class="p">]</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="n">_fundamental_stuff</span> <span class="o">+</span> <span class="n">_manipulation_stuff</span> <span class="o">+</span> <span class="n">_other_stuff</span> <span class="o">+</span> <span class="n">_qol_stuff</span> <span class="o">+</span> <span class="n">_creation_stuff</span> <span class="o">+</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="n">_batching_stuff</span> <span class="o">+</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="n">_lifting_and_lowering_stuff</span> <span class="o">+</span> <span class="n">_elementwise_stuff</span> <span class="o">+</span> <span class="n">_pairwise_stuff</span> <span class="o">+</span> <span class="n">_reductions_stuff</span> <span class="o">+</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="n">_gradient_stuff</span> <span class="o">+</span> <span class="n">_linalg_stuff</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="c1"># Small utility stuff ##############################################################################</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="k">class</span> <span class="nc">ShapeDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A ShapeDict is basically just a dict, except:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">    1. It is frozen after creation</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">    2. It ensures that all keys are of type `Axis`</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">    3. It ensures that all values are of type `int`</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">    4. It prints more compactly</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">    Examples</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">    --------</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">    &gt;&gt;&gt; d = ShapeDict(i=3)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">    &gt;&gt;&gt; d</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">    ShapeDict(i=3)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">    &gt;&gt;&gt; print(d)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">    {i:3}</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">    &gt;&gt;&gt; d[&#39;i&#39;]</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">    3</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">    &gt;&gt;&gt; d[Axis(&#39;i&#39;)]</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">    3</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">    &gt;&gt;&gt; d = ShapeDict({&#39;dogs&#39;:3, Axis(&#39;cats&#39;):4}, zebras=7, frogs=9)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">    &gt;&gt;&gt; d</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">    ShapeDict(dogs=3, cats=4, zebras=7, frogs=9)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">    &gt;&gt;&gt; print(d)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">    {dogs:3, cats:4, zebras:7, frogs:9}</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t assign to ShapeDict after creation.&quot;</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="n">new_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="k">if</span> <span class="n">base_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>            <span class="n">base_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">base_dict</span><span class="p">:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Axis</span><span class="p">)):</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ShapeDict keys must be str or Axis, got </span><span class="si">{</span><span class="n">ax</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_dict</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ShapeDict values must be int, got </span><span class="si">{</span><span class="n">base_dict</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            <span class="n">new_dict</span><span class="p">[</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)]</span> <span class="o">=</span> <span class="n">base_dict</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ShapeDict values must be int, got </span><span class="si">{</span><span class="n">kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>            <span class="k">if</span> <span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_dict</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ShapeDict got repeated axis </span><span class="si">{</span><span class="n">ax</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>            <span class="n">new_dict</span><span class="p">[</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">new_dict</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;ShapeDict(&#39;</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;=&#39;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;}&#39;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>    <span class="nd">@property</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="k">class</span> <span class="nc">ConsistentDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>    <span class="s2">&quot;like a dict, but upon repeated assignments, enforces equality&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>                    <span class="sa">f</span><span class="s2">&quot;Tried to assign </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> but already has value </span><span class="si">{</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="k">def</span> <span class="nf">is_set_of_type</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">typ</span><span class="p">:</span> <span class="n">Type</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Type</span><span class="p">],</span> <span class="n">len_zero_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">Set</span><span class="p">,</span><span class="nb">frozenset</span><span class="p">)):</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="k">if</span> <span class="n">len_zero_ok</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>            <span class="k">return</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="k">def</span> <span class="nf">is_sequence_of_type</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">typ</span><span class="p">:</span> <span class="n">Type</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Type</span><span class="p">],</span> <span class="n">len_zero_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="k">if</span> <span class="n">len_zero_ok</span><span class="p">:</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="k">return</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="k">def</span> <span class="nf">can_be_converted_to_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># Try to convert to ndarray</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="k">def</span> <span class="nf">convert_to_0dim_array_if_possible</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>    <span class="k">if</span> <span class="n">can_be_converted_to_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>    <span class="k">return</span> <span class="n">obj</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="k">def</span> <span class="nf">convert_empty_dict</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>    <span class="s2">&quot;If arg is the </span><span class="si">{}</span><span class="s2"> dict, get an empty set. Otherwise do nothing.&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">()</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>    <span class="k">return</span> <span class="n">arg</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="k">def</span> <span class="nf">is_ntensor</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="k">def</span> <span class="nf">ensure_ntensor</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="c1"># raise ValueError(f&quot;Couldn&#39;t cast {x} to NTensor&quot;)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="k">def</span> <span class="nf">ensure_ntensor_tree</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ensure_ntensor</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="k">def</span> <span class="nf">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>    <span class="n">leaves</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>        <span class="k">return</span> <span class="n">axes</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>    <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="c1"># The fundamental classes ####################################################################################</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="k">class</span> <span class="nc">Axis</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An axis is a unique axis label. It&#39;s *basically* just a string but with a few tricks to make</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">    notation nicer. For convenience, axes evaluate as to equal to their strings. Axes are equal based on</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">    names, not object identity.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">    Examples</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="sd">    --------</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">    &gt;&gt;&gt; cat = Axis(&#39;cat&#39;)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">    &gt;&gt;&gt; dog = Axis(&#39;dog&#39;)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">    &gt;&gt;&gt; cat == dog</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">    False</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">    &gt;&gt;&gt; cat == &#39;cat&#39;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">    True</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">    &gt;&gt;&gt; cat == &#39;dog&#39;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">    False</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>    <span class="n">_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>    <span class="s2">&quot;The stored name. Don&#39;t change this!&quot;</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Self</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an `Axis`.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">        Parameters</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">        ----------</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">        name:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">            Create an axis with the given name. If `None`, then try to detect name being assigned to</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">            with evil magics.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">        Examples</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">        --------</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">        &gt;&gt;&gt; time = Axis(&#39;time&#39;)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">        &gt;&gt;&gt; time</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">        Axis(&#39;time&#39;)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">        &gt;&gt;&gt; time._name</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">        &#39;time&#39;</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">        &gt;&gt;&gt; time == &#39;time&#39; # can compare to strings</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">        True</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">        &gt;&gt;&gt; time == Axis(&#39;time&#39;) # can compare to other Axis with same name</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">        True</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">        &gt;&gt;&gt; id(time) == id(Axis(&#39;time&#39;)) # even though different objects</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">        False</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">        &gt;&gt;&gt; days = Axis() # evil magic</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">        &gt;&gt;&gt; days._name</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">        &#39;days&#39;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">        &gt;&gt;&gt; days == &#39;days&#39;</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">        True</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">        &gt;&gt;&gt; days == Axis(&#39;days&#39;)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        True</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        &gt;&gt;&gt; alice = Axis(&quot;bob&quot;) # this is almost certainly a bad idea</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        &gt;&gt;&gt; alice._name</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        &#39;bob&#39;</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">        &gt;&gt;&gt; alice == &#39;bob&#39;</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        True</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">        &gt;&gt;&gt; alice == &#39;alice&#39;</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">        False</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>            <span class="c1"># try to detect name using evil magics</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>            <span class="kn">import</span> <span class="nn">varname</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">varname</span><span class="o">.</span><span class="n">varname</span><span class="p">()</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">_name</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name must be str or Axis, got </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_name</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name must be str or Axis, got </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Axis(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        You can index into an `Axis` for nicer syntactic sugar when indexing an `ntensor`. If `x` is</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        an `ntensor` with some `Axis` `ax`, then if you do `x(ax=ax[(1,2,3)])`, that&#39;s equivalent to</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">        `x(ax=ntensor((1,2,3),&#39;ax&#39;))`.</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">        If you do `x(ax=ax[1:10:3])`, that&#39;s equivalent to `x(ax=IndexedAxis(ax,slice(1,10,3)))` which is</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">        in turn equivalent to `x(ax=NTensor(np.arange(x.shape[&#39;ax&#39;])[1:10:3])`.</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">        This is achieved by making `ax[...]` do slightly tricky stuff, which is this function.</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">        Parameters</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">        ----------</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">        item: slice | ArrayLike</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">            If this is a slice, then returns an `IndexedAxis`. If this is anything that can be cast</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">            to a 1D numpy array, then this returns an `ntensor`. Anything else is an error.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">        Examples</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">        --------</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">        &gt;&gt;&gt; cats = Axis(&#39;cats&#39;)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">        OK: Numpy arrays or things castable to them.</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">        &gt;&gt;&gt; cats[jnp.array([7,5,2,9])]</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">        &gt;&gt;&gt; cats[(7,5,2,9)]</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">        &gt;&gt;&gt; cats[7,5,2,9]</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">        Also OK: slices.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">        &gt;&gt;&gt; cats[:]</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        IndexedAxis(cats, slice(None, None, None))</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="sd">        &gt;&gt;&gt; cats[1:20:3]</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        IndexedAxis(cats, slice(1, 20, 3))</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        Not OK: Integers. (Since 0-dimensional arrays don&#39;t have shapes, this has no purpose.)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        &gt;&gt;&gt; cats[0]</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">        ...</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">        ValueError: Axis index castable to numpy array, but got 0 dims (must be 1)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">        Not OK: `ntensor` (What would `x(ax=ax[y])` mean if `y` is `ntensor`? Allowing this would lead to</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">        confusion.)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">        &gt;&gt;&gt; cats[ntensor(3)]</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">        ...</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">        ValueError: Can&#39;t index an Axis with an NTensor (1-D numpy array OK).</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">        Not OK: Thing castable to 2+ dimensional numpy arrays. (We only have 1 `Axis`!)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">        &gt;&gt;&gt; cats[((1,2,3),(4,5,6))] # 2d index not allowed!</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">        ...</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">        ValueError: Axis index castable to numpy array, but got 2 dims (must be 1)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t index an Axis with an NTensor (1-D numpy array OK).&quot;</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>            <span class="k">return</span> <span class="n">IndexedAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                    <span class="sa">f</span><span class="s2">&quot;Axis index (</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">) not slice and not castable to a 1-d numpy array&quot;</span><span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Axis index castable to numpy array, but got </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dims (must be 1)&quot;</span><span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make axes sortable by name (mostly just to make tests deterministic)&quot;&quot;&quot;</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_name</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="k">class</span> <span class="nc">IndexedAxis</span><span class="p">:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">        An axis and an index into it. This class just stores the</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">        Parameters</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">        ----------</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">        axis: Axis</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">            The axis being indexed. Needs to be an actual Axis, not a str.</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        index</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">            The indices into the axis. Could be slice or something that can be cast to a 1-D</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">            numpy array. Cannot be NTensor!</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">Axis</span><span class="p">)</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                          <span class="n">IndexedAxis</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">axis</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IndexedAxis(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="k">class</span> <span class="nc">ntensor</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An array is the base type of this package. The first thing about `array`s is that you can</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">    create them. The second thing about `array`s is that you can (elegantly) index them. The third</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">    thing about `array`s is you can call functions on them.</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">    For core usage, see:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">    * `__init__` for creating arrays</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">    * `axes` for getting the axes</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">    * `__call__` for indexing</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">    * `__getitem__` for converting to</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>    <span class="n">_data</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>    <span class="s2">&quot;The underlying data, stored as a numpy array. (You shouldn&#39;t need to mess with this directly!)&quot;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>    <span class="n">_axes_ordered</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Axis</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>    <span class="s2">&quot;The Axis for each dimension in `data`. (You shouldn&#39;t need to mess with this directly!)&quot;</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an array from some block of data. This is familiar from other array languages,</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        except you must provide axis names if there are more than 0 dimensions</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">        Parameters</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">        ----------</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">        data</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">            An array or  [ArrayLike](https://docs.jax.dev/en/latest/_autosummary/jax.typing.ArrayLike.html)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">            that can be cast to a numpy array.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        *axes</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">            `Axis` or strings. Must have same length as number of dimensions of data.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        Examples</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        --------</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        Zero dimensional arrays have no dimensions, and so don&#39;t have axis names</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        &gt;&gt;&gt; ntensor(137.036)</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        &lt;ntensor {} 137.036&gt;</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        Arrays with at least one dimension must have axis names</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">        &gt;&gt;&gt; ntensor([11, 22, 33], &#39;cats&#39;)</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        &lt;ntensor {cats:3} [11 22 33]&gt;</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        &gt;&gt;&gt; ntensor([5.5], &#39;i&#39;)</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        &lt;ntensor {i:1} [5.5]&gt;</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        &gt;&gt;&gt; ntensor([[1,2,3],[4,5,6]], &#39;row&#39;, &#39;col&#39;)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        &lt;ntensor {row:2, col:3}</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">         [4 5 6]]&gt;</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">        You can create an explicit `Axis` objects first if you want. This is *completely equivalent*. (If you</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        pass strings, they are automatically converted into `Axis` object for you.</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">        &gt;&gt;&gt; cats = Axis(&#39;cats&#39;)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">        &gt;&gt;&gt; ntensor([11, 22, 33], cats)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">        &lt;ntensor {cats:3} [11 22 33]&gt;</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ntensor got non-unique axes </span><span class="si">{</span><span class="n">axes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="c1">#print(f&quot;about to create data with array {data=}&quot;)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>                <span class="sa">f</span><span class="s2">&quot;data has shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dims, but given &quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2"> axes: </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span> <span class="o">=</span> <span class="n">axes</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="c1">#self._shape = ShapeDict({axes[i]: self._data.shape[i] for i in range(len(axes))})</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        <span class="c1"># # hack to make jax.grad work for scalars</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="c1"># if self._data.ndim == 0:</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="c1">#     self.__jax_array__ = lambda: self._data</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="c1">#     self.dtype = self._data.dtype</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>    <span class="k">def</span> <span class="nf">__jax_array__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only ntensor with &lt;= 1 can be auto-converted to jax array&quot;</span><span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>    <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only ntensor with &lt;= 1 can be auto-converted to array&quot;</span><span class="p">)</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__array__ </span><span class="si">{</span><span class="bp">self</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">dtype</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="k">return</span> <span class="n">onp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>    <span class="nd">@property</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>    <span class="nd">@property</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">Axis</span><span class="p">]:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Axis objects. It&#39;s a set, because axes *don&#39;t have an order* (that you&#39;re supposed to</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="sd">        think about).</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">        Examples</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="sd">        --------</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]], &quot;day&quot;, &quot;person&quot;)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">        &gt;&gt;&gt; A.axes == {Axis(&#39;day&#39;), Axis(&#39;person&#39;)}</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">        True</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">        &gt;&gt;&gt; A.axes == {&#39;day&#39;, &#39;person&#39;}</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">        True</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">)</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>    <span class="c1"># @property</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>    <span class="c1"># def _axes_ordered(self) -&gt; Tuple[Axis, ...]:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>    <span class="c1">#     return tuple(self._shape.keys())</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>    <span class="nd">@property</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>    <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of dimensions. Equal to `len(axes)`</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">        Examples</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">        --------</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;rows&#39;,&#39;cols&#39;)</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">        &gt;&gt;&gt; A.ndim</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">        2</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>    <span class="nd">@property</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShapeDict</span><span class="p">:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The shape is a *dict* mapping axes to ints.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">        Examples</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        --------</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;record&#39;,&#39;hour&#39;)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        &gt;&gt;&gt; A.shape</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        ShapeDict(record=2, hour=3)</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">        &gt;&gt;&gt; print(A.shape)</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">        {record:2, hour:3}</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="k">return</span> <span class="n">ShapeDict</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">)})</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>    <span class="nd">@property</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="k">def</span> <span class="nf">_shape_ordered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>            <span class="k">return</span> <span class="s2">&quot;&lt;ntensor </span><span class="si">{}</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ntensor </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;ntensor </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="k">def</span> <span class="nf">numpy_broadcasted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to a (Jax) numpy array, by providing order for axes.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">        If you provide an axis that doesn&#39;t exist, a new one with a singleton dimension</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        will be created</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        Parameters</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">        ----------</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">        *axes</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">            The axes, in order. Must include all axes present in self.</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">        Examples</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">        --------</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">        Zero dimensional array</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor(5)</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">        &gt;&gt;&gt; A</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">        &lt;ntensor {} 5&gt;</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted())</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">        5</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;))</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">        [5]</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">        [[5]]</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">        Two-dimensional array</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">         [4 5 6]]</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;j&#39;,&#39;i&#39;))</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">        [[1 4]</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">         [2 5]</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">         [3 6]]</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;k&#39;,&#39;j&#39;,&#39;l&#39;).shape)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">        (2, 1, 3, 1)</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axes </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2"> not a subset of </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">=}</span><span class="s2"> not equal to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>        <span class="n">extra_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">extra_dims</span><span class="p">)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="n">where</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>        <span class="n">where_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">where_extra</span><span class="p">)</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                <span class="n">where_extra</span> <span class="o">=</span> <span class="n">where_extra</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>    <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to a (Jax) numpy array, by providing order for axes.</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">        Unlike numpy_broadcasted, you cannot provide new axes. Also, if self has only 1 dimension,</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">        it&#39;s acceptable to skip it.</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">        Parameters</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">        ----------</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">        *axes</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">            The axes, in order. Must have equal number as dimensions, unless number of dimensions is one,</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">            in which case it can be skipped</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">        Examples</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        --------</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">        Zero dimensional array</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor(5)</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">        &gt;&gt;&gt; A</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">        &lt;ntensor {} 5&gt;</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy())</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">        5</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">        One dimensional array</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;i&#39;))</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">        [1 2 3]</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy())</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">        [1 2 3]</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">        Two-dimensional array</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">         [4 5 6]]</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;j&#39;,&#39;i&#39;))</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">        [[1 4]</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">         [2 5]</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">         [3 6]]</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="k">if</span> <span class="n">axes</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided axes </span><span class="si">{</span><span class="n">axes</span><span class="si">}</span><span class="s2"> do not match ntensor axes </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="n">extra_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">extra_dims</span><span class="p">)</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="n">where</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="n">where_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">where_extra</span><span class="p">)</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="n">where_extra</span> <span class="o">=</span> <span class="n">where_extra</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>    <span class="c1"># def __getitem__(self, idx):</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>    <span class="c1">#     if isinstance(idx, slice):</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>    <span class="c1">#         raise ValueError(&quot;Can&#39;t index NTensor with slice. (Remember, A[i,j] converts to numpy)&quot;)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="c1">#</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>    <span class="c1">#     if isinstance(idx, int):</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>    <span class="c1">#         raise ValueError(&quot;Can&#39;t index NTensor with int. (Remember, A[i] converts to numpy)&quot;)</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>    <span class="c1">#</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>    <span class="c1">#     if idx is ...:</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>    <span class="c1">#         if self.shape != {}:</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>    <span class="c1">#             raise ValueError(</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>    <span class="c1">#                 f&quot;Can only call A[...] for scalar NTensor, got shape {self.shape})&quot;)</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    <span class="c1">#         else:</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>    <span class="c1">#             return self.numpy_broadcasted()</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>    <span class="c1">#</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>    <span class="c1">#     if isinstance(idx, (str, Axis)):</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>    <span class="c1">#         return self.numpy_broadcasted(idx)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>    <span class="c1">#</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>    <span class="c1">#     if len(idx) != self.ndim:</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>    <span class="c1">#         raise ValueError(</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="c1">#             f&quot;Number of indices in {idx} not equal to number of dimensions ({self.ndim})&quot;)</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>    <span class="c1">#</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>    <span class="c1">#     return self.numpy_broadcasted(*idx)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Self</span> <span class="o">|</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">        Do fully-batched addition. Unlike `add`, this seamlessly handles arrays of any shape with</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">        full automatic broadcasting.</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">        `A+B` is equivalent to `add(self, other)`, i.e. maps over all axes.</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">        Examples</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">        -------</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1,2],&#39;cats&#39;)</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([0,5],&#39;dogs&#39;)</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">        &gt;&gt;&gt; (A+B).shape == {&#39;cats&#39;: 3, &#39;dogs&#39;:2}</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">        True</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">        Do fully-batched substraction.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>        <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        Do fully-batched multiplication.</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>        <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>        <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        Do fully-batched division.</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>        <span class="k">return</span> <span class="n">true_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="k">return</span> <span class="n">true_divide</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">        Do fully-batched powers.</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="k">return</span> <span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="k">return</span> <span class="n">power</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>    <span class="c1"># def __float__(self)-&gt;float:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="c1">#     if self.shape != {}:</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>    <span class="c1">#         raise ValueError(f&quot;Can&#39;t convert NTensor with shape {self.shape} to float&quot;)</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>    <span class="c1">#     return float(self._data)</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>    <span class="c1"># def __array__(self)-&gt;jnp.ndarray:</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>    <span class="c1">#     print(&quot;ARRAY CALLED&quot;)</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>    <span class="c1">#     if self.shape != {}:</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>    <span class="c1">#         raise ValueError(f&quot;Can&#39;t convert NTensor with shape {self.shape} to array&quot;)</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>    <span class="c1">#     return self._data</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>    <span class="c1">#</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>    <span class="c1"># @property</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>    <span class="c1"># def dtype(self):</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>    <span class="c1">#     print(&quot;DTYPE CALLED&quot;)</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>    <span class="c1">#     return self._data.dtype</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>    <span class="c1">#</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>    <span class="c1"># @property</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>    <span class="c1"># def aval(self):</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>    <span class="c1">#     print(&quot;AVAL CALLED&quot;)</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>    <span class="c1">#     #return self._data.aval</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>    <span class="c1">#     return jax.core.ShapedArray((),dtype=self._data.dtype)</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>    <span class="c1">#     #return jnp.ones(())</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>    <span class="c1"># @property</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>    <span class="c1"># def T(self):</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>    <span class="c1">#     return NTensor(self._data, *reversed(self._axes_ordered))</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="c1">#</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">        Do einstein summation on two arrays, taking reductions over all shared axes. This is equivalent to</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">        an alias for `dot(self, other)`.</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">        Parameters</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">        ----------</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">        other: ntensor</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">        Returns</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">        -------</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">        result: ntensor</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">            result of Einstein summation on two arrays.</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">        Examples</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">        --------</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([5,1,3],&#39;i&#39;)</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="sd">        &gt;&gt;&gt; A @ B</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">        &lt;ntensor {} 7&gt;</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1],&#39;i&#39;)</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([0,2],&#39;j&#39;)</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">        &gt;&gt;&gt; A @ B</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">        &lt;ntensor {i:2, j:2}</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        [[0 0]</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">         [0 2]]&gt;</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">        See Also</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">        --------</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">        dot</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>        <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>    <span class="k">def</span> <span class="fm">__rmatmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>    <span class="c1"># def __getitem__(self,idx)-&gt;&#39;array&#39;:</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="c1">#     if not isinstance(idx,tuple):</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>    <span class="c1">#         idx = (idx,)</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>    <span class="c1">#     assert builtins.all(isinstance(i,IndexedAxis) for i in idx), &quot;all inputs must be</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>    <span class="c1">#     IndexedAxis&quot;</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="c1">#     return select(self, **{i.axis.name:i.index for i in idx})</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">        Index this array. All indexing follows the One True Rule:</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">        * All axes must be indexed.</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        * All indices are themselves `arrays`.</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">        * The axes of the indices determine the output axes.</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">        * Non-shared axes in indices are orthogonal.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">        * Shared axes in indices are pointwise. (And must therefore have equal lengths!)</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">        That&#39;s it. That&#39;s the only *real* rule. (Cf. numpy&#39;s [insanely complex advanced indexing</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">        rules](https://numpy.org/doc/stable/user/basics.indexing.html#advanced-indexing).) But to</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">        make things nicer, we offer some ergonomic syntactic sugar.</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">        1. If you don&#39;t explicitly index an input axis, it is implicitly fully sliced,</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">        with itself as an output axis.</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">        2. You can slice an input axis and then use that as an index.</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">        3. You can index any axis (input or not) with a slice or 1-d list/tuple/numpy array. This</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">        is treated like a 1-d array with that axis.</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">        Parameters</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">        ----------</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">        kwargs</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">        Returns</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">        -------</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">        out: ntensor</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">        Examples</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">        --------</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">        You *can&#39;t* index arrays without giving names for axes. If you try, you get an error. (I</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">        *told* you this package was uncompromising, right?)</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45],&#39;i&#39;)</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">        &gt;&gt;&gt; A[1] # Nope. No! Doesn&#39;t work!</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">        ...</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">        ValueError: Can&#39;t index NTensor with int. (Remember, A[i] converts to numpy)</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">        You do it like this, always with keywork arguments for axes.</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45],&#39;i&#39;)</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">        &gt;&gt;&gt; A(i=1) # yes!</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">        &lt;ntensor {} 30&gt;</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">        Here are examples illustrating the one true rule</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=5, j=6)</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([1,0],&#39;n&#39;)</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([2,3],&#39;n&#39;)</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index)</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">        {n:2}</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        &gt;&gt;&gt; B(n=0) == A(i=1, j=2)</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        &gt;&gt;&gt; B(n=1) == A(i=0, j=3)</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=5, j=6)</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([1,0],&#39;n&#39;)</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([2,3],&#39;m&#39;)</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index)</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">        {n:2, m:2}</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">        &gt;&gt;&gt; B(n=0, m=0) == A(i=1, j=2)</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">        &gt;&gt;&gt; B(n=0, m=1) == A(i=1, j=3)</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a><span class="sd">        &gt;&gt;&gt; B(n=1, m=0) == A(i=0, j=2)</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">        &gt;&gt;&gt; B(n=1, m=1) == A(i=0, j=3)</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=20, j=20, k=20)</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([[0,1,2],[3,4,5]],&#39;k&#39;,&#39;l&#39;)</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([6,7,8],&#39;l&#39;)</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">        &gt;&gt;&gt; k_index = ntensor([9,10,11,12],&#39;m&#39;)</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index, k=k_index)</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">        {k:2, l:3, m:4}</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">        You can re-use input as output dimensions if you want. This changes nothing! It&#39;s</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">        equivalent to using all new dimensions and then relabeling.</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([[0,1,2],[3,4,5]],&#39;k&#39;,&#39;i&#39;)</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([6,7,8],&#39;i&#39;)</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">        &gt;&gt;&gt; k_index = ntensor([9,10,11,12],&#39;m&#39;)</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index, k=k_index)</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="sd">        {k:2, i:3, m:4}</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">        Examples using syntacic sugar for numbers or 1-d lists/tuple/numpy arrays or slices as</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">        indices</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">        &gt;&gt;&gt; A(i=2)                    # ints work</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">        &lt;ntensor {} 45&gt;</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">        &gt;&gt;&gt; A(i=[2,0,5])              # lists work</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">        &lt;ntensor {i:3} [45 15 90]&gt;</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">        &gt;&gt;&gt; A(i=jnp.array([2,0,5]))    # numpy arrays work</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">        &lt;ntensor {i:3} [45 15 90]&gt;</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">        &gt;&gt;&gt; i = Axis(&#39;i&#39;)</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[6:1:-2])</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">        &lt;ntensor {i:3} [105  75  45]&gt;</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a><span class="sd">        Remember, using numbers or 1D lists/tuples/numpy arrays or slices is just syntactic sugar!</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="sd">        &gt;&gt;&gt; A(i=2)==A(i=ntensor(2))</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="sd">        &gt;&gt;&gt; A(i=jnp.array([2,0,5])) == A(i=ntensor(jnp.array([2,0,5]),&#39;i&#39;))</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">        &lt;ntensor {i:3} [ True  True  True]&gt;</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">        &gt;&gt;&gt; i = Axis(&#39;i&#39;)</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[6:1:-2]) == A(i=ntensor([6,4,2],&#39;i&#39;))</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="sd">        &lt;ntensor {i:3} [ True  True  True]&gt;</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">        You can index an Axis as a shortcut to create a new array.</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a><span class="sd">        &gt;&gt;&gt; i, j = axes()</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">        &gt;&gt;&gt; print(A(i=i[:]).shape)</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">        {i:8}</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[:]) == A</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">        &lt;ntensor {i:8} [ True  True  True  True  True  True  True  True]&gt;</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">        &gt;&gt;&gt; print(A(i=j[[2,0,5]]).shape)</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">        {j:3}</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">        &gt;&gt;&gt; A(i=j[[2,0,5]]) == A(i=ntensor([2,0,5],j))</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">        &lt;ntensor {j:3} [ True  True  True]&gt;</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">        You can also index with a *slice* from another input index. (You can *only* slice axes that exist</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">        in the `NTensor` since otherwise the shape would be ambiguous.)</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>        <span class="k">return</span> <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="p">{</span><span class="n">Axis</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="p">}</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="n">other</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t compare NTensor with </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>                <span class="sa">f</span><span class="s2">&quot;Can&#39;t compare NTensor with shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> to other with shape </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>        <span class="k">return</span> <span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="n">AxisIndices</span> <span class="o">=</span> <span class="n">ntensor</span> <span class="o">|</span> <span class="nb">slice</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="n">IndexedAxis</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="n">AxisLike</span> <span class="o">=</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="n">AxisSetLike</span> <span class="o">=</span> <span class="n">AxisLike</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AxisLike</span><span class="p">]</span> <span class="o">|</span> <span class="n">Set</span><span class="p">[</span><span class="n">AxisLike</span><span class="p">]</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="c1"># Register NTensor as a pytree node ################################################################</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="k">def</span> <span class="nf">ntensor_flatten</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>    <span class="c1"># print(f&quot;flattening {x=}&quot;)</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>    <span class="n">children</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_data</span><span class="p">,)</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>    <span class="n">aux_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">,)</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>    <span class="k">return</span> <span class="n">children</span><span class="p">,</span> <span class="n">aux_data</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="k">def</span> <span class="nf">ntensor_unflatten</span><span class="p">(</span><span class="n">aux_data</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>    <span class="c1"># Do unflattening without calling ntensor.__init__ to avoid issues discussed here:</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>    <span class="c1"># https://docs.jax.dev/en/latest/working-with-pytrees.html</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>    <span class="c1"># in &quot;Custom pytrees and initialization with unexpected values&quot; section</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>    <span class="c1">#print(f&quot;unflattening {aux_data=} {children=}&quot;)</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>    <span class="n">data</span><span class="p">,</span> <span class="o">=</span> <span class="n">children</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>    <span class="n">axes_ordered</span><span class="p">,</span> <span class="o">=</span> <span class="n">aux_data</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>    <span class="n">obj</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">ntensor</span><span class="p">)</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>    <span class="n">obj</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>    <span class="n">obj</span><span class="o">.</span><span class="n">_axes_ordered</span> <span class="o">=</span> <span class="n">axes_ordered</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>    <span class="k">return</span> <span class="n">obj</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a><span class="c1"># Global registration</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="n">jax</span><span class="o">.</span><span class="n">tree_util</span><span class="o">.</span><span class="n">register_pytree_node</span><span class="p">(</span><span class="n">ntensor</span><span class="p">,</span> <span class="n">ntensor_flatten</span><span class="p">,</span> <span class="n">ntensor_unflatten</span><span class="p">)</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a><span class="c1"># def ntensor_flatten(x: ntensor):</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a><span class="c1">#     # print(f&quot;flattening {x=}&quot;)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="c1">#     children = ()</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="c1">#     aux_data = x._data, x._axes_ordered</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a><span class="c1">#     return children, aux_data</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="c1">#</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a><span class="c1">#</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a><span class="c1"># def ntensor_unflatten(aux_data, children):</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a><span class="c1">#     # print(f&quot;unflattening {aux_data=} {children=}&quot;)</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="c1">#     #x, = children</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="c1">#     data, axes = aux_data</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="c1">#     return ntensor(data, *axes)</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="c1">#</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="c1"># # Global registration</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a><span class="c1"># jax.tree_util.register_pytree_node(ntensor, ntensor_flatten, ntensor_unflatten)</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="c1">#</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="c1"># Various quality of life improvements #############################################################</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function to create a bunch of axes at once</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="sd">    Parameters</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">    ----------</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">    *names: str</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">        names to give to each element. pass none if you want them to be inferred</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="sd">    Returns</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">    -------</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">    out_axes: tuple[Axis]</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">        sequence of tuples</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">    Examples</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">    --------</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">    &gt;&gt;&gt; rows, cols, batch = axes(&#39;rows&#39;, &#39;cols&#39;, &#39;batch&#39;) # safe boring redudnancy</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">    &gt;&gt;&gt; rows._name</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">    &#39;rows&#39;</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">    &gt;&gt;&gt; cols._name</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">    &#39;cols&#39;</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">    &gt;&gt;&gt; batch._name</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a><span class="sd">    &#39;batch&#39;</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">    &gt;&gt;&gt; rows, cols, batch = axes() # exciting evil magic</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="sd">    &gt;&gt;&gt; rows._name</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">    &#39;rows&#39;</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">    &gt;&gt;&gt; cols._name</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">    &#39;cols&#39;</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">    &gt;&gt;&gt; batch._name</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">    &#39;batch&#39;</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>    <span class="k">if</span> <span class="n">names</span> <span class="o">==</span> <span class="p">():</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>        <span class="kn">import</span> <span class="nn">varname</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="n">varname</span><span class="o">.</span><span class="n">varname</span><span class="p">(</span><span class="n">multi_vars</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>            <span class="k">return</span> <span class="n">Axis</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="k">def</span> <span class="nf">allclose</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">equal_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>    <span class="c1"># TODO: numpy allclose can only handle 2 inputs</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;2 inputs only&quot;</span><span class="p">)</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>        <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="n">axes</span><span class="p">,</span> <span class="s2">&quot;all axes must be same&quot;</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_axes_ordered</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>    <span class="n">numpy_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="o">*</span><span class="n">axes</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>    <span class="n">rez</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="o">*</span><span class="n">numpy_arrays</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span> <span class="n">equal_nan</span><span class="o">=</span><span class="n">equal_nan</span><span class="p">)</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>        <span class="k">return</span> <span class="n">rez</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>        <span class="k">assert</span> <span class="n">rez</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>        <span class="k">assert</span> <span class="n">rez</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">rez</span><span class="p">)</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a><span class="c1"># Creating arrays # ################################################################################</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="k">def</span> <span class="nf">ones</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function, over just using `np.ones` and then `ntensor`.</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a><span class="sd">    Parameters</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">    ----------</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="sd">    **axes: Dict[str,int]</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a><span class="sd">        Mapping from axes to sizes. Will be converted to axes.</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a><span class="sd">    Returns</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a><span class="sd">    -------</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a><span class="sd">    A: array</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a><span class="sd">        Array with given shape</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a><span class="sd">    Examples</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a><span class="sd">    --------</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a><span class="sd">    &gt;&gt;&gt; A = ones(i=5)</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a><span class="sd">    &gt;&gt;&gt; print(A.shape)</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a><span class="sd">    {i:5}</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="sd">    &gt;&gt;&gt; B = ones(cats=5, dogs=15)</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="sd">    &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">    {cats:5, dogs:15}</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="k">def</span> <span class="nf">ones_like</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>        <span class="n">dtype</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>    <span class="n">str_shape</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">A</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">}</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>    <span class="k">return</span> <span class="n">ones</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="o">**</span><span class="n">str_shape</span><span class="p">)</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="k">def</span> <span class="nf">zeros</span><span class="p">(</span><span class="o">**</span><span class="n">axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function, over just using `np.zeros` and then `array`. Use just like `ones`</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">])</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="k">def</span> <span class="nf">randn</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function, to call `np.random.randn` and then `ntensor`. Use just like</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">    `ones`</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">    Parameters</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">    ----------</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">    **kwargs: int</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">        keyword arguments mapping strings to ints</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">    Returns</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">    -------</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">    out: `ntensor`</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">        random data with requested shape</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">    Examples</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="sd">    --------</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">    &gt;&gt;&gt; A = randn(i=5, j=10, k=100)</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">    &gt;&gt;&gt; A.shape</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">    ShapeDict(i=5, j=10, k=100)</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Axis</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">sizes</span><span class="p">),</span> <span class="o">*</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a><span class="c1"># Random key management ######################################################################################</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a><span class="k">def</span> <span class="nf">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="n">Axis</span><span class="p">):</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a><span class="k">def</span> <span class="nf">random_split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>    <span class="k">assert</span> <span class="n">key</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>    <span class="n">old_axis</span><span class="p">,</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>    <span class="n">jax_key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="n">old_axis</span><span class="p">)</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">new_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>        <span class="n">jax_a</span><span class="p">,</span> <span class="n">jax_b</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">jax_key</span><span class="p">)</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>        <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jax_a</span><span class="p">,</span> <span class="n">old_axis</span><span class="p">),</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jax_b</span><span class="p">,</span> <span class="n">old_axis</span><span class="p">)</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>    <span class="k">elif</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">new_axis</span><span class="p">:</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>        <span class="n">jax_keys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">jax_key</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>        <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jax_keys</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">,</span> <span class="n">old_axis</span><span class="p">)</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;either both n and new_axis must be none or both specified&quot;</span><span class="p">)</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="k">def</span> <span class="nf">random_int</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">):</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;only 1D arrays are supported&quot;</span><span class="p">)</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">minval</span><span class="o">=</span><span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="n">maxval</span><span class="p">))</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a><span class="k">def</span> <span class="nf">random_normal</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;only 1D arrays are supported&quot;</span><span class="p">)</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="c1"># Mangling arrays # ##########################################################################################</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="n">arrays</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ntensor</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="n">Axis</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Concatenate a sequence of NTensors into a NTensor.</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a><span class="sd">    Parameters</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a><span class="sd">    ----------</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a><span class="sd">    arrays: Iterable[ntensor]</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a><span class="sd">        The tensors must have the same shape except in the dimension axis</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a><span class="sd">    axis: str|Axis</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="sd">        The axis along which to be joined</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a><span class="sd">    Returns</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a><span class="sd">    -------</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">    out: ntensor</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a><span class="sd">        The concatenated ntensor</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a><span class="sd">    See Also</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a><span class="sd">    --------</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a><span class="sd">    stack</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a><span class="sd">    Examples</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a><span class="sd">    --------</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([1,2],&#39;i&#39;)</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([3,4],&#39;i&#39;)</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a><span class="sd">    &gt;&gt;&gt; concatenate([A,B], axis=&#39;i&#39;)</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="sd">    &lt;ntensor {i:4} [1 2 3 4]&gt;</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([[1,2],[3,4]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([[5,6],[7,8]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a><span class="sd">    &gt;&gt;&gt; concatenate([A,B],axis=&#39;i&#39;)</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a><span class="sd">    &lt;ntensor {j:2, i:4}</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="sd">    [[1 3 5 7]</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a><span class="sd">     [2 4 6 8]]&gt;</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a><span class="sd">    &gt;&gt;&gt; concatenate((A,B),axis=Axis(&#39;i&#39;))</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a><span class="sd">    &lt;ntensor {j:2, i:4}</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a><span class="sd">    [[1 3 5 7]</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a><span class="sd">     [2 4 6 8]]&gt;</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a><span class="sd">    &gt;&gt;&gt; concatenate([A,B],axis=&#39;j&#39;)</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">    &lt;ntensor {i:2, j:4}</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a><span class="sd">    [[1 2 5 6]</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a><span class="sd">     [3 4 7 8]]&gt;</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>    <span class="n">axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>    <span class="k">return</span> <span class="n">lift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">out_axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">])(</span><span class="n">arrays</span><span class="p">)</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a><span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">arrays</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">ntensor</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="n">Axis</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Join a squence of ntensor along a new axis into a new ntensor.</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a><span class="sd">    Parameters</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a><span class="sd">    ----------</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a><span class="sd">    arrays: Iterable[ntensor]</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a><span class="sd">        The tensors must have the same shape</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a><span class="sd">    axis: str|Axis</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a><span class="sd">        The axis along which to be joined</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a><span class="sd">    Returns</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a><span class="sd">    -------</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a><span class="sd">    out: ntensor</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a><span class="sd">        The concatenated ntensor</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a><span class="sd">    See Also</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a><span class="sd">    --------</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="sd">    concatenate</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a><span class="sd">    Examples</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a><span class="sd">    --------</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor(5)</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor(9)</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a><span class="sd">    &gt;&gt;&gt; stack([A,B],&#39;i&#39;)</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a><span class="sd">    &lt;ntensor {i:2} [5 9]&gt;</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([4,5,6],&#39;i&#39;)</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="sd">    &gt;&gt;&gt; stack([A,B], axis=&#39;j&#39;)</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a><span class="sd">    [[1 4]</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a><span class="sd">     [2 5]</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a><span class="sd">     [3 6]]&gt;</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([4,5,6],&#39;i&#39;)</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a><span class="sd">    &gt;&gt;&gt; stack((A,B), axis=&#39;j&#39;)</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a><span class="sd">    [[1 4]</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a><span class="sd">     [2 5]</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a><span class="sd">     [3 6]]&gt;</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>    <span class="n">axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>    <span class="k">return</span> <span class="n">lift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">[],</span> <span class="n">out_axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">])(</span><span class="n">arrays</span><span class="p">)</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a><span class="c1"># Lifting  #########################################################################################</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a><span class="k">def</span> <span class="nf">parse_lift_str</span><span class="p">(</span><span class="n">axes_str</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">):</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a lift string</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a><span class="sd">    Parameters</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a><span class="sd">    ----------</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a><span class="sd">    axes_str: str</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a><span class="sd">    Returns</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a><span class="sd">    -------</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a><span class="sd">    in_axes: Tuple[Axis] | Tuple[Tuple[Axis]]</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a><span class="sd">        the in axes</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>    <span class="k">if</span> <span class="n">axes_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">in_axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">out_axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t provide both </span><span class="si">{</span><span class="n">axes_str</span><span class="si">=}</span><span class="s2"> and </span><span class="si">{</span><span class="n">in_axes</span><span class="si">=}</span><span class="s2">/</span><span class="si">{</span><span class="n">out_axes</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>    <span class="k">if</span> <span class="n">axes_str</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">in_axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">out_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>    <span class="k">elif</span> <span class="n">axes_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>        <span class="k">return</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>    <span class="k">if</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes_str</span><span class="p">:</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>        <span class="n">axes_str</span> <span class="o">=</span> <span class="n">axes_str</span> <span class="o">+</span> <span class="s1">&#39;-&gt;&#39;</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>    <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">axes_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">)</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>    <span class="k">def</span> <span class="nf">get_ax_tuple</span><span class="p">(</span><span class="n">part</span><span class="p">):</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>    <span class="k">def</span> <span class="nf">my_split</span><span class="p">(</span><span class="n">stuff</span><span class="p">):</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>        <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">stuff</span><span class="p">:</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">get_ax_tuple</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">stuff</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>            <span class="k">return</span> <span class="n">get_ax_tuple</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>    <span class="k">return</span> <span class="n">my_split</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="n">my_split</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a><span class="k">def</span> <span class="nf">lift_pytree</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(),</span> <span class="n">out_axes</span><span class="o">=</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Lower a namedtensor function into a function that operates on jax arrays.</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a><span class="sd">    Parameters</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a><span class="sd">    ----------</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a><span class="sd">    fun</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a><span class="sd">        the function to be lifted</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="sd">    in_axes</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a><span class="sd">        Input axes. This can be A sequence of sequences of Axis, of the same length as the number of</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a><span class="sd">        args. Or, it can just be a sequence of Axis, in which case all NTensor arguments are mapped</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a><span class="sd">        over the same args.</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a><span class="sd">    out_axes</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a><span class="sd">        The output axes</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a><span class="sd">    Returns</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a><span class="sd">    -------</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a><span class="sd">    new fun</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a><span class="sd">        keyword args are passed unchanged.</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">ntensor_args</span><span class="p">):</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>        <span class="c1">#ntensor_args = ensure_ntensor_tree(ntensor_args)</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>        <span class="k">def</span> <span class="nf">my_array</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>            <span class="k">if</span> <span class="n">in_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>                <span class="k">return</span> <span class="n">arg</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>            <span class="n">ntensor_arg</span> <span class="o">=</span> <span class="n">ensure_ntensor</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>            <span class="k">return</span> <span class="n">ntensor_arg</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="o">*</span><span class="n">in_axes</span><span class="p">)</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">tree_map_axes</span><span class="p">(</span><span class="n">my_array</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">ntensor_args</span><span class="p">)</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>        <span class="k">def</span> <span class="nf">my_ntensor</span><span class="p">(</span><span class="n">out_axes</span><span class="p">,</span> <span class="n">numpy_out</span><span class="p">):</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>            <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">numpy_out</span><span class="p">,</span> <span class="o">*</span><span class="n">out_axes</span><span class="p">)</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>        <span class="k">return</span> <span class="n">tree_map_axes</span><span class="p">(</span><span class="n">my_ntensor</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>    <span class="k">return</span> <span class="n">wrapped</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a><span class="k">def</span> <span class="nf">lift</span><span class="p">(</span><span class="n">jax_fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">axes_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>         <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>    <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span> <span class="o">=</span> <span class="n">parse_lift_str</span><span class="p">(</span><span class="n">axes_str</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>    <span class="n">fun</span> <span class="o">=</span> <span class="n">lift_pytree</span><span class="p">(</span><span class="n">jax_fun</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>    <span class="k">if</span> <span class="n">batched</span><span class="p">:</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>        <span class="k">if</span> <span class="n">is_sequence_of_type</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">in_axes</span><span class="p">)</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">in_ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">in_ax</span> <span class="ow">in</span> <span class="n">in_axes</span><span class="p">])</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>        <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>        <span class="k">return</span> <span class="n">fun</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a><span class="c1"># def abstract_lift(jax_fun, in_ints:Tuple[Tuple[int]], out_ints:Tuple[Tuple[int]])-&gt;Callable:</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a><span class="c1">#     def fun(*args):</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a><span class="c1">#         int2ax = WriteOnceDict()</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a><span class="c1">#         for arg, my_in_ints in zip(args, in_ints, strict=True):</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a><span class="c1">#             for ax, i in zip(arg._axe)</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a><span class="c1"># Lowering #########################################################################################</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="c1"># def tree_map_axes(f, axes, *other):</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="c1">#     def mini_eval(leaf, *remaining_subtrees):</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="c1">#         return jax.tree_map(lambda *leaves: f(leaf, *leaves), *remaining_subtrees,</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a><span class="c1">#                             is_leaf=is_ntensor)</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="c1">#</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="c1">#     is_axis_sequence = lambda x: is_sequence_of_type(x, Axis)</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="c1">#     return jax.tree_util.tree_map(mini_eval, axes, *other, is_leaf=is_axis_sequence)</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="k">def</span> <span class="nf">tree_map_axes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span><span class="p">):</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>    <span class="k">def</span> <span class="nf">mini_eval</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="o">*</span><span class="n">remaining_subtrees</span><span class="p">):</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">leaves</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="o">*</span><span class="n">leaves</span><span class="p">),</span> <span class="o">*</span><span class="n">remaining_subtrees</span><span class="p">,</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>                            <span class="n">is_leaf</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">is_ntensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>    <span class="n">is_axis_sequence</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">is_sequence_of_type</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Axis</span><span class="p">)</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_util</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="n">mini_eval</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_axis_sequence</span><span class="p">)</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a><span class="k">def</span> <span class="nf">lower_pytree</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">in_axes_pytree</span><span class="p">,</span> <span class="n">out_axes_pytree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Lower a namedtensor function into a function that operates on jax arrays.</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a><span class="sd">    Parameters</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a><span class="sd">    ----------</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a><span class="sd">    fun</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a><span class="sd">        the function to be lowered</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a><span class="sd">    in_axes</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a><span class="sd">        Input axes. This can be a pytree of Sequences of Axis, where the pytree has the same structure as</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a><span class="sd">        the args and each Sequence has length equal to the number of Axis or None (indicating an argument</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a><span class="sd">        that should not be converted). Or it can be a pytree prefix, in which case everything below is</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a><span class="sd">        treated with the same axes.</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a><span class="sd">    out_axes</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a><span class="sd">        The output axes</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a><span class="sd">    Returns</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a><span class="sd">    -------</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a><span class="sd">    new fun</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a><span class="sd">        keyword args are passed unchanged.</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">numpy_args</span><span class="p">):</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>        <span class="k">def</span> <span class="nf">my_ntensor</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="n">numpy_arg</span><span class="p">):</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>            <span class="k">if</span> <span class="n">in_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>                <span class="k">return</span> <span class="n">numpy_arg</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_sequence_of_type</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="p">(</span><span class="n">Axis</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>                    <span class="sa">f</span><span class="s2">&quot;lower found leaf node where </span><span class="si">{</span><span class="n">in_axes</span><span class="si">=}</span><span class="s2"> is not sequence of Axis/str&quot;</span><span class="p">)</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>            <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">numpy_arg</span><span class="p">,</span> <span class="o">*</span><span class="n">in_axes</span><span class="p">)</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>        <span class="c1"># print(f&quot;{fun=} {in_axes_pytree=} {out_axes_pytree=} {numpy_args=}&quot;)</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">tree_map_axes</span><span class="p">(</span><span class="n">my_ntensor</span><span class="p">,</span> <span class="n">in_axes_pytree</span><span class="p">,</span> <span class="n">numpy_args</span><span class="p">)</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>        <span class="k">def</span> <span class="nf">my_array</span><span class="p">(</span><span class="n">out_axes</span><span class="p">,</span> <span class="n">ntensor_out</span><span class="p">):</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>            <span class="k">return</span> <span class="n">ntensor_out</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="o">*</span><span class="n">out_axes</span><span class="p">)</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>        <span class="k">return</span> <span class="n">tree_map_axes</span><span class="p">(</span><span class="n">my_array</span><span class="p">,</span> <span class="n">out_axes_pytree</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>    <span class="k">return</span> <span class="n">wrapped</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a><span class="k">def</span> <span class="nf">lower</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">axes_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>    <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span> <span class="o">=</span> <span class="n">parse_lift_str</span><span class="p">(</span><span class="n">axes_str</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>    <span class="k">return</span> <span class="n">lower_pytree</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a><span class="c1"># Dot ##############################################################################################</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a><span class="k">def</span> <span class="nf">classify_axis_names</span><span class="p">(</span><span class="n">axes1</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">axes2</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>    <span class="n">shared</span> <span class="o">=</span> <span class="n">axes1</span> <span class="o">&amp;</span> <span class="n">axes2</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>    <span class="n">only1</span> <span class="o">=</span> <span class="n">axes1</span> <span class="o">-</span> <span class="n">shared</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>    <span class="n">only2</span> <span class="o">=</span> <span class="n">axes2</span> <span class="o">-</span> <span class="n">shared</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>    <span class="k">return</span> <span class="n">shared</span><span class="p">,</span> <span class="n">only1</span><span class="p">,</span> <span class="n">only2</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a><span class="k">def</span> <span class="nf">n2c</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts an integer to its corresponding lowercase character.&quot;&quot;&quot;</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">:</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">num</span> <span class="o">+</span> <span class="mi">97</span><span class="p">)</span>  <span class="c1"># 97 is the ASCII value for &#39;a&#39;</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid input&quot;</span><span class="p">)</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a><span class="k">def</span> <span class="nf">count_axes</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>    <span class="n">ax_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>    <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">:</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ax_counts</span><span class="p">:</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>                <span class="n">ax_counts</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>                <span class="n">ax_counts</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>    <span class="k">return</span> <span class="n">ax_counts</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a><span class="k">def</span> <span class="nf">get_remaining_axes</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span><span class="p">]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">()):</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the axes that will remain after doing einsum.</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a><span class="sd">    Axes are ordered as encountered in the arrays.</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a><span class="sd">    Examples</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a><span class="sd">    --------</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([[0,1,2],[3,4,5]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([[6,7,8],[9,10,11]],&#39;j&#39;,&#39;k&#39;)</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a><span class="sd">    &gt;&gt;&gt; get_remaining_axes(A, B)</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a><span class="sd">    (Axis(&#39;i&#39;), Axis(&#39;k&#39;))</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a><span class="sd">    &gt;&gt;&gt; get_remaining_axes(A, B, keep={&#39;j&#39;})</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a><span class="sd">    (Axis(&#39;i&#39;), Axis(&#39;j&#39;), Axis(&#39;k&#39;))</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>    <span class="n">ax_counts</span> <span class="o">=</span> <span class="n">count_axes</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">)</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>    <span class="c1">#print(f&quot;{ax_counts=}&quot;)</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>    <span class="n">remaining_axes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>    <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">:</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remaining_axes</span><span class="p">:</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>                <span class="k">if</span> <span class="n">ax_counts</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">keep</span><span class="p">:</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>                    <span class="n">remaining_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">remaining_axes</span><span class="p">)</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a><span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n">ntensor</span> <span class="o">|</span> <span class="n">Number</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span><span class="p">]</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Do inner products or outer products or matrix multiplication or tensor multiplication or einstein</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a><span class="sd">    summation or batched versions of any of these.</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a><span class="sd">    Parameters</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a><span class="sd">    ----------</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="sd">    arrays</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a><span class="sd">        The `NTensor` objects to operate on. In principle, the order does not matter. (Though it may affect</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a><span class="sd">        the internal layout of the data.)</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a><span class="sd">    keep</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a><span class="sd">        Any shared indices you don&#39;t want reduced.</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a><span class="sd">    Returns</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a><span class="sd">    -------</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a><span class="sd">    out</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a><span class="sd">        Reduced `NTensor`</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a><span class="sd">    Examples</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a><span class="sd">    --------</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a><span class="sd">    Inner product</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a><span class="sd">    &gt;&gt;&gt; a = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a><span class="sd">    &gt;&gt;&gt; b = ntensor([10,0,100],&#39;i&#39;)</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a><span class="sd">    &gt;&gt;&gt; dot(a,b)</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a><span class="sd">    &lt;ntensor {} 310&gt;</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a><span class="sd">    Elementwise product</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a><span class="sd">    &gt;&gt;&gt; dot(a,b,keep={&#39;i&#39;})</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a><span class="sd">    &lt;ntensor {i:3} [ 10   0 300]&gt;</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a><span class="sd">    Outer product</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a><span class="sd">    &gt;&gt;&gt; a = ntensor([0,10],&#39;i&#39;)</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a><span class="sd">    &gt;&gt;&gt; b = ntensor([1,2,3],&#39;j&#39;)</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a><span class="sd">    &gt;&gt;&gt; dot(a,b)</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a><span class="sd">    &lt;ntensor {i:2, j:3}</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a><span class="sd">    [[ 0  0  0]</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a><span class="sd">     [10 20 30]]&gt;</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a><span class="sd">    Matrix-vector multiplication</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a><span class="sd">    &gt;&gt;&gt; a = randn(i=5, j=4)</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a><span class="sd">    &gt;&gt;&gt; b = randn(j=4)</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b).shape</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a><span class="sd">    ShapeDict(i=5)</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a><span class="sd">    &gt;&gt;&gt; dot(b, a).shape</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a><span class="sd">    ShapeDict(i=5)</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b) == dot(b, a)</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a><span class="sd">    &lt;ntensor {i:5} [ True  True  True  True  True]&gt;</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a><span class="sd">    &gt;&gt;&gt; c = randn(i=5)</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a><span class="sd">    &gt;&gt;&gt; dot(c, a).shape</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a><span class="sd">    ShapeDict(j=4)</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a><span class="sd">    &gt;&gt;&gt; dot(c, a, b).shape</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a><span class="sd">    ShapeDict()</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a><span class="sd">    Matrix-matrix multiplication</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a><span class="sd">    &gt;&gt;&gt; a = randn(i=5, j=6)</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a><span class="sd">    &gt;&gt;&gt; b = randn(j=6, k=7)</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b).shape</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a><span class="sd">    ShapeDict(i=5, k=7)</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a><span class="sd">    Tensor multiplication / Einstein summation</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a><span class="sd">    &gt;&gt;&gt; a = randn(i=5, j=6, k=7)</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a><span class="sd">    &gt;&gt;&gt; b = randn(j=6, l=8)</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a><span class="sd">    &gt;&gt;&gt; c = randn(k=7, l=8, m=9)</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b, c).shape</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a><span class="sd">    ShapeDict(i=5, m=9)</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b, c, keep={&#39;j&#39;}).shape</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a><span class="sd">    ShapeDict(i=5, j=6, m=9)</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b, c, keep={&#39;k&#39;,&#39;l&#39;}).shape</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a><span class="sd">    ShapeDict(i=5, k=7, l=8, m=9)</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>    <span class="n">arrays</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>    <span class="n">keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_sequence_of_type</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Arguments to do must be sequence of NTensors (got </span><span class="si">{arrays}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>    <span class="n">all_axes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">))</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>    <span class="n">remaining_axes</span> <span class="o">=</span> <span class="n">get_remaining_axes</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="n">keep</span><span class="p">)</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>    <span class="n">a2c</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">all_axes</span><span class="p">:</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>        <span class="n">a2c</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">n2c</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>    <span class="n">array_chars</span> <span class="o">=</span> <span class="p">[[</span><span class="n">a2c</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">]</span> <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>    <span class="c1"># result should keep all non-shared dims, A first then B</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>    <span class="n">out_chars</span> <span class="o">=</span> <span class="p">[</span><span class="n">a2c</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">remaining_axes</span><span class="p">]</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>    <span class="n">array_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ar_chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">ar_chars</span> <span class="ow">in</span> <span class="n">array_chars</span><span class="p">]</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>    <span class="n">out_chars</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_chars</span><span class="p">)</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>    <span class="n">subscripts</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>    <span class="k">for</span> <span class="n">ar_chars</span> <span class="ow">in</span> <span class="n">array_chars</span><span class="p">:</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>        <span class="n">subscripts</span> <span class="o">+=</span> <span class="n">ar_chars</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>    <span class="n">subscripts</span> <span class="o">=</span> <span class="n">subscripts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>    <span class="n">subscripts</span> <span class="o">+=</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="o">+</span> <span class="n">out_chars</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>    <span class="n">out_data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">subscripts</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">_data</span> <span class="k">for</span> <span class="n">A</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">])</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="o">*</span><span class="n">remaining_axes</span><span class="p">)</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a><span class="c1"># vmap #############################################################################################</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a><span class="k">def</span> <span class="nf">prepare_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">):</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>    <span class="n">args_treedef</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">structure</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>    <span class="n">args_flat</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">builtins</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">in_axis</span> <span class="ow">in</span> <span class="n">arg</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args_flat</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)):</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>            <span class="sa">f</span><span class="s2">&quot;in axis </span><span class="si">{</span><span class="n">in_axis</span><span class="si">}</span><span class="s2"> doesn&#39;t appear in args with axes </span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>    <span class="n">numpy_in_axes_flat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>    <span class="n">numpy_args_flat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>    <span class="n">example_args_flat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>    <span class="n">in_axes_flat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args_flat</span><span class="p">:</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>            <span class="n">my_example_arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>            <span class="n">my_numpy_in_axis</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>            <span class="n">my_in_axes</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>            <span class="n">my_numpy_arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>        <span class="k">elif</span> <span class="n">in_axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arg</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>            <span class="n">my_example_arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>            <span class="n">my_numpy_in_axis</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>            <span class="n">my_in_axes</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_axes_ordered</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>            <span class="n">my_numpy_arg</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="o">*</span><span class="n">my_in_axes</span><span class="p">)</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>            <span class="n">where</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">in_axis</span><span class="p">)</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="n">where</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>            <span class="n">my_example_arg_numpy</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="o">*</span><span class="n">ind</span><span class="p">]</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>            <span class="n">my_in_axes</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">[:</span><span class="n">where</span><span class="p">]</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">[</span><span class="n">where</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>            <span class="n">my_example_arg</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">my_example_arg_numpy</span><span class="p">,</span> <span class="o">*</span><span class="n">my_in_axes</span><span class="p">)</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>            <span class="n">my_numpy_in_axis</span> <span class="o">=</span> <span class="n">where</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>            <span class="n">my_numpy_arg</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_data</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>        <span class="n">example_args_flat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_example_arg</span><span class="p">)</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>        <span class="n">numpy_in_axes_flat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_numpy_in_axis</span><span class="p">)</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>        <span class="n">in_axes_flat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_in_axes</span><span class="p">)</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>        <span class="n">numpy_args_flat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_numpy_arg</span><span class="p">)</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>    <span class="n">example_args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">unflatten</span><span class="p">(</span><span class="n">args_treedef</span><span class="p">,</span> <span class="n">example_args_flat</span><span class="p">)</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>    <span class="n">numpy_in_axes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">unflatten</span><span class="p">(</span><span class="n">args_treedef</span><span class="p">,</span> <span class="n">numpy_in_axes_flat</span><span class="p">)</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>    <span class="n">in_axes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">unflatten</span><span class="p">(</span><span class="n">args_treedef</span><span class="p">,</span> <span class="n">in_axes_flat</span><span class="p">)</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>    <span class="n">numpy_args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">unflatten</span><span class="p">(</span><span class="n">args_treedef</span><span class="p">,</span> <span class="n">numpy_args_flat</span><span class="p">)</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>    <span class="k">return</span> <span class="n">example_args</span><span class="p">,</span> <span class="n">numpy_args</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">numpy_in_axes</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a><span class="k">def</span> <span class="nf">vmap_eval</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">:</span> <span class="n">AxisLike</span><span class="p">):</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a><span class="sd">    Here&#39;s one very solid concept. You can define `vmap_eval(fun, [A_1, ..., A_N], [ax_1, ...,</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a><span class="sd">    ax_N], out_ax)` and this will do the obvious thing provided and work provided that:</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a><span class="sd">    1. `fun(A_1(ax_1=0), ..., A_N(ax_N=0))` works.</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a><span class="sd">    2. `out_ax not in fun(A_1(ax_1=0), ..., A_N(ax_N=0)).axes`</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a><span class="sd">    2. `A_1.shape[ax_1] == ... == A_N.shape[ax_N]`.</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a><span class="sd">    The output will have shape `fun(A_1(ax_1=0), ..., A_N(ax_N=0)).shape | {out_ax: A_1.shape[</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a><span class="sd">    ax_1]}`.  You can easily generalize this to allow `ax_n=None`. (At least one `ax_n` must be</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a><span class="sd">    non-none.)</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a><span class="sd">    Clearly in *principle*, all batched operations could be reduced to this.</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a><span class="sd">    Examples</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a><span class="sd">    --------</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([3,4,5],&#39;i&#39;)</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a><span class="sd">    &gt;&gt;&gt; vmap_eval(add_scalar, (A, B), &#39;i&#39;)</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a><span class="sd">    &lt;ntensor {i:3} [3 5 7]&gt;</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor(3)</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a><span class="sd">    &gt;&gt;&gt; vmap_eval(add_scalar, (A, B), &#39;i&#39;)</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a><span class="sd">    &lt;ntensor {i:3} [3 4 5]&gt;</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([3,4,5],&#39;i&#39;)</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a><span class="sd">    &gt;&gt;&gt; myfun = lambda a, b: a+b*ntensor([0,10],&#39;j&#39;)</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a><span class="sd">    &gt;&gt;&gt; vmap_eval(myfun, (A, B), &#39;i&#39;)</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a><span class="sd">    [[ 0 30]</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a><span class="sd">     [ 1 41]</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a><span class="sd">     [ 2 52]]&gt;</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>    <span class="c1"># TODO: tolerate non-ntensor inputs</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>    <span class="c1">#args = ensure_ntensor_tree(args)</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>    <span class="n">in_axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">in_axis</span><span class="p">)</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>    <span class="c1">#args_treedef = jax.tree.structure(args, is_leaf=is_ntensor)</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>    <span class="n">args_flat</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">builtins</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">in_axis</span> <span class="ow">in</span> <span class="n">arg</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args_flat</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)):</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>            <span class="sa">f</span><span class="s2">&quot;in axis </span><span class="si">{</span><span class="n">in_axis</span><span class="si">}</span><span class="s2"> doesn&#39;t appear in args with axes </span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>    <span class="n">example_args</span><span class="p">,</span> <span class="n">numpy_args</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">numpy_in_axes</span> <span class="o">=</span> <span class="n">prepare_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">)</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>    <span class="k">def</span> <span class="nf">convert1</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>            <span class="k">return</span> <span class="n">a</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>            <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t auto-convert data with &gt; 0 dims to ntensor&quot;</span><span class="p">)</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>            <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>    <span class="k">def</span> <span class="nf">myfun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>        <span class="s2">&quot;like fun except converts scalars to scalar ntensor&quot;</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert1</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>    <span class="n">example_out</span> <span class="o">=</span> <span class="n">myfun</span><span class="p">(</span><span class="o">*</span><span class="n">example_args</span><span class="p">)</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>    <span class="k">if</span> <span class="n">builtins</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">in_axis</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">example_out</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)]):</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>            <span class="sa">f</span><span class="s2">&quot;Can&#39;t vmap function over </span><span class="si">{</span><span class="n">in_axis</span><span class="si">=}</span><span class="s2"> with function that returns same mapped axis.&quot;</span><span class="p">)</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>    <span class="n">out_axes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">arg</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">,</span> <span class="n">example_out</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>    <span class="n">numpy_fun</span> <span class="o">=</span> <span class="n">lower_pytree</span><span class="p">(</span><span class="n">myfun</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>    <span class="n">numpy_out</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">numpy_fun</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="n">numpy_in_axes</span><span class="p">)(</span><span class="o">*</span><span class="n">numpy_args</span><span class="p">)</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>        <span class="k">lambda</span> <span class="n">numpy_o</span><span class="p">,</span> <span class="n">example_o</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">numpy_o</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">,</span> <span class="o">*</span><span class="n">example_o</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">),</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>        <span class="n">numpy_out</span><span class="p">,</span> <span class="n">example_out</span><span class="p">)</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>    <span class="k">return</span> <span class="n">out</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a><span class="k">def</span> <span class="nf">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">:</span> <span class="n">AxisLike</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AxisLike</span><span class="p">]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(),</span> <span class="n">other</span><span class="p">:</span> <span class="kc">None</span><span class="o">|</span><span class="n">Iterable</span><span class="p">[</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>    <span class="n">AxisLike</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>        <span class="n">Callable</span><span class="p">):</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implements almost all of vmap. The only difference here is that for simplicity we require</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a><span class="sd">    that in_axes and out_ax are provided in the wrapper call.</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a><span class="sd">    Parameters</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a><span class="sd">    ----------</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a><span class="sd">    fun</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a><span class="sd">        The function to be vmapped</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a><span class="sd">    in_axes</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a><span class="sd">        What input axis to map each argument over. If just given a single axis, all arguments that</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a><span class="sd">        are `array`s and contain that axis are mapped over it and all other arguments are mapped</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a><span class="sd">        over None.</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a><span class="sd">    other</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a><span class="sd">        iterable of other axes or None. If None (default), ignored. Otherwise, used as a check: all axes</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a><span class="sd">        that appear in any argument must either appear in in_axes or other.</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a><span class="sd">    Returns</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a><span class="sd">    -------</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a><span class="sd">    vfun</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a><span class="sd">        vmapped function</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a><span class="sd">    Examples</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a><span class="sd">    --------</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([3,4,5],&#39;i&#39;)</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a><span class="sd">    &gt;&gt;&gt; vmap(add_scalar, &#39;i&#39;)(A, B)</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a><span class="sd">    &lt;ntensor {i:3} [3 5 7]&gt;</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor(3)</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a><span class="sd">    &gt;&gt;&gt; vmap(add_scalar, &#39;i&#39;)(A, B)</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a><span class="sd">    &lt;ntensor {i:3} [3 4 5]&gt;</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([10,20],&#39;j&#39;)</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a><span class="sd">    &gt;&gt;&gt; vmap(add_scalar, [&#39;i&#39;,&#39;j&#39;])(A, B)</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a><span class="sd">    [[10 20]</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a><span class="sd">     [11 21]</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a><span class="sd">     [12 22]]&gt;</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([3,4,5],&#39;i&#39;)</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a><span class="sd">    &gt;&gt;&gt; myfun = lambda a, b: a+b*ntensor([0,10],&#39;j&#39;)</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a><span class="sd">    &gt;&gt;&gt; vmap(myfun, &#39;i&#39;)(A, B)</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a><span class="sd">    [[ 0 30]</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a><span class="sd">     [ 1 41]</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a><span class="sd">     [ 2 52]]&gt;</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>    <span class="c1"># if in_axes=={} (a dict), let&#39;s be forgiving</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="n">AxisLike</span><span class="p">):</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>        <span class="n">in_axes</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_axes</span><span class="p">,)</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>    <span class="n">flat_in_axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">in_axes</span><span class="p">)</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>    <span class="c1">#print(f&quot;vmap called: {in_axes=}&quot;)</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>            <span class="n">remaining</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remaining axes </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="s2"> not equal to provided other=</span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>        <span class="k">if</span> <span class="n">flat_in_axes</span> <span class="o">==</span> <span class="p">():</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>            <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>            <span class="n">first</span> <span class="o">=</span> <span class="n">flat_in_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>            <span class="k">return</span> <span class="n">vmap_eval</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>            <span class="n">first</span> <span class="o">=</span> <span class="n">flat_in_axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>            <span class="n">rest</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">flat_in_axes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>            <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">first</span><span class="p">),</span> <span class="n">rest</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>    <span class="k">return</span> <span class="n">wrapped</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a><span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AxisLike</span><span class="p">]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(),</span> <span class="n">other</span><span class="p">:</span><span class="kc">None</span><span class="o">|</span><span class="n">Iterable</span><span class="p">[</span><span class="n">AxisLike</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>        <span class="n">Callable</span><span class="p">):</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a><span class="sd">    Create a batched version of a function</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a><span class="sd">    Parameters</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a><span class="sd">    ----------</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a><span class="sd">    fun</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a><span class="sd">        function to be batched</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a><span class="sd">    axes: Set[Axis|Str]</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a><span class="sd">        axes to be batched. Must be an `Axis` or str.</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a><span class="sd">    other:</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a><span class="sd">        optional: All other axes (for checking only)</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a><span class="sd">    Returns</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a><span class="sd">    -------</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a><span class="sd">    new_fun</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a><span class="sd">        batched function</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>    <span class="k">return</span> <span class="n">wrapped</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a><span class="k">def</span> <span class="nf">get_common_axes</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>    <span class="n">common_axes</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)])</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ax</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span> <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">common_axes</span><span class="p">)</span> <span class="c1"># preserve original order</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a><span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap a function so it can LATER be batched or vmapped by providing `axes` or `vmap_axes`</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a><span class="sd">    arguments.</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a><span class="sd">    `wrap(fun)(A, B, axes={i,j})` is equivalent to `batch(fun, {i,j})(A, B)`</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a><span class="sd">    `wrap(fun)(A, B, vmap={k,l})` is equivalent to `vmap(fun, {k,l})(A, B)`</span>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a><span class="sd">    `wrap(fun)(A, B, axes={i,j}, vmap={k,l})` is equivalent to `vmap(fun, {k,l}, other={i,j})(A, B)`</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>    <span class="n">vmap_fun</span> <span class="o">=</span> <span class="n">vmap</span>  <span class="c1"># gets shadowed below</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>            <span class="n">fun_with_kwargs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>                <span class="k">return</span> <span class="n">fun_with_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun_with_kwargs</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun_with_kwargs</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>    <span class="k">return</span> <span class="n">wrapped</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a><span class="c1"># Scan #########################################################################################</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a><span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">):</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>    <span class="n">in_axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">in_axis</span><span class="p">)</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>    <span class="c1"># TODO: put in_axes in dimension 0 so scan can handle it</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>    <span class="c1"># TODO: shield arguments that don&#39;t contain given dimension</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>    <span class="n">example_x</span><span class="p">,</span> <span class="n">xs_numpy</span><span class="p">,</span> <span class="n">x_in_axes</span><span class="p">,</span> <span class="n">x_in_axes_numpy</span> <span class="o">=</span> <span class="n">prepare_args</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">)</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>    <span class="n">example_carry</span><span class="p">,</span> <span class="n">example_y</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">example_x</span><span class="p">)</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>    <span class="n">out_axes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">arg</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">,</span> <span class="p">(</span><span class="n">example_carry</span><span class="p">,</span> <span class="n">example_y</span><span class="p">),</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>    <span class="k">if</span> <span class="n">builtins</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">in_axis</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)):</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Init can&#39;t contain scanned Axis&quot;</span><span class="p">)</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>    <span class="n">init_in_axes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>    <span class="n">init_numpy</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>    <span class="n">in_axes</span> <span class="o">=</span> <span class="p">(</span><span class="n">init_in_axes</span><span class="p">,</span> <span class="n">x_in_axes</span><span class="p">)</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>    <span class="n">numpy_fun</span> <span class="o">=</span> <span class="n">lower_pytree</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>    <span class="n">numpy_carry</span><span class="p">,</span> <span class="n">numpy_ys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">numpy_fun</span><span class="p">,</span> <span class="n">init_numpy</span><span class="p">,</span> <span class="n">xs_numpy</span><span class="p">)</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>    <span class="n">carry</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>        <span class="k">lambda</span> <span class="n">numpy_c</span><span class="p">,</span> <span class="n">init_leaf</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">numpy_c</span><span class="p">,</span> <span class="o">*</span><span class="n">init_leaf</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">),</span> <span class="n">numpy_carry</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>    <span class="n">ys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>        <span class="k">lambda</span> <span class="n">numpy_o</span><span class="p">,</span> <span class="n">example_o</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">numpy_o</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">,</span> <span class="o">*</span><span class="n">example_o</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">),</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>        <span class="n">numpy_ys</span><span class="p">,</span> <span class="n">example_y</span><span class="p">)</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>    <span class="k">return</span> <span class="n">carry</span><span class="p">,</span> <span class="n">ys</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a><span class="c1"># Indexing #########################################################################################</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a><span class="k">def</span> <span class="nf">select_output_shape</span><span class="p">(</span><span class="n">input_shape</span><span class="p">:</span> <span class="n">ShapeDict</span><span class="p">,</span> <span class="n">axis_shapes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Axis</span><span class="p">,</span> <span class="n">ShapeDict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ShapeDict</span><span class="p">:</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;(Not intended for end usage.) Given an input shape and shapes for each axis, compute output</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a><span class="sd">    shape. This function isn&#39;t intended for end usage, so it is very picky about inputs. But it</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a><span class="sd">    might be useful for understanding what&#39;s happening under the hood.</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a><span class="sd">    Parameters</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a><span class="sd">    ----------</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a><span class="sd">    input_shape: ShapeDict</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a><span class="sd">        The shape of the array to be selected from</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a><span class="sd">    axis_shapes: Dict[Axis, ShapeDict]</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a><span class="sd">        The shapes for each Axis in the ShapeDict. All axes from input_shape must be included.</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a><span class="sd">        (Notice that because it&#39;s a dict of dicts, repeated axes are impossible.)</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a><span class="sd">    Returns</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a><span class="sd">    -------</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a><span class="sd">    output_shape: ShapeDict</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a><span class="sd">        the shape of the output</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a><span class="sd">    Examples</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a><span class="sd">    --------</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a><span class="sd">    The most basic usage is to resample a single dimension.</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a><span class="sd">    &gt;&gt;&gt; i,j,k,l = axes()</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a><span class="sd">    &gt;&gt;&gt; input_shape = ShapeDict(i=3)</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a><span class="sd">    &gt;&gt;&gt; input_shape</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a><span class="sd">    ShapeDict(i=3)</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a><span class="sd">    &gt;&gt;&gt; axis_shapes = {i:ShapeDict(i=5)}</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a><span class="sd">    &gt;&gt;&gt; print(axis_shapes)</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a><span class="sd">    {Axis(&#39;i&#39;): ShapeDict(i=5)}</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, axis_shapes)</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a><span class="sd">    ShapeDict(i=5)</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a><span class="sd">    An input dimension can be sent to itself or to a new dimension.</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, {i:ShapeDict(i=5)})</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a><span class="sd">    ShapeDict(i=5)</span>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, {i:ShapeDict(j=6)})</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a><span class="sd">    ShapeDict(j=6)</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a><span class="sd">    An input dimension can be expanded into multiple output dimensions.</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, {i:ShapeDict(j=4, k=5)})</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a><span class="sd">    ShapeDict(j=4, k=5)</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a><span class="sd">    You *can* include input dimensions in output dimensions.</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, {i:ShapeDict(j=3, i=5)})</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a><span class="sd">    ShapeDict(j=3, i=5)</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a><span class="sd">    You can collapse multiple axes together</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a><span class="sd">    &gt;&gt;&gt; input_shape = ShapeDict(i=3, j=4)</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a><span class="sd">    &gt;&gt;&gt; axis_shapes = {i:ShapeDict(k=3), j:ShapeDict(k=3)}</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, axis_shapes)</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a><span class="sd">    ShapeDict(k=3)</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a><span class="sd">    You can also do slightly crazy stuff.</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a><span class="sd">    &gt;&gt;&gt; input_shape = ShapeDict(i=3, j=4)</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a><span class="sd">    &gt;&gt;&gt; axis_shapes = {i:ShapeDict(k=5,i=6), j:ShapeDict(i=6,l=7)}</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, axis_shapes)</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a><span class="sd">    ShapeDict(k=5, i=6, l=7)</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a><span class="sd">    If you fail to give a shape for an input axis, you get an error.</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a><span class="sd">    &gt;&gt;&gt; input_shape = ShapeDict(i=3)</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, {})</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a><span class="sd">    Traceback (most recent call last):</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a><span class="sd">    ...</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a><span class="sd">    ValueError: Input has axes (Axis(&#39;i&#39;),) but only () given</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a><span class="sd">    If you try to use inconsistent lengths for the same axis, you get an error.</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a><span class="sd">    &gt;&gt;&gt; i,j,k = axes()</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a><span class="sd">    &gt;&gt;&gt; input_shape = ShapeDict(i=3, j=4)</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a><span class="sd">    &gt;&gt;&gt; axis_shapes = {i:ShapeDict(k=3), j:ShapeDict(k=4)}</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a><span class="sd">    &gt;&gt;&gt; select_output_shape(input_shape, axis_shapes)</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a><span class="sd">    Traceback (most recent call last):</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a><span class="sd">    ...</span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a><span class="sd">    ValueError: Tried to assign k to 4 but already has value 3.</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>    <span class="c1"># dict(i=ShapeDict)</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ax</span> <span class="ow">in</span> <span class="n">axis_shapes</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">input_shape</span><span class="p">):</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>            <span class="sa">f</span><span class="s2">&quot;Input has axes </span><span class="si">{</span><span class="n">input_shape</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2"> but only </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">axis_shapes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>            <span class="sa">f</span><span class="s2">&quot;given&quot;</span><span class="p">)</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>    <span class="n">output_shape</span> <span class="o">=</span> <span class="n">ConsistentDict</span><span class="p">()</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">input_shape</span><span class="p">:</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="n">axis_shapes</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a>        <span class="k">for</span> <span class="n">ind_axis</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">:</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a>            <span class="n">output_shape</span><span class="p">[</span><span class="n">ind_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="n">ind_axis</span><span class="p">]</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a>        <span class="c1"># if axis not in axis_shapes:</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a>        <span class="c1">#     output_shape[axis] = input_shape[axis]</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a>        <span class="c1"># else:</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a>        <span class="c1">#     shape = axis_shapes[axis]</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>        <span class="c1">#     for ind_axis in shape:</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>        <span class="c1">#         output_shape[ind_axis] = shape[ind_axis]</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>    <span class="k">return</span> <span class="n">ShapeDict</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a><span class="k">def</span> <span class="nf">select_pedantic</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">axis_indices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Axis</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;(Not intended for end usage.) Given an input array and indices for each axis, compute output</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a><span class="sd">    array. This function isn&#39;t intended for end usage, so it is very picky about inputs. But it</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a><span class="sd">    might be useful for understanding what&#39;s happening under the hood.</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a><span class="sd">    Parameters</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a><span class="sd">    ----------</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a><span class="sd">    A: ntensor</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a><span class="sd">        to be selected from</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a><span class="sd">    axis_indices: Dict[Axis,ntensor]</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a><span class="sd">        dict mapping each input axis in array (must all be included) to an output axis</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a><span class="sd">    Returns</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a><span class="sd">    -------</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a><span class="sd">    B: ntensor</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a><span class="sd">        A after selecting</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a><span class="sd">    Examples</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a><span class="sd">    --------</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a><span class="sd">    The simplest usage is to reindex a single dimension</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a><span class="sd">    &gt;&gt;&gt; i,j,k,l = axes()</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0, 10, 20, 30], i)</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a><span class="sd">    &gt;&gt;&gt; i_index = ntensor([2,0,1],i)</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a><span class="sd">    &gt;&gt;&gt; B = select_pedantic(A, {i:i_index})</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a><span class="sd">    &gt;&gt;&gt; B.shape</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a><span class="sd">    ShapeDict(i=3)</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a><span class="sd">    &gt;&gt;&gt; print(B.numpy_broadcasted(i))</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a><span class="sd">    [20  0 10]</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a><span class="sd">    You can also expand that single dimension with a multi-dim index</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0, 10, 20, 30], i)</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a><span class="sd">    &gt;&gt;&gt; i_index = ntensor([[2,0,1],[4,4,4]],j,k)</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a><span class="sd">    &gt;&gt;&gt; B = select_pedantic(A, {i:i_index})</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a><span class="sd">    &gt;&gt;&gt; B.shape</span>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a><span class="sd">    ShapeDict(j=2, k=3)</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a><span class="sd">    &gt;&gt;&gt; print(B.numpy_broadcasted(j,k))</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a><span class="sd">    [[20  0 10]</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a><span class="sd">     [30 30 30]]</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a><span class="sd">    Here is how you do &quot;pointwise&quot; sampling from a 2d array:</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([[0, 10, 20],[30, 40, 50]], i, j)</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a><span class="sd">    &gt;&gt;&gt; A.shape</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a><span class="sd">    ShapeDict(i=2, j=3)</span>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a><span class="sd">    &gt;&gt;&gt; print(A.numpy_broadcasted(i,j))</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a><span class="sd">    [[ 0 10 20]</span>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a><span class="sd">     [30 40 50]]</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a><span class="sd">    &gt;&gt;&gt; i_index = ntensor([0,0,1,1], k)</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a><span class="sd">    &gt;&gt;&gt; j_index = ntensor([0,1,2,2], k)</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a><span class="sd">    &gt;&gt;&gt; B = select_pedantic(A, {i:i_index, j:j_index})</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a><span class="sd">    &gt;&gt;&gt; B.shape</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a><span class="sd">    ShapeDict(k=4)</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a><span class="sd">    &gt;&gt;&gt; print(B.numpy_broadcasted(k))</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a><span class="sd">    [ 0 10 50 50]</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a><span class="sd">    Here is how you do &quot;orthogonal&quot; sampling from a 2d array:</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([[0, 10, 20],[100, 110, 120]], i, j)</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a><span class="sd">    &gt;&gt;&gt; A.shape</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a><span class="sd">    ShapeDict(i=2, j=3)</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a><span class="sd">    &gt;&gt;&gt; print(A.numpy_broadcasted(i,j))</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a><span class="sd">    [[  0  10  20]</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a><span class="sd">     [100 110 120]]</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a><span class="sd">    &gt;&gt;&gt; i_index = ntensor([1,0,1], i)</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a><span class="sd">    &gt;&gt;&gt; j_index = ntensor([2,0], j)</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a><span class="sd">    &gt;&gt;&gt; B = select_pedantic(A, {i:i_index, j:j_index})</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a><span class="sd">    &gt;&gt;&gt; B.shape</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a><span class="sd">    ShapeDict(i=3, j=2)</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a><span class="sd">    &gt;&gt;&gt; print(B.numpy_broadcasted(i,j))</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a><span class="sd">    [[120 100]</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a><span class="sd">     [ 20   0]</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a><span class="sd">     [120 100]]</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a><span class="sd">    &gt;&gt;&gt; # here&#39;s the horrorshow if you want to do that in numpy</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a><span class="sd">    &gt;&gt;&gt; i_index_numpy = jnp.array([[1],[0],[1]]) # 1x3</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a><span class="sd">    &gt;&gt;&gt; j_index_numpy = jnp.array([[2,0]]) # 2x1</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a><span class="sd">    &gt;&gt;&gt; B_numpy = A.numpy_broadcasted(i,j)[i_index_numpy, j_index_numpy]</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a><span class="sd">    &gt;&gt;&gt; print(B_numpy)</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a><span class="sd">    [[120 100]</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a><span class="sd">     [ 20   0]</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a><span class="sd">     [120 100]]</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Axis</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axis_indices</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;not all keys in axis_indices are of type Axis&quot;</span><span class="p">)</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)</span> <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">axis_indices</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;not all values in axis_indices are of type array&quot;</span><span class="p">)</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>    <span class="k">assert</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ax</span> <span class="ow">in</span> <span class="n">axis_indices</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">A</span><span class="o">.</span><span class="n">axes</span><span class="p">),</span> <span class="s2">&quot;all axes must be indexed&quot;</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>    <span class="n">axis_shapes</span> <span class="o">=</span> <span class="p">{</span><span class="n">ax</span><span class="p">:</span> <span class="n">axis_indices</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axis_indices</span><span class="p">}</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>    <span class="n">output_shape</span> <span class="o">=</span> <span class="n">select_output_shape</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axis_shapes</span><span class="p">)</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>    <span class="n">output_axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">output_shape</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>    <span class="c1"># go through each INPUT axis and put indices into shape that will broadcast to output size</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>    <span class="n">numpy_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>    <span class="k">for</span> <span class="n">in_ax</span> <span class="ow">in</span> <span class="n">A</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">:</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>        <span class="n">unordered_indices</span> <span class="o">=</span> <span class="n">axis_indices</span><span class="p">[</span><span class="n">in_ax</span><span class="p">]</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>        <span class="c1"># put in order and add blank dims for broadcasting</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>        <span class="n">my_numpy_indices</span> <span class="o">=</span> <span class="n">unordered_indices</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="o">*</span><span class="n">output_axes</span><span class="p">)</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>        <span class="n">numpy_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_numpy_indices</span><span class="p">)</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="o">*</span><span class="n">numpy_indices</span><span class="p">],</span> <span class="o">*</span><span class="n">output_axes</span><span class="p">)</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="o">**</span><span class="n">axis_indices</span><span class="p">:</span> <span class="n">AxisIndices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select/index data. Note you can also using indexing. One of the core highlights of this</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a><span class="sd">    package is how general and simple this is.</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a><span class="sd">    Parameters</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a><span class="sd">    ----------</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a><span class="sd">    A: ntensor</span>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a><span class="sd">        the array to select/index from</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a><span class="sd">    **axis_indices</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a><span class="sd">        mapping from str or Axis to int or slice or Sequence or 1-d array</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a><span class="sd">    Returns</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a><span class="sd">    -------</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a><span class="sd">    B: ntensor</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a><span class="sd">        NTensor after indexing</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a><span class="sd">    Examples</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a><span class="sd">    --------</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a><span class="sd">    Basic indexing of 1-d arrays with integers, lists, slices</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,10,20,30,40,50,60,70,80],&#39;n&#39;)</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a><span class="sd">    &gt;&gt;&gt; print(A.shape)</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a><span class="sd">    {n:9}</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a><span class="sd">    &gt;&gt;&gt; B = select(A,n=4)</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a><span class="sd">    &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a><span class="sd">    {}</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a><span class="sd">    &gt;&gt;&gt; print(B.numpy_broadcasted())</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a><span class="sd">    40</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a><span class="sd">    &gt;&gt;&gt; B = select(A,n=[2,0,3])</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a><span class="sd">    &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a><span class="sd">    {n:3}</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a><span class="sd">    &gt;&gt;&gt; print(B.numpy_broadcasted(&#39;n&#39;))</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a><span class="sd">    [20  0 30]</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a><span class="sd">    &gt;&gt;&gt; C = select(A,n=slice(1,5))</span>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a><span class="sd">    &gt;&gt;&gt; print(C.shape)</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a><span class="sd">    {n:4}</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a><span class="sd">    &gt;&gt;&gt; print(C.numpy_broadcasted(&#39;n&#39;))</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a><span class="sd">    [10 20 30 40]</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a><span class="sd">    &gt;&gt;&gt; D = select(A,n=slice(0,8,2))</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a><span class="sd">    &gt;&gt;&gt; print(D.shape)</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a><span class="sd">    {n:4}</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a><span class="sd">    &gt;&gt;&gt; print(D.numpy_broadcasted(&#39;n&#39;))</span>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a><span class="sd">    [ 0 20 40 60]</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a><span class="sd">    More advanced indexing</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a><span class="sd">    &gt;&gt;&gt; A = ones(i=5, j=6, k=8, l=9) # complex example that shows almost all functionality</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a><span class="sd">    &gt;&gt;&gt; B = select(A, i=0, j=slice(None,None,2), k=[5,4,1,1])</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a><span class="sd">    &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a><span class="sd">    {j:3, k:4, l:9}</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a><span class="sd">    &gt;&gt;&gt; B = select(A, i=0, j=slice(None,None,2), k=ntensor([5,4,1,1],&#39;m&#39;))</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a><span class="sd">    &gt;&gt;&gt; print(B.shape)</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a><span class="sd">    {j:3, m:4, l:9}</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a><span class="sd">    See Also</span>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a><span class="sd">    --------</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a><span class="sd">    select_pedantic</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a><span class="sd">    select_output_shape</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>    <span class="c1"># TODO: avoid converting slices into arrays</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>    <span class="c1"># if args:</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>    <span class="c1">#     extra_kwargs = {}</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>    <span class="c1">#     for arg in args:</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>    <span class="c1">#         assert isinstance(arg, IndexedAxis)</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>    <span class="c1">#         extra_kwargs[arg.axis.name] = arg</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>    <span class="c1">#</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>    <span class="c1">#     return select(A, **kwargs, **extra_kwargs)</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>    <span class="c1"># force all keys to be of type Axis</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>    <span class="n">axis_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span> <span class="n">axis_indices</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axis_indices</span><span class="p">}</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>    <span class="c1"># create full slices for any indices that aren&#39;t mentioned</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">A</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axis_indices</span><span class="p">:</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>            <span class="n">axis_indices</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>    <span class="n">new_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axis_indices</span><span class="p">:</span>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">A</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Array with shape </span><span class="si">{</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> indexed with nonexistent axis </span><span class="si">{</span><span class="n">ax</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="n">axis_indices</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>        <span class="c1"># # allow usage like i=j rather than i=j[:] ?</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>        <span class="c1"># if isinstance(ind, Axis):</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>        <span class="c1">#     ind = IndexedAxis(ind, slice(None))</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">IndexedAxis</span><span class="p">):</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>                <span class="c1"># for slices, size is determined by the INPUT axes</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>                <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>                    <span class="n">ax_len</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>                <span class="k">elif</span> <span class="n">ind</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>                    <span class="n">ax_len</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">stop</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>                        <span class="s2">&quot;If using NEW index as coord with slice, stop must be provided&quot;</span><span class="p">)</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a>                <span class="n">new_kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ax_len</span><span class="p">)[</span><span class="n">ind</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> <span class="n">ind</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Must have 1 dims (got </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a>                <span class="n">new_kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ind</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>            <span class="n">new_kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis_indices</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>            <span class="n">new_kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">ax</span><span class="p">])[</span><span class="n">ind</span><span class="p">],</span> <span class="n">ax</span><span class="p">)</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>                <span class="n">new_kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a>                <span class="n">new_kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;can&#39;t provide non-NTensor index with N&gt;1 dims (got </span><span class="si">{</span><span class="n">ax</span><span class="si">}</span><span class="s2"> index with shape&quot;</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a>                                 <span class="sa">f</span><span class="s2">&quot;=</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a>    <span class="k">return</span> <span class="n">select_pedantic</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">new_kwargs</span><span class="p">)</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a><span class="c1"># Scalar ops #######################################################################################</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a><span class="n">add_scalar</span> <span class="o">=</span> <span class="n">lift_pytree</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a><span class="n">multiply_scalar</span> <span class="o">=</span> <span class="n">lift_pytree</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">multiply</span><span class="p">)</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a><span class="n">subtract_scalar</span> <span class="o">=</span> <span class="n">lift_pytree</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">subtract</span><span class="p">)</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a><span class="n">divide_scalar</span> <span class="o">=</span> <span class="n">lift_pytree</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">divide</span><span class="p">)</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a><span class="n">pow_scalar</span> <span class="o">=</span> <span class="n">lift_pytree</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a><span class="k">def</span> <span class="nf">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jax_fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>    <span class="c1"># def new_fun(arg: ntensor):</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>    <span class="c1">#     assert isinstance(arg, ntensor)</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>    <span class="c1">#     return ntensor(jax_fun(arg._data), *arg._axes_ordered)</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>    <span class="c1">#return batch_wrap(new_fun)</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>    <span class="k">return</span> <span class="n">lift</span><span class="p">(</span><span class="n">jax_fun</span><span class="p">)</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a><span class="nb">abs</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a><span class="n">acos</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">acos</span><span class="p">)</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a><span class="n">acosh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">acosh</span><span class="p">)</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a><span class="n">arccos</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arccos</span><span class="p">)</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a><span class="n">arccosh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arccosh</span><span class="p">)</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a><span class="n">arcsin</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arcsin</span><span class="p">)</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a><span class="n">arcsinh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">)</span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a><span class="n">arctan</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arctan</span><span class="p">)</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a><span class="n">arctanh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arctanh</span><span class="p">)</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a><span class="n">asin</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">asin</span><span class="p">)</span>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a><span class="n">asinh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">asinh</span><span class="p">)</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a><span class="n">atan</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">atan</span><span class="p">)</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a><span class="n">atanh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">atanh</span><span class="p">)</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a><span class="n">ceil</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ceil</span><span class="p">)</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a><span class="n">conj</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">conj</span><span class="p">)</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a><span class="n">cos</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">)</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a><span class="n">cosh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">cosh</span><span class="p">)</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a><span class="n">deg2rad</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">)</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a><span class="n">exp</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">)</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a><span class="n">exp2</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp2</span><span class="p">)</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a><span class="n">expm1</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">expm1</span><span class="p">)</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a><span class="n">i0</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">i0</span><span class="p">)</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a><span class="n">imag</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a><span class="n">log</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a><span class="n">log10</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log10</span><span class="p">)</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a><span class="n">log1p</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log1p</span><span class="p">)</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a><span class="n">log2</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log2</span><span class="p">)</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a><span class="n">rad2deg</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">)</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a><span class="n">real</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a><span class="n">reciprocal</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">)</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a><span class="n">rint</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">rint</span><span class="p">)</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a><span class="nb">round</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">)</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a><span class="n">sign</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a><span class="n">sin</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">)</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a><span class="n">sinc</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sinc</span><span class="p">)</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a><span class="n">sinh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sinh</span><span class="p">)</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a><span class="n">sqrt</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a><span class="n">square</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">square</span><span class="p">)</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a><span class="n">tan</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">tan</span><span class="p">)</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a><span class="n">tanh</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">tanh</span><span class="p">)</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a><span class="n">trunc</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">trunc</span><span class="p">)</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a><span class="n">relu</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a><span class="s2">&quot;Elementwise operation (see same operation in [`jax.nn`](https://docs.jax.dev/en/latest/jax.nn.html))&quot;</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a><span class="c1"># Pairwise functions ###############################################################################</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a><span class="n">wrap_jax_pairwise</span> <span class="o">=</span> <span class="n">lift</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a><span class="n">add</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a><span class="sd">&quot;&quot;&quot;Pairwise operation defined simply as `wrap_jax_pairwise(jnp.add)`</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a><span class="sd">(see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a><span class="n">arctan2</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arctan2</span><span class="p">)</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a><span class="n">atan2</span> <span class="o">=</span> <span class="n">wrap_jax_elementwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arctan2</span><span class="p">)</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a><span class="n">divide</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">divide</span><span class="p">)</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a><span class="nb">divmod</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">divmod</span><span class="p">)</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a><span class="n">equal</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">)</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a><span class="n">floor_divide</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">)</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a><span class="n">gcd</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">gcd</span><span class="p">)</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a><span class="n">greater</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">greater</span><span class="p">)</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a><span class="n">greater_equal</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">)</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a><span class="n">heaviside</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">heaviside</span><span class="p">)</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a><span class="n">hypot</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">hypot</span><span class="p">)</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a><span class="n">lcm</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">lcm</span><span class="p">)</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a><span class="n">ldexp</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ldexp</span><span class="p">)</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a><span class="n">less</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">less</span><span class="p">)</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a><span class="n">less_equal</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">less_equal</span><span class="p">)</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a><span class="n">logaddexp</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">logaddexp</span><span class="p">)</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a><span class="n">logaddexp2</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">logaddexp2</span><span class="p">)</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a><span class="n">maximum</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a><span class="n">minimum</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">minimum</span><span class="p">)</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a><span class="n">multiply</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">multiply</span><span class="p">)</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a><span class="n">mod</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">mod</span><span class="p">)</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a><span class="n">nextafter</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">nextafter</span><span class="p">)</span>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a><span class="n">not_equal</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">not_equal</span><span class="p">)</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a><span class="n">polyadd</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">polyadd</span><span class="p">)</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a><span class="n">polymul</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">polymul</span><span class="p">)</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a><span class="n">polysub</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">polysub</span><span class="p">)</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a><span class="n">polyval</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">polyval</span><span class="p">)</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a><span class="nb">pow</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a><span class="n">power</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a><span class="n">remainder</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">remainder</span><span class="p">)</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a><span class="n">subtract</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">subtract</span><span class="p">)</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a><span class="n">true_divide</span> <span class="o">=</span> <span class="n">wrap_jax_pairwise</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">true_divide</span><span class="p">)</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a><span class="s2">&quot;Pairwise operation (see same operation in [`jax.numpy`](https://docs.jax.dev/en/latest/jax.numpy.html))&quot;</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a><span class="c1"># Reductions #######################################################################################</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a><span class="k">def</span> <span class="nf">wrap_jax_reduction</span><span class="p">(</span><span class="n">jax_fun</span><span class="p">):</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>    <span class="k">def</span> <span class="nf">new_fun</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>        <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jax_fun</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>    <span class="k">return</span> <span class="n">wrap</span><span class="p">(</span><span class="n">new_fun</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a><span class="nb">any</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">)</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.any`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.any.html). Call </span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a><span class="sd">with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a><span class="nb">all</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.all`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.all.html). </span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a><span class="sd">Call with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a><span class="n">logsumexp</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">logsumexp</span><span class="p">)</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.nn.logsumexp`](https://docs.jax.dev/en/latest/_autosummary/jax.nn.logsumexp.html). </span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a><span class="sd">Call with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a><span class="nb">max</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.max`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.max.html). Call </span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a><span class="sd">with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a><span class="n">mean</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.mean`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.mean.html). </span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a><span class="sd">Call with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a><span class="n">median</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">median</span><span class="p">)</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.median`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.median.html). </span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a><span class="sd">Call with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a><span class="nb">min</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.min`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.min.html). Call </span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a><span class="sd">with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a><span class="n">prod</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.prod`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.prod.html). </span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a><span class="sd">Call with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a><span class="nb">sum</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.sum`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.sum.html). Call </span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a><span class="sd">with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a><span class="n">std</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">std</span><span class="p">)</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.std`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.std.html). </span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a><span class="sd">Call with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a><span class="n">var</span> <span class="o">=</span> <span class="n">wrap_jax_reduction</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a><span class="sd">&quot;&quot;&quot;Wraps [`jax.numpy.var`](https://docs.jax.dev/en/latest/_autosummary/jax.numpy.var.html). </span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a><span class="sd">Call with `axes` to reduce or `vmap_axes` to *not* reduce.&quot;&quot;&quot;</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a><span class="c1"># Gradients ########################################################################################</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a><span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A thin wrapper around [`jax.grad`](https://docs.jax.dev/en/latest/_autosummary/jax.grad.html). All</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a><span class="sd">    this really does is convert the final `NTensor` output to a jax value.</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a><span class="sd">    Parameters</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a><span class="sd">    ----------</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a><span class="sd">    fun</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a><span class="sd">        The function you will take the gradient of</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a><span class="sd">    argnums</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a><span class="sd">        Optional, integer or sequence of integers, specifying what arguments to take gradient with respect</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a><span class="sd">        to. Defaults to 0.</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a><span class="sd">    Returns</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a><span class="sd">    -------</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a><span class="sd">    grad_fun</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a><span class="sd">        Gradient function</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a><span class="sd">    Examples</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a><span class="sd">    --------</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a><span class="sd">    &gt;&gt;&gt; x = ntensor([0., 1., 2.],&#39;i&#39;)</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a><span class="sd">    &gt;&gt;&gt; grad_sum = grad(sum)</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a><span class="sd">    &gt;&gt;&gt; grad_sum(x)</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a><span class="sd">    &lt;ntensor {i:3} [1. 1. 1.]&gt;</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a><span class="sd">    You can use regular jax grad if you really want to (this is effectively all this function does).</span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a><span class="sd">    &gt;&gt;&gt; x = ntensor([0., 1., 2.],&#39;i&#39;)</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a><span class="sd">    &gt;&gt;&gt; mysum = lambda arg: sum(arg).numpy() # converts to jax float</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a><span class="sd">    &gt;&gt;&gt; sum(x)</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a><span class="sd">    &lt;ntensor {} 3.0&gt;</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a><span class="sd">    &gt;&gt;&gt; mysum(x)</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a><span class="sd">    Array(3., dtype=float32)</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a><span class="sd">    &gt;&gt;&gt; grad_sum = jax.grad(mysum)</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a><span class="sd">    &gt;&gt;&gt; grad_sum(x)</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a><span class="sd">    &lt;ntensor {i:3} [1. 1. 1.]&gt;</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>    <span class="k">def</span> <span class="nf">myfun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">{}):</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gradient can only be taken of scalar functions (got </span><span class="si">{</span><span class="n">out</span><span class="si">=}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a>        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">_data</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a>    <span class="n">mygrad</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">myfun</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="n">argnums</span><span class="p">)</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a>    <span class="k">def</span> <span class="nf">wrapped_grad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>        <span class="k">return</span> <span class="n">mygrad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>    <span class="k">return</span> <span class="n">wrapped_grad</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a><span class="k">def</span> <span class="nf">value_and_grad</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A thin wrapper around</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a><span class="sd">    [`jax.value_and_grad`](https://docs.jax.dev/en/latest/_autosummary/jax.value_and_grad.html).</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a><span class="sd">    Parameters</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a><span class="sd">    ----------</span>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a><span class="sd">    fun</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a><span class="sd">        The function you will take the gradient of</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a><span class="sd">    argnums</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a><span class="sd">        Optional, integer or sequence of integers, specifying what arguments to take gradient with respect</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a><span class="sd">        to. Defaults to 0.</span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a><span class="sd">    Returns</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a><span class="sd">    -------</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a><span class="sd">    value_and_grad_fun</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a><span class="sd">        Function that returns the value and the gradient</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a><span class="sd">    Examples</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a><span class="sd">    --------</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a><span class="sd">    &gt;&gt;&gt; x = ntensor([0., 1., 2.],&#39;i&#39;)</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a><span class="sd">    &gt;&gt;&gt; value_and_grad_sum = value_and_grad(sum)</span>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a><span class="sd">    &gt;&gt;&gt; value_and_grad_sum(x)</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a><span class="sd">    (&lt;ntensor {} 3.0&gt;, &lt;ntensor {i:3} [1. 1. 1.]&gt;)</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>    <span class="k">def</span> <span class="nf">myfun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">{}):</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gradient can only be taken of scalar functions (got </span><span class="si">{</span><span class="n">out</span><span class="si">=}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">_data</span>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>    <span class="n">my_value_and_grad</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">value_and_grad</span><span class="p">(</span><span class="n">myfun</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="n">argnums</span><span class="p">)</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>    <span class="k">def</span> <span class="nf">wrapped_value_and_grad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">my_value_and_grad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>        <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>    <span class="k">return</span> <span class="n">wrapped_value_and_grad</span>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a><span class="c1"># Other matrix operations ##########################################################################</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a><span class="nd">@wrap</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;first argument to solve (after batching) must have 2 dims (got </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>    <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;second argument to solve (after batching) must have 1 dim (got </span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span> <span class="o">&amp;</span> <span class="n">b</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;arguments must overlap on exactly one axis (got </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>    <span class="n">new_axis</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">axes</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>    <span class="n">new_axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_axis</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>    <span class="n">c_jax</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">c_jax</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">)</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a><span class="nd">@wrap</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a><span class="k">def</span> <span class="nf">inv</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Take an inverse</span>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a><span class="sd">    Parameters</span>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a><span class="sd">    ----------</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a><span class="sd">    a</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a><span class="sd">        2-D NTensor</span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a><span class="sd">    Returns</span>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a><span class="sd">    -------</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a><span class="sd">    b</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a><span class="sd">        Inverse NTensor</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a><span class="sd">    Examples</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a><span class="sd">    --------</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a><span class="sd">    &gt;&gt;&gt; a = ntensor([[2., 0],[0, 1]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a><span class="sd">    &gt;&gt;&gt; inv(a)</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a><span class="sd">    &lt;ntensor {j:2 i:2}</span>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a><span class="sd">    [[0.5 0. ]</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a><span class="sd">     [0.  1. ]]&gt;</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a><span class="sd">    &gt;&gt;&gt; b = ntensor([5., 3.],&#39;i&#39;)</span>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a><span class="sd">    &gt;&gt;&gt; x = inv(a) @ b</span>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a><span class="sd">    &gt;&gt;&gt; x</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a><span class="sd">    &lt;ntensor {j:2} [2.5 3. ]&gt;</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a><span class="sd">    &gt;&gt;&gt; a @ x</span>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a><span class="sd">    &lt;ntensor {i:2} [5. 3.]&gt;</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a>    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;argument to inv (after batching) must have 2 dims (got </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a>    <span class="n">b_jax</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">b_jax</span><span class="p">,</span> <span class="o">*</span><span class="nb">reversed</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">))</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a><span class="k">def</span> <span class="nf">conv_1d</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a>    <span class="c1"># axis = Axis(Axis)</span>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a>    <span class="c1"># if a.axes != {axis} or b.axes != {axis}:</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a>    <span class="c1">#    raise ValueError(f&quot;conv_1d get {a.shape=} {b.shape=} not matching {axis=}&quot;)</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>    <span class="c1"># print(f&quot;{a.shape=} {b.shape=}&quot;)</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Convolve must take 1d arg&quot;</span><span class="p">)</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>    <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Convolve must take 1d arg&quot;</span><span class="p">)</span>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span> <span class="o">&amp;</span> <span class="n">b</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Convolve args must share dimension&quot;</span><span class="p">)</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>    <span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">_axes_ordered</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>    <span class="k">return</span> <span class="n">lift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">convolve</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="p">[</span><span class="n">ax</span><span class="p">]),</span> <span class="n">out_axes</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">])(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a><span class="c1">#</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a><span class="nd">@wrap</span>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a><span class="k">def</span> <span class="nf">convolve</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a>    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">axes</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t convolve with non-matching axes&quot;</span><span class="p">)</span>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">_axes_ordered</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="o">*</span><span class="n">axes</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="o">*</span><span class="n">axes</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">),</span> <span class="o">*</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a><span class="c1"># Dataframe ##################################################################################################</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a><span class="k">def</span> <span class="nf">dataframe</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">axis_arrays</span><span class="p">):</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert ntensor to dataframe</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a><span class="sd">    Parameters</span>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a><span class="sd">    ----------</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a><span class="sd">    A</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a><span class="sd">    label</span>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a><span class="sd">    axis_arrays</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a><span class="sd">    Returns</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a><span class="sd">    -------</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a><span class="sd">    out: DataFrame</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a><span class="sd">        Dataframe representing all the data in A, in &quot;tidy&quot; format</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a><span class="sd">    Examples</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a><span class="sd">    --------</span>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([10, 25.5, 30], &#39;dogs&#39;)</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a><span class="sd">    &gt;&gt;&gt; dog_indices = ntensor([2, 5, 10],&#39;dogs&#39;)</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a><span class="sd">    &gt;&gt;&gt; df = dataframe(A, &#39;weight&#39;, dog_indices)</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a><span class="sd">    &gt;&gt;&gt; df</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a><span class="sd">       weight  dogs</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a><span class="sd">    0    10.0     2</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a><span class="sd">    1    25.5     5</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a><span class="sd">    2    30.0    10</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([[10, 25.5, 30],[44.5, 50.0, 0.0]], &#39;dogs&#39;, &#39;meals&#39;)</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a><span class="sd">    &gt;&gt;&gt; dog_indices = ntensor([2, 5],&#39;dogs&#39;)</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a><span class="sd">    &gt;&gt;&gt; meal_indices = ntensor([3.3, 1.1, 10],&#39;meals&#39;)</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a><span class="sd">    &gt;&gt;&gt; dataframe(A, &#39;weight&#39;, dog_indices, meal_indices)</span>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a><span class="sd">       weight  dogs  meals</span>
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a><span class="sd">    0    10.0     2    3.3</span>
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a><span class="sd">    1    25.5     2    1.1</span>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a><span class="sd">    2    30.0     2   10.0</span>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a><span class="sd">    3    44.5     5    3.3</span>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a><span class="sd">    4    50.0     5    1.1</span>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a><span class="sd">    5     0.0     5   10.0</span>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a><span class="sd">    &gt;&gt;&gt; dataframe(A, &#39;weight&#39;, meal_indices, dog_indices)</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a><span class="sd">       weight  meals  dogs</span>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a><span class="sd">    0    10.0    3.3     2</span>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a><span class="sd">    1    44.5    3.3     5</span>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a><span class="sd">    2    25.5    1.1     2</span>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a><span class="sd">    3    50.0    1.1     5</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a><span class="sd">    4    30.0   10.0     2</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a><span class="sd">    5     0.0   10.0     5</span>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a>    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a>    <span class="k">for</span> <span class="n">axis_array</span> <span class="ow">in</span> <span class="n">axis_arrays</span><span class="p">:</span>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a>        <span class="k">assert</span> <span class="n">axis_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a>        <span class="n">axis</span><span class="p">,</span> <span class="o">=</span> <span class="n">axis_array</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a>        <span class="k">assert</span> <span class="n">axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes</span>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a>        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a>    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="n">A</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a>    <span class="c1"># broadcast axis_arrays to full size</span>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a>    <span class="n">axis_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_array</span><span class="o">*</span><span class="n">ones_like</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">axis_array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">axis_array</span> <span class="ow">in</span> <span class="n">axis_arrays</span><span class="p">]</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="o">*</span><span class="n">axes</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span> <span class="o">+</span> <span class="p">[</span><span class="n">axis_array</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="o">*</span><span class="n">axes</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">axis_array</span> <span class="ow">in</span> <span class="n">axis_arrays</span><span class="p">]</span>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a>    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">axis</span><span class="o">.</span><span class="n">_name</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">col</span><span class="p">:</span><span class="n">d</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">data</span><span class="p">)})</span>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a>    <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            </section>
                <section id="Axis">
                            <input id="Axis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Axis</span>:

                <label class="view-source-button" for="Axis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Axis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Axis-494"><a href="#Axis-494"><span class="linenos">494</span></a><span class="k">class</span> <span class="nc">Axis</span><span class="p">:</span>
</span><span id="Axis-495"><a href="#Axis-495"><span class="linenos">495</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An axis is a unique axis label. It&#39;s *basically* just a string but with a few tricks to make</span>
</span><span id="Axis-496"><a href="#Axis-496"><span class="linenos">496</span></a><span class="sd">    notation nicer. For convenience, axes evaluate as to equal to their strings. Axes are equal based on</span>
</span><span id="Axis-497"><a href="#Axis-497"><span class="linenos">497</span></a><span class="sd">    names, not object identity.</span>
</span><span id="Axis-498"><a href="#Axis-498"><span class="linenos">498</span></a>
</span><span id="Axis-499"><a href="#Axis-499"><span class="linenos">499</span></a><span class="sd">    Examples</span>
</span><span id="Axis-500"><a href="#Axis-500"><span class="linenos">500</span></a><span class="sd">    --------</span>
</span><span id="Axis-501"><a href="#Axis-501"><span class="linenos">501</span></a><span class="sd">    &gt;&gt;&gt; cat = Axis(&#39;cat&#39;)</span>
</span><span id="Axis-502"><a href="#Axis-502"><span class="linenos">502</span></a><span class="sd">    &gt;&gt;&gt; dog = Axis(&#39;dog&#39;)</span>
</span><span id="Axis-503"><a href="#Axis-503"><span class="linenos">503</span></a><span class="sd">    &gt;&gt;&gt; cat == dog</span>
</span><span id="Axis-504"><a href="#Axis-504"><span class="linenos">504</span></a><span class="sd">    False</span>
</span><span id="Axis-505"><a href="#Axis-505"><span class="linenos">505</span></a><span class="sd">    &gt;&gt;&gt; cat == &#39;cat&#39;</span>
</span><span id="Axis-506"><a href="#Axis-506"><span class="linenos">506</span></a><span class="sd">    True</span>
</span><span id="Axis-507"><a href="#Axis-507"><span class="linenos">507</span></a><span class="sd">    &gt;&gt;&gt; cat == &#39;dog&#39;</span>
</span><span id="Axis-508"><a href="#Axis-508"><span class="linenos">508</span></a><span class="sd">    False</span>
</span><span id="Axis-509"><a href="#Axis-509"><span class="linenos">509</span></a>
</span><span id="Axis-510"><a href="#Axis-510"><span class="linenos">510</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Axis-511"><a href="#Axis-511"><span class="linenos">511</span></a>
</span><span id="Axis-512"><a href="#Axis-512"><span class="linenos">512</span></a>    <span class="n">_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Axis-513"><a href="#Axis-513"><span class="linenos">513</span></a>    <span class="s2">&quot;The stored name. Don&#39;t change this!&quot;</span>
</span><span id="Axis-514"><a href="#Axis-514"><span class="linenos">514</span></a>
</span><span id="Axis-515"><a href="#Axis-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Self</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Axis-516"><a href="#Axis-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an `Axis`.</span>
</span><span id="Axis-517"><a href="#Axis-517"><span class="linenos">517</span></a>
</span><span id="Axis-518"><a href="#Axis-518"><span class="linenos">518</span></a><span class="sd">        Parameters</span>
</span><span id="Axis-519"><a href="#Axis-519"><span class="linenos">519</span></a><span class="sd">        ----------</span>
</span><span id="Axis-520"><a href="#Axis-520"><span class="linenos">520</span></a><span class="sd">        name:</span>
</span><span id="Axis-521"><a href="#Axis-521"><span class="linenos">521</span></a><span class="sd">            Create an axis with the given name. If `None`, then try to detect name being assigned to</span>
</span><span id="Axis-522"><a href="#Axis-522"><span class="linenos">522</span></a><span class="sd">            with evil magics.</span>
</span><span id="Axis-523"><a href="#Axis-523"><span class="linenos">523</span></a>
</span><span id="Axis-524"><a href="#Axis-524"><span class="linenos">524</span></a><span class="sd">        Examples</span>
</span><span id="Axis-525"><a href="#Axis-525"><span class="linenos">525</span></a><span class="sd">        --------</span>
</span><span id="Axis-526"><a href="#Axis-526"><span class="linenos">526</span></a><span class="sd">        &gt;&gt;&gt; time = Axis(&#39;time&#39;)</span>
</span><span id="Axis-527"><a href="#Axis-527"><span class="linenos">527</span></a><span class="sd">        &gt;&gt;&gt; time</span>
</span><span id="Axis-528"><a href="#Axis-528"><span class="linenos">528</span></a><span class="sd">        Axis(&#39;time&#39;)</span>
</span><span id="Axis-529"><a href="#Axis-529"><span class="linenos">529</span></a><span class="sd">        &gt;&gt;&gt; time._name</span>
</span><span id="Axis-530"><a href="#Axis-530"><span class="linenos">530</span></a><span class="sd">        &#39;time&#39;</span>
</span><span id="Axis-531"><a href="#Axis-531"><span class="linenos">531</span></a><span class="sd">        &gt;&gt;&gt; time == &#39;time&#39; # can compare to strings</span>
</span><span id="Axis-532"><a href="#Axis-532"><span class="linenos">532</span></a><span class="sd">        True</span>
</span><span id="Axis-533"><a href="#Axis-533"><span class="linenos">533</span></a><span class="sd">        &gt;&gt;&gt; time == Axis(&#39;time&#39;) # can compare to other Axis with same name</span>
</span><span id="Axis-534"><a href="#Axis-534"><span class="linenos">534</span></a><span class="sd">        True</span>
</span><span id="Axis-535"><a href="#Axis-535"><span class="linenos">535</span></a><span class="sd">        &gt;&gt;&gt; id(time) == id(Axis(&#39;time&#39;)) # even though different objects</span>
</span><span id="Axis-536"><a href="#Axis-536"><span class="linenos">536</span></a><span class="sd">        False</span>
</span><span id="Axis-537"><a href="#Axis-537"><span class="linenos">537</span></a>
</span><span id="Axis-538"><a href="#Axis-538"><span class="linenos">538</span></a><span class="sd">        &gt;&gt;&gt; days = Axis() # evil magic</span>
</span><span id="Axis-539"><a href="#Axis-539"><span class="linenos">539</span></a><span class="sd">        &gt;&gt;&gt; days._name</span>
</span><span id="Axis-540"><a href="#Axis-540"><span class="linenos">540</span></a><span class="sd">        &#39;days&#39;</span>
</span><span id="Axis-541"><a href="#Axis-541"><span class="linenos">541</span></a><span class="sd">        &gt;&gt;&gt; days == &#39;days&#39;</span>
</span><span id="Axis-542"><a href="#Axis-542"><span class="linenos">542</span></a><span class="sd">        True</span>
</span><span id="Axis-543"><a href="#Axis-543"><span class="linenos">543</span></a><span class="sd">        &gt;&gt;&gt; days == Axis(&#39;days&#39;)</span>
</span><span id="Axis-544"><a href="#Axis-544"><span class="linenos">544</span></a><span class="sd">        True</span>
</span><span id="Axis-545"><a href="#Axis-545"><span class="linenos">545</span></a>
</span><span id="Axis-546"><a href="#Axis-546"><span class="linenos">546</span></a><span class="sd">        &gt;&gt;&gt; alice = Axis(&quot;bob&quot;) # this is almost certainly a bad idea</span>
</span><span id="Axis-547"><a href="#Axis-547"><span class="linenos">547</span></a><span class="sd">        &gt;&gt;&gt; alice._name</span>
</span><span id="Axis-548"><a href="#Axis-548"><span class="linenos">548</span></a><span class="sd">        &#39;bob&#39;</span>
</span><span id="Axis-549"><a href="#Axis-549"><span class="linenos">549</span></a><span class="sd">        &gt;&gt;&gt; alice == &#39;bob&#39;</span>
</span><span id="Axis-550"><a href="#Axis-550"><span class="linenos">550</span></a><span class="sd">        True</span>
</span><span id="Axis-551"><a href="#Axis-551"><span class="linenos">551</span></a><span class="sd">        &gt;&gt;&gt; alice == &#39;alice&#39;</span>
</span><span id="Axis-552"><a href="#Axis-552"><span class="linenos">552</span></a><span class="sd">        False</span>
</span><span id="Axis-553"><a href="#Axis-553"><span class="linenos">553</span></a>
</span><span id="Axis-554"><a href="#Axis-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Axis-555"><a href="#Axis-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Axis-556"><a href="#Axis-556"><span class="linenos">556</span></a>            <span class="c1"># try to detect name using evil magics</span>
</span><span id="Axis-557"><a href="#Axis-557"><span class="linenos">557</span></a>            <span class="kn">import</span> <span class="nn">varname</span>
</span><span id="Axis-558"><a href="#Axis-558"><span class="linenos">558</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">varname</span><span class="o">.</span><span class="n">varname</span><span class="p">()</span>
</span><span id="Axis-559"><a href="#Axis-559"><span class="linenos">559</span></a>
</span><span id="Axis-560"><a href="#Axis-560"><span class="linenos">560</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Axis-561"><a href="#Axis-561"><span class="linenos">561</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Axis-562"><a href="#Axis-562"><span class="linenos">562</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="Axis-563"><a href="#Axis-563"><span class="linenos">563</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">_name</span>
</span><span id="Axis-564"><a href="#Axis-564"><span class="linenos">564</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Axis-565"><a href="#Axis-565"><span class="linenos">565</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name must be str or Axis, got </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Axis-566"><a href="#Axis-566"><span class="linenos">566</span></a>
</span><span id="Axis-567"><a href="#Axis-567"><span class="linenos">567</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Axis-568"><a href="#Axis-568"><span class="linenos">568</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="Axis-569"><a href="#Axis-569"><span class="linenos">569</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_name</span>
</span><span id="Axis-570"><a href="#Axis-570"><span class="linenos">570</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Axis-571"><a href="#Axis-571"><span class="linenos">571</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="Axis-572"><a href="#Axis-572"><span class="linenos">572</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Axis-573"><a href="#Axis-573"><span class="linenos">573</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name must be str or Axis, got </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Axis-574"><a href="#Axis-574"><span class="linenos">574</span></a>
</span><span id="Axis-575"><a href="#Axis-575"><span class="linenos">575</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Axis-576"><a href="#Axis-576"><span class="linenos">576</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
</span><span id="Axis-577"><a href="#Axis-577"><span class="linenos">577</span></a>
</span><span id="Axis-578"><a href="#Axis-578"><span class="linenos">578</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Axis-579"><a href="#Axis-579"><span class="linenos">579</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="Axis-580"><a href="#Axis-580"><span class="linenos">580</span></a>
</span><span id="Axis-581"><a href="#Axis-581"><span class="linenos">581</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Axis-582"><a href="#Axis-582"><span class="linenos">582</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Axis(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</span><span id="Axis-583"><a href="#Axis-583"><span class="linenos">583</span></a>
</span><span id="Axis-584"><a href="#Axis-584"><span class="linenos">584</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="Axis-585"><a href="#Axis-585"><span class="linenos">585</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="Axis-586"><a href="#Axis-586"><span class="linenos">586</span></a>
</span><span id="Axis-587"><a href="#Axis-587"><span class="linenos">587</span></a><span class="sd">        You can index into an `Axis` for nicer syntactic sugar when indexing an `ntensor`. If `x` is</span>
</span><span id="Axis-588"><a href="#Axis-588"><span class="linenos">588</span></a><span class="sd">        an `ntensor` with some `Axis` `ax`, then if you do `x(ax=ax[(1,2,3)])`, that&#39;s equivalent to</span>
</span><span id="Axis-589"><a href="#Axis-589"><span class="linenos">589</span></a><span class="sd">        `x(ax=ntensor((1,2,3),&#39;ax&#39;))`.</span>
</span><span id="Axis-590"><a href="#Axis-590"><span class="linenos">590</span></a>
</span><span id="Axis-591"><a href="#Axis-591"><span class="linenos">591</span></a><span class="sd">        If you do `x(ax=ax[1:10:3])`, that&#39;s equivalent to `x(ax=IndexedAxis(ax,slice(1,10,3)))` which is</span>
</span><span id="Axis-592"><a href="#Axis-592"><span class="linenos">592</span></a><span class="sd">        in turn equivalent to `x(ax=NTensor(np.arange(x.shape[&#39;ax&#39;])[1:10:3])`.</span>
</span><span id="Axis-593"><a href="#Axis-593"><span class="linenos">593</span></a>
</span><span id="Axis-594"><a href="#Axis-594"><span class="linenos">594</span></a><span class="sd">        This is achieved by making `ax[...]` do slightly tricky stuff, which is this function.</span>
</span><span id="Axis-595"><a href="#Axis-595"><span class="linenos">595</span></a>
</span><span id="Axis-596"><a href="#Axis-596"><span class="linenos">596</span></a><span class="sd">        Parameters</span>
</span><span id="Axis-597"><a href="#Axis-597"><span class="linenos">597</span></a><span class="sd">        ----------</span>
</span><span id="Axis-598"><a href="#Axis-598"><span class="linenos">598</span></a><span class="sd">        item: slice | ArrayLike</span>
</span><span id="Axis-599"><a href="#Axis-599"><span class="linenos">599</span></a><span class="sd">            If this is a slice, then returns an `IndexedAxis`. If this is anything that can be cast</span>
</span><span id="Axis-600"><a href="#Axis-600"><span class="linenos">600</span></a><span class="sd">            to a 1D numpy array, then this returns an `ntensor`. Anything else is an error.</span>
</span><span id="Axis-601"><a href="#Axis-601"><span class="linenos">601</span></a>
</span><span id="Axis-602"><a href="#Axis-602"><span class="linenos">602</span></a><span class="sd">        Examples</span>
</span><span id="Axis-603"><a href="#Axis-603"><span class="linenos">603</span></a><span class="sd">        --------</span>
</span><span id="Axis-604"><a href="#Axis-604"><span class="linenos">604</span></a><span class="sd">        &gt;&gt;&gt; cats = Axis(&#39;cats&#39;)</span>
</span><span id="Axis-605"><a href="#Axis-605"><span class="linenos">605</span></a>
</span><span id="Axis-606"><a href="#Axis-606"><span class="linenos">606</span></a><span class="sd">        OK: Numpy arrays or things castable to them.</span>
</span><span id="Axis-607"><a href="#Axis-607"><span class="linenos">607</span></a>
</span><span id="Axis-608"><a href="#Axis-608"><span class="linenos">608</span></a><span class="sd">        &gt;&gt;&gt; cats[jnp.array([7,5,2,9])]</span>
</span><span id="Axis-609"><a href="#Axis-609"><span class="linenos">609</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="Axis-610"><a href="#Axis-610"><span class="linenos">610</span></a><span class="sd">        &gt;&gt;&gt; cats[(7,5,2,9)]</span>
</span><span id="Axis-611"><a href="#Axis-611"><span class="linenos">611</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="Axis-612"><a href="#Axis-612"><span class="linenos">612</span></a><span class="sd">        &gt;&gt;&gt; cats[7,5,2,9]</span>
</span><span id="Axis-613"><a href="#Axis-613"><span class="linenos">613</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="Axis-614"><a href="#Axis-614"><span class="linenos">614</span></a>
</span><span id="Axis-615"><a href="#Axis-615"><span class="linenos">615</span></a><span class="sd">        Also OK: slices.</span>
</span><span id="Axis-616"><a href="#Axis-616"><span class="linenos">616</span></a>
</span><span id="Axis-617"><a href="#Axis-617"><span class="linenos">617</span></a><span class="sd">        &gt;&gt;&gt; cats[:]</span>
</span><span id="Axis-618"><a href="#Axis-618"><span class="linenos">618</span></a><span class="sd">        IndexedAxis(cats, slice(None, None, None))</span>
</span><span id="Axis-619"><a href="#Axis-619"><span class="linenos">619</span></a><span class="sd">        &gt;&gt;&gt; cats[1:20:3]</span>
</span><span id="Axis-620"><a href="#Axis-620"><span class="linenos">620</span></a><span class="sd">        IndexedAxis(cats, slice(1, 20, 3))</span>
</span><span id="Axis-621"><a href="#Axis-621"><span class="linenos">621</span></a>
</span><span id="Axis-622"><a href="#Axis-622"><span class="linenos">622</span></a><span class="sd">        Not OK: Integers. (Since 0-dimensional arrays don&#39;t have shapes, this has no purpose.)</span>
</span><span id="Axis-623"><a href="#Axis-623"><span class="linenos">623</span></a>
</span><span id="Axis-624"><a href="#Axis-624"><span class="linenos">624</span></a><span class="sd">        &gt;&gt;&gt; cats[0]</span>
</span><span id="Axis-625"><a href="#Axis-625"><span class="linenos">625</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Axis-626"><a href="#Axis-626"><span class="linenos">626</span></a><span class="sd">        ...</span>
</span><span id="Axis-627"><a href="#Axis-627"><span class="linenos">627</span></a><span class="sd">        ValueError: Axis index castable to numpy array, but got 0 dims (must be 1)</span>
</span><span id="Axis-628"><a href="#Axis-628"><span class="linenos">628</span></a>
</span><span id="Axis-629"><a href="#Axis-629"><span class="linenos">629</span></a><span class="sd">        Not OK: `ntensor` (What would `x(ax=ax[y])` mean if `y` is `ntensor`? Allowing this would lead to</span>
</span><span id="Axis-630"><a href="#Axis-630"><span class="linenos">630</span></a><span class="sd">        confusion.)</span>
</span><span id="Axis-631"><a href="#Axis-631"><span class="linenos">631</span></a>
</span><span id="Axis-632"><a href="#Axis-632"><span class="linenos">632</span></a><span class="sd">        &gt;&gt;&gt; cats[ntensor(3)]</span>
</span><span id="Axis-633"><a href="#Axis-633"><span class="linenos">633</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Axis-634"><a href="#Axis-634"><span class="linenos">634</span></a><span class="sd">        ...</span>
</span><span id="Axis-635"><a href="#Axis-635"><span class="linenos">635</span></a><span class="sd">        ValueError: Can&#39;t index an Axis with an NTensor (1-D numpy array OK).</span>
</span><span id="Axis-636"><a href="#Axis-636"><span class="linenos">636</span></a>
</span><span id="Axis-637"><a href="#Axis-637"><span class="linenos">637</span></a><span class="sd">        Not OK: Thing castable to 2+ dimensional numpy arrays. (We only have 1 `Axis`!)</span>
</span><span id="Axis-638"><a href="#Axis-638"><span class="linenos">638</span></a>
</span><span id="Axis-639"><a href="#Axis-639"><span class="linenos">639</span></a><span class="sd">        &gt;&gt;&gt; cats[((1,2,3),(4,5,6))] # 2d index not allowed!</span>
</span><span id="Axis-640"><a href="#Axis-640"><span class="linenos">640</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Axis-641"><a href="#Axis-641"><span class="linenos">641</span></a><span class="sd">        ...</span>
</span><span id="Axis-642"><a href="#Axis-642"><span class="linenos">642</span></a><span class="sd">        ValueError: Axis index castable to numpy array, but got 2 dims (must be 1)</span>
</span><span id="Axis-643"><a href="#Axis-643"><span class="linenos">643</span></a>
</span><span id="Axis-644"><a href="#Axis-644"><span class="linenos">644</span></a>
</span><span id="Axis-645"><a href="#Axis-645"><span class="linenos">645</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Axis-646"><a href="#Axis-646"><span class="linenos">646</span></a>
</span><span id="Axis-647"><a href="#Axis-647"><span class="linenos">647</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="Axis-648"><a href="#Axis-648"><span class="linenos">648</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t index an Axis with an NTensor (1-D numpy array OK).&quot;</span><span class="p">)</span>
</span><span id="Axis-649"><a href="#Axis-649"><span class="linenos">649</span></a>
</span><span id="Axis-650"><a href="#Axis-650"><span class="linenos">650</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="Axis-651"><a href="#Axis-651"><span class="linenos">651</span></a>            <span class="k">return</span> <span class="n">IndexedAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="Axis-652"><a href="#Axis-652"><span class="linenos">652</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Axis-653"><a href="#Axis-653"><span class="linenos">653</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Axis-654"><a href="#Axis-654"><span class="linenos">654</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="Axis-655"><a href="#Axis-655"><span class="linenos">655</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="Axis-656"><a href="#Axis-656"><span class="linenos">656</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Axis-657"><a href="#Axis-657"><span class="linenos">657</span></a>                    <span class="sa">f</span><span class="s2">&quot;Axis index (</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">) not slice and not castable to a 1-d numpy array&quot;</span><span class="p">)</span>
</span><span id="Axis-658"><a href="#Axis-658"><span class="linenos">658</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Axis-659"><a href="#Axis-659"><span class="linenos">659</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Axis index castable to numpy array, but got </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dims (must be 1)&quot;</span><span class="p">)</span>
</span><span id="Axis-660"><a href="#Axis-660"><span class="linenos">660</span></a>            <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Axis-661"><a href="#Axis-661"><span class="linenos">661</span></a>
</span><span id="Axis-662"><a href="#Axis-662"><span class="linenos">662</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Axis-663"><a href="#Axis-663"><span class="linenos">663</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make axes sortable by name (mostly just to make tests deterministic)&quot;&quot;&quot;</span>
</span><span id="Axis-664"><a href="#Axis-664"><span class="linenos">664</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_name</span>
</span></pre></div>


            <div class="docstring"><p>An axis is a unique axis label. It's <em>basically</em> just a string but with a few tricks to make
notation nicer. For convenience, axes evaluate as to equal to their strings. Axes are equal based on
names, not object identity.</p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cat</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dog</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;dog&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cat</span> <span class="o">==</span> <span class="n">dog</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cat</span> <span class="o">==</span> <span class="s1">&#39;cat&#39;</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cat</span> <span class="o">==</span> <span class="s1">&#39;dog&#39;</span>
<span class="go">False</span>
</code></pre>
</div>
</div>


                            <div id="Axis.__init__" class="classattr">
                                        <input id="Axis.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Axis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Self</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Axis.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Axis.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Axis.__init__-515"><a href="#Axis.__init__-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Self</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Axis.__init__-516"><a href="#Axis.__init__-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an `Axis`.</span>
</span><span id="Axis.__init__-517"><a href="#Axis.__init__-517"><span class="linenos">517</span></a>
</span><span id="Axis.__init__-518"><a href="#Axis.__init__-518"><span class="linenos">518</span></a><span class="sd">        Parameters</span>
</span><span id="Axis.__init__-519"><a href="#Axis.__init__-519"><span class="linenos">519</span></a><span class="sd">        ----------</span>
</span><span id="Axis.__init__-520"><a href="#Axis.__init__-520"><span class="linenos">520</span></a><span class="sd">        name:</span>
</span><span id="Axis.__init__-521"><a href="#Axis.__init__-521"><span class="linenos">521</span></a><span class="sd">            Create an axis with the given name. If `None`, then try to detect name being assigned to</span>
</span><span id="Axis.__init__-522"><a href="#Axis.__init__-522"><span class="linenos">522</span></a><span class="sd">            with evil magics.</span>
</span><span id="Axis.__init__-523"><a href="#Axis.__init__-523"><span class="linenos">523</span></a>
</span><span id="Axis.__init__-524"><a href="#Axis.__init__-524"><span class="linenos">524</span></a><span class="sd">        Examples</span>
</span><span id="Axis.__init__-525"><a href="#Axis.__init__-525"><span class="linenos">525</span></a><span class="sd">        --------</span>
</span><span id="Axis.__init__-526"><a href="#Axis.__init__-526"><span class="linenos">526</span></a><span class="sd">        &gt;&gt;&gt; time = Axis(&#39;time&#39;)</span>
</span><span id="Axis.__init__-527"><a href="#Axis.__init__-527"><span class="linenos">527</span></a><span class="sd">        &gt;&gt;&gt; time</span>
</span><span id="Axis.__init__-528"><a href="#Axis.__init__-528"><span class="linenos">528</span></a><span class="sd">        Axis(&#39;time&#39;)</span>
</span><span id="Axis.__init__-529"><a href="#Axis.__init__-529"><span class="linenos">529</span></a><span class="sd">        &gt;&gt;&gt; time._name</span>
</span><span id="Axis.__init__-530"><a href="#Axis.__init__-530"><span class="linenos">530</span></a><span class="sd">        &#39;time&#39;</span>
</span><span id="Axis.__init__-531"><a href="#Axis.__init__-531"><span class="linenos">531</span></a><span class="sd">        &gt;&gt;&gt; time == &#39;time&#39; # can compare to strings</span>
</span><span id="Axis.__init__-532"><a href="#Axis.__init__-532"><span class="linenos">532</span></a><span class="sd">        True</span>
</span><span id="Axis.__init__-533"><a href="#Axis.__init__-533"><span class="linenos">533</span></a><span class="sd">        &gt;&gt;&gt; time == Axis(&#39;time&#39;) # can compare to other Axis with same name</span>
</span><span id="Axis.__init__-534"><a href="#Axis.__init__-534"><span class="linenos">534</span></a><span class="sd">        True</span>
</span><span id="Axis.__init__-535"><a href="#Axis.__init__-535"><span class="linenos">535</span></a><span class="sd">        &gt;&gt;&gt; id(time) == id(Axis(&#39;time&#39;)) # even though different objects</span>
</span><span id="Axis.__init__-536"><a href="#Axis.__init__-536"><span class="linenos">536</span></a><span class="sd">        False</span>
</span><span id="Axis.__init__-537"><a href="#Axis.__init__-537"><span class="linenos">537</span></a>
</span><span id="Axis.__init__-538"><a href="#Axis.__init__-538"><span class="linenos">538</span></a><span class="sd">        &gt;&gt;&gt; days = Axis() # evil magic</span>
</span><span id="Axis.__init__-539"><a href="#Axis.__init__-539"><span class="linenos">539</span></a><span class="sd">        &gt;&gt;&gt; days._name</span>
</span><span id="Axis.__init__-540"><a href="#Axis.__init__-540"><span class="linenos">540</span></a><span class="sd">        &#39;days&#39;</span>
</span><span id="Axis.__init__-541"><a href="#Axis.__init__-541"><span class="linenos">541</span></a><span class="sd">        &gt;&gt;&gt; days == &#39;days&#39;</span>
</span><span id="Axis.__init__-542"><a href="#Axis.__init__-542"><span class="linenos">542</span></a><span class="sd">        True</span>
</span><span id="Axis.__init__-543"><a href="#Axis.__init__-543"><span class="linenos">543</span></a><span class="sd">        &gt;&gt;&gt; days == Axis(&#39;days&#39;)</span>
</span><span id="Axis.__init__-544"><a href="#Axis.__init__-544"><span class="linenos">544</span></a><span class="sd">        True</span>
</span><span id="Axis.__init__-545"><a href="#Axis.__init__-545"><span class="linenos">545</span></a>
</span><span id="Axis.__init__-546"><a href="#Axis.__init__-546"><span class="linenos">546</span></a><span class="sd">        &gt;&gt;&gt; alice = Axis(&quot;bob&quot;) # this is almost certainly a bad idea</span>
</span><span id="Axis.__init__-547"><a href="#Axis.__init__-547"><span class="linenos">547</span></a><span class="sd">        &gt;&gt;&gt; alice._name</span>
</span><span id="Axis.__init__-548"><a href="#Axis.__init__-548"><span class="linenos">548</span></a><span class="sd">        &#39;bob&#39;</span>
</span><span id="Axis.__init__-549"><a href="#Axis.__init__-549"><span class="linenos">549</span></a><span class="sd">        &gt;&gt;&gt; alice == &#39;bob&#39;</span>
</span><span id="Axis.__init__-550"><a href="#Axis.__init__-550"><span class="linenos">550</span></a><span class="sd">        True</span>
</span><span id="Axis.__init__-551"><a href="#Axis.__init__-551"><span class="linenos">551</span></a><span class="sd">        &gt;&gt;&gt; alice == &#39;alice&#39;</span>
</span><span id="Axis.__init__-552"><a href="#Axis.__init__-552"><span class="linenos">552</span></a><span class="sd">        False</span>
</span><span id="Axis.__init__-553"><a href="#Axis.__init__-553"><span class="linenos">553</span></a>
</span><span id="Axis.__init__-554"><a href="#Axis.__init__-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Axis.__init__-555"><a href="#Axis.__init__-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Axis.__init__-556"><a href="#Axis.__init__-556"><span class="linenos">556</span></a>            <span class="c1"># try to detect name using evil magics</span>
</span><span id="Axis.__init__-557"><a href="#Axis.__init__-557"><span class="linenos">557</span></a>            <span class="kn">import</span> <span class="nn">varname</span>
</span><span id="Axis.__init__-558"><a href="#Axis.__init__-558"><span class="linenos">558</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">varname</span><span class="o">.</span><span class="n">varname</span><span class="p">()</span>
</span><span id="Axis.__init__-559"><a href="#Axis.__init__-559"><span class="linenos">559</span></a>
</span><span id="Axis.__init__-560"><a href="#Axis.__init__-560"><span class="linenos">560</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Axis.__init__-561"><a href="#Axis.__init__-561"><span class="linenos">561</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Axis.__init__-562"><a href="#Axis.__init__-562"><span class="linenos">562</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="Axis.__init__-563"><a href="#Axis.__init__-563"><span class="linenos">563</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">_name</span>
</span><span id="Axis.__init__-564"><a href="#Axis.__init__-564"><span class="linenos">564</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Axis.__init__-565"><a href="#Axis.__init__-565"><span class="linenos">565</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name must be str or Axis, got </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an <code><a href="#Axis">Axis</a></code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>name:</strong>: Create an axis with the given name. If <code>None</code>, then try to detect name being assigned to
with evil magics.</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span>
<span class="go">Axis(&#39;time&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;time&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span> <span class="c1"># can compare to strings</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">==</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="c1"># can compare to other Axis with same name</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">))</span> <span class="c1"># even though different objects</span>
<span class="go">False</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">days</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">()</span> <span class="c1"># evil magic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">days</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;days&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">days</span> <span class="o">==</span> <span class="s1">&#39;days&#39;</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">days</span> <span class="o">==</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;days&#39;</span><span class="p">)</span>
<span class="go">True</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">alice</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">)</span> <span class="c1"># this is almost certainly a bad idea</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alice</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;bob&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alice</span> <span class="o">==</span> <span class="s1">&#39;bob&#39;</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alice</span> <span class="o">==</span> <span class="s1">&#39;alice&#39;</span>
<span class="go">False</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Axis.__getitem__" class="classattr">
                                        <input id="Axis.__getitem__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">__getitem__</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">item</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Buffer</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Axis.__getitem__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Axis.__getitem__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Axis.__getitem__-584"><a href="#Axis.__getitem__-584"><span class="linenos">584</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="Axis.__getitem__-585"><a href="#Axis.__getitem__-585"><span class="linenos">585</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="Axis.__getitem__-586"><a href="#Axis.__getitem__-586"><span class="linenos">586</span></a>
</span><span id="Axis.__getitem__-587"><a href="#Axis.__getitem__-587"><span class="linenos">587</span></a><span class="sd">        You can index into an `Axis` for nicer syntactic sugar when indexing an `ntensor`. If `x` is</span>
</span><span id="Axis.__getitem__-588"><a href="#Axis.__getitem__-588"><span class="linenos">588</span></a><span class="sd">        an `ntensor` with some `Axis` `ax`, then if you do `x(ax=ax[(1,2,3)])`, that&#39;s equivalent to</span>
</span><span id="Axis.__getitem__-589"><a href="#Axis.__getitem__-589"><span class="linenos">589</span></a><span class="sd">        `x(ax=ntensor((1,2,3),&#39;ax&#39;))`.</span>
</span><span id="Axis.__getitem__-590"><a href="#Axis.__getitem__-590"><span class="linenos">590</span></a>
</span><span id="Axis.__getitem__-591"><a href="#Axis.__getitem__-591"><span class="linenos">591</span></a><span class="sd">        If you do `x(ax=ax[1:10:3])`, that&#39;s equivalent to `x(ax=IndexedAxis(ax,slice(1,10,3)))` which is</span>
</span><span id="Axis.__getitem__-592"><a href="#Axis.__getitem__-592"><span class="linenos">592</span></a><span class="sd">        in turn equivalent to `x(ax=NTensor(np.arange(x.shape[&#39;ax&#39;])[1:10:3])`.</span>
</span><span id="Axis.__getitem__-593"><a href="#Axis.__getitem__-593"><span class="linenos">593</span></a>
</span><span id="Axis.__getitem__-594"><a href="#Axis.__getitem__-594"><span class="linenos">594</span></a><span class="sd">        This is achieved by making `ax[...]` do slightly tricky stuff, which is this function.</span>
</span><span id="Axis.__getitem__-595"><a href="#Axis.__getitem__-595"><span class="linenos">595</span></a>
</span><span id="Axis.__getitem__-596"><a href="#Axis.__getitem__-596"><span class="linenos">596</span></a><span class="sd">        Parameters</span>
</span><span id="Axis.__getitem__-597"><a href="#Axis.__getitem__-597"><span class="linenos">597</span></a><span class="sd">        ----------</span>
</span><span id="Axis.__getitem__-598"><a href="#Axis.__getitem__-598"><span class="linenos">598</span></a><span class="sd">        item: slice | ArrayLike</span>
</span><span id="Axis.__getitem__-599"><a href="#Axis.__getitem__-599"><span class="linenos">599</span></a><span class="sd">            If this is a slice, then returns an `IndexedAxis`. If this is anything that can be cast</span>
</span><span id="Axis.__getitem__-600"><a href="#Axis.__getitem__-600"><span class="linenos">600</span></a><span class="sd">            to a 1D numpy array, then this returns an `ntensor`. Anything else is an error.</span>
</span><span id="Axis.__getitem__-601"><a href="#Axis.__getitem__-601"><span class="linenos">601</span></a>
</span><span id="Axis.__getitem__-602"><a href="#Axis.__getitem__-602"><span class="linenos">602</span></a><span class="sd">        Examples</span>
</span><span id="Axis.__getitem__-603"><a href="#Axis.__getitem__-603"><span class="linenos">603</span></a><span class="sd">        --------</span>
</span><span id="Axis.__getitem__-604"><a href="#Axis.__getitem__-604"><span class="linenos">604</span></a><span class="sd">        &gt;&gt;&gt; cats = Axis(&#39;cats&#39;)</span>
</span><span id="Axis.__getitem__-605"><a href="#Axis.__getitem__-605"><span class="linenos">605</span></a>
</span><span id="Axis.__getitem__-606"><a href="#Axis.__getitem__-606"><span class="linenos">606</span></a><span class="sd">        OK: Numpy arrays or things castable to them.</span>
</span><span id="Axis.__getitem__-607"><a href="#Axis.__getitem__-607"><span class="linenos">607</span></a>
</span><span id="Axis.__getitem__-608"><a href="#Axis.__getitem__-608"><span class="linenos">608</span></a><span class="sd">        &gt;&gt;&gt; cats[jnp.array([7,5,2,9])]</span>
</span><span id="Axis.__getitem__-609"><a href="#Axis.__getitem__-609"><span class="linenos">609</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="Axis.__getitem__-610"><a href="#Axis.__getitem__-610"><span class="linenos">610</span></a><span class="sd">        &gt;&gt;&gt; cats[(7,5,2,9)]</span>
</span><span id="Axis.__getitem__-611"><a href="#Axis.__getitem__-611"><span class="linenos">611</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="Axis.__getitem__-612"><a href="#Axis.__getitem__-612"><span class="linenos">612</span></a><span class="sd">        &gt;&gt;&gt; cats[7,5,2,9]</span>
</span><span id="Axis.__getitem__-613"><a href="#Axis.__getitem__-613"><span class="linenos">613</span></a><span class="sd">        &lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</span><span id="Axis.__getitem__-614"><a href="#Axis.__getitem__-614"><span class="linenos">614</span></a>
</span><span id="Axis.__getitem__-615"><a href="#Axis.__getitem__-615"><span class="linenos">615</span></a><span class="sd">        Also OK: slices.</span>
</span><span id="Axis.__getitem__-616"><a href="#Axis.__getitem__-616"><span class="linenos">616</span></a>
</span><span id="Axis.__getitem__-617"><a href="#Axis.__getitem__-617"><span class="linenos">617</span></a><span class="sd">        &gt;&gt;&gt; cats[:]</span>
</span><span id="Axis.__getitem__-618"><a href="#Axis.__getitem__-618"><span class="linenos">618</span></a><span class="sd">        IndexedAxis(cats, slice(None, None, None))</span>
</span><span id="Axis.__getitem__-619"><a href="#Axis.__getitem__-619"><span class="linenos">619</span></a><span class="sd">        &gt;&gt;&gt; cats[1:20:3]</span>
</span><span id="Axis.__getitem__-620"><a href="#Axis.__getitem__-620"><span class="linenos">620</span></a><span class="sd">        IndexedAxis(cats, slice(1, 20, 3))</span>
</span><span id="Axis.__getitem__-621"><a href="#Axis.__getitem__-621"><span class="linenos">621</span></a>
</span><span id="Axis.__getitem__-622"><a href="#Axis.__getitem__-622"><span class="linenos">622</span></a><span class="sd">        Not OK: Integers. (Since 0-dimensional arrays don&#39;t have shapes, this has no purpose.)</span>
</span><span id="Axis.__getitem__-623"><a href="#Axis.__getitem__-623"><span class="linenos">623</span></a>
</span><span id="Axis.__getitem__-624"><a href="#Axis.__getitem__-624"><span class="linenos">624</span></a><span class="sd">        &gt;&gt;&gt; cats[0]</span>
</span><span id="Axis.__getitem__-625"><a href="#Axis.__getitem__-625"><span class="linenos">625</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Axis.__getitem__-626"><a href="#Axis.__getitem__-626"><span class="linenos">626</span></a><span class="sd">        ...</span>
</span><span id="Axis.__getitem__-627"><a href="#Axis.__getitem__-627"><span class="linenos">627</span></a><span class="sd">        ValueError: Axis index castable to numpy array, but got 0 dims (must be 1)</span>
</span><span id="Axis.__getitem__-628"><a href="#Axis.__getitem__-628"><span class="linenos">628</span></a>
</span><span id="Axis.__getitem__-629"><a href="#Axis.__getitem__-629"><span class="linenos">629</span></a><span class="sd">        Not OK: `ntensor` (What would `x(ax=ax[y])` mean if `y` is `ntensor`? Allowing this would lead to</span>
</span><span id="Axis.__getitem__-630"><a href="#Axis.__getitem__-630"><span class="linenos">630</span></a><span class="sd">        confusion.)</span>
</span><span id="Axis.__getitem__-631"><a href="#Axis.__getitem__-631"><span class="linenos">631</span></a>
</span><span id="Axis.__getitem__-632"><a href="#Axis.__getitem__-632"><span class="linenos">632</span></a><span class="sd">        &gt;&gt;&gt; cats[ntensor(3)]</span>
</span><span id="Axis.__getitem__-633"><a href="#Axis.__getitem__-633"><span class="linenos">633</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Axis.__getitem__-634"><a href="#Axis.__getitem__-634"><span class="linenos">634</span></a><span class="sd">        ...</span>
</span><span id="Axis.__getitem__-635"><a href="#Axis.__getitem__-635"><span class="linenos">635</span></a><span class="sd">        ValueError: Can&#39;t index an Axis with an NTensor (1-D numpy array OK).</span>
</span><span id="Axis.__getitem__-636"><a href="#Axis.__getitem__-636"><span class="linenos">636</span></a>
</span><span id="Axis.__getitem__-637"><a href="#Axis.__getitem__-637"><span class="linenos">637</span></a><span class="sd">        Not OK: Thing castable to 2+ dimensional numpy arrays. (We only have 1 `Axis`!)</span>
</span><span id="Axis.__getitem__-638"><a href="#Axis.__getitem__-638"><span class="linenos">638</span></a>
</span><span id="Axis.__getitem__-639"><a href="#Axis.__getitem__-639"><span class="linenos">639</span></a><span class="sd">        &gt;&gt;&gt; cats[((1,2,3),(4,5,6))] # 2d index not allowed!</span>
</span><span id="Axis.__getitem__-640"><a href="#Axis.__getitem__-640"><span class="linenos">640</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Axis.__getitem__-641"><a href="#Axis.__getitem__-641"><span class="linenos">641</span></a><span class="sd">        ...</span>
</span><span id="Axis.__getitem__-642"><a href="#Axis.__getitem__-642"><span class="linenos">642</span></a><span class="sd">        ValueError: Axis index castable to numpy array, but got 2 dims (must be 1)</span>
</span><span id="Axis.__getitem__-643"><a href="#Axis.__getitem__-643"><span class="linenos">643</span></a>
</span><span id="Axis.__getitem__-644"><a href="#Axis.__getitem__-644"><span class="linenos">644</span></a>
</span><span id="Axis.__getitem__-645"><a href="#Axis.__getitem__-645"><span class="linenos">645</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Axis.__getitem__-646"><a href="#Axis.__getitem__-646"><span class="linenos">646</span></a>
</span><span id="Axis.__getitem__-647"><a href="#Axis.__getitem__-647"><span class="linenos">647</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="Axis.__getitem__-648"><a href="#Axis.__getitem__-648"><span class="linenos">648</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t index an Axis with an NTensor (1-D numpy array OK).&quot;</span><span class="p">)</span>
</span><span id="Axis.__getitem__-649"><a href="#Axis.__getitem__-649"><span class="linenos">649</span></a>
</span><span id="Axis.__getitem__-650"><a href="#Axis.__getitem__-650"><span class="linenos">650</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="Axis.__getitem__-651"><a href="#Axis.__getitem__-651"><span class="linenos">651</span></a>            <span class="k">return</span> <span class="n">IndexedAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="Axis.__getitem__-652"><a href="#Axis.__getitem__-652"><span class="linenos">652</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Axis.__getitem__-653"><a href="#Axis.__getitem__-653"><span class="linenos">653</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Axis.__getitem__-654"><a href="#Axis.__getitem__-654"><span class="linenos">654</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="Axis.__getitem__-655"><a href="#Axis.__getitem__-655"><span class="linenos">655</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="Axis.__getitem__-656"><a href="#Axis.__getitem__-656"><span class="linenos">656</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Axis.__getitem__-657"><a href="#Axis.__getitem__-657"><span class="linenos">657</span></a>                    <span class="sa">f</span><span class="s2">&quot;Axis index (</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">) not slice and not castable to a 1-d numpy array&quot;</span><span class="p">)</span>
</span><span id="Axis.__getitem__-658"><a href="#Axis.__getitem__-658"><span class="linenos">658</span></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Axis.__getitem__-659"><a href="#Axis.__getitem__-659"><span class="linenos">659</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Axis index castable to numpy array, but got </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dims (must be 1)&quot;</span><span class="p">)</span>
</span><span id="Axis.__getitem__-660"><a href="#Axis.__getitem__-660"><span class="linenos">660</span></a>            <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>You can index into an <code><a href="#Axis">Axis</a></code> for nicer syntactic sugar when indexing an <code><a href="#ntensor">ntensor</a></code>. If <code>x</code> is
an <code><a href="#ntensor">ntensor</a></code> with some <code><a href="#Axis">Axis</a></code> <code>ax</code>, then if you do <code>x(ax=ax[(1,2,3)])</code>, that's equivalent to
<code>x(ax=ntensor((1,2,3),'ax'))</code>.</p>

<p>If you do <code>x(ax=ax[1:10:3])</code>, that's equivalent to <code>x(ax=IndexedAxis(ax,slice(1,10,3)))</code> which is
in turn equivalent to <code>x(ax=NTensor(np.arange(x.shape['ax'])[1:10:3])</code>.</p>

<p>This is achieved by making <code>ax[...]</code> do slightly tricky stuff, which is this function.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>item</strong> (slice | ArrayLike):
If this is a slice, then returns an <code>IndexedAxis</code>. If this is anything that can be cast
to a 1D numpy array, then this returns an <code><a href="#ntensor">ntensor</a></code>. Anything else is an error.</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;cats&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p>OK: Numpy arrays or things castable to them.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">])]</span>
<span class="go">&lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span><span class="p">[(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">)]</span>
<span class="go">&lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>
<span class="go">&lt;ntensor {cats:4} [7 5 2 9]&gt;</span>
</code></pre>
</div>

<p>Also OK: slices.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span><span class="p">[:]</span>
<span class="go">IndexedAxis(cats, slice(None, None, None))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">IndexedAxis(cats, slice(1, 20, 3))</span>
</code></pre>
</div>

<p>Not OK: Integers. (Since 0-dimensional arrays don't have shapes, this has no purpose.)</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Axis index castable to numpy array, but got 0 dims (must be 1)</span>
</code></pre>
</div>

<p>Not OK: <code><a href="#ntensor">ntensor</a></code> (What would <code>x(ax=ax[y])</code> mean if <code>y</code> is <code><a href="#ntensor">ntensor</a></code>? Allowing this would lead to
confusion.)</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span><span class="p">[</span><span class="n">ntensor</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Can&#39;t index an Axis with an NTensor (1-D numpy array OK).</span>
</code></pre>
</div>

<p>Not OK: Thing castable to 2+ dimensional numpy arrays. (We only have 1 <code><a href="#Axis">Axis</a></code>!)</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span><span class="p">[((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">))]</span> <span class="c1"># 2d index not allowed!</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Axis index castable to numpy array, but got 2 dims (must be 1)</span>
</code></pre>
</div>
</div>


                            </div>
                </section>
                <section id="ntensor">
                            <input id="ntensor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ntensor</span>:

                <label class="view-source-button" for="ntensor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor-695"><a href="#ntensor-695"><span class="linenos"> 695</span></a><span class="k">class</span> <span class="nc">ntensor</span><span class="p">:</span>
</span><span id="ntensor-696"><a href="#ntensor-696"><span class="linenos"> 696</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An array is the base type of this package. The first thing about `array`s is that you can</span>
</span><span id="ntensor-697"><a href="#ntensor-697"><span class="linenos"> 697</span></a><span class="sd">    create them. The second thing about `array`s is that you can (elegantly) index them. The third</span>
</span><span id="ntensor-698"><a href="#ntensor-698"><span class="linenos"> 698</span></a><span class="sd">    thing about `array`s is you can call functions on them.</span>
</span><span id="ntensor-699"><a href="#ntensor-699"><span class="linenos"> 699</span></a>
</span><span id="ntensor-700"><a href="#ntensor-700"><span class="linenos"> 700</span></a><span class="sd">    For core usage, see:</span>
</span><span id="ntensor-701"><a href="#ntensor-701"><span class="linenos"> 701</span></a><span class="sd">    * `__init__` for creating arrays</span>
</span><span id="ntensor-702"><a href="#ntensor-702"><span class="linenos"> 702</span></a><span class="sd">    * `axes` for getting the axes</span>
</span><span id="ntensor-703"><a href="#ntensor-703"><span class="linenos"> 703</span></a><span class="sd">    * `__call__` for indexing</span>
</span><span id="ntensor-704"><a href="#ntensor-704"><span class="linenos"> 704</span></a><span class="sd">    * `__getitem__` for converting to</span>
</span><span id="ntensor-705"><a href="#ntensor-705"><span class="linenos"> 705</span></a>
</span><span id="ntensor-706"><a href="#ntensor-706"><span class="linenos"> 706</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ntensor-707"><a href="#ntensor-707"><span class="linenos"> 707</span></a>
</span><span id="ntensor-708"><a href="#ntensor-708"><span class="linenos"> 708</span></a>    <span class="n">_data</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="ntensor-709"><a href="#ntensor-709"><span class="linenos"> 709</span></a>    <span class="s2">&quot;The underlying data, stored as a numpy array. (You shouldn&#39;t need to mess with this directly!)&quot;</span>
</span><span id="ntensor-710"><a href="#ntensor-710"><span class="linenos"> 710</span></a>
</span><span id="ntensor-711"><a href="#ntensor-711"><span class="linenos"> 711</span></a>    <span class="n">_axes_ordered</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Axis</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="ntensor-712"><a href="#ntensor-712"><span class="linenos"> 712</span></a>    <span class="s2">&quot;The Axis for each dimension in `data`. (You shouldn&#39;t need to mess with this directly!)&quot;</span>
</span><span id="ntensor-713"><a href="#ntensor-713"><span class="linenos"> 713</span></a>
</span><span id="ntensor-714"><a href="#ntensor-714"><span class="linenos"> 714</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="ntensor-715"><a href="#ntensor-715"><span class="linenos"> 715</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an array from some block of data. This is familiar from other array languages,</span>
</span><span id="ntensor-716"><a href="#ntensor-716"><span class="linenos"> 716</span></a><span class="sd">        except you must provide axis names if there are more than 0 dimensions</span>
</span><span id="ntensor-717"><a href="#ntensor-717"><span class="linenos"> 717</span></a>
</span><span id="ntensor-718"><a href="#ntensor-718"><span class="linenos"> 718</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor-719"><a href="#ntensor-719"><span class="linenos"> 719</span></a><span class="sd">        ----------</span>
</span><span id="ntensor-720"><a href="#ntensor-720"><span class="linenos"> 720</span></a><span class="sd">        data</span>
</span><span id="ntensor-721"><a href="#ntensor-721"><span class="linenos"> 721</span></a><span class="sd">            An array or  [ArrayLike](https://docs.jax.dev/en/latest/_autosummary/jax.typing.ArrayLike.html)</span>
</span><span id="ntensor-722"><a href="#ntensor-722"><span class="linenos"> 722</span></a><span class="sd">            that can be cast to a numpy array.</span>
</span><span id="ntensor-723"><a href="#ntensor-723"><span class="linenos"> 723</span></a><span class="sd">        *axes</span>
</span><span id="ntensor-724"><a href="#ntensor-724"><span class="linenos"> 724</span></a><span class="sd">            `Axis` or strings. Must have same length as number of dimensions of data.</span>
</span><span id="ntensor-725"><a href="#ntensor-725"><span class="linenos"> 725</span></a>
</span><span id="ntensor-726"><a href="#ntensor-726"><span class="linenos"> 726</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-727"><a href="#ntensor-727"><span class="linenos"> 727</span></a><span class="sd">        --------</span>
</span><span id="ntensor-728"><a href="#ntensor-728"><span class="linenos"> 728</span></a><span class="sd">        Zero dimensional arrays have no dimensions, and so don&#39;t have axis names</span>
</span><span id="ntensor-729"><a href="#ntensor-729"><span class="linenos"> 729</span></a>
</span><span id="ntensor-730"><a href="#ntensor-730"><span class="linenos"> 730</span></a><span class="sd">        &gt;&gt;&gt; ntensor(137.036)</span>
</span><span id="ntensor-731"><a href="#ntensor-731"><span class="linenos"> 731</span></a><span class="sd">        &lt;ntensor {} 137.036&gt;</span>
</span><span id="ntensor-732"><a href="#ntensor-732"><span class="linenos"> 732</span></a>
</span><span id="ntensor-733"><a href="#ntensor-733"><span class="linenos"> 733</span></a><span class="sd">        Arrays with at least one dimension must have axis names</span>
</span><span id="ntensor-734"><a href="#ntensor-734"><span class="linenos"> 734</span></a>
</span><span id="ntensor-735"><a href="#ntensor-735"><span class="linenos"> 735</span></a><span class="sd">        &gt;&gt;&gt; ntensor([11, 22, 33], &#39;cats&#39;)</span>
</span><span id="ntensor-736"><a href="#ntensor-736"><span class="linenos"> 736</span></a><span class="sd">        &lt;ntensor {cats:3} [11 22 33]&gt;</span>
</span><span id="ntensor-737"><a href="#ntensor-737"><span class="linenos"> 737</span></a><span class="sd">        &gt;&gt;&gt; ntensor([5.5], &#39;i&#39;)</span>
</span><span id="ntensor-738"><a href="#ntensor-738"><span class="linenos"> 738</span></a><span class="sd">        &lt;ntensor {i:1} [5.5]&gt;</span>
</span><span id="ntensor-739"><a href="#ntensor-739"><span class="linenos"> 739</span></a><span class="sd">        &gt;&gt;&gt; ntensor([[1,2,3],[4,5,6]], &#39;row&#39;, &#39;col&#39;)</span>
</span><span id="ntensor-740"><a href="#ntensor-740"><span class="linenos"> 740</span></a><span class="sd">        &lt;ntensor {row:2, col:3}</span>
</span><span id="ntensor-741"><a href="#ntensor-741"><span class="linenos"> 741</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="ntensor-742"><a href="#ntensor-742"><span class="linenos"> 742</span></a><span class="sd">         [4 5 6]]&gt;</span>
</span><span id="ntensor-743"><a href="#ntensor-743"><span class="linenos"> 743</span></a>
</span><span id="ntensor-744"><a href="#ntensor-744"><span class="linenos"> 744</span></a><span class="sd">        You can create an explicit `Axis` objects first if you want. This is *completely equivalent*. (If you</span>
</span><span id="ntensor-745"><a href="#ntensor-745"><span class="linenos"> 745</span></a><span class="sd">        pass strings, they are automatically converted into `Axis` object for you.</span>
</span><span id="ntensor-746"><a href="#ntensor-746"><span class="linenos"> 746</span></a><span class="sd">        &gt;&gt;&gt; cats = Axis(&#39;cats&#39;)</span>
</span><span id="ntensor-747"><a href="#ntensor-747"><span class="linenos"> 747</span></a><span class="sd">        &gt;&gt;&gt; ntensor([11, 22, 33], cats)</span>
</span><span id="ntensor-748"><a href="#ntensor-748"><span class="linenos"> 748</span></a><span class="sd">        &lt;ntensor {cats:3} [11 22 33]&gt;</span>
</span><span id="ntensor-749"><a href="#ntensor-749"><span class="linenos"> 749</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-750"><a href="#ntensor-750"><span class="linenos"> 750</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor-751"><a href="#ntensor-751"><span class="linenos"> 751</span></a>
</span><span id="ntensor-752"><a href="#ntensor-752"><span class="linenos"> 752</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="ntensor-753"><a href="#ntensor-753"><span class="linenos"> 753</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ntensor got non-unique axes </span><span class="si">{</span><span class="n">axes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor-754"><a href="#ntensor-754"><span class="linenos"> 754</span></a>
</span><span id="ntensor-755"><a href="#ntensor-755"><span class="linenos"> 755</span></a>        <span class="c1">#print(f&quot;about to create data with array {data=}&quot;)</span>
</span><span id="ntensor-756"><a href="#ntensor-756"><span class="linenos"> 756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ntensor-757"><a href="#ntensor-757"><span class="linenos"> 757</span></a>
</span><span id="ntensor-758"><a href="#ntensor-758"><span class="linenos"> 758</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="ntensor-759"><a href="#ntensor-759"><span class="linenos"> 759</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ntensor-760"><a href="#ntensor-760"><span class="linenos"> 760</span></a>                <span class="sa">f</span><span class="s2">&quot;data has shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dims, but given &quot;</span>
</span><span id="ntensor-761"><a href="#ntensor-761"><span class="linenos"> 761</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2"> axes: </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor-762"><a href="#ntensor-762"><span class="linenos"> 762</span></a>
</span><span id="ntensor-763"><a href="#ntensor-763"><span class="linenos"> 763</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span> <span class="o">=</span> <span class="n">axes</span>
</span><span id="ntensor-764"><a href="#ntensor-764"><span class="linenos"> 764</span></a>
</span><span id="ntensor-765"><a href="#ntensor-765"><span class="linenos"> 765</span></a>        <span class="c1">#self._shape = ShapeDict({axes[i]: self._data.shape[i] for i in range(len(axes))})</span>
</span><span id="ntensor-766"><a href="#ntensor-766"><span class="linenos"> 766</span></a>
</span><span id="ntensor-767"><a href="#ntensor-767"><span class="linenos"> 767</span></a>        <span class="c1"># # hack to make jax.grad work for scalars</span>
</span><span id="ntensor-768"><a href="#ntensor-768"><span class="linenos"> 768</span></a>        <span class="c1"># if self._data.ndim == 0:</span>
</span><span id="ntensor-769"><a href="#ntensor-769"><span class="linenos"> 769</span></a>        <span class="c1">#     self.__jax_array__ = lambda: self._data</span>
</span><span id="ntensor-770"><a href="#ntensor-770"><span class="linenos"> 770</span></a>        <span class="c1">#     self.dtype = self._data.dtype</span>
</span><span id="ntensor-771"><a href="#ntensor-771"><span class="linenos"> 771</span></a>
</span><span id="ntensor-772"><a href="#ntensor-772"><span class="linenos"> 772</span></a>    <span class="k">def</span> <span class="nf">__jax_array__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ntensor-773"><a href="#ntensor-773"><span class="linenos"> 773</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ntensor-774"><a href="#ntensor-774"><span class="linenos"> 774</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only ntensor with &lt;= 1 can be auto-converted to jax array&quot;</span><span class="p">)</span>
</span><span id="ntensor-775"><a href="#ntensor-775"><span class="linenos"> 775</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="ntensor-776"><a href="#ntensor-776"><span class="linenos"> 776</span></a>
</span><span id="ntensor-777"><a href="#ntensor-777"><span class="linenos"> 777</span></a>    <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ntensor-778"><a href="#ntensor-778"><span class="linenos"> 778</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ntensor-779"><a href="#ntensor-779"><span class="linenos"> 779</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only ntensor with &lt;= 1 can be auto-converted to array&quot;</span><span class="p">)</span>
</span><span id="ntensor-780"><a href="#ntensor-780"><span class="linenos"> 780</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__array__ </span><span class="si">{</span><span class="bp">self</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">dtype</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor-781"><a href="#ntensor-781"><span class="linenos"> 781</span></a>        <span class="k">return</span> <span class="n">onp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="ntensor-782"><a href="#ntensor-782"><span class="linenos"> 782</span></a>
</span><span id="ntensor-783"><a href="#ntensor-783"><span class="linenos"> 783</span></a>    <span class="nd">@property</span>
</span><span id="ntensor-784"><a href="#ntensor-784"><span class="linenos"> 784</span></a>    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ntensor-785"><a href="#ntensor-785"><span class="linenos"> 785</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="ntensor-786"><a href="#ntensor-786"><span class="linenos"> 786</span></a>
</span><span id="ntensor-787"><a href="#ntensor-787"><span class="linenos"> 787</span></a>    <span class="nd">@property</span>
</span><span id="ntensor-788"><a href="#ntensor-788"><span class="linenos"> 788</span></a>    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">Axis</span><span class="p">]:</span>
</span><span id="ntensor-789"><a href="#ntensor-789"><span class="linenos"> 789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Axis objects. It&#39;s a set, because axes *don&#39;t have an order* (that you&#39;re supposed to</span>
</span><span id="ntensor-790"><a href="#ntensor-790"><span class="linenos"> 790</span></a><span class="sd">        think about).</span>
</span><span id="ntensor-791"><a href="#ntensor-791"><span class="linenos"> 791</span></a>
</span><span id="ntensor-792"><a href="#ntensor-792"><span class="linenos"> 792</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-793"><a href="#ntensor-793"><span class="linenos"> 793</span></a><span class="sd">        --------</span>
</span><span id="ntensor-794"><a href="#ntensor-794"><span class="linenos"> 794</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]], &quot;day&quot;, &quot;person&quot;)</span>
</span><span id="ntensor-795"><a href="#ntensor-795"><span class="linenos"> 795</span></a><span class="sd">        &gt;&gt;&gt; A.axes == {Axis(&#39;day&#39;), Axis(&#39;person&#39;)}</span>
</span><span id="ntensor-796"><a href="#ntensor-796"><span class="linenos"> 796</span></a><span class="sd">        True</span>
</span><span id="ntensor-797"><a href="#ntensor-797"><span class="linenos"> 797</span></a><span class="sd">        &gt;&gt;&gt; A.axes == {&#39;day&#39;, &#39;person&#39;}</span>
</span><span id="ntensor-798"><a href="#ntensor-798"><span class="linenos"> 798</span></a><span class="sd">        True</span>
</span><span id="ntensor-799"><a href="#ntensor-799"><span class="linenos"> 799</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-800"><a href="#ntensor-800"><span class="linenos"> 800</span></a>        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">)</span>
</span><span id="ntensor-801"><a href="#ntensor-801"><span class="linenos"> 801</span></a>
</span><span id="ntensor-802"><a href="#ntensor-802"><span class="linenos"> 802</span></a>    <span class="c1"># @property</span>
</span><span id="ntensor-803"><a href="#ntensor-803"><span class="linenos"> 803</span></a>    <span class="c1"># def _axes_ordered(self) -&gt; Tuple[Axis, ...]:</span>
</span><span id="ntensor-804"><a href="#ntensor-804"><span class="linenos"> 804</span></a>    <span class="c1">#     return tuple(self._shape.keys())</span>
</span><span id="ntensor-805"><a href="#ntensor-805"><span class="linenos"> 805</span></a>
</span><span id="ntensor-806"><a href="#ntensor-806"><span class="linenos"> 806</span></a>    <span class="nd">@property</span>
</span><span id="ntensor-807"><a href="#ntensor-807"><span class="linenos"> 807</span></a>    <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ntensor-808"><a href="#ntensor-808"><span class="linenos"> 808</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of dimensions. Equal to `len(axes)`</span>
</span><span id="ntensor-809"><a href="#ntensor-809"><span class="linenos"> 809</span></a>
</span><span id="ntensor-810"><a href="#ntensor-810"><span class="linenos"> 810</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-811"><a href="#ntensor-811"><span class="linenos"> 811</span></a><span class="sd">        --------</span>
</span><span id="ntensor-812"><a href="#ntensor-812"><span class="linenos"> 812</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;rows&#39;,&#39;cols&#39;)</span>
</span><span id="ntensor-813"><a href="#ntensor-813"><span class="linenos"> 813</span></a><span class="sd">        &gt;&gt;&gt; A.ndim</span>
</span><span id="ntensor-814"><a href="#ntensor-814"><span class="linenos"> 814</span></a><span class="sd">        2</span>
</span><span id="ntensor-815"><a href="#ntensor-815"><span class="linenos"> 815</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-816"><a href="#ntensor-816"><span class="linenos"> 816</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor-817"><a href="#ntensor-817"><span class="linenos"> 817</span></a>
</span><span id="ntensor-818"><a href="#ntensor-818"><span class="linenos"> 818</span></a>    <span class="nd">@property</span>
</span><span id="ntensor-819"><a href="#ntensor-819"><span class="linenos"> 819</span></a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShapeDict</span><span class="p">:</span>
</span><span id="ntensor-820"><a href="#ntensor-820"><span class="linenos"> 820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The shape is a *dict* mapping axes to ints.</span>
</span><span id="ntensor-821"><a href="#ntensor-821"><span class="linenos"> 821</span></a>
</span><span id="ntensor-822"><a href="#ntensor-822"><span class="linenos"> 822</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-823"><a href="#ntensor-823"><span class="linenos"> 823</span></a><span class="sd">        --------</span>
</span><span id="ntensor-824"><a href="#ntensor-824"><span class="linenos"> 824</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;record&#39;,&#39;hour&#39;)</span>
</span><span id="ntensor-825"><a href="#ntensor-825"><span class="linenos"> 825</span></a><span class="sd">        &gt;&gt;&gt; A.shape</span>
</span><span id="ntensor-826"><a href="#ntensor-826"><span class="linenos"> 826</span></a><span class="sd">        ShapeDict(record=2, hour=3)</span>
</span><span id="ntensor-827"><a href="#ntensor-827"><span class="linenos"> 827</span></a><span class="sd">        &gt;&gt;&gt; print(A.shape)</span>
</span><span id="ntensor-828"><a href="#ntensor-828"><span class="linenos"> 828</span></a><span class="sd">        {record:2, hour:3}</span>
</span><span id="ntensor-829"><a href="#ntensor-829"><span class="linenos"> 829</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-830"><a href="#ntensor-830"><span class="linenos"> 830</span></a>        <span class="k">return</span> <span class="n">ShapeDict</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">)})</span>
</span><span id="ntensor-831"><a href="#ntensor-831"><span class="linenos"> 831</span></a>
</span><span id="ntensor-832"><a href="#ntensor-832"><span class="linenos"> 832</span></a>    <span class="nd">@property</span>
</span><span id="ntensor-833"><a href="#ntensor-833"><span class="linenos"> 833</span></a>    <span class="k">def</span> <span class="nf">_shape_ordered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ntensor-834"><a href="#ntensor-834"><span class="linenos"> 834</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">)</span>
</span><span id="ntensor-835"><a href="#ntensor-835"><span class="linenos"> 835</span></a>
</span><span id="ntensor-836"><a href="#ntensor-836"><span class="linenos"> 836</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ntensor-837"><a href="#ntensor-837"><span class="linenos"> 837</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ntensor-838"><a href="#ntensor-838"><span class="linenos"> 838</span></a>            <span class="k">return</span> <span class="s2">&quot;&lt;ntensor </span><span class="si">{}</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
</span><span id="ntensor-839"><a href="#ntensor-839"><span class="linenos"> 839</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ntensor-840"><a href="#ntensor-840"><span class="linenos"> 840</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ntensor </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="ntensor-841"><a href="#ntensor-841"><span class="linenos"> 841</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ntensor-842"><a href="#ntensor-842"><span class="linenos"> 842</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;ntensor </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ntensor-843"><a href="#ntensor-843"><span class="linenos"> 843</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span><span id="ntensor-844"><a href="#ntensor-844"><span class="linenos"> 844</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="ntensor-845"><a href="#ntensor-845"><span class="linenos"> 845</span></a>
</span><span id="ntensor-846"><a href="#ntensor-846"><span class="linenos"> 846</span></a>    <span class="k">def</span> <span class="nf">numpy_broadcasted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ntensor-847"><a href="#ntensor-847"><span class="linenos"> 847</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to a (Jax) numpy array, by providing order for axes.</span>
</span><span id="ntensor-848"><a href="#ntensor-848"><span class="linenos"> 848</span></a><span class="sd">        If you provide an axis that doesn&#39;t exist, a new one with a singleton dimension</span>
</span><span id="ntensor-849"><a href="#ntensor-849"><span class="linenos"> 849</span></a><span class="sd">        will be created</span>
</span><span id="ntensor-850"><a href="#ntensor-850"><span class="linenos"> 850</span></a>
</span><span id="ntensor-851"><a href="#ntensor-851"><span class="linenos"> 851</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor-852"><a href="#ntensor-852"><span class="linenos"> 852</span></a><span class="sd">        ----------</span>
</span><span id="ntensor-853"><a href="#ntensor-853"><span class="linenos"> 853</span></a><span class="sd">        *axes</span>
</span><span id="ntensor-854"><a href="#ntensor-854"><span class="linenos"> 854</span></a><span class="sd">            The axes, in order. Must include all axes present in self.</span>
</span><span id="ntensor-855"><a href="#ntensor-855"><span class="linenos"> 855</span></a>
</span><span id="ntensor-856"><a href="#ntensor-856"><span class="linenos"> 856</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-857"><a href="#ntensor-857"><span class="linenos"> 857</span></a><span class="sd">        --------</span>
</span><span id="ntensor-858"><a href="#ntensor-858"><span class="linenos"> 858</span></a>
</span><span id="ntensor-859"><a href="#ntensor-859"><span class="linenos"> 859</span></a><span class="sd">        Zero dimensional array</span>
</span><span id="ntensor-860"><a href="#ntensor-860"><span class="linenos"> 860</span></a>
</span><span id="ntensor-861"><a href="#ntensor-861"><span class="linenos"> 861</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor(5)</span>
</span><span id="ntensor-862"><a href="#ntensor-862"><span class="linenos"> 862</span></a><span class="sd">        &gt;&gt;&gt; A</span>
</span><span id="ntensor-863"><a href="#ntensor-863"><span class="linenos"> 863</span></a><span class="sd">        &lt;ntensor {} 5&gt;</span>
</span><span id="ntensor-864"><a href="#ntensor-864"><span class="linenos"> 864</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted())</span>
</span><span id="ntensor-865"><a href="#ntensor-865"><span class="linenos"> 865</span></a><span class="sd">        5</span>
</span><span id="ntensor-866"><a href="#ntensor-866"><span class="linenos"> 866</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;))</span>
</span><span id="ntensor-867"><a href="#ntensor-867"><span class="linenos"> 867</span></a><span class="sd">        [5]</span>
</span><span id="ntensor-868"><a href="#ntensor-868"><span class="linenos"> 868</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="ntensor-869"><a href="#ntensor-869"><span class="linenos"> 869</span></a><span class="sd">        [[5]]</span>
</span><span id="ntensor-870"><a href="#ntensor-870"><span class="linenos"> 870</span></a>
</span><span id="ntensor-871"><a href="#ntensor-871"><span class="linenos"> 871</span></a><span class="sd">        Two-dimensional array</span>
</span><span id="ntensor-872"><a href="#ntensor-872"><span class="linenos"> 872</span></a>
</span><span id="ntensor-873"><a href="#ntensor-873"><span class="linenos"> 873</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="ntensor-874"><a href="#ntensor-874"><span class="linenos"> 874</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="ntensor-875"><a href="#ntensor-875"><span class="linenos"> 875</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="ntensor-876"><a href="#ntensor-876"><span class="linenos"> 876</span></a><span class="sd">         [4 5 6]]</span>
</span><span id="ntensor-877"><a href="#ntensor-877"><span class="linenos"> 877</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;j&#39;,&#39;i&#39;))</span>
</span><span id="ntensor-878"><a href="#ntensor-878"><span class="linenos"> 878</span></a><span class="sd">        [[1 4]</span>
</span><span id="ntensor-879"><a href="#ntensor-879"><span class="linenos"> 879</span></a><span class="sd">         [2 5]</span>
</span><span id="ntensor-880"><a href="#ntensor-880"><span class="linenos"> 880</span></a><span class="sd">         [3 6]]</span>
</span><span id="ntensor-881"><a href="#ntensor-881"><span class="linenos"> 881</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;k&#39;,&#39;j&#39;,&#39;l&#39;).shape)</span>
</span><span id="ntensor-882"><a href="#ntensor-882"><span class="linenos"> 882</span></a><span class="sd">        (2, 1, 3, 1)</span>
</span><span id="ntensor-883"><a href="#ntensor-883"><span class="linenos"> 883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-884"><a href="#ntensor-884"><span class="linenos"> 884</span></a>
</span><span id="ntensor-885"><a href="#ntensor-885"><span class="linenos"> 885</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor-886"><a href="#ntensor-886"><span class="linenos"> 886</span></a>
</span><span id="ntensor-887"><a href="#ntensor-887"><span class="linenos"> 887</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
</span><span id="ntensor-888"><a href="#ntensor-888"><span class="linenos"> 888</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axes </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2"> not a subset of </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor-889"><a href="#ntensor-889"><span class="linenos"> 889</span></a>
</span><span id="ntensor-890"><a href="#ntensor-890"><span class="linenos"> 890</span></a>        <span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
</span><span id="ntensor-891"><a href="#ntensor-891"><span class="linenos"> 891</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">=}</span><span class="s2"> not equal to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor-892"><a href="#ntensor-892"><span class="linenos"> 892</span></a>
</span><span id="ntensor-893"><a href="#ntensor-893"><span class="linenos"> 893</span></a>
</span><span id="ntensor-894"><a href="#ntensor-894"><span class="linenos"> 894</span></a>        <span class="n">extra_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor-895"><a href="#ntensor-895"><span class="linenos"> 895</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">extra_dims</span><span class="p">)</span>
</span><span id="ntensor-896"><a href="#ntensor-896"><span class="linenos"> 896</span></a>        <span class="n">where</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ntensor-897"><a href="#ntensor-897"><span class="linenos"> 897</span></a>        <span class="n">where_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="ntensor-898"><a href="#ntensor-898"><span class="linenos"> 898</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor-899"><a href="#ntensor-899"><span class="linenos"> 899</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor-900"><a href="#ntensor-900"><span class="linenos"> 900</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
</span><span id="ntensor-901"><a href="#ntensor-901"><span class="linenos"> 901</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ntensor-902"><a href="#ntensor-902"><span class="linenos"> 902</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">where_extra</span><span class="p">)</span>
</span><span id="ntensor-903"><a href="#ntensor-903"><span class="linenos"> 903</span></a>                <span class="n">where_extra</span> <span class="o">=</span> <span class="n">where_extra</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ntensor-904"><a href="#ntensor-904"><span class="linenos"> 904</span></a>
</span><span id="ntensor-905"><a href="#ntensor-905"><span class="linenos"> 905</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
</span><span id="ntensor-906"><a href="#ntensor-906"><span class="linenos"> 906</span></a>
</span><span id="ntensor-907"><a href="#ntensor-907"><span class="linenos"> 907</span></a>    <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ntensor-908"><a href="#ntensor-908"><span class="linenos"> 908</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to a (Jax) numpy array, by providing order for axes.</span>
</span><span id="ntensor-909"><a href="#ntensor-909"><span class="linenos"> 909</span></a>
</span><span id="ntensor-910"><a href="#ntensor-910"><span class="linenos"> 910</span></a><span class="sd">        Unlike numpy_broadcasted, you cannot provide new axes. Also, if self has only 1 dimension,</span>
</span><span id="ntensor-911"><a href="#ntensor-911"><span class="linenos"> 911</span></a><span class="sd">        it&#39;s acceptable to skip it.</span>
</span><span id="ntensor-912"><a href="#ntensor-912"><span class="linenos"> 912</span></a>
</span><span id="ntensor-913"><a href="#ntensor-913"><span class="linenos"> 913</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor-914"><a href="#ntensor-914"><span class="linenos"> 914</span></a><span class="sd">        ----------</span>
</span><span id="ntensor-915"><a href="#ntensor-915"><span class="linenos"> 915</span></a><span class="sd">        *axes</span>
</span><span id="ntensor-916"><a href="#ntensor-916"><span class="linenos"> 916</span></a><span class="sd">            The axes, in order. Must have equal number as dimensions, unless number of dimensions is one,</span>
</span><span id="ntensor-917"><a href="#ntensor-917"><span class="linenos"> 917</span></a><span class="sd">            in which case it can be skipped</span>
</span><span id="ntensor-918"><a href="#ntensor-918"><span class="linenos"> 918</span></a>
</span><span id="ntensor-919"><a href="#ntensor-919"><span class="linenos"> 919</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-920"><a href="#ntensor-920"><span class="linenos"> 920</span></a><span class="sd">        --------</span>
</span><span id="ntensor-921"><a href="#ntensor-921"><span class="linenos"> 921</span></a>
</span><span id="ntensor-922"><a href="#ntensor-922"><span class="linenos"> 922</span></a><span class="sd">        Zero dimensional array</span>
</span><span id="ntensor-923"><a href="#ntensor-923"><span class="linenos"> 923</span></a>
</span><span id="ntensor-924"><a href="#ntensor-924"><span class="linenos"> 924</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor(5)</span>
</span><span id="ntensor-925"><a href="#ntensor-925"><span class="linenos"> 925</span></a><span class="sd">        &gt;&gt;&gt; A</span>
</span><span id="ntensor-926"><a href="#ntensor-926"><span class="linenos"> 926</span></a><span class="sd">        &lt;ntensor {} 5&gt;</span>
</span><span id="ntensor-927"><a href="#ntensor-927"><span class="linenos"> 927</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy())</span>
</span><span id="ntensor-928"><a href="#ntensor-928"><span class="linenos"> 928</span></a><span class="sd">        5</span>
</span><span id="ntensor-929"><a href="#ntensor-929"><span class="linenos"> 929</span></a>
</span><span id="ntensor-930"><a href="#ntensor-930"><span class="linenos"> 930</span></a><span class="sd">        One dimensional array</span>
</span><span id="ntensor-931"><a href="#ntensor-931"><span class="linenos"> 931</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="ntensor-932"><a href="#ntensor-932"><span class="linenos"> 932</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;i&#39;))</span>
</span><span id="ntensor-933"><a href="#ntensor-933"><span class="linenos"> 933</span></a><span class="sd">        [1 2 3]</span>
</span><span id="ntensor-934"><a href="#ntensor-934"><span class="linenos"> 934</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy())</span>
</span><span id="ntensor-935"><a href="#ntensor-935"><span class="linenos"> 935</span></a><span class="sd">        [1 2 3]</span>
</span><span id="ntensor-936"><a href="#ntensor-936"><span class="linenos"> 936</span></a>
</span><span id="ntensor-937"><a href="#ntensor-937"><span class="linenos"> 937</span></a><span class="sd">        Two-dimensional array</span>
</span><span id="ntensor-938"><a href="#ntensor-938"><span class="linenos"> 938</span></a>
</span><span id="ntensor-939"><a href="#ntensor-939"><span class="linenos"> 939</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="ntensor-940"><a href="#ntensor-940"><span class="linenos"> 940</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="ntensor-941"><a href="#ntensor-941"><span class="linenos"> 941</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="ntensor-942"><a href="#ntensor-942"><span class="linenos"> 942</span></a><span class="sd">         [4 5 6]]</span>
</span><span id="ntensor-943"><a href="#ntensor-943"><span class="linenos"> 943</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;j&#39;,&#39;i&#39;))</span>
</span><span id="ntensor-944"><a href="#ntensor-944"><span class="linenos"> 944</span></a><span class="sd">        [[1 4]</span>
</span><span id="ntensor-945"><a href="#ntensor-945"><span class="linenos"> 945</span></a><span class="sd">         [2 5]</span>
</span><span id="ntensor-946"><a href="#ntensor-946"><span class="linenos"> 946</span></a><span class="sd">         [3 6]]</span>
</span><span id="ntensor-947"><a href="#ntensor-947"><span class="linenos"> 947</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-948"><a href="#ntensor-948"><span class="linenos"> 948</span></a>
</span><span id="ntensor-949"><a href="#ntensor-949"><span class="linenos"> 949</span></a>        <span class="k">if</span> <span class="n">axes</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ntensor-950"><a href="#ntensor-950"><span class="linenos"> 950</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>
</span><span id="ntensor-951"><a href="#ntensor-951"><span class="linenos"> 951</span></a>
</span><span id="ntensor-952"><a href="#ntensor-952"><span class="linenos"> 952</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor-953"><a href="#ntensor-953"><span class="linenos"> 953</span></a>
</span><span id="ntensor-954"><a href="#ntensor-954"><span class="linenos"> 954</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor-955"><a href="#ntensor-955"><span class="linenos"> 955</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided axes </span><span class="si">{</span><span class="n">axes</span><span class="si">}</span><span class="s2"> do not match ntensor axes </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor-956"><a href="#ntensor-956"><span class="linenos"> 956</span></a>
</span><span id="ntensor-957"><a href="#ntensor-957"><span class="linenos"> 957</span></a>
</span><span id="ntensor-958"><a href="#ntensor-958"><span class="linenos"> 958</span></a>        <span class="n">extra_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor-959"><a href="#ntensor-959"><span class="linenos"> 959</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">extra_dims</span><span class="p">)</span>
</span><span id="ntensor-960"><a href="#ntensor-960"><span class="linenos"> 960</span></a>        <span class="n">where</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ntensor-961"><a href="#ntensor-961"><span class="linenos"> 961</span></a>        <span class="n">where_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="ntensor-962"><a href="#ntensor-962"><span class="linenos"> 962</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor-963"><a href="#ntensor-963"><span class="linenos"> 963</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor-964"><a href="#ntensor-964"><span class="linenos"> 964</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
</span><span id="ntensor-965"><a href="#ntensor-965"><span class="linenos"> 965</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ntensor-966"><a href="#ntensor-966"><span class="linenos"> 966</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">where_extra</span><span class="p">)</span>
</span><span id="ntensor-967"><a href="#ntensor-967"><span class="linenos"> 967</span></a>                <span class="n">where_extra</span> <span class="o">=</span> <span class="n">where_extra</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ntensor-968"><a href="#ntensor-968"><span class="linenos"> 968</span></a>
</span><span id="ntensor-969"><a href="#ntensor-969"><span class="linenos"> 969</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
</span><span id="ntensor-970"><a href="#ntensor-970"><span class="linenos"> 970</span></a>
</span><span id="ntensor-971"><a href="#ntensor-971"><span class="linenos"> 971</span></a>
</span><span id="ntensor-972"><a href="#ntensor-972"><span class="linenos"> 972</span></a>
</span><span id="ntensor-973"><a href="#ntensor-973"><span class="linenos"> 973</span></a>    <span class="c1"># def __getitem__(self, idx):</span>
</span><span id="ntensor-974"><a href="#ntensor-974"><span class="linenos"> 974</span></a>    <span class="c1">#     if isinstance(idx, slice):</span>
</span><span id="ntensor-975"><a href="#ntensor-975"><span class="linenos"> 975</span></a>    <span class="c1">#         raise ValueError(&quot;Can&#39;t index NTensor with slice. (Remember, A[i,j] converts to numpy)&quot;)</span>
</span><span id="ntensor-976"><a href="#ntensor-976"><span class="linenos"> 976</span></a>    <span class="c1">#</span>
</span><span id="ntensor-977"><a href="#ntensor-977"><span class="linenos"> 977</span></a>    <span class="c1">#     if isinstance(idx, int):</span>
</span><span id="ntensor-978"><a href="#ntensor-978"><span class="linenos"> 978</span></a>    <span class="c1">#         raise ValueError(&quot;Can&#39;t index NTensor with int. (Remember, A[i] converts to numpy)&quot;)</span>
</span><span id="ntensor-979"><a href="#ntensor-979"><span class="linenos"> 979</span></a>    <span class="c1">#</span>
</span><span id="ntensor-980"><a href="#ntensor-980"><span class="linenos"> 980</span></a>    <span class="c1">#     if idx is ...:</span>
</span><span id="ntensor-981"><a href="#ntensor-981"><span class="linenos"> 981</span></a>    <span class="c1">#         if self.shape != {}:</span>
</span><span id="ntensor-982"><a href="#ntensor-982"><span class="linenos"> 982</span></a>    <span class="c1">#             raise ValueError(</span>
</span><span id="ntensor-983"><a href="#ntensor-983"><span class="linenos"> 983</span></a>    <span class="c1">#                 f&quot;Can only call A[...] for scalar NTensor, got shape {self.shape})&quot;)</span>
</span><span id="ntensor-984"><a href="#ntensor-984"><span class="linenos"> 984</span></a>    <span class="c1">#         else:</span>
</span><span id="ntensor-985"><a href="#ntensor-985"><span class="linenos"> 985</span></a>    <span class="c1">#             return self.numpy_broadcasted()</span>
</span><span id="ntensor-986"><a href="#ntensor-986"><span class="linenos"> 986</span></a>    <span class="c1">#</span>
</span><span id="ntensor-987"><a href="#ntensor-987"><span class="linenos"> 987</span></a>    <span class="c1">#     if isinstance(idx, (str, Axis)):</span>
</span><span id="ntensor-988"><a href="#ntensor-988"><span class="linenos"> 988</span></a>    <span class="c1">#         return self.numpy_broadcasted(idx)</span>
</span><span id="ntensor-989"><a href="#ntensor-989"><span class="linenos"> 989</span></a>    <span class="c1">#</span>
</span><span id="ntensor-990"><a href="#ntensor-990"><span class="linenos"> 990</span></a>    <span class="c1">#     if len(idx) != self.ndim:</span>
</span><span id="ntensor-991"><a href="#ntensor-991"><span class="linenos"> 991</span></a>    <span class="c1">#         raise ValueError(</span>
</span><span id="ntensor-992"><a href="#ntensor-992"><span class="linenos"> 992</span></a>    <span class="c1">#             f&quot;Number of indices in {idx} not equal to number of dimensions ({self.ndim})&quot;)</span>
</span><span id="ntensor-993"><a href="#ntensor-993"><span class="linenos"> 993</span></a>    <span class="c1">#</span>
</span><span id="ntensor-994"><a href="#ntensor-994"><span class="linenos"> 994</span></a>    <span class="c1">#     return self.numpy_broadcasted(*idx)</span>
</span><span id="ntensor-995"><a href="#ntensor-995"><span class="linenos"> 995</span></a>
</span><span id="ntensor-996"><a href="#ntensor-996"><span class="linenos"> 996</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Self</span> <span class="o">|</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ntensor-997"><a href="#ntensor-997"><span class="linenos"> 997</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor-998"><a href="#ntensor-998"><span class="linenos"> 998</span></a><span class="sd">        Do fully-batched addition. Unlike `add`, this seamlessly handles arrays of any shape with</span>
</span><span id="ntensor-999"><a href="#ntensor-999"><span class="linenos"> 999</span></a><span class="sd">        full automatic broadcasting.</span>
</span><span id="ntensor-1000"><a href="#ntensor-1000"><span class="linenos">1000</span></a>
</span><span id="ntensor-1001"><a href="#ntensor-1001"><span class="linenos">1001</span></a><span class="sd">        `A+B` is equivalent to `add(self, other)`, i.e. maps over all axes.</span>
</span><span id="ntensor-1002"><a href="#ntensor-1002"><span class="linenos">1002</span></a>
</span><span id="ntensor-1003"><a href="#ntensor-1003"><span class="linenos">1003</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-1004"><a href="#ntensor-1004"><span class="linenos">1004</span></a><span class="sd">        -------</span>
</span><span id="ntensor-1005"><a href="#ntensor-1005"><span class="linenos">1005</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1,2],&#39;cats&#39;)</span>
</span><span id="ntensor-1006"><a href="#ntensor-1006"><span class="linenos">1006</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([0,5],&#39;dogs&#39;)</span>
</span><span id="ntensor-1007"><a href="#ntensor-1007"><span class="linenos">1007</span></a><span class="sd">        &gt;&gt;&gt; (A+B).shape == {&#39;cats&#39;: 3, &#39;dogs&#39;:2}</span>
</span><span id="ntensor-1008"><a href="#ntensor-1008"><span class="linenos">1008</span></a><span class="sd">        True</span>
</span><span id="ntensor-1009"><a href="#ntensor-1009"><span class="linenos">1009</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-1010"><a href="#ntensor-1010"><span class="linenos">1010</span></a>
</span><span id="ntensor-1011"><a href="#ntensor-1011"><span class="linenos">1011</span></a>        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="ntensor-1012"><a href="#ntensor-1012"><span class="linenos">1012</span></a>
</span><span id="ntensor-1013"><a href="#ntensor-1013"><span class="linenos">1013</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1014"><a href="#ntensor-1014"><span class="linenos">1014</span></a>        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="ntensor-1015"><a href="#ntensor-1015"><span class="linenos">1015</span></a>
</span><span id="ntensor-1016"><a href="#ntensor-1016"><span class="linenos">1016</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1017"><a href="#ntensor-1017"><span class="linenos">1017</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor-1018"><a href="#ntensor-1018"><span class="linenos">1018</span></a><span class="sd">        Do fully-batched substraction.</span>
</span><span id="ntensor-1019"><a href="#ntensor-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-1020"><a href="#ntensor-1020"><span class="linenos">1020</span></a>        <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="ntensor-1021"><a href="#ntensor-1021"><span class="linenos">1021</span></a>
</span><span id="ntensor-1022"><a href="#ntensor-1022"><span class="linenos">1022</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1023"><a href="#ntensor-1023"><span class="linenos">1023</span></a>        <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="ntensor-1024"><a href="#ntensor-1024"><span class="linenos">1024</span></a>
</span><span id="ntensor-1025"><a href="#ntensor-1025"><span class="linenos">1025</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1026"><a href="#ntensor-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor-1027"><a href="#ntensor-1027"><span class="linenos">1027</span></a><span class="sd">        Do fully-batched multiplication.</span>
</span><span id="ntensor-1028"><a href="#ntensor-1028"><span class="linenos">1028</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-1029"><a href="#ntensor-1029"><span class="linenos">1029</span></a>        <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="ntensor-1030"><a href="#ntensor-1030"><span class="linenos">1030</span></a>
</span><span id="ntensor-1031"><a href="#ntensor-1031"><span class="linenos">1031</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1032"><a href="#ntensor-1032"><span class="linenos">1032</span></a>        <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="ntensor-1033"><a href="#ntensor-1033"><span class="linenos">1033</span></a>
</span><span id="ntensor-1034"><a href="#ntensor-1034"><span class="linenos">1034</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1035"><a href="#ntensor-1035"><span class="linenos">1035</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor-1036"><a href="#ntensor-1036"><span class="linenos">1036</span></a><span class="sd">        Do fully-batched division.</span>
</span><span id="ntensor-1037"><a href="#ntensor-1037"><span class="linenos">1037</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-1038"><a href="#ntensor-1038"><span class="linenos">1038</span></a>        <span class="k">return</span> <span class="n">true_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="ntensor-1039"><a href="#ntensor-1039"><span class="linenos">1039</span></a>
</span><span id="ntensor-1040"><a href="#ntensor-1040"><span class="linenos">1040</span></a>    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1041"><a href="#ntensor-1041"><span class="linenos">1041</span></a>        <span class="k">return</span> <span class="n">true_divide</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="ntensor-1042"><a href="#ntensor-1042"><span class="linenos">1042</span></a>
</span><span id="ntensor-1043"><a href="#ntensor-1043"><span class="linenos">1043</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1044"><a href="#ntensor-1044"><span class="linenos">1044</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor-1045"><a href="#ntensor-1045"><span class="linenos">1045</span></a><span class="sd">        Do fully-batched powers.</span>
</span><span id="ntensor-1046"><a href="#ntensor-1046"><span class="linenos">1046</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-1047"><a href="#ntensor-1047"><span class="linenos">1047</span></a>        <span class="k">return</span> <span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="ntensor-1048"><a href="#ntensor-1048"><span class="linenos">1048</span></a>
</span><span id="ntensor-1049"><a href="#ntensor-1049"><span class="linenos">1049</span></a>    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1050"><a href="#ntensor-1050"><span class="linenos">1050</span></a>        <span class="k">return</span> <span class="n">power</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="ntensor-1051"><a href="#ntensor-1051"><span class="linenos">1051</span></a>
</span><span id="ntensor-1052"><a href="#ntensor-1052"><span class="linenos">1052</span></a>    <span class="c1"># def __float__(self)-&gt;float:</span>
</span><span id="ntensor-1053"><a href="#ntensor-1053"><span class="linenos">1053</span></a>    <span class="c1">#     if self.shape != {}:</span>
</span><span id="ntensor-1054"><a href="#ntensor-1054"><span class="linenos">1054</span></a>    <span class="c1">#         raise ValueError(f&quot;Can&#39;t convert NTensor with shape {self.shape} to float&quot;)</span>
</span><span id="ntensor-1055"><a href="#ntensor-1055"><span class="linenos">1055</span></a>    <span class="c1">#     return float(self._data)</span>
</span><span id="ntensor-1056"><a href="#ntensor-1056"><span class="linenos">1056</span></a>
</span><span id="ntensor-1057"><a href="#ntensor-1057"><span class="linenos">1057</span></a>    <span class="c1"># def __array__(self)-&gt;jnp.ndarray:</span>
</span><span id="ntensor-1058"><a href="#ntensor-1058"><span class="linenos">1058</span></a>    <span class="c1">#     print(&quot;ARRAY CALLED&quot;)</span>
</span><span id="ntensor-1059"><a href="#ntensor-1059"><span class="linenos">1059</span></a>    <span class="c1">#     if self.shape != {}:</span>
</span><span id="ntensor-1060"><a href="#ntensor-1060"><span class="linenos">1060</span></a>    <span class="c1">#         raise ValueError(f&quot;Can&#39;t convert NTensor with shape {self.shape} to array&quot;)</span>
</span><span id="ntensor-1061"><a href="#ntensor-1061"><span class="linenos">1061</span></a>    <span class="c1">#     return self._data</span>
</span><span id="ntensor-1062"><a href="#ntensor-1062"><span class="linenos">1062</span></a>    <span class="c1">#</span>
</span><span id="ntensor-1063"><a href="#ntensor-1063"><span class="linenos">1063</span></a>    <span class="c1"># @property</span>
</span><span id="ntensor-1064"><a href="#ntensor-1064"><span class="linenos">1064</span></a>    <span class="c1"># def dtype(self):</span>
</span><span id="ntensor-1065"><a href="#ntensor-1065"><span class="linenos">1065</span></a>    <span class="c1">#     print(&quot;DTYPE CALLED&quot;)</span>
</span><span id="ntensor-1066"><a href="#ntensor-1066"><span class="linenos">1066</span></a>    <span class="c1">#     return self._data.dtype</span>
</span><span id="ntensor-1067"><a href="#ntensor-1067"><span class="linenos">1067</span></a>    <span class="c1">#</span>
</span><span id="ntensor-1068"><a href="#ntensor-1068"><span class="linenos">1068</span></a>    <span class="c1"># @property</span>
</span><span id="ntensor-1069"><a href="#ntensor-1069"><span class="linenos">1069</span></a>    <span class="c1"># def aval(self):</span>
</span><span id="ntensor-1070"><a href="#ntensor-1070"><span class="linenos">1070</span></a>    <span class="c1">#     print(&quot;AVAL CALLED&quot;)</span>
</span><span id="ntensor-1071"><a href="#ntensor-1071"><span class="linenos">1071</span></a>    <span class="c1">#     #return self._data.aval</span>
</span><span id="ntensor-1072"><a href="#ntensor-1072"><span class="linenos">1072</span></a>    <span class="c1">#     return jax.core.ShapedArray((),dtype=self._data.dtype)</span>
</span><span id="ntensor-1073"><a href="#ntensor-1073"><span class="linenos">1073</span></a>    <span class="c1">#     #return jnp.ones(())</span>
</span><span id="ntensor-1074"><a href="#ntensor-1074"><span class="linenos">1074</span></a>
</span><span id="ntensor-1075"><a href="#ntensor-1075"><span class="linenos">1075</span></a>    <span class="c1"># @property</span>
</span><span id="ntensor-1076"><a href="#ntensor-1076"><span class="linenos">1076</span></a>    <span class="c1"># def T(self):</span>
</span><span id="ntensor-1077"><a href="#ntensor-1077"><span class="linenos">1077</span></a>    <span class="c1">#     return NTensor(self._data, *reversed(self._axes_ordered))</span>
</span><span id="ntensor-1078"><a href="#ntensor-1078"><span class="linenos">1078</span></a>    <span class="c1">#</span>
</span><span id="ntensor-1079"><a href="#ntensor-1079"><span class="linenos">1079</span></a>    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1080"><a href="#ntensor-1080"><span class="linenos">1080</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor-1081"><a href="#ntensor-1081"><span class="linenos">1081</span></a>
</span><span id="ntensor-1082"><a href="#ntensor-1082"><span class="linenos">1082</span></a><span class="sd">        Do einstein summation on two arrays, taking reductions over all shared axes. This is equivalent to</span>
</span><span id="ntensor-1083"><a href="#ntensor-1083"><span class="linenos">1083</span></a><span class="sd">        an alias for `dot(self, other)`.</span>
</span><span id="ntensor-1084"><a href="#ntensor-1084"><span class="linenos">1084</span></a>
</span><span id="ntensor-1085"><a href="#ntensor-1085"><span class="linenos">1085</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor-1086"><a href="#ntensor-1086"><span class="linenos">1086</span></a><span class="sd">        ----------</span>
</span><span id="ntensor-1087"><a href="#ntensor-1087"><span class="linenos">1087</span></a><span class="sd">        other: ntensor</span>
</span><span id="ntensor-1088"><a href="#ntensor-1088"><span class="linenos">1088</span></a>
</span><span id="ntensor-1089"><a href="#ntensor-1089"><span class="linenos">1089</span></a><span class="sd">        Returns</span>
</span><span id="ntensor-1090"><a href="#ntensor-1090"><span class="linenos">1090</span></a><span class="sd">        -------</span>
</span><span id="ntensor-1091"><a href="#ntensor-1091"><span class="linenos">1091</span></a><span class="sd">        result: ntensor</span>
</span><span id="ntensor-1092"><a href="#ntensor-1092"><span class="linenos">1092</span></a><span class="sd">            result of Einstein summation on two arrays.</span>
</span><span id="ntensor-1093"><a href="#ntensor-1093"><span class="linenos">1093</span></a>
</span><span id="ntensor-1094"><a href="#ntensor-1094"><span class="linenos">1094</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-1095"><a href="#ntensor-1095"><span class="linenos">1095</span></a><span class="sd">        --------</span>
</span><span id="ntensor-1096"><a href="#ntensor-1096"><span class="linenos">1096</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="ntensor-1097"><a href="#ntensor-1097"><span class="linenos">1097</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([5,1,3],&#39;i&#39;)</span>
</span><span id="ntensor-1098"><a href="#ntensor-1098"><span class="linenos">1098</span></a><span class="sd">        &gt;&gt;&gt; A @ B</span>
</span><span id="ntensor-1099"><a href="#ntensor-1099"><span class="linenos">1099</span></a><span class="sd">        &lt;ntensor {} 7&gt;</span>
</span><span id="ntensor-1100"><a href="#ntensor-1100"><span class="linenos">1100</span></a>
</span><span id="ntensor-1101"><a href="#ntensor-1101"><span class="linenos">1101</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1],&#39;i&#39;)</span>
</span><span id="ntensor-1102"><a href="#ntensor-1102"><span class="linenos">1102</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([0,2],&#39;j&#39;)</span>
</span><span id="ntensor-1103"><a href="#ntensor-1103"><span class="linenos">1103</span></a><span class="sd">        &gt;&gt;&gt; A @ B</span>
</span><span id="ntensor-1104"><a href="#ntensor-1104"><span class="linenos">1104</span></a><span class="sd">        &lt;ntensor {i:2, j:2}</span>
</span><span id="ntensor-1105"><a href="#ntensor-1105"><span class="linenos">1105</span></a><span class="sd">        [[0 0]</span>
</span><span id="ntensor-1106"><a href="#ntensor-1106"><span class="linenos">1106</span></a><span class="sd">         [0 2]]&gt;</span>
</span><span id="ntensor-1107"><a href="#ntensor-1107"><span class="linenos">1107</span></a>
</span><span id="ntensor-1108"><a href="#ntensor-1108"><span class="linenos">1108</span></a>
</span><span id="ntensor-1109"><a href="#ntensor-1109"><span class="linenos">1109</span></a><span class="sd">        See Also</span>
</span><span id="ntensor-1110"><a href="#ntensor-1110"><span class="linenos">1110</span></a><span class="sd">        --------</span>
</span><span id="ntensor-1111"><a href="#ntensor-1111"><span class="linenos">1111</span></a><span class="sd">        dot</span>
</span><span id="ntensor-1112"><a href="#ntensor-1112"><span class="linenos">1112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-1113"><a href="#ntensor-1113"><span class="linenos">1113</span></a>        <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="ntensor-1114"><a href="#ntensor-1114"><span class="linenos">1114</span></a>
</span><span id="ntensor-1115"><a href="#ntensor-1115"><span class="linenos">1115</span></a>    <span class="k">def</span> <span class="fm">__rmatmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1116"><a href="#ntensor-1116"><span class="linenos">1116</span></a>        <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="ntensor-1117"><a href="#ntensor-1117"><span class="linenos">1117</span></a>
</span><span id="ntensor-1118"><a href="#ntensor-1118"><span class="linenos">1118</span></a>    <span class="c1"># def __getitem__(self,idx)-&gt;&#39;array&#39;:</span>
</span><span id="ntensor-1119"><a href="#ntensor-1119"><span class="linenos">1119</span></a>    <span class="c1">#     if not isinstance(idx,tuple):</span>
</span><span id="ntensor-1120"><a href="#ntensor-1120"><span class="linenos">1120</span></a>    <span class="c1">#         idx = (idx,)</span>
</span><span id="ntensor-1121"><a href="#ntensor-1121"><span class="linenos">1121</span></a>    <span class="c1">#     assert builtins.all(isinstance(i,IndexedAxis) for i in idx), &quot;all inputs must be</span>
</span><span id="ntensor-1122"><a href="#ntensor-1122"><span class="linenos">1122</span></a>    <span class="c1">#     IndexedAxis&quot;</span>
</span><span id="ntensor-1123"><a href="#ntensor-1123"><span class="linenos">1123</span></a>    <span class="c1">#     return select(self, **{i.axis.name:i.index for i in idx})</span>
</span><span id="ntensor-1124"><a href="#ntensor-1124"><span class="linenos">1124</span></a>
</span><span id="ntensor-1125"><a href="#ntensor-1125"><span class="linenos">1125</span></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1126"><a href="#ntensor-1126"><span class="linenos">1126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor-1127"><a href="#ntensor-1127"><span class="linenos">1127</span></a>
</span><span id="ntensor-1128"><a href="#ntensor-1128"><span class="linenos">1128</span></a><span class="sd">        Index this array. All indexing follows the One True Rule:</span>
</span><span id="ntensor-1129"><a href="#ntensor-1129"><span class="linenos">1129</span></a><span class="sd">        * All axes must be indexed.</span>
</span><span id="ntensor-1130"><a href="#ntensor-1130"><span class="linenos">1130</span></a><span class="sd">        * All indices are themselves `arrays`.</span>
</span><span id="ntensor-1131"><a href="#ntensor-1131"><span class="linenos">1131</span></a><span class="sd">        * The axes of the indices determine the output axes.</span>
</span><span id="ntensor-1132"><a href="#ntensor-1132"><span class="linenos">1132</span></a><span class="sd">        * Non-shared axes in indices are orthogonal.</span>
</span><span id="ntensor-1133"><a href="#ntensor-1133"><span class="linenos">1133</span></a><span class="sd">        * Shared axes in indices are pointwise. (And must therefore have equal lengths!)</span>
</span><span id="ntensor-1134"><a href="#ntensor-1134"><span class="linenos">1134</span></a>
</span><span id="ntensor-1135"><a href="#ntensor-1135"><span class="linenos">1135</span></a><span class="sd">        That&#39;s it. That&#39;s the only *real* rule. (Cf. numpy&#39;s [insanely complex advanced indexing</span>
</span><span id="ntensor-1136"><a href="#ntensor-1136"><span class="linenos">1136</span></a><span class="sd">        rules](https://numpy.org/doc/stable/user/basics.indexing.html#advanced-indexing).) But to</span>
</span><span id="ntensor-1137"><a href="#ntensor-1137"><span class="linenos">1137</span></a><span class="sd">        make things nicer, we offer some ergonomic syntactic sugar.</span>
</span><span id="ntensor-1138"><a href="#ntensor-1138"><span class="linenos">1138</span></a>
</span><span id="ntensor-1139"><a href="#ntensor-1139"><span class="linenos">1139</span></a><span class="sd">        1. If you don&#39;t explicitly index an input axis, it is implicitly fully sliced,</span>
</span><span id="ntensor-1140"><a href="#ntensor-1140"><span class="linenos">1140</span></a><span class="sd">        with itself as an output axis.</span>
</span><span id="ntensor-1141"><a href="#ntensor-1141"><span class="linenos">1141</span></a><span class="sd">        2. You can slice an input axis and then use that as an index.</span>
</span><span id="ntensor-1142"><a href="#ntensor-1142"><span class="linenos">1142</span></a><span class="sd">        3. You can index any axis (input or not) with a slice or 1-d list/tuple/numpy array. This</span>
</span><span id="ntensor-1143"><a href="#ntensor-1143"><span class="linenos">1143</span></a><span class="sd">        is treated like a 1-d array with that axis.</span>
</span><span id="ntensor-1144"><a href="#ntensor-1144"><span class="linenos">1144</span></a>
</span><span id="ntensor-1145"><a href="#ntensor-1145"><span class="linenos">1145</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor-1146"><a href="#ntensor-1146"><span class="linenos">1146</span></a><span class="sd">        ----------</span>
</span><span id="ntensor-1147"><a href="#ntensor-1147"><span class="linenos">1147</span></a><span class="sd">        kwargs</span>
</span><span id="ntensor-1148"><a href="#ntensor-1148"><span class="linenos">1148</span></a>
</span><span id="ntensor-1149"><a href="#ntensor-1149"><span class="linenos">1149</span></a><span class="sd">        Returns</span>
</span><span id="ntensor-1150"><a href="#ntensor-1150"><span class="linenos">1150</span></a><span class="sd">        -------</span>
</span><span id="ntensor-1151"><a href="#ntensor-1151"><span class="linenos">1151</span></a><span class="sd">        out: ntensor</span>
</span><span id="ntensor-1152"><a href="#ntensor-1152"><span class="linenos">1152</span></a>
</span><span id="ntensor-1153"><a href="#ntensor-1153"><span class="linenos">1153</span></a><span class="sd">        Examples</span>
</span><span id="ntensor-1154"><a href="#ntensor-1154"><span class="linenos">1154</span></a><span class="sd">        --------</span>
</span><span id="ntensor-1155"><a href="#ntensor-1155"><span class="linenos">1155</span></a>
</span><span id="ntensor-1156"><a href="#ntensor-1156"><span class="linenos">1156</span></a><span class="sd">        You *can&#39;t* index arrays without giving names for axes. If you try, you get an error. (I</span>
</span><span id="ntensor-1157"><a href="#ntensor-1157"><span class="linenos">1157</span></a><span class="sd">        *told* you this package was uncompromising, right?)</span>
</span><span id="ntensor-1158"><a href="#ntensor-1158"><span class="linenos">1158</span></a>
</span><span id="ntensor-1159"><a href="#ntensor-1159"><span class="linenos">1159</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45],&#39;i&#39;)</span>
</span><span id="ntensor-1160"><a href="#ntensor-1160"><span class="linenos">1160</span></a><span class="sd">        &gt;&gt;&gt; A[1] # Nope. No! Doesn&#39;t work!</span>
</span><span id="ntensor-1161"><a href="#ntensor-1161"><span class="linenos">1161</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="ntensor-1162"><a href="#ntensor-1162"><span class="linenos">1162</span></a><span class="sd">        ...</span>
</span><span id="ntensor-1163"><a href="#ntensor-1163"><span class="linenos">1163</span></a><span class="sd">        ValueError: Can&#39;t index NTensor with int. (Remember, A[i] converts to numpy)</span>
</span><span id="ntensor-1164"><a href="#ntensor-1164"><span class="linenos">1164</span></a>
</span><span id="ntensor-1165"><a href="#ntensor-1165"><span class="linenos">1165</span></a><span class="sd">        You do it like this, always with keywork arguments for axes.</span>
</span><span id="ntensor-1166"><a href="#ntensor-1166"><span class="linenos">1166</span></a>
</span><span id="ntensor-1167"><a href="#ntensor-1167"><span class="linenos">1167</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45],&#39;i&#39;)</span>
</span><span id="ntensor-1168"><a href="#ntensor-1168"><span class="linenos">1168</span></a><span class="sd">        &gt;&gt;&gt; A(i=1) # yes!</span>
</span><span id="ntensor-1169"><a href="#ntensor-1169"><span class="linenos">1169</span></a><span class="sd">        &lt;ntensor {} 30&gt;</span>
</span><span id="ntensor-1170"><a href="#ntensor-1170"><span class="linenos">1170</span></a>
</span><span id="ntensor-1171"><a href="#ntensor-1171"><span class="linenos">1171</span></a><span class="sd">        Here are examples illustrating the one true rule</span>
</span><span id="ntensor-1172"><a href="#ntensor-1172"><span class="linenos">1172</span></a>
</span><span id="ntensor-1173"><a href="#ntensor-1173"><span class="linenos">1173</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=5, j=6)</span>
</span><span id="ntensor-1174"><a href="#ntensor-1174"><span class="linenos">1174</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([1,0],&#39;n&#39;)</span>
</span><span id="ntensor-1175"><a href="#ntensor-1175"><span class="linenos">1175</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([2,3],&#39;n&#39;)</span>
</span><span id="ntensor-1176"><a href="#ntensor-1176"><span class="linenos">1176</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index)</span>
</span><span id="ntensor-1177"><a href="#ntensor-1177"><span class="linenos">1177</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ntensor-1178"><a href="#ntensor-1178"><span class="linenos">1178</span></a><span class="sd">        {n:2}</span>
</span><span id="ntensor-1179"><a href="#ntensor-1179"><span class="linenos">1179</span></a><span class="sd">        &gt;&gt;&gt; B(n=0) == A(i=1, j=2)</span>
</span><span id="ntensor-1180"><a href="#ntensor-1180"><span class="linenos">1180</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor-1181"><a href="#ntensor-1181"><span class="linenos">1181</span></a><span class="sd">        &gt;&gt;&gt; B(n=1) == A(i=0, j=3)</span>
</span><span id="ntensor-1182"><a href="#ntensor-1182"><span class="linenos">1182</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor-1183"><a href="#ntensor-1183"><span class="linenos">1183</span></a>
</span><span id="ntensor-1184"><a href="#ntensor-1184"><span class="linenos">1184</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=5, j=6)</span>
</span><span id="ntensor-1185"><a href="#ntensor-1185"><span class="linenos">1185</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([1,0],&#39;n&#39;)</span>
</span><span id="ntensor-1186"><a href="#ntensor-1186"><span class="linenos">1186</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([2,3],&#39;m&#39;)</span>
</span><span id="ntensor-1187"><a href="#ntensor-1187"><span class="linenos">1187</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index)</span>
</span><span id="ntensor-1188"><a href="#ntensor-1188"><span class="linenos">1188</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ntensor-1189"><a href="#ntensor-1189"><span class="linenos">1189</span></a><span class="sd">        {n:2, m:2}</span>
</span><span id="ntensor-1190"><a href="#ntensor-1190"><span class="linenos">1190</span></a><span class="sd">        &gt;&gt;&gt; B(n=0, m=0) == A(i=1, j=2)</span>
</span><span id="ntensor-1191"><a href="#ntensor-1191"><span class="linenos">1191</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor-1192"><a href="#ntensor-1192"><span class="linenos">1192</span></a><span class="sd">        &gt;&gt;&gt; B(n=0, m=1) == A(i=1, j=3)</span>
</span><span id="ntensor-1193"><a href="#ntensor-1193"><span class="linenos">1193</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor-1194"><a href="#ntensor-1194"><span class="linenos">1194</span></a><span class="sd">        &gt;&gt;&gt; B(n=1, m=0) == A(i=0, j=2)</span>
</span><span id="ntensor-1195"><a href="#ntensor-1195"><span class="linenos">1195</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor-1196"><a href="#ntensor-1196"><span class="linenos">1196</span></a><span class="sd">        &gt;&gt;&gt; B(n=1, m=1) == A(i=0, j=3)</span>
</span><span id="ntensor-1197"><a href="#ntensor-1197"><span class="linenos">1197</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor-1198"><a href="#ntensor-1198"><span class="linenos">1198</span></a>
</span><span id="ntensor-1199"><a href="#ntensor-1199"><span class="linenos">1199</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=20, j=20, k=20)</span>
</span><span id="ntensor-1200"><a href="#ntensor-1200"><span class="linenos">1200</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([[0,1,2],[3,4,5]],&#39;k&#39;,&#39;l&#39;)</span>
</span><span id="ntensor-1201"><a href="#ntensor-1201"><span class="linenos">1201</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([6,7,8],&#39;l&#39;)</span>
</span><span id="ntensor-1202"><a href="#ntensor-1202"><span class="linenos">1202</span></a><span class="sd">        &gt;&gt;&gt; k_index = ntensor([9,10,11,12],&#39;m&#39;)</span>
</span><span id="ntensor-1203"><a href="#ntensor-1203"><span class="linenos">1203</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index, k=k_index)</span>
</span><span id="ntensor-1204"><a href="#ntensor-1204"><span class="linenos">1204</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ntensor-1205"><a href="#ntensor-1205"><span class="linenos">1205</span></a><span class="sd">        {k:2, l:3, m:4}</span>
</span><span id="ntensor-1206"><a href="#ntensor-1206"><span class="linenos">1206</span></a>
</span><span id="ntensor-1207"><a href="#ntensor-1207"><span class="linenos">1207</span></a><span class="sd">        You can re-use input as output dimensions if you want. This changes nothing! It&#39;s</span>
</span><span id="ntensor-1208"><a href="#ntensor-1208"><span class="linenos">1208</span></a><span class="sd">        equivalent to using all new dimensions and then relabeling.</span>
</span><span id="ntensor-1209"><a href="#ntensor-1209"><span class="linenos">1209</span></a>
</span><span id="ntensor-1210"><a href="#ntensor-1210"><span class="linenos">1210</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([[0,1,2],[3,4,5]],&#39;k&#39;,&#39;i&#39;)</span>
</span><span id="ntensor-1211"><a href="#ntensor-1211"><span class="linenos">1211</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([6,7,8],&#39;i&#39;)</span>
</span><span id="ntensor-1212"><a href="#ntensor-1212"><span class="linenos">1212</span></a><span class="sd">        &gt;&gt;&gt; k_index = ntensor([9,10,11,12],&#39;m&#39;)</span>
</span><span id="ntensor-1213"><a href="#ntensor-1213"><span class="linenos">1213</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index, k=k_index)</span>
</span><span id="ntensor-1214"><a href="#ntensor-1214"><span class="linenos">1214</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ntensor-1215"><a href="#ntensor-1215"><span class="linenos">1215</span></a><span class="sd">        {k:2, i:3, m:4}</span>
</span><span id="ntensor-1216"><a href="#ntensor-1216"><span class="linenos">1216</span></a>
</span><span id="ntensor-1217"><a href="#ntensor-1217"><span class="linenos">1217</span></a><span class="sd">        Examples using syntacic sugar for numbers or 1-d lists/tuple/numpy arrays or slices as</span>
</span><span id="ntensor-1218"><a href="#ntensor-1218"><span class="linenos">1218</span></a><span class="sd">        indices</span>
</span><span id="ntensor-1219"><a href="#ntensor-1219"><span class="linenos">1219</span></a>
</span><span id="ntensor-1220"><a href="#ntensor-1220"><span class="linenos">1220</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="ntensor-1221"><a href="#ntensor-1221"><span class="linenos">1221</span></a><span class="sd">        &gt;&gt;&gt; A(i=2)                    # ints work</span>
</span><span id="ntensor-1222"><a href="#ntensor-1222"><span class="linenos">1222</span></a><span class="sd">        &lt;ntensor {} 45&gt;</span>
</span><span id="ntensor-1223"><a href="#ntensor-1223"><span class="linenos">1223</span></a><span class="sd">        &gt;&gt;&gt; A(i=[2,0,5])              # lists work</span>
</span><span id="ntensor-1224"><a href="#ntensor-1224"><span class="linenos">1224</span></a><span class="sd">        &lt;ntensor {i:3} [45 15 90]&gt;</span>
</span><span id="ntensor-1225"><a href="#ntensor-1225"><span class="linenos">1225</span></a><span class="sd">        &gt;&gt;&gt; A(i=jnp.array([2,0,5]))    # numpy arrays work</span>
</span><span id="ntensor-1226"><a href="#ntensor-1226"><span class="linenos">1226</span></a><span class="sd">        &lt;ntensor {i:3} [45 15 90]&gt;</span>
</span><span id="ntensor-1227"><a href="#ntensor-1227"><span class="linenos">1227</span></a><span class="sd">        &gt;&gt;&gt; i = Axis(&#39;i&#39;)</span>
</span><span id="ntensor-1228"><a href="#ntensor-1228"><span class="linenos">1228</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[6:1:-2])</span>
</span><span id="ntensor-1229"><a href="#ntensor-1229"><span class="linenos">1229</span></a><span class="sd">        &lt;ntensor {i:3} [105  75  45]&gt;</span>
</span><span id="ntensor-1230"><a href="#ntensor-1230"><span class="linenos">1230</span></a>
</span><span id="ntensor-1231"><a href="#ntensor-1231"><span class="linenos">1231</span></a><span class="sd">        Remember, using numbers or 1D lists/tuples/numpy arrays or slices is just syntactic sugar!</span>
</span><span id="ntensor-1232"><a href="#ntensor-1232"><span class="linenos">1232</span></a>
</span><span id="ntensor-1233"><a href="#ntensor-1233"><span class="linenos">1233</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="ntensor-1234"><a href="#ntensor-1234"><span class="linenos">1234</span></a><span class="sd">        &gt;&gt;&gt; A(i=2)==A(i=ntensor(2))</span>
</span><span id="ntensor-1235"><a href="#ntensor-1235"><span class="linenos">1235</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor-1236"><a href="#ntensor-1236"><span class="linenos">1236</span></a><span class="sd">        &gt;&gt;&gt; A(i=jnp.array([2,0,5])) == A(i=ntensor(jnp.array([2,0,5]),&#39;i&#39;))</span>
</span><span id="ntensor-1237"><a href="#ntensor-1237"><span class="linenos">1237</span></a><span class="sd">        &lt;ntensor {i:3} [ True  True  True]&gt;</span>
</span><span id="ntensor-1238"><a href="#ntensor-1238"><span class="linenos">1238</span></a><span class="sd">        &gt;&gt;&gt; i = Axis(&#39;i&#39;)</span>
</span><span id="ntensor-1239"><a href="#ntensor-1239"><span class="linenos">1239</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[6:1:-2]) == A(i=ntensor([6,4,2],&#39;i&#39;))</span>
</span><span id="ntensor-1240"><a href="#ntensor-1240"><span class="linenos">1240</span></a><span class="sd">        &lt;ntensor {i:3} [ True  True  True]&gt;</span>
</span><span id="ntensor-1241"><a href="#ntensor-1241"><span class="linenos">1241</span></a>
</span><span id="ntensor-1242"><a href="#ntensor-1242"><span class="linenos">1242</span></a><span class="sd">        You can index an Axis as a shortcut to create a new array.</span>
</span><span id="ntensor-1243"><a href="#ntensor-1243"><span class="linenos">1243</span></a>
</span><span id="ntensor-1244"><a href="#ntensor-1244"><span class="linenos">1244</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="ntensor-1245"><a href="#ntensor-1245"><span class="linenos">1245</span></a><span class="sd">        &gt;&gt;&gt; i, j = axes()</span>
</span><span id="ntensor-1246"><a href="#ntensor-1246"><span class="linenos">1246</span></a><span class="sd">        &gt;&gt;&gt; print(A(i=i[:]).shape)</span>
</span><span id="ntensor-1247"><a href="#ntensor-1247"><span class="linenos">1247</span></a><span class="sd">        {i:8}</span>
</span><span id="ntensor-1248"><a href="#ntensor-1248"><span class="linenos">1248</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[:]) == A</span>
</span><span id="ntensor-1249"><a href="#ntensor-1249"><span class="linenos">1249</span></a><span class="sd">        &lt;ntensor {i:8} [ True  True  True  True  True  True  True  True]&gt;</span>
</span><span id="ntensor-1250"><a href="#ntensor-1250"><span class="linenos">1250</span></a><span class="sd">        &gt;&gt;&gt; print(A(i=j[[2,0,5]]).shape)</span>
</span><span id="ntensor-1251"><a href="#ntensor-1251"><span class="linenos">1251</span></a><span class="sd">        {j:3}</span>
</span><span id="ntensor-1252"><a href="#ntensor-1252"><span class="linenos">1252</span></a><span class="sd">        &gt;&gt;&gt; A(i=j[[2,0,5]]) == A(i=ntensor([2,0,5],j))</span>
</span><span id="ntensor-1253"><a href="#ntensor-1253"><span class="linenos">1253</span></a><span class="sd">        &lt;ntensor {j:3} [ True  True  True]&gt;</span>
</span><span id="ntensor-1254"><a href="#ntensor-1254"><span class="linenos">1254</span></a>
</span><span id="ntensor-1255"><a href="#ntensor-1255"><span class="linenos">1255</span></a><span class="sd">        You can also index with a *slice* from another input index. (You can *only* slice axes that exist</span>
</span><span id="ntensor-1256"><a href="#ntensor-1256"><span class="linenos">1256</span></a><span class="sd">        in the `NTensor` since otherwise the shape would be ambiguous.)</span>
</span><span id="ntensor-1257"><a href="#ntensor-1257"><span class="linenos">1257</span></a>
</span><span id="ntensor-1258"><a href="#ntensor-1258"><span class="linenos">1258</span></a>
</span><span id="ntensor-1259"><a href="#ntensor-1259"><span class="linenos">1259</span></a>
</span><span id="ntensor-1260"><a href="#ntensor-1260"><span class="linenos">1260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor-1261"><a href="#ntensor-1261"><span class="linenos">1261</span></a>        <span class="k">return</span> <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ntensor-1262"><a href="#ntensor-1262"><span class="linenos">1262</span></a>
</span><span id="ntensor-1263"><a href="#ntensor-1263"><span class="linenos">1263</span></a>    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor-1264"><a href="#ntensor-1264"><span class="linenos">1264</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="p">{</span><span class="n">Axis</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="p">}</span>
</span><span id="ntensor-1265"><a href="#ntensor-1265"><span class="linenos">1265</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="n">other</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ntensor-1266"><a href="#ntensor-1266"><span class="linenos">1266</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="ntensor-1267"><a href="#ntensor-1267"><span class="linenos">1267</span></a>
</span><span id="ntensor-1268"><a href="#ntensor-1268"><span class="linenos">1268</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ntensor-1269"><a href="#ntensor-1269"><span class="linenos">1269</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="ntensor-1270"><a href="#ntensor-1270"><span class="linenos">1270</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t compare NTensor with </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor-1271"><a href="#ntensor-1271"><span class="linenos">1271</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="ntensor-1272"><a href="#ntensor-1272"><span class="linenos">1272</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ntensor-1273"><a href="#ntensor-1273"><span class="linenos">1273</span></a>                <span class="sa">f</span><span class="s2">&quot;Can&#39;t compare NTensor with shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> to other with shape </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor-1274"><a href="#ntensor-1274"><span class="linenos">1274</span></a>        <span class="k">return</span> <span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>An array is the base type of this package. The first thing about <code>array</code>s is that you can
create them. The second thing about <code>array</code>s is that you can (elegantly) index them. The third
thing about <code>array</code>s is you can call functions on them.</p>

<p>For core usage, see:</p>

<ul>
<li><code><a href="#ntensor.__init__">__init__</a></code> for creating arrays</li>
<li><code><a href="#ntensor.axes">axes</a></code> for getting the axes</li>
<li><code><a href="#ntensor.__call__">__call__</a></code> for indexing</li>
<li><code>__getitem__</code> for converting to</li>
</ul>
</div>


                            <div id="ntensor.__init__" class="classattr">
                                        <input id="ntensor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ntensor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Buffer</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]]</span>,</span><span class="param">	<span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Axis">Axis</a></span></span>)</span>

                <label class="view-source-button" for="ntensor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.__init__-714"><a href="#ntensor.__init__-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="ntensor.__init__-715"><a href="#ntensor.__init__-715"><span class="linenos">715</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an array from some block of data. This is familiar from other array languages,</span>
</span><span id="ntensor.__init__-716"><a href="#ntensor.__init__-716"><span class="linenos">716</span></a><span class="sd">        except you must provide axis names if there are more than 0 dimensions</span>
</span><span id="ntensor.__init__-717"><a href="#ntensor.__init__-717"><span class="linenos">717</span></a>
</span><span id="ntensor.__init__-718"><a href="#ntensor.__init__-718"><span class="linenos">718</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor.__init__-719"><a href="#ntensor.__init__-719"><span class="linenos">719</span></a><span class="sd">        ----------</span>
</span><span id="ntensor.__init__-720"><a href="#ntensor.__init__-720"><span class="linenos">720</span></a><span class="sd">        data</span>
</span><span id="ntensor.__init__-721"><a href="#ntensor.__init__-721"><span class="linenos">721</span></a><span class="sd">            An array or  [ArrayLike](https://docs.jax.dev/en/latest/_autosummary/jax.typing.ArrayLike.html)</span>
</span><span id="ntensor.__init__-722"><a href="#ntensor.__init__-722"><span class="linenos">722</span></a><span class="sd">            that can be cast to a numpy array.</span>
</span><span id="ntensor.__init__-723"><a href="#ntensor.__init__-723"><span class="linenos">723</span></a><span class="sd">        *axes</span>
</span><span id="ntensor.__init__-724"><a href="#ntensor.__init__-724"><span class="linenos">724</span></a><span class="sd">            `Axis` or strings. Must have same length as number of dimensions of data.</span>
</span><span id="ntensor.__init__-725"><a href="#ntensor.__init__-725"><span class="linenos">725</span></a>
</span><span id="ntensor.__init__-726"><a href="#ntensor.__init__-726"><span class="linenos">726</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.__init__-727"><a href="#ntensor.__init__-727"><span class="linenos">727</span></a><span class="sd">        --------</span>
</span><span id="ntensor.__init__-728"><a href="#ntensor.__init__-728"><span class="linenos">728</span></a><span class="sd">        Zero dimensional arrays have no dimensions, and so don&#39;t have axis names</span>
</span><span id="ntensor.__init__-729"><a href="#ntensor.__init__-729"><span class="linenos">729</span></a>
</span><span id="ntensor.__init__-730"><a href="#ntensor.__init__-730"><span class="linenos">730</span></a><span class="sd">        &gt;&gt;&gt; ntensor(137.036)</span>
</span><span id="ntensor.__init__-731"><a href="#ntensor.__init__-731"><span class="linenos">731</span></a><span class="sd">        &lt;ntensor {} 137.036&gt;</span>
</span><span id="ntensor.__init__-732"><a href="#ntensor.__init__-732"><span class="linenos">732</span></a>
</span><span id="ntensor.__init__-733"><a href="#ntensor.__init__-733"><span class="linenos">733</span></a><span class="sd">        Arrays with at least one dimension must have axis names</span>
</span><span id="ntensor.__init__-734"><a href="#ntensor.__init__-734"><span class="linenos">734</span></a>
</span><span id="ntensor.__init__-735"><a href="#ntensor.__init__-735"><span class="linenos">735</span></a><span class="sd">        &gt;&gt;&gt; ntensor([11, 22, 33], &#39;cats&#39;)</span>
</span><span id="ntensor.__init__-736"><a href="#ntensor.__init__-736"><span class="linenos">736</span></a><span class="sd">        &lt;ntensor {cats:3} [11 22 33]&gt;</span>
</span><span id="ntensor.__init__-737"><a href="#ntensor.__init__-737"><span class="linenos">737</span></a><span class="sd">        &gt;&gt;&gt; ntensor([5.5], &#39;i&#39;)</span>
</span><span id="ntensor.__init__-738"><a href="#ntensor.__init__-738"><span class="linenos">738</span></a><span class="sd">        &lt;ntensor {i:1} [5.5]&gt;</span>
</span><span id="ntensor.__init__-739"><a href="#ntensor.__init__-739"><span class="linenos">739</span></a><span class="sd">        &gt;&gt;&gt; ntensor([[1,2,3],[4,5,6]], &#39;row&#39;, &#39;col&#39;)</span>
</span><span id="ntensor.__init__-740"><a href="#ntensor.__init__-740"><span class="linenos">740</span></a><span class="sd">        &lt;ntensor {row:2, col:3}</span>
</span><span id="ntensor.__init__-741"><a href="#ntensor.__init__-741"><span class="linenos">741</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="ntensor.__init__-742"><a href="#ntensor.__init__-742"><span class="linenos">742</span></a><span class="sd">         [4 5 6]]&gt;</span>
</span><span id="ntensor.__init__-743"><a href="#ntensor.__init__-743"><span class="linenos">743</span></a>
</span><span id="ntensor.__init__-744"><a href="#ntensor.__init__-744"><span class="linenos">744</span></a><span class="sd">        You can create an explicit `Axis` objects first if you want. This is *completely equivalent*. (If you</span>
</span><span id="ntensor.__init__-745"><a href="#ntensor.__init__-745"><span class="linenos">745</span></a><span class="sd">        pass strings, they are automatically converted into `Axis` object for you.</span>
</span><span id="ntensor.__init__-746"><a href="#ntensor.__init__-746"><span class="linenos">746</span></a><span class="sd">        &gt;&gt;&gt; cats = Axis(&#39;cats&#39;)</span>
</span><span id="ntensor.__init__-747"><a href="#ntensor.__init__-747"><span class="linenos">747</span></a><span class="sd">        &gt;&gt;&gt; ntensor([11, 22, 33], cats)</span>
</span><span id="ntensor.__init__-748"><a href="#ntensor.__init__-748"><span class="linenos">748</span></a><span class="sd">        &lt;ntensor {cats:3} [11 22 33]&gt;</span>
</span><span id="ntensor.__init__-749"><a href="#ntensor.__init__-749"><span class="linenos">749</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.__init__-750"><a href="#ntensor.__init__-750"><span class="linenos">750</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor.__init__-751"><a href="#ntensor.__init__-751"><span class="linenos">751</span></a>
</span><span id="ntensor.__init__-752"><a href="#ntensor.__init__-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="ntensor.__init__-753"><a href="#ntensor.__init__-753"><span class="linenos">753</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ntensor got non-unique axes </span><span class="si">{</span><span class="n">axes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor.__init__-754"><a href="#ntensor.__init__-754"><span class="linenos">754</span></a>
</span><span id="ntensor.__init__-755"><a href="#ntensor.__init__-755"><span class="linenos">755</span></a>        <span class="c1">#print(f&quot;about to create data with array {data=}&quot;)</span>
</span><span id="ntensor.__init__-756"><a href="#ntensor.__init__-756"><span class="linenos">756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ntensor.__init__-757"><a href="#ntensor.__init__-757"><span class="linenos">757</span></a>
</span><span id="ntensor.__init__-758"><a href="#ntensor.__init__-758"><span class="linenos">758</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="ntensor.__init__-759"><a href="#ntensor.__init__-759"><span class="linenos">759</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ntensor.__init__-760"><a href="#ntensor.__init__-760"><span class="linenos">760</span></a>                <span class="sa">f</span><span class="s2">&quot;data has shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dims, but given &quot;</span>
</span><span id="ntensor.__init__-761"><a href="#ntensor.__init__-761"><span class="linenos">761</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2"> axes: </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor.__init__-762"><a href="#ntensor.__init__-762"><span class="linenos">762</span></a>
</span><span id="ntensor.__init__-763"><a href="#ntensor.__init__-763"><span class="linenos">763</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span> <span class="o">=</span> <span class="n">axes</span>
</span><span id="ntensor.__init__-764"><a href="#ntensor.__init__-764"><span class="linenos">764</span></a>
</span><span id="ntensor.__init__-765"><a href="#ntensor.__init__-765"><span class="linenos">765</span></a>        <span class="c1">#self._shape = ShapeDict({axes[i]: self._data.shape[i] for i in range(len(axes))})</span>
</span><span id="ntensor.__init__-766"><a href="#ntensor.__init__-766"><span class="linenos">766</span></a>
</span><span id="ntensor.__init__-767"><a href="#ntensor.__init__-767"><span class="linenos">767</span></a>        <span class="c1"># # hack to make jax.grad work for scalars</span>
</span><span id="ntensor.__init__-768"><a href="#ntensor.__init__-768"><span class="linenos">768</span></a>        <span class="c1"># if self._data.ndim == 0:</span>
</span><span id="ntensor.__init__-769"><a href="#ntensor.__init__-769"><span class="linenos">769</span></a>        <span class="c1">#     self.__jax_array__ = lambda: self._data</span>
</span><span id="ntensor.__init__-770"><a href="#ntensor.__init__-770"><span class="linenos">770</span></a>        <span class="c1">#     self.dtype = self._data.dtype</span>
</span></pre></div>


            <div class="docstring"><p>Create an array from some block of data. This is familiar from other array languages,
except you must provide axis names if there are more than 0 dimensions</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>: An array or  <a href="https://docs.jax.dev/en/latest/_autosummary/jax.typing.ArrayLike.html">ArrayLike</a>
that can be cast to a numpy array.</li>
<li><strong>*axes</strong>: <code><a href="#Axis">Axis</a></code> or strings. Must have same length as number of dimensions of data.</li>
</ul>

<h6 id="examples">Examples</h6>

<p>Zero dimensional arrays have no dimensions, and so don't have axis names</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ntensor</span><span class="p">(</span><span class="mf">137.036</span><span class="p">)</span>
<span class="go">&lt;ntensor {} 137.036&gt;</span>
</code></pre>
</div>

<p>Arrays with at least one dimension must have axis names</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ntensor</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span> <span class="s1">&#39;cats&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {cats:3} [11 22 33]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ntensor</span><span class="p">([</span><span class="mf">5.5</span><span class="p">],</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:1} [5.5]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ntensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span> <span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="s1">&#39;col&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {row:2, col:3}</span>
<span class="go">[[1 2 3]</span>
<span class="go"> [4 5 6]]&gt;</span>
</code></pre>
</div>

<p>You can create an explicit <code><a href="#Axis">Axis</a></code> objects first if you want. This is <em>completely equivalent</em>. (If you
pass strings, they are automatically converted into <code><a href="#Axis">Axis</a></code> object for you.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cats</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;cats&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ntensor</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span> <span class="n">cats</span><span class="p">)</span>
<span class="go">&lt;ntensor {cats:3} [11 22 33]&gt;</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ntensor.dtype" class="classattr">
                                        <input id="ntensor.dtype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">dtype</span>

                <label class="view-source-button" for="ntensor.dtype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.dtype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.dtype-783"><a href="#ntensor.dtype-783"><span class="linenos">783</span></a>    <span class="nd">@property</span>
</span><span id="ntensor.dtype-784"><a href="#ntensor.dtype-784"><span class="linenos">784</span></a>    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ntensor.dtype-785"><a href="#ntensor.dtype-785"><span class="linenos">785</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span>
</span></pre></div>


    

                            </div>
                            <div id="ntensor.axes" class="classattr">
                                        <input id="ntensor.axes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">axes</span><span class="annotation">: frozenset[<a href="#Axis">Axis</a>]</span>

                <label class="view-source-button" for="ntensor.axes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.axes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.axes-787"><a href="#ntensor.axes-787"><span class="linenos">787</span></a>    <span class="nd">@property</span>
</span><span id="ntensor.axes-788"><a href="#ntensor.axes-788"><span class="linenos">788</span></a>    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">Axis</span><span class="p">]:</span>
</span><span id="ntensor.axes-789"><a href="#ntensor.axes-789"><span class="linenos">789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Axis objects. It&#39;s a set, because axes *don&#39;t have an order* (that you&#39;re supposed to</span>
</span><span id="ntensor.axes-790"><a href="#ntensor.axes-790"><span class="linenos">790</span></a><span class="sd">        think about).</span>
</span><span id="ntensor.axes-791"><a href="#ntensor.axes-791"><span class="linenos">791</span></a>
</span><span id="ntensor.axes-792"><a href="#ntensor.axes-792"><span class="linenos">792</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.axes-793"><a href="#ntensor.axes-793"><span class="linenos">793</span></a><span class="sd">        --------</span>
</span><span id="ntensor.axes-794"><a href="#ntensor.axes-794"><span class="linenos">794</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]], &quot;day&quot;, &quot;person&quot;)</span>
</span><span id="ntensor.axes-795"><a href="#ntensor.axes-795"><span class="linenos">795</span></a><span class="sd">        &gt;&gt;&gt; A.axes == {Axis(&#39;day&#39;), Axis(&#39;person&#39;)}</span>
</span><span id="ntensor.axes-796"><a href="#ntensor.axes-796"><span class="linenos">796</span></a><span class="sd">        True</span>
</span><span id="ntensor.axes-797"><a href="#ntensor.axes-797"><span class="linenos">797</span></a><span class="sd">        &gt;&gt;&gt; A.axes == {&#39;day&#39;, &#39;person&#39;}</span>
</span><span id="ntensor.axes-798"><a href="#ntensor.axes-798"><span class="linenos">798</span></a><span class="sd">        True</span>
</span><span id="ntensor.axes-799"><a href="#ntensor.axes-799"><span class="linenos">799</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.axes-800"><a href="#ntensor.axes-800"><span class="linenos">800</span></a>        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The Axis objects. It's a set, because axes <em>don't have an order</em> (that you're supposed to
think about).</p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span> <span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="s2">&quot;person&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="p">{</span><span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">),</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">)}</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;person&#39;</span><span class="p">}</span>
<span class="go">True</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ntensor.ndim" class="classattr">
                                        <input id="ntensor.ndim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">ndim</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ntensor.ndim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.ndim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.ndim-806"><a href="#ntensor.ndim-806"><span class="linenos">806</span></a>    <span class="nd">@property</span>
</span><span id="ntensor.ndim-807"><a href="#ntensor.ndim-807"><span class="linenos">807</span></a>    <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ntensor.ndim-808"><a href="#ntensor.ndim-808"><span class="linenos">808</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of dimensions. Equal to `len(axes)`</span>
</span><span id="ntensor.ndim-809"><a href="#ntensor.ndim-809"><span class="linenos">809</span></a>
</span><span id="ntensor.ndim-810"><a href="#ntensor.ndim-810"><span class="linenos">810</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.ndim-811"><a href="#ntensor.ndim-811"><span class="linenos">811</span></a><span class="sd">        --------</span>
</span><span id="ntensor.ndim-812"><a href="#ntensor.ndim-812"><span class="linenos">812</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;rows&#39;,&#39;cols&#39;)</span>
</span><span id="ntensor.ndim-813"><a href="#ntensor.ndim-813"><span class="linenos">813</span></a><span class="sd">        &gt;&gt;&gt; A.ndim</span>
</span><span id="ntensor.ndim-814"><a href="#ntensor.ndim-814"><span class="linenos">814</span></a><span class="sd">        2</span>
</span><span id="ntensor.ndim-815"><a href="#ntensor.ndim-815"><span class="linenos">815</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.ndim-816"><a href="#ntensor.ndim-816"><span class="linenos">816</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The number of dimensions. Equal to <code>len(axes)</code></p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span><span class="s1">&#39;rows&#39;</span><span class="p">,</span><span class="s1">&#39;cols&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">ndim</span>
<span class="go">2</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ntensor.shape" class="classattr">
                                        <input id="ntensor.shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">shape</span><span class="annotation">: numbat.ShapeDict</span>

                <label class="view-source-button" for="ntensor.shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.shape-818"><a href="#ntensor.shape-818"><span class="linenos">818</span></a>    <span class="nd">@property</span>
</span><span id="ntensor.shape-819"><a href="#ntensor.shape-819"><span class="linenos">819</span></a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShapeDict</span><span class="p">:</span>
</span><span id="ntensor.shape-820"><a href="#ntensor.shape-820"><span class="linenos">820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The shape is a *dict* mapping axes to ints.</span>
</span><span id="ntensor.shape-821"><a href="#ntensor.shape-821"><span class="linenos">821</span></a>
</span><span id="ntensor.shape-822"><a href="#ntensor.shape-822"><span class="linenos">822</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.shape-823"><a href="#ntensor.shape-823"><span class="linenos">823</span></a><span class="sd">        --------</span>
</span><span id="ntensor.shape-824"><a href="#ntensor.shape-824"><span class="linenos">824</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;record&#39;,&#39;hour&#39;)</span>
</span><span id="ntensor.shape-825"><a href="#ntensor.shape-825"><span class="linenos">825</span></a><span class="sd">        &gt;&gt;&gt; A.shape</span>
</span><span id="ntensor.shape-826"><a href="#ntensor.shape-826"><span class="linenos">826</span></a><span class="sd">        ShapeDict(record=2, hour=3)</span>
</span><span id="ntensor.shape-827"><a href="#ntensor.shape-827"><span class="linenos">827</span></a><span class="sd">        &gt;&gt;&gt; print(A.shape)</span>
</span><span id="ntensor.shape-828"><a href="#ntensor.shape-828"><span class="linenos">828</span></a><span class="sd">        {record:2, hour:3}</span>
</span><span id="ntensor.shape-829"><a href="#ntensor.shape-829"><span class="linenos">829</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.shape-830"><a href="#ntensor.shape-830"><span class="linenos">830</span></a>        <span class="k">return</span> <span class="n">ShapeDict</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">)})</span>
</span></pre></div>


            <div class="docstring"><p>The shape is a <em>dict</em> mapping axes to ints.</p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span><span class="s1">&#39;record&#39;</span><span class="p">,</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(record=2, hour=3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{record:2, hour:3}</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ntensor.numpy_broadcasted" class="classattr">
                                        <input id="ntensor.numpy_broadcasted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">numpy_broadcasted</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="n"><a href="#Axis">Axis</a></span> <span class="o">|</span> <span class="nb">str</span>, </span><span class="param"><span class="n">strict</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span>:</span></span>

                <label class="view-source-button" for="ntensor.numpy_broadcasted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.numpy_broadcasted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.numpy_broadcasted-846"><a href="#ntensor.numpy_broadcasted-846"><span class="linenos">846</span></a>    <span class="k">def</span> <span class="nf">numpy_broadcasted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ntensor.numpy_broadcasted-847"><a href="#ntensor.numpy_broadcasted-847"><span class="linenos">847</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to a (Jax) numpy array, by providing order for axes.</span>
</span><span id="ntensor.numpy_broadcasted-848"><a href="#ntensor.numpy_broadcasted-848"><span class="linenos">848</span></a><span class="sd">        If you provide an axis that doesn&#39;t exist, a new one with a singleton dimension</span>
</span><span id="ntensor.numpy_broadcasted-849"><a href="#ntensor.numpy_broadcasted-849"><span class="linenos">849</span></a><span class="sd">        will be created</span>
</span><span id="ntensor.numpy_broadcasted-850"><a href="#ntensor.numpy_broadcasted-850"><span class="linenos">850</span></a>
</span><span id="ntensor.numpy_broadcasted-851"><a href="#ntensor.numpy_broadcasted-851"><span class="linenos">851</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor.numpy_broadcasted-852"><a href="#ntensor.numpy_broadcasted-852"><span class="linenos">852</span></a><span class="sd">        ----------</span>
</span><span id="ntensor.numpy_broadcasted-853"><a href="#ntensor.numpy_broadcasted-853"><span class="linenos">853</span></a><span class="sd">        *axes</span>
</span><span id="ntensor.numpy_broadcasted-854"><a href="#ntensor.numpy_broadcasted-854"><span class="linenos">854</span></a><span class="sd">            The axes, in order. Must include all axes present in self.</span>
</span><span id="ntensor.numpy_broadcasted-855"><a href="#ntensor.numpy_broadcasted-855"><span class="linenos">855</span></a>
</span><span id="ntensor.numpy_broadcasted-856"><a href="#ntensor.numpy_broadcasted-856"><span class="linenos">856</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.numpy_broadcasted-857"><a href="#ntensor.numpy_broadcasted-857"><span class="linenos">857</span></a><span class="sd">        --------</span>
</span><span id="ntensor.numpy_broadcasted-858"><a href="#ntensor.numpy_broadcasted-858"><span class="linenos">858</span></a>
</span><span id="ntensor.numpy_broadcasted-859"><a href="#ntensor.numpy_broadcasted-859"><span class="linenos">859</span></a><span class="sd">        Zero dimensional array</span>
</span><span id="ntensor.numpy_broadcasted-860"><a href="#ntensor.numpy_broadcasted-860"><span class="linenos">860</span></a>
</span><span id="ntensor.numpy_broadcasted-861"><a href="#ntensor.numpy_broadcasted-861"><span class="linenos">861</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor(5)</span>
</span><span id="ntensor.numpy_broadcasted-862"><a href="#ntensor.numpy_broadcasted-862"><span class="linenos">862</span></a><span class="sd">        &gt;&gt;&gt; A</span>
</span><span id="ntensor.numpy_broadcasted-863"><a href="#ntensor.numpy_broadcasted-863"><span class="linenos">863</span></a><span class="sd">        &lt;ntensor {} 5&gt;</span>
</span><span id="ntensor.numpy_broadcasted-864"><a href="#ntensor.numpy_broadcasted-864"><span class="linenos">864</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted())</span>
</span><span id="ntensor.numpy_broadcasted-865"><a href="#ntensor.numpy_broadcasted-865"><span class="linenos">865</span></a><span class="sd">        5</span>
</span><span id="ntensor.numpy_broadcasted-866"><a href="#ntensor.numpy_broadcasted-866"><span class="linenos">866</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;))</span>
</span><span id="ntensor.numpy_broadcasted-867"><a href="#ntensor.numpy_broadcasted-867"><span class="linenos">867</span></a><span class="sd">        [5]</span>
</span><span id="ntensor.numpy_broadcasted-868"><a href="#ntensor.numpy_broadcasted-868"><span class="linenos">868</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="ntensor.numpy_broadcasted-869"><a href="#ntensor.numpy_broadcasted-869"><span class="linenos">869</span></a><span class="sd">        [[5]]</span>
</span><span id="ntensor.numpy_broadcasted-870"><a href="#ntensor.numpy_broadcasted-870"><span class="linenos">870</span></a>
</span><span id="ntensor.numpy_broadcasted-871"><a href="#ntensor.numpy_broadcasted-871"><span class="linenos">871</span></a><span class="sd">        Two-dimensional array</span>
</span><span id="ntensor.numpy_broadcasted-872"><a href="#ntensor.numpy_broadcasted-872"><span class="linenos">872</span></a>
</span><span id="ntensor.numpy_broadcasted-873"><a href="#ntensor.numpy_broadcasted-873"><span class="linenos">873</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="ntensor.numpy_broadcasted-874"><a href="#ntensor.numpy_broadcasted-874"><span class="linenos">874</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="ntensor.numpy_broadcasted-875"><a href="#ntensor.numpy_broadcasted-875"><span class="linenos">875</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="ntensor.numpy_broadcasted-876"><a href="#ntensor.numpy_broadcasted-876"><span class="linenos">876</span></a><span class="sd">         [4 5 6]]</span>
</span><span id="ntensor.numpy_broadcasted-877"><a href="#ntensor.numpy_broadcasted-877"><span class="linenos">877</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;j&#39;,&#39;i&#39;))</span>
</span><span id="ntensor.numpy_broadcasted-878"><a href="#ntensor.numpy_broadcasted-878"><span class="linenos">878</span></a><span class="sd">        [[1 4]</span>
</span><span id="ntensor.numpy_broadcasted-879"><a href="#ntensor.numpy_broadcasted-879"><span class="linenos">879</span></a><span class="sd">         [2 5]</span>
</span><span id="ntensor.numpy_broadcasted-880"><a href="#ntensor.numpy_broadcasted-880"><span class="linenos">880</span></a><span class="sd">         [3 6]]</span>
</span><span id="ntensor.numpy_broadcasted-881"><a href="#ntensor.numpy_broadcasted-881"><span class="linenos">881</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy_broadcasted(&#39;i&#39;,&#39;k&#39;,&#39;j&#39;,&#39;l&#39;).shape)</span>
</span><span id="ntensor.numpy_broadcasted-882"><a href="#ntensor.numpy_broadcasted-882"><span class="linenos">882</span></a><span class="sd">        (2, 1, 3, 1)</span>
</span><span id="ntensor.numpy_broadcasted-883"><a href="#ntensor.numpy_broadcasted-883"><span class="linenos">883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.numpy_broadcasted-884"><a href="#ntensor.numpy_broadcasted-884"><span class="linenos">884</span></a>
</span><span id="ntensor.numpy_broadcasted-885"><a href="#ntensor.numpy_broadcasted-885"><span class="linenos">885</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor.numpy_broadcasted-886"><a href="#ntensor.numpy_broadcasted-886"><span class="linenos">886</span></a>
</span><span id="ntensor.numpy_broadcasted-887"><a href="#ntensor.numpy_broadcasted-887"><span class="linenos">887</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
</span><span id="ntensor.numpy_broadcasted-888"><a href="#ntensor.numpy_broadcasted-888"><span class="linenos">888</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;axes </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2"> not a subset of </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor.numpy_broadcasted-889"><a href="#ntensor.numpy_broadcasted-889"><span class="linenos">889</span></a>
</span><span id="ntensor.numpy_broadcasted-890"><a href="#ntensor.numpy_broadcasted-890"><span class="linenos">890</span></a>        <span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
</span><span id="ntensor.numpy_broadcasted-891"><a href="#ntensor.numpy_broadcasted-891"><span class="linenos">891</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="si">=}</span><span class="s2"> not equal to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor.numpy_broadcasted-892"><a href="#ntensor.numpy_broadcasted-892"><span class="linenos">892</span></a>
</span><span id="ntensor.numpy_broadcasted-893"><a href="#ntensor.numpy_broadcasted-893"><span class="linenos">893</span></a>
</span><span id="ntensor.numpy_broadcasted-894"><a href="#ntensor.numpy_broadcasted-894"><span class="linenos">894</span></a>        <span class="n">extra_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor.numpy_broadcasted-895"><a href="#ntensor.numpy_broadcasted-895"><span class="linenos">895</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">extra_dims</span><span class="p">)</span>
</span><span id="ntensor.numpy_broadcasted-896"><a href="#ntensor.numpy_broadcasted-896"><span class="linenos">896</span></a>        <span class="n">where</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ntensor.numpy_broadcasted-897"><a href="#ntensor.numpy_broadcasted-897"><span class="linenos">897</span></a>        <span class="n">where_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="ntensor.numpy_broadcasted-898"><a href="#ntensor.numpy_broadcasted-898"><span class="linenos">898</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor.numpy_broadcasted-899"><a href="#ntensor.numpy_broadcasted-899"><span class="linenos">899</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor.numpy_broadcasted-900"><a href="#ntensor.numpy_broadcasted-900"><span class="linenos">900</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
</span><span id="ntensor.numpy_broadcasted-901"><a href="#ntensor.numpy_broadcasted-901"><span class="linenos">901</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ntensor.numpy_broadcasted-902"><a href="#ntensor.numpy_broadcasted-902"><span class="linenos">902</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">where_extra</span><span class="p">)</span>
</span><span id="ntensor.numpy_broadcasted-903"><a href="#ntensor.numpy_broadcasted-903"><span class="linenos">903</span></a>                <span class="n">where_extra</span> <span class="o">=</span> <span class="n">where_extra</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ntensor.numpy_broadcasted-904"><a href="#ntensor.numpy_broadcasted-904"><span class="linenos">904</span></a>
</span><span id="ntensor.numpy_broadcasted-905"><a href="#ntensor.numpy_broadcasted-905"><span class="linenos">905</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert to a (Jax) numpy array, by providing order for axes.
If you provide an axis that doesn't exist, a new one with a singleton dimension
will be created</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>*axes</strong>: The axes, in order. Must include all axes present in self.</li>
</ul>

<h6 id="examples">Examples</h6>

<p>Zero dimensional array</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span>
<span class="go">&lt;ntensor {} 5&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">())</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<span class="go">[5]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">))</span>
<span class="go">[[5]]</span>
</code></pre>
</div>

<p>Two-dimensional array</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">))</span>
<span class="go">[[1 2 3]</span>
<span class="go"> [4 5 6]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<span class="go">[[1 4]</span>
<span class="go"> [2 5]</span>
<span class="go"> [3 6]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="s1">&#39;l&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(2, 1, 3, 1)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ntensor.numpy" class="classattr">
                                        <input id="ntensor.numpy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">numpy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="n"><a href="#Axis">Axis</a></span> <span class="o">|</span> <span class="nb">str</span>, </span><span class="param"><span class="n">strict</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span>:</span></span>

                <label class="view-source-button" for="ntensor.numpy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.numpy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.numpy-907"><a href="#ntensor.numpy-907"><span class="linenos">907</span></a>    <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ntensor.numpy-908"><a href="#ntensor.numpy-908"><span class="linenos">908</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to a (Jax) numpy array, by providing order for axes.</span>
</span><span id="ntensor.numpy-909"><a href="#ntensor.numpy-909"><span class="linenos">909</span></a>
</span><span id="ntensor.numpy-910"><a href="#ntensor.numpy-910"><span class="linenos">910</span></a><span class="sd">        Unlike numpy_broadcasted, you cannot provide new axes. Also, if self has only 1 dimension,</span>
</span><span id="ntensor.numpy-911"><a href="#ntensor.numpy-911"><span class="linenos">911</span></a><span class="sd">        it&#39;s acceptable to skip it.</span>
</span><span id="ntensor.numpy-912"><a href="#ntensor.numpy-912"><span class="linenos">912</span></a>
</span><span id="ntensor.numpy-913"><a href="#ntensor.numpy-913"><span class="linenos">913</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor.numpy-914"><a href="#ntensor.numpy-914"><span class="linenos">914</span></a><span class="sd">        ----------</span>
</span><span id="ntensor.numpy-915"><a href="#ntensor.numpy-915"><span class="linenos">915</span></a><span class="sd">        *axes</span>
</span><span id="ntensor.numpy-916"><a href="#ntensor.numpy-916"><span class="linenos">916</span></a><span class="sd">            The axes, in order. Must have equal number as dimensions, unless number of dimensions is one,</span>
</span><span id="ntensor.numpy-917"><a href="#ntensor.numpy-917"><span class="linenos">917</span></a><span class="sd">            in which case it can be skipped</span>
</span><span id="ntensor.numpy-918"><a href="#ntensor.numpy-918"><span class="linenos">918</span></a>
</span><span id="ntensor.numpy-919"><a href="#ntensor.numpy-919"><span class="linenos">919</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.numpy-920"><a href="#ntensor.numpy-920"><span class="linenos">920</span></a><span class="sd">        --------</span>
</span><span id="ntensor.numpy-921"><a href="#ntensor.numpy-921"><span class="linenos">921</span></a>
</span><span id="ntensor.numpy-922"><a href="#ntensor.numpy-922"><span class="linenos">922</span></a><span class="sd">        Zero dimensional array</span>
</span><span id="ntensor.numpy-923"><a href="#ntensor.numpy-923"><span class="linenos">923</span></a>
</span><span id="ntensor.numpy-924"><a href="#ntensor.numpy-924"><span class="linenos">924</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor(5)</span>
</span><span id="ntensor.numpy-925"><a href="#ntensor.numpy-925"><span class="linenos">925</span></a><span class="sd">        &gt;&gt;&gt; A</span>
</span><span id="ntensor.numpy-926"><a href="#ntensor.numpy-926"><span class="linenos">926</span></a><span class="sd">        &lt;ntensor {} 5&gt;</span>
</span><span id="ntensor.numpy-927"><a href="#ntensor.numpy-927"><span class="linenos">927</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy())</span>
</span><span id="ntensor.numpy-928"><a href="#ntensor.numpy-928"><span class="linenos">928</span></a><span class="sd">        5</span>
</span><span id="ntensor.numpy-929"><a href="#ntensor.numpy-929"><span class="linenos">929</span></a>
</span><span id="ntensor.numpy-930"><a href="#ntensor.numpy-930"><span class="linenos">930</span></a><span class="sd">        One dimensional array</span>
</span><span id="ntensor.numpy-931"><a href="#ntensor.numpy-931"><span class="linenos">931</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="ntensor.numpy-932"><a href="#ntensor.numpy-932"><span class="linenos">932</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;i&#39;))</span>
</span><span id="ntensor.numpy-933"><a href="#ntensor.numpy-933"><span class="linenos">933</span></a><span class="sd">        [1 2 3]</span>
</span><span id="ntensor.numpy-934"><a href="#ntensor.numpy-934"><span class="linenos">934</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy())</span>
</span><span id="ntensor.numpy-935"><a href="#ntensor.numpy-935"><span class="linenos">935</span></a><span class="sd">        [1 2 3]</span>
</span><span id="ntensor.numpy-936"><a href="#ntensor.numpy-936"><span class="linenos">936</span></a>
</span><span id="ntensor.numpy-937"><a href="#ntensor.numpy-937"><span class="linenos">937</span></a><span class="sd">        Two-dimensional array</span>
</span><span id="ntensor.numpy-938"><a href="#ntensor.numpy-938"><span class="linenos">938</span></a>
</span><span id="ntensor.numpy-939"><a href="#ntensor.numpy-939"><span class="linenos">939</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([[1,2,3],[4,5,6]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="ntensor.numpy-940"><a href="#ntensor.numpy-940"><span class="linenos">940</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;i&#39;,&#39;j&#39;))</span>
</span><span id="ntensor.numpy-941"><a href="#ntensor.numpy-941"><span class="linenos">941</span></a><span class="sd">        [[1 2 3]</span>
</span><span id="ntensor.numpy-942"><a href="#ntensor.numpy-942"><span class="linenos">942</span></a><span class="sd">         [4 5 6]]</span>
</span><span id="ntensor.numpy-943"><a href="#ntensor.numpy-943"><span class="linenos">943</span></a><span class="sd">        &gt;&gt;&gt; print(A.numpy(&#39;j&#39;,&#39;i&#39;))</span>
</span><span id="ntensor.numpy-944"><a href="#ntensor.numpy-944"><span class="linenos">944</span></a><span class="sd">        [[1 4]</span>
</span><span id="ntensor.numpy-945"><a href="#ntensor.numpy-945"><span class="linenos">945</span></a><span class="sd">         [2 5]</span>
</span><span id="ntensor.numpy-946"><a href="#ntensor.numpy-946"><span class="linenos">946</span></a><span class="sd">         [3 6]]</span>
</span><span id="ntensor.numpy-947"><a href="#ntensor.numpy-947"><span class="linenos">947</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.numpy-948"><a href="#ntensor.numpy-948"><span class="linenos">948</span></a>
</span><span id="ntensor.numpy-949"><a href="#ntensor.numpy-949"><span class="linenos">949</span></a>        <span class="k">if</span> <span class="n">axes</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ntensor.numpy-950"><a href="#ntensor.numpy-950"><span class="linenos">950</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>
</span><span id="ntensor.numpy-951"><a href="#ntensor.numpy-951"><span class="linenos">951</span></a>
</span><span id="ntensor.numpy-952"><a href="#ntensor.numpy-952"><span class="linenos">952</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor.numpy-953"><a href="#ntensor.numpy-953"><span class="linenos">953</span></a>
</span><span id="ntensor.numpy-954"><a href="#ntensor.numpy-954"><span class="linenos">954</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor.numpy-955"><a href="#ntensor.numpy-955"><span class="linenos">955</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided axes </span><span class="si">{</span><span class="n">axes</span><span class="si">}</span><span class="s2"> do not match ntensor axes </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ntensor.numpy-956"><a href="#ntensor.numpy-956"><span class="linenos">956</span></a>
</span><span id="ntensor.numpy-957"><a href="#ntensor.numpy-957"><span class="linenos">957</span></a>
</span><span id="ntensor.numpy-958"><a href="#ntensor.numpy-958"><span class="linenos">958</span></a>        <span class="n">extra_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="ntensor.numpy-959"><a href="#ntensor.numpy-959"><span class="linenos">959</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">extra_dims</span><span class="p">)</span>
</span><span id="ntensor.numpy-960"><a href="#ntensor.numpy-960"><span class="linenos">960</span></a>        <span class="n">where</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ntensor.numpy-961"><a href="#ntensor.numpy-961"><span class="linenos">961</span></a>        <span class="n">where_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="ntensor.numpy-962"><a href="#ntensor.numpy-962"><span class="linenos">962</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor.numpy-963"><a href="#ntensor.numpy-963"><span class="linenos">963</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ntensor.numpy-964"><a href="#ntensor.numpy-964"><span class="linenos">964</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
</span><span id="ntensor.numpy-965"><a href="#ntensor.numpy-965"><span class="linenos">965</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ntensor.numpy-966"><a href="#ntensor.numpy-966"><span class="linenos">966</span></a>                <span class="n">where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">where_extra</span><span class="p">)</span>
</span><span id="ntensor.numpy-967"><a href="#ntensor.numpy-967"><span class="linenos">967</span></a>                <span class="n">where_extra</span> <span class="o">=</span> <span class="n">where_extra</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ntensor.numpy-968"><a href="#ntensor.numpy-968"><span class="linenos">968</span></a>
</span><span id="ntensor.numpy-969"><a href="#ntensor.numpy-969"><span class="linenos">969</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert to a (Jax) numpy array, by providing order for axes.</p>

<p>Unlike numpy_broadcasted, you cannot provide new axes. Also, if self has only 1 dimension,
it's acceptable to skip it.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>*axes</strong>: The axes, in order. Must have equal number as dimensions, unless number of dimensions is one,
in which case it can be skipped</li>
</ul>

<h6 id="examples">Examples</h6>

<p>Zero dimensional array</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span>
<span class="go">&lt;ntensor {} 5&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="go">5</span>
</code></pre>
</div>

<p>One dimensional array</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<span class="go">[1 2 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="go">[1 2 3]</span>
</code></pre>
</div>

<p>Two-dimensional array</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">))</span>
<span class="go">[[1 2 3]</span>
<span class="go"> [4 5 6]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">numpy</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<span class="go">[[1 4]</span>
<span class="go"> [2 5]</span>
<span class="go"> [3 6]]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ntensor.__add__" class="classattr">
                                        <input id="ntensor.__add__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">__add__</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="ntensor.__add__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.__add__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.__add__-996"><a href="#ntensor.__add__-996"><span class="linenos"> 996</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Self</span> <span class="o">|</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ntensor.__add__-997"><a href="#ntensor.__add__-997"><span class="linenos"> 997</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor.__add__-998"><a href="#ntensor.__add__-998"><span class="linenos"> 998</span></a><span class="sd">        Do fully-batched addition. Unlike `add`, this seamlessly handles arrays of any shape with</span>
</span><span id="ntensor.__add__-999"><a href="#ntensor.__add__-999"><span class="linenos"> 999</span></a><span class="sd">        full automatic broadcasting.</span>
</span><span id="ntensor.__add__-1000"><a href="#ntensor.__add__-1000"><span class="linenos">1000</span></a>
</span><span id="ntensor.__add__-1001"><a href="#ntensor.__add__-1001"><span class="linenos">1001</span></a><span class="sd">        `A+B` is equivalent to `add(self, other)`, i.e. maps over all axes.</span>
</span><span id="ntensor.__add__-1002"><a href="#ntensor.__add__-1002"><span class="linenos">1002</span></a>
</span><span id="ntensor.__add__-1003"><a href="#ntensor.__add__-1003"><span class="linenos">1003</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.__add__-1004"><a href="#ntensor.__add__-1004"><span class="linenos">1004</span></a><span class="sd">        -------</span>
</span><span id="ntensor.__add__-1005"><a href="#ntensor.__add__-1005"><span class="linenos">1005</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1,2],&#39;cats&#39;)</span>
</span><span id="ntensor.__add__-1006"><a href="#ntensor.__add__-1006"><span class="linenos">1006</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([0,5],&#39;dogs&#39;)</span>
</span><span id="ntensor.__add__-1007"><a href="#ntensor.__add__-1007"><span class="linenos">1007</span></a><span class="sd">        &gt;&gt;&gt; (A+B).shape == {&#39;cats&#39;: 3, &#39;dogs&#39;:2}</span>
</span><span id="ntensor.__add__-1008"><a href="#ntensor.__add__-1008"><span class="linenos">1008</span></a><span class="sd">        True</span>
</span><span id="ntensor.__add__-1009"><a href="#ntensor.__add__-1009"><span class="linenos">1009</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.__add__-1010"><a href="#ntensor.__add__-1010"><span class="linenos">1010</span></a>
</span><span id="ntensor.__add__-1011"><a href="#ntensor.__add__-1011"><span class="linenos">1011</span></a>        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do fully-batched addition. Unlike <code><a href="#add">add</a></code>, this seamlessly handles arrays of any shape with
full automatic broadcasting.</p>

<p><code>A+B</code> is equivalent to <code>add(self, other)</code>, i.e. maps over all axes.</p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;cats&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="s1">&#39;dogs&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">A</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;cats&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;dogs&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
<span class="go">True</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ntensor.__sub__" class="classattr">
                                        <input id="ntensor.__sub__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">__sub__</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="ntensor.__sub__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.__sub__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.__sub__-1016"><a href="#ntensor.__sub__-1016"><span class="linenos">1016</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor.__sub__-1017"><a href="#ntensor.__sub__-1017"><span class="linenos">1017</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor.__sub__-1018"><a href="#ntensor.__sub__-1018"><span class="linenos">1018</span></a><span class="sd">        Do fully-batched substraction.</span>
</span><span id="ntensor.__sub__-1019"><a href="#ntensor.__sub__-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.__sub__-1020"><a href="#ntensor.__sub__-1020"><span class="linenos">1020</span></a>        <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do fully-batched substraction.</p>
</div>


                            </div>
                            <div id="ntensor.__mul__" class="classattr">
                                        <input id="ntensor.__mul__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">__mul__</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="ntensor.__mul__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.__mul__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.__mul__-1025"><a href="#ntensor.__mul__-1025"><span class="linenos">1025</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor.__mul__-1026"><a href="#ntensor.__mul__-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor.__mul__-1027"><a href="#ntensor.__mul__-1027"><span class="linenos">1027</span></a><span class="sd">        Do fully-batched multiplication.</span>
</span><span id="ntensor.__mul__-1028"><a href="#ntensor.__mul__-1028"><span class="linenos">1028</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.__mul__-1029"><a href="#ntensor.__mul__-1029"><span class="linenos">1029</span></a>        <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do fully-batched multiplication.</p>
</div>


                            </div>
                            <div id="ntensor.__truediv__" class="classattr">
                                        <input id="ntensor.__truediv__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">__truediv__</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="ntensor.__truediv__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.__truediv__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.__truediv__-1034"><a href="#ntensor.__truediv__-1034"><span class="linenos">1034</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor.__truediv__-1035"><a href="#ntensor.__truediv__-1035"><span class="linenos">1035</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor.__truediv__-1036"><a href="#ntensor.__truediv__-1036"><span class="linenos">1036</span></a><span class="sd">        Do fully-batched division.</span>
</span><span id="ntensor.__truediv__-1037"><a href="#ntensor.__truediv__-1037"><span class="linenos">1037</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.__truediv__-1038"><a href="#ntensor.__truediv__-1038"><span class="linenos">1038</span></a>        <span class="k">return</span> <span class="n">true_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do fully-batched division.</p>
</div>


                            </div>
                            <div id="ntensor.__pow__" class="classattr">
                                        <input id="ntensor.__pow__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">__pow__</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="ntensor.__pow__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.__pow__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.__pow__-1043"><a href="#ntensor.__pow__-1043"><span class="linenos">1043</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor.__pow__-1044"><a href="#ntensor.__pow__-1044"><span class="linenos">1044</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor.__pow__-1045"><a href="#ntensor.__pow__-1045"><span class="linenos">1045</span></a><span class="sd">        Do fully-batched powers.</span>
</span><span id="ntensor.__pow__-1046"><a href="#ntensor.__pow__-1046"><span class="linenos">1046</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.__pow__-1047"><a href="#ntensor.__pow__-1047"><span class="linenos">1047</span></a>        <span class="k">return</span> <span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do fully-batched powers.</p>
</div>


                            </div>
                            <div id="ntensor.__matmul__" class="classattr">
                                        <input id="ntensor.__matmul__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">__matmul__</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="n"><a href="#ntensor">ntensor</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="ntensor.__matmul__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.__matmul__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.__matmul__-1079"><a href="#ntensor.__matmul__-1079"><span class="linenos">1079</span></a>    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor.__matmul__-1080"><a href="#ntensor.__matmul__-1080"><span class="linenos">1080</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor.__matmul__-1081"><a href="#ntensor.__matmul__-1081"><span class="linenos">1081</span></a>
</span><span id="ntensor.__matmul__-1082"><a href="#ntensor.__matmul__-1082"><span class="linenos">1082</span></a><span class="sd">        Do einstein summation on two arrays, taking reductions over all shared axes. This is equivalent to</span>
</span><span id="ntensor.__matmul__-1083"><a href="#ntensor.__matmul__-1083"><span class="linenos">1083</span></a><span class="sd">        an alias for `dot(self, other)`.</span>
</span><span id="ntensor.__matmul__-1084"><a href="#ntensor.__matmul__-1084"><span class="linenos">1084</span></a>
</span><span id="ntensor.__matmul__-1085"><a href="#ntensor.__matmul__-1085"><span class="linenos">1085</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor.__matmul__-1086"><a href="#ntensor.__matmul__-1086"><span class="linenos">1086</span></a><span class="sd">        ----------</span>
</span><span id="ntensor.__matmul__-1087"><a href="#ntensor.__matmul__-1087"><span class="linenos">1087</span></a><span class="sd">        other: ntensor</span>
</span><span id="ntensor.__matmul__-1088"><a href="#ntensor.__matmul__-1088"><span class="linenos">1088</span></a>
</span><span id="ntensor.__matmul__-1089"><a href="#ntensor.__matmul__-1089"><span class="linenos">1089</span></a><span class="sd">        Returns</span>
</span><span id="ntensor.__matmul__-1090"><a href="#ntensor.__matmul__-1090"><span class="linenos">1090</span></a><span class="sd">        -------</span>
</span><span id="ntensor.__matmul__-1091"><a href="#ntensor.__matmul__-1091"><span class="linenos">1091</span></a><span class="sd">        result: ntensor</span>
</span><span id="ntensor.__matmul__-1092"><a href="#ntensor.__matmul__-1092"><span class="linenos">1092</span></a><span class="sd">            result of Einstein summation on two arrays.</span>
</span><span id="ntensor.__matmul__-1093"><a href="#ntensor.__matmul__-1093"><span class="linenos">1093</span></a>
</span><span id="ntensor.__matmul__-1094"><a href="#ntensor.__matmul__-1094"><span class="linenos">1094</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.__matmul__-1095"><a href="#ntensor.__matmul__-1095"><span class="linenos">1095</span></a><span class="sd">        --------</span>
</span><span id="ntensor.__matmul__-1096"><a href="#ntensor.__matmul__-1096"><span class="linenos">1096</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="ntensor.__matmul__-1097"><a href="#ntensor.__matmul__-1097"><span class="linenos">1097</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([5,1,3],&#39;i&#39;)</span>
</span><span id="ntensor.__matmul__-1098"><a href="#ntensor.__matmul__-1098"><span class="linenos">1098</span></a><span class="sd">        &gt;&gt;&gt; A @ B</span>
</span><span id="ntensor.__matmul__-1099"><a href="#ntensor.__matmul__-1099"><span class="linenos">1099</span></a><span class="sd">        &lt;ntensor {} 7&gt;</span>
</span><span id="ntensor.__matmul__-1100"><a href="#ntensor.__matmul__-1100"><span class="linenos">1100</span></a>
</span><span id="ntensor.__matmul__-1101"><a href="#ntensor.__matmul__-1101"><span class="linenos">1101</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([0,1],&#39;i&#39;)</span>
</span><span id="ntensor.__matmul__-1102"><a href="#ntensor.__matmul__-1102"><span class="linenos">1102</span></a><span class="sd">        &gt;&gt;&gt; B = ntensor([0,2],&#39;j&#39;)</span>
</span><span id="ntensor.__matmul__-1103"><a href="#ntensor.__matmul__-1103"><span class="linenos">1103</span></a><span class="sd">        &gt;&gt;&gt; A @ B</span>
</span><span id="ntensor.__matmul__-1104"><a href="#ntensor.__matmul__-1104"><span class="linenos">1104</span></a><span class="sd">        &lt;ntensor {i:2, j:2}</span>
</span><span id="ntensor.__matmul__-1105"><a href="#ntensor.__matmul__-1105"><span class="linenos">1105</span></a><span class="sd">        [[0 0]</span>
</span><span id="ntensor.__matmul__-1106"><a href="#ntensor.__matmul__-1106"><span class="linenos">1106</span></a><span class="sd">         [0 2]]&gt;</span>
</span><span id="ntensor.__matmul__-1107"><a href="#ntensor.__matmul__-1107"><span class="linenos">1107</span></a>
</span><span id="ntensor.__matmul__-1108"><a href="#ntensor.__matmul__-1108"><span class="linenos">1108</span></a>
</span><span id="ntensor.__matmul__-1109"><a href="#ntensor.__matmul__-1109"><span class="linenos">1109</span></a><span class="sd">        See Also</span>
</span><span id="ntensor.__matmul__-1110"><a href="#ntensor.__matmul__-1110"><span class="linenos">1110</span></a><span class="sd">        --------</span>
</span><span id="ntensor.__matmul__-1111"><a href="#ntensor.__matmul__-1111"><span class="linenos">1111</span></a><span class="sd">        dot</span>
</span><span id="ntensor.__matmul__-1112"><a href="#ntensor.__matmul__-1112"><span class="linenos">1112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.__matmul__-1113"><a href="#ntensor.__matmul__-1113"><span class="linenos">1113</span></a>        <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do einstein summation on two arrays, taking reductions over all shared axes. This is equivalent to
an alias for <code>dot(self, other)</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>other</strong> (ntensor):</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>result</strong> (ntensor):
result of Einstein summation on two arrays.</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">@</span> <span class="n">B</span>
<span class="go">&lt;ntensor {} 7&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">@</span> <span class="n">B</span>
<span class="go">&lt;ntensor {i:2, j:2}</span>
<span class="go">[[0 0]</span>
<span class="go"> [0 2]]&gt;</span>
</code></pre>
</div>

<h6 id="see-also">See Also</h6>

<p><code><a href="#dot">dot</a></code>  </p>
</div>


                            </div>
                            <div id="ntensor.__call__" class="classattr">
                                        <input id="ntensor.__call__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">__call__</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="ntensor.__call__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ntensor.__call__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ntensor.__call__-1125"><a href="#ntensor.__call__-1125"><span class="linenos">1125</span></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ntensor&#39;</span><span class="p">:</span>
</span><span id="ntensor.__call__-1126"><a href="#ntensor.__call__-1126"><span class="linenos">1126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@public</span>
</span><span id="ntensor.__call__-1127"><a href="#ntensor.__call__-1127"><span class="linenos">1127</span></a>
</span><span id="ntensor.__call__-1128"><a href="#ntensor.__call__-1128"><span class="linenos">1128</span></a><span class="sd">        Index this array. All indexing follows the One True Rule:</span>
</span><span id="ntensor.__call__-1129"><a href="#ntensor.__call__-1129"><span class="linenos">1129</span></a><span class="sd">        * All axes must be indexed.</span>
</span><span id="ntensor.__call__-1130"><a href="#ntensor.__call__-1130"><span class="linenos">1130</span></a><span class="sd">        * All indices are themselves `arrays`.</span>
</span><span id="ntensor.__call__-1131"><a href="#ntensor.__call__-1131"><span class="linenos">1131</span></a><span class="sd">        * The axes of the indices determine the output axes.</span>
</span><span id="ntensor.__call__-1132"><a href="#ntensor.__call__-1132"><span class="linenos">1132</span></a><span class="sd">        * Non-shared axes in indices are orthogonal.</span>
</span><span id="ntensor.__call__-1133"><a href="#ntensor.__call__-1133"><span class="linenos">1133</span></a><span class="sd">        * Shared axes in indices are pointwise. (And must therefore have equal lengths!)</span>
</span><span id="ntensor.__call__-1134"><a href="#ntensor.__call__-1134"><span class="linenos">1134</span></a>
</span><span id="ntensor.__call__-1135"><a href="#ntensor.__call__-1135"><span class="linenos">1135</span></a><span class="sd">        That&#39;s it. That&#39;s the only *real* rule. (Cf. numpy&#39;s [insanely complex advanced indexing</span>
</span><span id="ntensor.__call__-1136"><a href="#ntensor.__call__-1136"><span class="linenos">1136</span></a><span class="sd">        rules](https://numpy.org/doc/stable/user/basics.indexing.html#advanced-indexing).) But to</span>
</span><span id="ntensor.__call__-1137"><a href="#ntensor.__call__-1137"><span class="linenos">1137</span></a><span class="sd">        make things nicer, we offer some ergonomic syntactic sugar.</span>
</span><span id="ntensor.__call__-1138"><a href="#ntensor.__call__-1138"><span class="linenos">1138</span></a>
</span><span id="ntensor.__call__-1139"><a href="#ntensor.__call__-1139"><span class="linenos">1139</span></a><span class="sd">        1. If you don&#39;t explicitly index an input axis, it is implicitly fully sliced,</span>
</span><span id="ntensor.__call__-1140"><a href="#ntensor.__call__-1140"><span class="linenos">1140</span></a><span class="sd">        with itself as an output axis.</span>
</span><span id="ntensor.__call__-1141"><a href="#ntensor.__call__-1141"><span class="linenos">1141</span></a><span class="sd">        2. You can slice an input axis and then use that as an index.</span>
</span><span id="ntensor.__call__-1142"><a href="#ntensor.__call__-1142"><span class="linenos">1142</span></a><span class="sd">        3. You can index any axis (input or not) with a slice or 1-d list/tuple/numpy array. This</span>
</span><span id="ntensor.__call__-1143"><a href="#ntensor.__call__-1143"><span class="linenos">1143</span></a><span class="sd">        is treated like a 1-d array with that axis.</span>
</span><span id="ntensor.__call__-1144"><a href="#ntensor.__call__-1144"><span class="linenos">1144</span></a>
</span><span id="ntensor.__call__-1145"><a href="#ntensor.__call__-1145"><span class="linenos">1145</span></a><span class="sd">        Parameters</span>
</span><span id="ntensor.__call__-1146"><a href="#ntensor.__call__-1146"><span class="linenos">1146</span></a><span class="sd">        ----------</span>
</span><span id="ntensor.__call__-1147"><a href="#ntensor.__call__-1147"><span class="linenos">1147</span></a><span class="sd">        kwargs</span>
</span><span id="ntensor.__call__-1148"><a href="#ntensor.__call__-1148"><span class="linenos">1148</span></a>
</span><span id="ntensor.__call__-1149"><a href="#ntensor.__call__-1149"><span class="linenos">1149</span></a><span class="sd">        Returns</span>
</span><span id="ntensor.__call__-1150"><a href="#ntensor.__call__-1150"><span class="linenos">1150</span></a><span class="sd">        -------</span>
</span><span id="ntensor.__call__-1151"><a href="#ntensor.__call__-1151"><span class="linenos">1151</span></a><span class="sd">        out: ntensor</span>
</span><span id="ntensor.__call__-1152"><a href="#ntensor.__call__-1152"><span class="linenos">1152</span></a>
</span><span id="ntensor.__call__-1153"><a href="#ntensor.__call__-1153"><span class="linenos">1153</span></a><span class="sd">        Examples</span>
</span><span id="ntensor.__call__-1154"><a href="#ntensor.__call__-1154"><span class="linenos">1154</span></a><span class="sd">        --------</span>
</span><span id="ntensor.__call__-1155"><a href="#ntensor.__call__-1155"><span class="linenos">1155</span></a>
</span><span id="ntensor.__call__-1156"><a href="#ntensor.__call__-1156"><span class="linenos">1156</span></a><span class="sd">        You *can&#39;t* index arrays without giving names for axes. If you try, you get an error. (I</span>
</span><span id="ntensor.__call__-1157"><a href="#ntensor.__call__-1157"><span class="linenos">1157</span></a><span class="sd">        *told* you this package was uncompromising, right?)</span>
</span><span id="ntensor.__call__-1158"><a href="#ntensor.__call__-1158"><span class="linenos">1158</span></a>
</span><span id="ntensor.__call__-1159"><a href="#ntensor.__call__-1159"><span class="linenos">1159</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45],&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1160"><a href="#ntensor.__call__-1160"><span class="linenos">1160</span></a><span class="sd">        &gt;&gt;&gt; A[1] # Nope. No! Doesn&#39;t work!</span>
</span><span id="ntensor.__call__-1161"><a href="#ntensor.__call__-1161"><span class="linenos">1161</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="ntensor.__call__-1162"><a href="#ntensor.__call__-1162"><span class="linenos">1162</span></a><span class="sd">        ...</span>
</span><span id="ntensor.__call__-1163"><a href="#ntensor.__call__-1163"><span class="linenos">1163</span></a><span class="sd">        ValueError: Can&#39;t index NTensor with int. (Remember, A[i] converts to numpy)</span>
</span><span id="ntensor.__call__-1164"><a href="#ntensor.__call__-1164"><span class="linenos">1164</span></a>
</span><span id="ntensor.__call__-1165"><a href="#ntensor.__call__-1165"><span class="linenos">1165</span></a><span class="sd">        You do it like this, always with keywork arguments for axes.</span>
</span><span id="ntensor.__call__-1166"><a href="#ntensor.__call__-1166"><span class="linenos">1166</span></a>
</span><span id="ntensor.__call__-1167"><a href="#ntensor.__call__-1167"><span class="linenos">1167</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45],&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1168"><a href="#ntensor.__call__-1168"><span class="linenos">1168</span></a><span class="sd">        &gt;&gt;&gt; A(i=1) # yes!</span>
</span><span id="ntensor.__call__-1169"><a href="#ntensor.__call__-1169"><span class="linenos">1169</span></a><span class="sd">        &lt;ntensor {} 30&gt;</span>
</span><span id="ntensor.__call__-1170"><a href="#ntensor.__call__-1170"><span class="linenos">1170</span></a>
</span><span id="ntensor.__call__-1171"><a href="#ntensor.__call__-1171"><span class="linenos">1171</span></a><span class="sd">        Here are examples illustrating the one true rule</span>
</span><span id="ntensor.__call__-1172"><a href="#ntensor.__call__-1172"><span class="linenos">1172</span></a>
</span><span id="ntensor.__call__-1173"><a href="#ntensor.__call__-1173"><span class="linenos">1173</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=5, j=6)</span>
</span><span id="ntensor.__call__-1174"><a href="#ntensor.__call__-1174"><span class="linenos">1174</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([1,0],&#39;n&#39;)</span>
</span><span id="ntensor.__call__-1175"><a href="#ntensor.__call__-1175"><span class="linenos">1175</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([2,3],&#39;n&#39;)</span>
</span><span id="ntensor.__call__-1176"><a href="#ntensor.__call__-1176"><span class="linenos">1176</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index)</span>
</span><span id="ntensor.__call__-1177"><a href="#ntensor.__call__-1177"><span class="linenos">1177</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ntensor.__call__-1178"><a href="#ntensor.__call__-1178"><span class="linenos">1178</span></a><span class="sd">        {n:2}</span>
</span><span id="ntensor.__call__-1179"><a href="#ntensor.__call__-1179"><span class="linenos">1179</span></a><span class="sd">        &gt;&gt;&gt; B(n=0) == A(i=1, j=2)</span>
</span><span id="ntensor.__call__-1180"><a href="#ntensor.__call__-1180"><span class="linenos">1180</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor.__call__-1181"><a href="#ntensor.__call__-1181"><span class="linenos">1181</span></a><span class="sd">        &gt;&gt;&gt; B(n=1) == A(i=0, j=3)</span>
</span><span id="ntensor.__call__-1182"><a href="#ntensor.__call__-1182"><span class="linenos">1182</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor.__call__-1183"><a href="#ntensor.__call__-1183"><span class="linenos">1183</span></a>
</span><span id="ntensor.__call__-1184"><a href="#ntensor.__call__-1184"><span class="linenos">1184</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=5, j=6)</span>
</span><span id="ntensor.__call__-1185"><a href="#ntensor.__call__-1185"><span class="linenos">1185</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([1,0],&#39;n&#39;)</span>
</span><span id="ntensor.__call__-1186"><a href="#ntensor.__call__-1186"><span class="linenos">1186</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([2,3],&#39;m&#39;)</span>
</span><span id="ntensor.__call__-1187"><a href="#ntensor.__call__-1187"><span class="linenos">1187</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index)</span>
</span><span id="ntensor.__call__-1188"><a href="#ntensor.__call__-1188"><span class="linenos">1188</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ntensor.__call__-1189"><a href="#ntensor.__call__-1189"><span class="linenos">1189</span></a><span class="sd">        {n:2, m:2}</span>
</span><span id="ntensor.__call__-1190"><a href="#ntensor.__call__-1190"><span class="linenos">1190</span></a><span class="sd">        &gt;&gt;&gt; B(n=0, m=0) == A(i=1, j=2)</span>
</span><span id="ntensor.__call__-1191"><a href="#ntensor.__call__-1191"><span class="linenos">1191</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor.__call__-1192"><a href="#ntensor.__call__-1192"><span class="linenos">1192</span></a><span class="sd">        &gt;&gt;&gt; B(n=0, m=1) == A(i=1, j=3)</span>
</span><span id="ntensor.__call__-1193"><a href="#ntensor.__call__-1193"><span class="linenos">1193</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor.__call__-1194"><a href="#ntensor.__call__-1194"><span class="linenos">1194</span></a><span class="sd">        &gt;&gt;&gt; B(n=1, m=0) == A(i=0, j=2)</span>
</span><span id="ntensor.__call__-1195"><a href="#ntensor.__call__-1195"><span class="linenos">1195</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor.__call__-1196"><a href="#ntensor.__call__-1196"><span class="linenos">1196</span></a><span class="sd">        &gt;&gt;&gt; B(n=1, m=1) == A(i=0, j=3)</span>
</span><span id="ntensor.__call__-1197"><a href="#ntensor.__call__-1197"><span class="linenos">1197</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor.__call__-1198"><a href="#ntensor.__call__-1198"><span class="linenos">1198</span></a>
</span><span id="ntensor.__call__-1199"><a href="#ntensor.__call__-1199"><span class="linenos">1199</span></a><span class="sd">        &gt;&gt;&gt; A = randn(i=20, j=20, k=20)</span>
</span><span id="ntensor.__call__-1200"><a href="#ntensor.__call__-1200"><span class="linenos">1200</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([[0,1,2],[3,4,5]],&#39;k&#39;,&#39;l&#39;)</span>
</span><span id="ntensor.__call__-1201"><a href="#ntensor.__call__-1201"><span class="linenos">1201</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([6,7,8],&#39;l&#39;)</span>
</span><span id="ntensor.__call__-1202"><a href="#ntensor.__call__-1202"><span class="linenos">1202</span></a><span class="sd">        &gt;&gt;&gt; k_index = ntensor([9,10,11,12],&#39;m&#39;)</span>
</span><span id="ntensor.__call__-1203"><a href="#ntensor.__call__-1203"><span class="linenos">1203</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index, k=k_index)</span>
</span><span id="ntensor.__call__-1204"><a href="#ntensor.__call__-1204"><span class="linenos">1204</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ntensor.__call__-1205"><a href="#ntensor.__call__-1205"><span class="linenos">1205</span></a><span class="sd">        {k:2, l:3, m:4}</span>
</span><span id="ntensor.__call__-1206"><a href="#ntensor.__call__-1206"><span class="linenos">1206</span></a>
</span><span id="ntensor.__call__-1207"><a href="#ntensor.__call__-1207"><span class="linenos">1207</span></a><span class="sd">        You can re-use input as output dimensions if you want. This changes nothing! It&#39;s</span>
</span><span id="ntensor.__call__-1208"><a href="#ntensor.__call__-1208"><span class="linenos">1208</span></a><span class="sd">        equivalent to using all new dimensions and then relabeling.</span>
</span><span id="ntensor.__call__-1209"><a href="#ntensor.__call__-1209"><span class="linenos">1209</span></a>
</span><span id="ntensor.__call__-1210"><a href="#ntensor.__call__-1210"><span class="linenos">1210</span></a><span class="sd">        &gt;&gt;&gt; i_index = ntensor([[0,1,2],[3,4,5]],&#39;k&#39;,&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1211"><a href="#ntensor.__call__-1211"><span class="linenos">1211</span></a><span class="sd">        &gt;&gt;&gt; j_index = ntensor([6,7,8],&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1212"><a href="#ntensor.__call__-1212"><span class="linenos">1212</span></a><span class="sd">        &gt;&gt;&gt; k_index = ntensor([9,10,11,12],&#39;m&#39;)</span>
</span><span id="ntensor.__call__-1213"><a href="#ntensor.__call__-1213"><span class="linenos">1213</span></a><span class="sd">        &gt;&gt;&gt; B = A(i=i_index, j=j_index, k=k_index)</span>
</span><span id="ntensor.__call__-1214"><a href="#ntensor.__call__-1214"><span class="linenos">1214</span></a><span class="sd">        &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ntensor.__call__-1215"><a href="#ntensor.__call__-1215"><span class="linenos">1215</span></a><span class="sd">        {k:2, i:3, m:4}</span>
</span><span id="ntensor.__call__-1216"><a href="#ntensor.__call__-1216"><span class="linenos">1216</span></a>
</span><span id="ntensor.__call__-1217"><a href="#ntensor.__call__-1217"><span class="linenos">1217</span></a><span class="sd">        Examples using syntacic sugar for numbers or 1-d lists/tuple/numpy arrays or slices as</span>
</span><span id="ntensor.__call__-1218"><a href="#ntensor.__call__-1218"><span class="linenos">1218</span></a><span class="sd">        indices</span>
</span><span id="ntensor.__call__-1219"><a href="#ntensor.__call__-1219"><span class="linenos">1219</span></a>
</span><span id="ntensor.__call__-1220"><a href="#ntensor.__call__-1220"><span class="linenos">1220</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1221"><a href="#ntensor.__call__-1221"><span class="linenos">1221</span></a><span class="sd">        &gt;&gt;&gt; A(i=2)                    # ints work</span>
</span><span id="ntensor.__call__-1222"><a href="#ntensor.__call__-1222"><span class="linenos">1222</span></a><span class="sd">        &lt;ntensor {} 45&gt;</span>
</span><span id="ntensor.__call__-1223"><a href="#ntensor.__call__-1223"><span class="linenos">1223</span></a><span class="sd">        &gt;&gt;&gt; A(i=[2,0,5])              # lists work</span>
</span><span id="ntensor.__call__-1224"><a href="#ntensor.__call__-1224"><span class="linenos">1224</span></a><span class="sd">        &lt;ntensor {i:3} [45 15 90]&gt;</span>
</span><span id="ntensor.__call__-1225"><a href="#ntensor.__call__-1225"><span class="linenos">1225</span></a><span class="sd">        &gt;&gt;&gt; A(i=jnp.array([2,0,5]))    # numpy arrays work</span>
</span><span id="ntensor.__call__-1226"><a href="#ntensor.__call__-1226"><span class="linenos">1226</span></a><span class="sd">        &lt;ntensor {i:3} [45 15 90]&gt;</span>
</span><span id="ntensor.__call__-1227"><a href="#ntensor.__call__-1227"><span class="linenos">1227</span></a><span class="sd">        &gt;&gt;&gt; i = Axis(&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1228"><a href="#ntensor.__call__-1228"><span class="linenos">1228</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[6:1:-2])</span>
</span><span id="ntensor.__call__-1229"><a href="#ntensor.__call__-1229"><span class="linenos">1229</span></a><span class="sd">        &lt;ntensor {i:3} [105  75  45]&gt;</span>
</span><span id="ntensor.__call__-1230"><a href="#ntensor.__call__-1230"><span class="linenos">1230</span></a>
</span><span id="ntensor.__call__-1231"><a href="#ntensor.__call__-1231"><span class="linenos">1231</span></a><span class="sd">        Remember, using numbers or 1D lists/tuples/numpy arrays or slices is just syntactic sugar!</span>
</span><span id="ntensor.__call__-1232"><a href="#ntensor.__call__-1232"><span class="linenos">1232</span></a>
</span><span id="ntensor.__call__-1233"><a href="#ntensor.__call__-1233"><span class="linenos">1233</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1234"><a href="#ntensor.__call__-1234"><span class="linenos">1234</span></a><span class="sd">        &gt;&gt;&gt; A(i=2)==A(i=ntensor(2))</span>
</span><span id="ntensor.__call__-1235"><a href="#ntensor.__call__-1235"><span class="linenos">1235</span></a><span class="sd">        &lt;ntensor {} True&gt;</span>
</span><span id="ntensor.__call__-1236"><a href="#ntensor.__call__-1236"><span class="linenos">1236</span></a><span class="sd">        &gt;&gt;&gt; A(i=jnp.array([2,0,5])) == A(i=ntensor(jnp.array([2,0,5]),&#39;i&#39;))</span>
</span><span id="ntensor.__call__-1237"><a href="#ntensor.__call__-1237"><span class="linenos">1237</span></a><span class="sd">        &lt;ntensor {i:3} [ True  True  True]&gt;</span>
</span><span id="ntensor.__call__-1238"><a href="#ntensor.__call__-1238"><span class="linenos">1238</span></a><span class="sd">        &gt;&gt;&gt; i = Axis(&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1239"><a href="#ntensor.__call__-1239"><span class="linenos">1239</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[6:1:-2]) == A(i=ntensor([6,4,2],&#39;i&#39;))</span>
</span><span id="ntensor.__call__-1240"><a href="#ntensor.__call__-1240"><span class="linenos">1240</span></a><span class="sd">        &lt;ntensor {i:3} [ True  True  True]&gt;</span>
</span><span id="ntensor.__call__-1241"><a href="#ntensor.__call__-1241"><span class="linenos">1241</span></a>
</span><span id="ntensor.__call__-1242"><a href="#ntensor.__call__-1242"><span class="linenos">1242</span></a><span class="sd">        You can index an Axis as a shortcut to create a new array.</span>
</span><span id="ntensor.__call__-1243"><a href="#ntensor.__call__-1243"><span class="linenos">1243</span></a>
</span><span id="ntensor.__call__-1244"><a href="#ntensor.__call__-1244"><span class="linenos">1244</span></a><span class="sd">        &gt;&gt;&gt; A = ntensor([15,30,45,60,75,90,105,120],&#39;i&#39;)</span>
</span><span id="ntensor.__call__-1245"><a href="#ntensor.__call__-1245"><span class="linenos">1245</span></a><span class="sd">        &gt;&gt;&gt; i, j = axes()</span>
</span><span id="ntensor.__call__-1246"><a href="#ntensor.__call__-1246"><span class="linenos">1246</span></a><span class="sd">        &gt;&gt;&gt; print(A(i=i[:]).shape)</span>
</span><span id="ntensor.__call__-1247"><a href="#ntensor.__call__-1247"><span class="linenos">1247</span></a><span class="sd">        {i:8}</span>
</span><span id="ntensor.__call__-1248"><a href="#ntensor.__call__-1248"><span class="linenos">1248</span></a><span class="sd">        &gt;&gt;&gt; A(i=i[:]) == A</span>
</span><span id="ntensor.__call__-1249"><a href="#ntensor.__call__-1249"><span class="linenos">1249</span></a><span class="sd">        &lt;ntensor {i:8} [ True  True  True  True  True  True  True  True]&gt;</span>
</span><span id="ntensor.__call__-1250"><a href="#ntensor.__call__-1250"><span class="linenos">1250</span></a><span class="sd">        &gt;&gt;&gt; print(A(i=j[[2,0,5]]).shape)</span>
</span><span id="ntensor.__call__-1251"><a href="#ntensor.__call__-1251"><span class="linenos">1251</span></a><span class="sd">        {j:3}</span>
</span><span id="ntensor.__call__-1252"><a href="#ntensor.__call__-1252"><span class="linenos">1252</span></a><span class="sd">        &gt;&gt;&gt; A(i=j[[2,0,5]]) == A(i=ntensor([2,0,5],j))</span>
</span><span id="ntensor.__call__-1253"><a href="#ntensor.__call__-1253"><span class="linenos">1253</span></a><span class="sd">        &lt;ntensor {j:3} [ True  True  True]&gt;</span>
</span><span id="ntensor.__call__-1254"><a href="#ntensor.__call__-1254"><span class="linenos">1254</span></a>
</span><span id="ntensor.__call__-1255"><a href="#ntensor.__call__-1255"><span class="linenos">1255</span></a><span class="sd">        You can also index with a *slice* from another input index. (You can *only* slice axes that exist</span>
</span><span id="ntensor.__call__-1256"><a href="#ntensor.__call__-1256"><span class="linenos">1256</span></a><span class="sd">        in the `NTensor` since otherwise the shape would be ambiguous.)</span>
</span><span id="ntensor.__call__-1257"><a href="#ntensor.__call__-1257"><span class="linenos">1257</span></a>
</span><span id="ntensor.__call__-1258"><a href="#ntensor.__call__-1258"><span class="linenos">1258</span></a>
</span><span id="ntensor.__call__-1259"><a href="#ntensor.__call__-1259"><span class="linenos">1259</span></a>
</span><span id="ntensor.__call__-1260"><a href="#ntensor.__call__-1260"><span class="linenos">1260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ntensor.__call__-1261"><a href="#ntensor.__call__-1261"><span class="linenos">1261</span></a>        <span class="k">return</span> <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Index this array. All indexing follows the One True Rule:</p>

<ul>
<li>All axes must be indexed.</li>
<li>All indices are themselves <code>arrays</code>.</li>
<li>The axes of the indices determine the output axes.</li>
<li>Non-shared axes in indices are orthogonal.</li>
<li>Shared axes in indices are pointwise. (And must therefore have equal lengths!)</li>
</ul>

<p>That's it. That's the only <em>real</em> rule. (Cf. numpy's <a href="https://numpy.org/doc/stable/user/basics.indexing.html#advanced-indexing">insanely complex advanced indexing
rules</a>.) But to
make things nicer, we offer some ergonomic syntactic sugar.</p>

<ol>
<li>If you don't explicitly index an input axis, it is implicitly fully sliced,
with itself as an output axis.</li>
<li>You can slice an input axis and then use that as an index.</li>
<li>You can index any axis (input or not) with a slice or 1-d list/tuple/numpy array. This
is treated like a 1-d array with that axis.</li>
</ol>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>kwargs</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out</strong> (ntensor):</li>
</ul>

<h6 id="examples">Examples</h6>

<p>You <em>can't</em> index arrays without giving names for axes. If you try, you get an error. (I
<em>told</em> you this package was uncompromising, right?)</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">45</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Nope. No! Doesn&#39;t work!</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Can&#39;t index NTensor with int. (Remember, A[i] converts to numpy)</span>
</code></pre>
</div>

<p>You do it like this, always with keywork arguments for axes.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">45</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># yes!</span>
<span class="go">&lt;ntensor {} 30&gt;</span>
</code></pre>
</div>

<p>Here are examples illustrating the one true rule</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i_index</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j_index</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{n:2}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;ntensor {} True&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">&lt;ntensor {} True&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i_index</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j_index</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{n:2, m:2}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;ntensor {} True&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">&lt;ntensor {} True&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;ntensor {} True&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">&lt;ntensor {} True&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i_index</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j_index</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_index</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{k:2, l:3, m:4}</span>
</code></pre>
</div>

<p>You can re-use input as output dimensions if you want. This changes nothing! It's
equivalent to using all new dimensions and then relabeling.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">i_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k_index</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i_index</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j_index</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_index</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{k:2, i:3, m:4}</span>
</code></pre>
</div>

<p>Examples using syntacic sugar for numbers or 1-d lists/tuple/numpy arrays or slices as
indices</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">120</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>                    <span class="c1"># ints work</span>
<span class="go">&lt;ntensor {} 45&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>              <span class="c1"># lists work</span>
<span class="go">&lt;ntensor {i:3} [45 15 90]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]))</span>    <span class="c1"># numpy arrays work</span>
<span class="go">&lt;ntensor {i:3} [45 15 90]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<span class="go">&lt;ntensor {i:3} [105  75  45]&gt;</span>
</code></pre>
</div>

<p>Remember, using numbers or 1D lists/tuples/numpy arrays or slices is just syntactic sugar!</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">120</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">ntensor</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="go">&lt;ntensor {} True&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]))</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">ntensor</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<span class="go">&lt;ntensor {i:3} [ True  True  True]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">ntensor</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<span class="go">&lt;ntensor {i:3} [ True  True  True]&gt;</span>
</code></pre>
</div>

<p>You can index an Axis as a shortcut to create a new array.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">120</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">axes</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[:])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{i:8}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[:])</span> <span class="o">==</span> <span class="n">A</span>
<span class="go">&lt;ntensor {i:8} [ True  True  True  True  True  True  True  True]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">j</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{j:3}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">j</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span> <span class="o">==</span> <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">ntensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">j</span><span class="p">))</span>
<span class="go">&lt;ntensor {j:3} [ True  True  True]&gt;</span>
</code></pre>
</div>

<p>You can also index with a <em>slice</em> from another input index. (You can <em>only</em> slice axes that exist
in the <code>NTensor</code> since otherwise the shape would be ambiguous.)</p>
</div>


                            </div>
                </section>
                <section id="concatenate">
                            <input id="concatenate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">concatenate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arrays</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#ntensor">ntensor</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Axis">Axis</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="concatenate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#concatenate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="concatenate-1486"><a href="#concatenate-1486"><span class="linenos">1486</span></a><span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="n">arrays</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ntensor</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="n">Axis</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="concatenate-1487"><a href="#concatenate-1487"><span class="linenos">1487</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Concatenate a sequence of NTensors into a NTensor.</span>
</span><span id="concatenate-1488"><a href="#concatenate-1488"><span class="linenos">1488</span></a>
</span><span id="concatenate-1489"><a href="#concatenate-1489"><span class="linenos">1489</span></a><span class="sd">    Parameters</span>
</span><span id="concatenate-1490"><a href="#concatenate-1490"><span class="linenos">1490</span></a><span class="sd">    ----------</span>
</span><span id="concatenate-1491"><a href="#concatenate-1491"><span class="linenos">1491</span></a><span class="sd">    arrays: Iterable[ntensor]</span>
</span><span id="concatenate-1492"><a href="#concatenate-1492"><span class="linenos">1492</span></a><span class="sd">        The tensors must have the same shape except in the dimension axis</span>
</span><span id="concatenate-1493"><a href="#concatenate-1493"><span class="linenos">1493</span></a><span class="sd">    axis: str|Axis</span>
</span><span id="concatenate-1494"><a href="#concatenate-1494"><span class="linenos">1494</span></a><span class="sd">        The axis along which to be joined</span>
</span><span id="concatenate-1495"><a href="#concatenate-1495"><span class="linenos">1495</span></a>
</span><span id="concatenate-1496"><a href="#concatenate-1496"><span class="linenos">1496</span></a><span class="sd">    Returns</span>
</span><span id="concatenate-1497"><a href="#concatenate-1497"><span class="linenos">1497</span></a><span class="sd">    -------</span>
</span><span id="concatenate-1498"><a href="#concatenate-1498"><span class="linenos">1498</span></a><span class="sd">    out: ntensor</span>
</span><span id="concatenate-1499"><a href="#concatenate-1499"><span class="linenos">1499</span></a><span class="sd">        The concatenated ntensor</span>
</span><span id="concatenate-1500"><a href="#concatenate-1500"><span class="linenos">1500</span></a>
</span><span id="concatenate-1501"><a href="#concatenate-1501"><span class="linenos">1501</span></a><span class="sd">    See Also</span>
</span><span id="concatenate-1502"><a href="#concatenate-1502"><span class="linenos">1502</span></a><span class="sd">    --------</span>
</span><span id="concatenate-1503"><a href="#concatenate-1503"><span class="linenos">1503</span></a><span class="sd">    stack</span>
</span><span id="concatenate-1504"><a href="#concatenate-1504"><span class="linenos">1504</span></a>
</span><span id="concatenate-1505"><a href="#concatenate-1505"><span class="linenos">1505</span></a><span class="sd">    Examples</span>
</span><span id="concatenate-1506"><a href="#concatenate-1506"><span class="linenos">1506</span></a><span class="sd">    --------</span>
</span><span id="concatenate-1507"><a href="#concatenate-1507"><span class="linenos">1507</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([1,2],&#39;i&#39;)</span>
</span><span id="concatenate-1508"><a href="#concatenate-1508"><span class="linenos">1508</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([3,4],&#39;i&#39;)</span>
</span><span id="concatenate-1509"><a href="#concatenate-1509"><span class="linenos">1509</span></a><span class="sd">    &gt;&gt;&gt; concatenate([A,B], axis=&#39;i&#39;)</span>
</span><span id="concatenate-1510"><a href="#concatenate-1510"><span class="linenos">1510</span></a><span class="sd">    &lt;ntensor {i:4} [1 2 3 4]&gt;</span>
</span><span id="concatenate-1511"><a href="#concatenate-1511"><span class="linenos">1511</span></a>
</span><span id="concatenate-1512"><a href="#concatenate-1512"><span class="linenos">1512</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([[1,2],[3,4]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="concatenate-1513"><a href="#concatenate-1513"><span class="linenos">1513</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([[5,6],[7,8]],&#39;i&#39;,&#39;j&#39;)</span>
</span><span id="concatenate-1514"><a href="#concatenate-1514"><span class="linenos">1514</span></a><span class="sd">    &gt;&gt;&gt; concatenate([A,B],axis=&#39;i&#39;)</span>
</span><span id="concatenate-1515"><a href="#concatenate-1515"><span class="linenos">1515</span></a><span class="sd">    &lt;ntensor {j:2, i:4}</span>
</span><span id="concatenate-1516"><a href="#concatenate-1516"><span class="linenos">1516</span></a><span class="sd">    [[1 3 5 7]</span>
</span><span id="concatenate-1517"><a href="#concatenate-1517"><span class="linenos">1517</span></a><span class="sd">     [2 4 6 8]]&gt;</span>
</span><span id="concatenate-1518"><a href="#concatenate-1518"><span class="linenos">1518</span></a><span class="sd">    &gt;&gt;&gt; concatenate((A,B),axis=Axis(&#39;i&#39;))</span>
</span><span id="concatenate-1519"><a href="#concatenate-1519"><span class="linenos">1519</span></a><span class="sd">    &lt;ntensor {j:2, i:4}</span>
</span><span id="concatenate-1520"><a href="#concatenate-1520"><span class="linenos">1520</span></a><span class="sd">    [[1 3 5 7]</span>
</span><span id="concatenate-1521"><a href="#concatenate-1521"><span class="linenos">1521</span></a><span class="sd">     [2 4 6 8]]&gt;</span>
</span><span id="concatenate-1522"><a href="#concatenate-1522"><span class="linenos">1522</span></a><span class="sd">    &gt;&gt;&gt; concatenate([A,B],axis=&#39;j&#39;)</span>
</span><span id="concatenate-1523"><a href="#concatenate-1523"><span class="linenos">1523</span></a><span class="sd">    &lt;ntensor {i:2, j:4}</span>
</span><span id="concatenate-1524"><a href="#concatenate-1524"><span class="linenos">1524</span></a><span class="sd">    [[1 2 5 6]</span>
</span><span id="concatenate-1525"><a href="#concatenate-1525"><span class="linenos">1525</span></a><span class="sd">     [3 4 7 8]]&gt;</span>
</span><span id="concatenate-1526"><a href="#concatenate-1526"><span class="linenos">1526</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="concatenate-1527"><a href="#concatenate-1527"><span class="linenos">1527</span></a>    <span class="n">axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="concatenate-1528"><a href="#concatenate-1528"><span class="linenos">1528</span></a>    <span class="k">return</span> <span class="n">lift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">out_axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">])(</span><span class="n">arrays</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Concatenate a sequence of NTensors into a NTensor.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arrays</strong> (Iterable[ntensor]):
The tensors must have the same shape except in the dimension axis</li>
<li><strong>axis</strong> (str|Axis):
The axis along which to be joined</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out</strong> (ntensor):
The concatenated ntensor</li>
</ul>

<h6 id="see-also">See Also</h6>

<p><code><a href="#stack">stack</a></code>  </p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concatenate</span><span class="p">([</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:4} [1 2 3 4]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]],</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]],</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concatenate</span><span class="p">([</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {j:2, i:4}</span>
<span class="go">[[1 3 5 7]</span>
<span class="go"> [2 4 6 8]]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concatenate</span><span class="p">((</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="n">Axis</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<span class="go">&lt;ntensor {j:2, i:4}</span>
<span class="go">[[1 3 5 7]</span>
<span class="go"> [2 4 6 8]]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concatenate</span><span class="p">([</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:2, j:4}</span>
<span class="go">[[1 2 5 6]</span>
<span class="go"> [3 4 7 8]]&gt;</span>
</code></pre>
</div>
</div>


                </section>
                <section id="stack">
                            <input id="stack-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stack</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arrays</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n"><a href="#ntensor">ntensor</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Axis">Axis</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="stack-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stack"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stack-1530"><a href="#stack-1530"><span class="linenos">1530</span></a><span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">arrays</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">ntensor</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="n">Axis</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="stack-1531"><a href="#stack-1531"><span class="linenos">1531</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Join a squence of ntensor along a new axis into a new ntensor.</span>
</span><span id="stack-1532"><a href="#stack-1532"><span class="linenos">1532</span></a>
</span><span id="stack-1533"><a href="#stack-1533"><span class="linenos">1533</span></a><span class="sd">    Parameters</span>
</span><span id="stack-1534"><a href="#stack-1534"><span class="linenos">1534</span></a><span class="sd">    ----------</span>
</span><span id="stack-1535"><a href="#stack-1535"><span class="linenos">1535</span></a><span class="sd">    arrays: Iterable[ntensor]</span>
</span><span id="stack-1536"><a href="#stack-1536"><span class="linenos">1536</span></a><span class="sd">        The tensors must have the same shape</span>
</span><span id="stack-1537"><a href="#stack-1537"><span class="linenos">1537</span></a><span class="sd">    axis: str|Axis</span>
</span><span id="stack-1538"><a href="#stack-1538"><span class="linenos">1538</span></a><span class="sd">        The axis along which to be joined</span>
</span><span id="stack-1539"><a href="#stack-1539"><span class="linenos">1539</span></a>
</span><span id="stack-1540"><a href="#stack-1540"><span class="linenos">1540</span></a><span class="sd">    Returns</span>
</span><span id="stack-1541"><a href="#stack-1541"><span class="linenos">1541</span></a><span class="sd">    -------</span>
</span><span id="stack-1542"><a href="#stack-1542"><span class="linenos">1542</span></a><span class="sd">    out: ntensor</span>
</span><span id="stack-1543"><a href="#stack-1543"><span class="linenos">1543</span></a><span class="sd">        The concatenated ntensor</span>
</span><span id="stack-1544"><a href="#stack-1544"><span class="linenos">1544</span></a>
</span><span id="stack-1545"><a href="#stack-1545"><span class="linenos">1545</span></a><span class="sd">    See Also</span>
</span><span id="stack-1546"><a href="#stack-1546"><span class="linenos">1546</span></a><span class="sd">    --------</span>
</span><span id="stack-1547"><a href="#stack-1547"><span class="linenos">1547</span></a><span class="sd">    concatenate</span>
</span><span id="stack-1548"><a href="#stack-1548"><span class="linenos">1548</span></a>
</span><span id="stack-1549"><a href="#stack-1549"><span class="linenos">1549</span></a><span class="sd">    Examples</span>
</span><span id="stack-1550"><a href="#stack-1550"><span class="linenos">1550</span></a><span class="sd">    --------</span>
</span><span id="stack-1551"><a href="#stack-1551"><span class="linenos">1551</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor(5)</span>
</span><span id="stack-1552"><a href="#stack-1552"><span class="linenos">1552</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor(9)</span>
</span><span id="stack-1553"><a href="#stack-1553"><span class="linenos">1553</span></a><span class="sd">    &gt;&gt;&gt; stack([A,B],&#39;i&#39;)</span>
</span><span id="stack-1554"><a href="#stack-1554"><span class="linenos">1554</span></a><span class="sd">    &lt;ntensor {i:2} [5 9]&gt;</span>
</span><span id="stack-1555"><a href="#stack-1555"><span class="linenos">1555</span></a>
</span><span id="stack-1556"><a href="#stack-1556"><span class="linenos">1556</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="stack-1557"><a href="#stack-1557"><span class="linenos">1557</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([4,5,6],&#39;i&#39;)</span>
</span><span id="stack-1558"><a href="#stack-1558"><span class="linenos">1558</span></a><span class="sd">    &gt;&gt;&gt; stack([A,B], axis=&#39;j&#39;)</span>
</span><span id="stack-1559"><a href="#stack-1559"><span class="linenos">1559</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="stack-1560"><a href="#stack-1560"><span class="linenos">1560</span></a><span class="sd">    [[1 4]</span>
</span><span id="stack-1561"><a href="#stack-1561"><span class="linenos">1561</span></a><span class="sd">     [2 5]</span>
</span><span id="stack-1562"><a href="#stack-1562"><span class="linenos">1562</span></a><span class="sd">     [3 6]]&gt;</span>
</span><span id="stack-1563"><a href="#stack-1563"><span class="linenos">1563</span></a>
</span><span id="stack-1564"><a href="#stack-1564"><span class="linenos">1564</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="stack-1565"><a href="#stack-1565"><span class="linenos">1565</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([4,5,6],&#39;i&#39;)</span>
</span><span id="stack-1566"><a href="#stack-1566"><span class="linenos">1566</span></a><span class="sd">    &gt;&gt;&gt; stack((A,B), axis=&#39;j&#39;)</span>
</span><span id="stack-1567"><a href="#stack-1567"><span class="linenos">1567</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="stack-1568"><a href="#stack-1568"><span class="linenos">1568</span></a><span class="sd">    [[1 4]</span>
</span><span id="stack-1569"><a href="#stack-1569"><span class="linenos">1569</span></a><span class="sd">     [2 5]</span>
</span><span id="stack-1570"><a href="#stack-1570"><span class="linenos">1570</span></a><span class="sd">     [3 6]]&gt;</span>
</span><span id="stack-1571"><a href="#stack-1571"><span class="linenos">1571</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="stack-1572"><a href="#stack-1572"><span class="linenos">1572</span></a>    <span class="n">axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="stack-1573"><a href="#stack-1573"><span class="linenos">1573</span></a>    <span class="k">return</span> <span class="n">lift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">[],</span> <span class="n">out_axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">])(</span><span class="n">arrays</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Join a squence of ntensor along a new axis into a new ntensor.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arrays</strong> (Iterable[ntensor]):
The tensors must have the same shape</li>
<li><strong>axis</strong> (str|Axis):
The axis along which to be joined</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out</strong> (ntensor):
The concatenated ntensor</li>
</ul>

<h6 id="see-also">See Also</h6>

<p><code><a href="#concatenate">concatenate</a></code>  </p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">([</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:2} [5 9]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">([</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3, j:2}</span>
<span class="go">[[1 4]</span>
<span class="go"> [2 5]</span>
<span class="go"> [3 6]]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">((</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3, j:2}</span>
<span class="go">[[1 4]</span>
<span class="go"> [2 5]</span>
<span class="go"> [3 6]]&gt;</span>
</code></pre>
</div>
</div>


                </section>
                <section id="dot">
                            <input id="dot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n"><a href="#ntensor">ntensor</a></span> <span class="o">|</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Axis">Axis</a></span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="dot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dot-1799"><a href="#dot-1799"><span class="linenos">1799</span></a><span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n">ntensor</span> <span class="o">|</span> <span class="n">Number</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Axis</span><span class="p">]</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="dot-1800"><a href="#dot-1800"><span class="linenos">1800</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Do inner products or outer products or matrix multiplication or tensor multiplication or einstein</span>
</span><span id="dot-1801"><a href="#dot-1801"><span class="linenos">1801</span></a><span class="sd">    summation or batched versions of any of these.</span>
</span><span id="dot-1802"><a href="#dot-1802"><span class="linenos">1802</span></a>
</span><span id="dot-1803"><a href="#dot-1803"><span class="linenos">1803</span></a><span class="sd">    Parameters</span>
</span><span id="dot-1804"><a href="#dot-1804"><span class="linenos">1804</span></a><span class="sd">    ----------</span>
</span><span id="dot-1805"><a href="#dot-1805"><span class="linenos">1805</span></a><span class="sd">    arrays</span>
</span><span id="dot-1806"><a href="#dot-1806"><span class="linenos">1806</span></a><span class="sd">        The `NTensor` objects to operate on. In principle, the order does not matter. (Though it may affect</span>
</span><span id="dot-1807"><a href="#dot-1807"><span class="linenos">1807</span></a><span class="sd">        the internal layout of the data.)</span>
</span><span id="dot-1808"><a href="#dot-1808"><span class="linenos">1808</span></a><span class="sd">    keep</span>
</span><span id="dot-1809"><a href="#dot-1809"><span class="linenos">1809</span></a><span class="sd">        Any shared indices you don&#39;t want reduced.</span>
</span><span id="dot-1810"><a href="#dot-1810"><span class="linenos">1810</span></a>
</span><span id="dot-1811"><a href="#dot-1811"><span class="linenos">1811</span></a><span class="sd">    Returns</span>
</span><span id="dot-1812"><a href="#dot-1812"><span class="linenos">1812</span></a><span class="sd">    -------</span>
</span><span id="dot-1813"><a href="#dot-1813"><span class="linenos">1813</span></a><span class="sd">    out</span>
</span><span id="dot-1814"><a href="#dot-1814"><span class="linenos">1814</span></a><span class="sd">        Reduced `NTensor`</span>
</span><span id="dot-1815"><a href="#dot-1815"><span class="linenos">1815</span></a>
</span><span id="dot-1816"><a href="#dot-1816"><span class="linenos">1816</span></a><span class="sd">    Examples</span>
</span><span id="dot-1817"><a href="#dot-1817"><span class="linenos">1817</span></a><span class="sd">    --------</span>
</span><span id="dot-1818"><a href="#dot-1818"><span class="linenos">1818</span></a>
</span><span id="dot-1819"><a href="#dot-1819"><span class="linenos">1819</span></a><span class="sd">    Inner product</span>
</span><span id="dot-1820"><a href="#dot-1820"><span class="linenos">1820</span></a><span class="sd">    &gt;&gt;&gt; a = ntensor([1,2,3],&#39;i&#39;)</span>
</span><span id="dot-1821"><a href="#dot-1821"><span class="linenos">1821</span></a><span class="sd">    &gt;&gt;&gt; b = ntensor([10,0,100],&#39;i&#39;)</span>
</span><span id="dot-1822"><a href="#dot-1822"><span class="linenos">1822</span></a><span class="sd">    &gt;&gt;&gt; dot(a,b)</span>
</span><span id="dot-1823"><a href="#dot-1823"><span class="linenos">1823</span></a><span class="sd">    &lt;ntensor {} 310&gt;</span>
</span><span id="dot-1824"><a href="#dot-1824"><span class="linenos">1824</span></a>
</span><span id="dot-1825"><a href="#dot-1825"><span class="linenos">1825</span></a><span class="sd">    Elementwise product</span>
</span><span id="dot-1826"><a href="#dot-1826"><span class="linenos">1826</span></a><span class="sd">    &gt;&gt;&gt; dot(a,b,keep={&#39;i&#39;})</span>
</span><span id="dot-1827"><a href="#dot-1827"><span class="linenos">1827</span></a><span class="sd">    &lt;ntensor {i:3} [ 10   0 300]&gt;</span>
</span><span id="dot-1828"><a href="#dot-1828"><span class="linenos">1828</span></a>
</span><span id="dot-1829"><a href="#dot-1829"><span class="linenos">1829</span></a><span class="sd">    Outer product</span>
</span><span id="dot-1830"><a href="#dot-1830"><span class="linenos">1830</span></a><span class="sd">    &gt;&gt;&gt; a = ntensor([0,10],&#39;i&#39;)</span>
</span><span id="dot-1831"><a href="#dot-1831"><span class="linenos">1831</span></a><span class="sd">    &gt;&gt;&gt; b = ntensor([1,2,3],&#39;j&#39;)</span>
</span><span id="dot-1832"><a href="#dot-1832"><span class="linenos">1832</span></a><span class="sd">    &gt;&gt;&gt; dot(a,b)</span>
</span><span id="dot-1833"><a href="#dot-1833"><span class="linenos">1833</span></a><span class="sd">    &lt;ntensor {i:2, j:3}</span>
</span><span id="dot-1834"><a href="#dot-1834"><span class="linenos">1834</span></a><span class="sd">    [[ 0  0  0]</span>
</span><span id="dot-1835"><a href="#dot-1835"><span class="linenos">1835</span></a><span class="sd">     [10 20 30]]&gt;</span>
</span><span id="dot-1836"><a href="#dot-1836"><span class="linenos">1836</span></a>
</span><span id="dot-1837"><a href="#dot-1837"><span class="linenos">1837</span></a><span class="sd">    Matrix-vector multiplication</span>
</span><span id="dot-1838"><a href="#dot-1838"><span class="linenos">1838</span></a><span class="sd">    &gt;&gt;&gt; a = randn(i=5, j=4)</span>
</span><span id="dot-1839"><a href="#dot-1839"><span class="linenos">1839</span></a><span class="sd">    &gt;&gt;&gt; b = randn(j=4)</span>
</span><span id="dot-1840"><a href="#dot-1840"><span class="linenos">1840</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b).shape</span>
</span><span id="dot-1841"><a href="#dot-1841"><span class="linenos">1841</span></a><span class="sd">    ShapeDict(i=5)</span>
</span><span id="dot-1842"><a href="#dot-1842"><span class="linenos">1842</span></a><span class="sd">    &gt;&gt;&gt; dot(b, a).shape</span>
</span><span id="dot-1843"><a href="#dot-1843"><span class="linenos">1843</span></a><span class="sd">    ShapeDict(i=5)</span>
</span><span id="dot-1844"><a href="#dot-1844"><span class="linenos">1844</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b) == dot(b, a)</span>
</span><span id="dot-1845"><a href="#dot-1845"><span class="linenos">1845</span></a><span class="sd">    &lt;ntensor {i:5} [ True  True  True  True  True]&gt;</span>
</span><span id="dot-1846"><a href="#dot-1846"><span class="linenos">1846</span></a><span class="sd">    &gt;&gt;&gt; c = randn(i=5)</span>
</span><span id="dot-1847"><a href="#dot-1847"><span class="linenos">1847</span></a><span class="sd">    &gt;&gt;&gt; dot(c, a).shape</span>
</span><span id="dot-1848"><a href="#dot-1848"><span class="linenos">1848</span></a><span class="sd">    ShapeDict(j=4)</span>
</span><span id="dot-1849"><a href="#dot-1849"><span class="linenos">1849</span></a><span class="sd">    &gt;&gt;&gt; dot(c, a, b).shape</span>
</span><span id="dot-1850"><a href="#dot-1850"><span class="linenos">1850</span></a><span class="sd">    ShapeDict()</span>
</span><span id="dot-1851"><a href="#dot-1851"><span class="linenos">1851</span></a>
</span><span id="dot-1852"><a href="#dot-1852"><span class="linenos">1852</span></a><span class="sd">    Matrix-matrix multiplication</span>
</span><span id="dot-1853"><a href="#dot-1853"><span class="linenos">1853</span></a><span class="sd">    &gt;&gt;&gt; a = randn(i=5, j=6)</span>
</span><span id="dot-1854"><a href="#dot-1854"><span class="linenos">1854</span></a><span class="sd">    &gt;&gt;&gt; b = randn(j=6, k=7)</span>
</span><span id="dot-1855"><a href="#dot-1855"><span class="linenos">1855</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b).shape</span>
</span><span id="dot-1856"><a href="#dot-1856"><span class="linenos">1856</span></a><span class="sd">    ShapeDict(i=5, k=7)</span>
</span><span id="dot-1857"><a href="#dot-1857"><span class="linenos">1857</span></a>
</span><span id="dot-1858"><a href="#dot-1858"><span class="linenos">1858</span></a><span class="sd">    Tensor multiplication / Einstein summation</span>
</span><span id="dot-1859"><a href="#dot-1859"><span class="linenos">1859</span></a><span class="sd">    &gt;&gt;&gt; a = randn(i=5, j=6, k=7)</span>
</span><span id="dot-1860"><a href="#dot-1860"><span class="linenos">1860</span></a><span class="sd">    &gt;&gt;&gt; b = randn(j=6, l=8)</span>
</span><span id="dot-1861"><a href="#dot-1861"><span class="linenos">1861</span></a><span class="sd">    &gt;&gt;&gt; c = randn(k=7, l=8, m=9)</span>
</span><span id="dot-1862"><a href="#dot-1862"><span class="linenos">1862</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b, c).shape</span>
</span><span id="dot-1863"><a href="#dot-1863"><span class="linenos">1863</span></a><span class="sd">    ShapeDict(i=5, m=9)</span>
</span><span id="dot-1864"><a href="#dot-1864"><span class="linenos">1864</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b, c, keep={&#39;j&#39;}).shape</span>
</span><span id="dot-1865"><a href="#dot-1865"><span class="linenos">1865</span></a><span class="sd">    ShapeDict(i=5, j=6, m=9)</span>
</span><span id="dot-1866"><a href="#dot-1866"><span class="linenos">1866</span></a><span class="sd">    &gt;&gt;&gt; dot(a, b, c, keep={&#39;k&#39;,&#39;l&#39;}).shape</span>
</span><span id="dot-1867"><a href="#dot-1867"><span class="linenos">1867</span></a><span class="sd">    ShapeDict(i=5, k=7, l=8, m=9)</span>
</span><span id="dot-1868"><a href="#dot-1868"><span class="linenos">1868</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dot-1869"><a href="#dot-1869"><span class="linenos">1869</span></a>
</span><span id="dot-1870"><a href="#dot-1870"><span class="linenos">1870</span></a>    <span class="n">arrays</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span>
</span><span id="dot-1871"><a href="#dot-1871"><span class="linenos">1871</span></a>    <span class="n">keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
</span><span id="dot-1872"><a href="#dot-1872"><span class="linenos">1872</span></a>
</span><span id="dot-1873"><a href="#dot-1873"><span class="linenos">1873</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_sequence_of_type</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">):</span>
</span><span id="dot-1874"><a href="#dot-1874"><span class="linenos">1874</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Arguments to do must be sequence of NTensors (got </span><span class="si">{arrays}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="dot-1875"><a href="#dot-1875"><span class="linenos">1875</span></a>
</span><span id="dot-1876"><a href="#dot-1876"><span class="linenos">1876</span></a>    <span class="n">all_axes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">))</span>
</span><span id="dot-1877"><a href="#dot-1877"><span class="linenos">1877</span></a>    <span class="n">remaining_axes</span> <span class="o">=</span> <span class="n">get_remaining_axes</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="n">keep</span><span class="p">)</span>
</span><span id="dot-1878"><a href="#dot-1878"><span class="linenos">1878</span></a>
</span><span id="dot-1879"><a href="#dot-1879"><span class="linenos">1879</span></a>    <span class="n">a2c</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="dot-1880"><a href="#dot-1880"><span class="linenos">1880</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="dot-1881"><a href="#dot-1881"><span class="linenos">1881</span></a>    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">all_axes</span><span class="p">:</span>
</span><span id="dot-1882"><a href="#dot-1882"><span class="linenos">1882</span></a>        <span class="n">a2c</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">n2c</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="dot-1883"><a href="#dot-1883"><span class="linenos">1883</span></a>        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="dot-1884"><a href="#dot-1884"><span class="linenos">1884</span></a>
</span><span id="dot-1885"><a href="#dot-1885"><span class="linenos">1885</span></a>    <span class="n">array_chars</span> <span class="o">=</span> <span class="p">[[</span><span class="n">a2c</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">]</span> <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
</span><span id="dot-1886"><a href="#dot-1886"><span class="linenos">1886</span></a>
</span><span id="dot-1887"><a href="#dot-1887"><span class="linenos">1887</span></a>    <span class="c1"># result should keep all non-shared dims, A first then B</span>
</span><span id="dot-1888"><a href="#dot-1888"><span class="linenos">1888</span></a>    <span class="n">out_chars</span> <span class="o">=</span> <span class="p">[</span><span class="n">a2c</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">remaining_axes</span><span class="p">]</span>
</span><span id="dot-1889"><a href="#dot-1889"><span class="linenos">1889</span></a>
</span><span id="dot-1890"><a href="#dot-1890"><span class="linenos">1890</span></a>    <span class="n">array_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ar_chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">ar_chars</span> <span class="ow">in</span> <span class="n">array_chars</span><span class="p">]</span>
</span><span id="dot-1891"><a href="#dot-1891"><span class="linenos">1891</span></a>    <span class="n">out_chars</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_chars</span><span class="p">)</span>
</span><span id="dot-1892"><a href="#dot-1892"><span class="linenos">1892</span></a>
</span><span id="dot-1893"><a href="#dot-1893"><span class="linenos">1893</span></a>    <span class="n">subscripts</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="dot-1894"><a href="#dot-1894"><span class="linenos">1894</span></a>    <span class="k">for</span> <span class="n">ar_chars</span> <span class="ow">in</span> <span class="n">array_chars</span><span class="p">:</span>
</span><span id="dot-1895"><a href="#dot-1895"><span class="linenos">1895</span></a>        <span class="n">subscripts</span> <span class="o">+=</span> <span class="n">ar_chars</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
</span><span id="dot-1896"><a href="#dot-1896"><span class="linenos">1896</span></a>    <span class="n">subscripts</span> <span class="o">=</span> <span class="n">subscripts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="dot-1897"><a href="#dot-1897"><span class="linenos">1897</span></a>    <span class="n">subscripts</span> <span class="o">+=</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="o">+</span> <span class="n">out_chars</span>
</span><span id="dot-1898"><a href="#dot-1898"><span class="linenos">1898</span></a>
</span><span id="dot-1899"><a href="#dot-1899"><span class="linenos">1899</span></a>    <span class="n">out_data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">subscripts</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">_data</span> <span class="k">for</span> <span class="n">A</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">])</span>
</span><span id="dot-1900"><a href="#dot-1900"><span class="linenos">1900</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="o">*</span><span class="n">remaining_axes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Do inner products or outer products or matrix multiplication or tensor multiplication or einstein
summation or batched versions of any of these.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arrays</strong>: The <code>NTensor</code> objects to operate on. In principle, the order does not matter. (Though it may affect
the internal layout of the data.)</li>
<li><strong>keep</strong>: Any shared indices you don't want reduced.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out</strong>: Reduced <code>NTensor</code></li>
</ul>

<h6 id="examples">Examples</h6>

<p>Inner product</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="go">&lt;ntensor {} 310&gt;</span>
</code></pre>
</div>

<p>Elementwise product</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;i&#39;</span><span class="p">})</span>
<span class="go">&lt;ntensor {i:3} [ 10   0 300]&gt;</span>
</code></pre>
</div>

<p>Outer product</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:2, j:3}</span>
<span class="go">[[ 0  0  0]</span>
<span class="go"> [10 20 30]]&gt;</span>
</code></pre>
</div>

<p>Matrix-vector multiplication</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=5)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=5)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:5} [ True  True  True  True  True]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(j=4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict()</span>
</code></pre>
</div>

<p>Matrix-matrix multiplication</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=5, k=7)</span>
</code></pre>
</div>

<p>Tensor multiplication / Einstein summation</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=5, m=9)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;j&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=5, j=6, m=9)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;l&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=5, k=7, l=8, m=9)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="axes">
                            <input id="axes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">axes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">names</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="axes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#axes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="axes-1330"><a href="#axes-1330"><span class="linenos">1330</span></a><span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="axes-1331"><a href="#axes-1331"><span class="linenos">1331</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function to create a bunch of axes at once</span>
</span><span id="axes-1332"><a href="#axes-1332"><span class="linenos">1332</span></a>
</span><span id="axes-1333"><a href="#axes-1333"><span class="linenos">1333</span></a><span class="sd">    Parameters</span>
</span><span id="axes-1334"><a href="#axes-1334"><span class="linenos">1334</span></a><span class="sd">    ----------</span>
</span><span id="axes-1335"><a href="#axes-1335"><span class="linenos">1335</span></a><span class="sd">    *names: str</span>
</span><span id="axes-1336"><a href="#axes-1336"><span class="linenos">1336</span></a><span class="sd">        names to give to each element. pass none if you want them to be inferred</span>
</span><span id="axes-1337"><a href="#axes-1337"><span class="linenos">1337</span></a>
</span><span id="axes-1338"><a href="#axes-1338"><span class="linenos">1338</span></a><span class="sd">    Returns</span>
</span><span id="axes-1339"><a href="#axes-1339"><span class="linenos">1339</span></a><span class="sd">    -------</span>
</span><span id="axes-1340"><a href="#axes-1340"><span class="linenos">1340</span></a><span class="sd">    out_axes: tuple[Axis]</span>
</span><span id="axes-1341"><a href="#axes-1341"><span class="linenos">1341</span></a><span class="sd">        sequence of tuples</span>
</span><span id="axes-1342"><a href="#axes-1342"><span class="linenos">1342</span></a>
</span><span id="axes-1343"><a href="#axes-1343"><span class="linenos">1343</span></a><span class="sd">    Examples</span>
</span><span id="axes-1344"><a href="#axes-1344"><span class="linenos">1344</span></a><span class="sd">    --------</span>
</span><span id="axes-1345"><a href="#axes-1345"><span class="linenos">1345</span></a><span class="sd">    &gt;&gt;&gt; rows, cols, batch = axes(&#39;rows&#39;, &#39;cols&#39;, &#39;batch&#39;) # safe boring redudnancy</span>
</span><span id="axes-1346"><a href="#axes-1346"><span class="linenos">1346</span></a><span class="sd">    &gt;&gt;&gt; rows._name</span>
</span><span id="axes-1347"><a href="#axes-1347"><span class="linenos">1347</span></a><span class="sd">    &#39;rows&#39;</span>
</span><span id="axes-1348"><a href="#axes-1348"><span class="linenos">1348</span></a><span class="sd">    &gt;&gt;&gt; cols._name</span>
</span><span id="axes-1349"><a href="#axes-1349"><span class="linenos">1349</span></a><span class="sd">    &#39;cols&#39;</span>
</span><span id="axes-1350"><a href="#axes-1350"><span class="linenos">1350</span></a><span class="sd">    &gt;&gt;&gt; batch._name</span>
</span><span id="axes-1351"><a href="#axes-1351"><span class="linenos">1351</span></a><span class="sd">    &#39;batch&#39;</span>
</span><span id="axes-1352"><a href="#axes-1352"><span class="linenos">1352</span></a>
</span><span id="axes-1353"><a href="#axes-1353"><span class="linenos">1353</span></a><span class="sd">    &gt;&gt;&gt; rows, cols, batch = axes() # exciting evil magic</span>
</span><span id="axes-1354"><a href="#axes-1354"><span class="linenos">1354</span></a><span class="sd">    &gt;&gt;&gt; rows._name</span>
</span><span id="axes-1355"><a href="#axes-1355"><span class="linenos">1355</span></a><span class="sd">    &#39;rows&#39;</span>
</span><span id="axes-1356"><a href="#axes-1356"><span class="linenos">1356</span></a><span class="sd">    &gt;&gt;&gt; cols._name</span>
</span><span id="axes-1357"><a href="#axes-1357"><span class="linenos">1357</span></a><span class="sd">    &#39;cols&#39;</span>
</span><span id="axes-1358"><a href="#axes-1358"><span class="linenos">1358</span></a><span class="sd">    &gt;&gt;&gt; batch._name</span>
</span><span id="axes-1359"><a href="#axes-1359"><span class="linenos">1359</span></a><span class="sd">    &#39;batch&#39;</span>
</span><span id="axes-1360"><a href="#axes-1360"><span class="linenos">1360</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="axes-1361"><a href="#axes-1361"><span class="linenos">1361</span></a>    <span class="k">if</span> <span class="n">names</span> <span class="o">==</span> <span class="p">():</span>
</span><span id="axes-1362"><a href="#axes-1362"><span class="linenos">1362</span></a>        <span class="kn">import</span> <span class="nn">varname</span>
</span><span id="axes-1363"><a href="#axes-1363"><span class="linenos">1363</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="n">varname</span><span class="o">.</span><span class="n">varname</span><span class="p">(</span><span class="n">multi_vars</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="axes-1364"><a href="#axes-1364"><span class="linenos">1364</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
</span><span id="axes-1365"><a href="#axes-1365"><span class="linenos">1365</span></a>            <span class="k">return</span> <span class="n">Axis</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="axes-1366"><a href="#axes-1366"><span class="linenos">1366</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="axes-1367"><a href="#axes-1367"><span class="linenos">1367</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
</span><span id="axes-1368"><a href="#axes-1368"><span class="linenos">1368</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience function to create a bunch of axes at once</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>*names</strong> (str):
names to give to each element. pass none if you want them to be inferred</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out_axes</strong> (tuple[Axis]):
sequence of tuples</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">batch</span> <span class="o">=</span> <span class="n">axes</span><span class="p">(</span><span class="s1">&#39;rows&#39;</span><span class="p">,</span> <span class="s1">&#39;cols&#39;</span><span class="p">,</span> <span class="s1">&#39;batch&#39;</span><span class="p">)</span> <span class="c1"># safe boring redudnancy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rows</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;rows&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cols</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;cols&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;batch&#39;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">batch</span> <span class="o">=</span> <span class="n">axes</span><span class="p">()</span> <span class="c1"># exciting evil magic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rows</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;rows&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cols</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;cols&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">_name</span>
<span class="go">&#39;batch&#39;</span>
</code></pre>
</div>
</div>


                </section>
                <section id="allclose">
                            <input id="allclose-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">allclose</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n"><a href="#ntensor">ntensor</a></span>, </span><span class="param"><span class="n">rtol</span><span class="o">=</span><span class="mf">1e-05</span>, </span><span class="param"><span class="n">atol</span><span class="o">=</span><span class="mf">1e-08</span>, </span><span class="param"><span class="n">equal_nan</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="allclose-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#allclose"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="allclose-1371"><a href="#allclose-1371"><span class="linenos">1371</span></a><span class="k">def</span> <span class="nf">allclose</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">equal_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="allclose-1372"><a href="#allclose-1372"><span class="linenos">1372</span></a>    <span class="c1"># TODO: numpy allclose can only handle 2 inputs</span>
</span><span id="allclose-1373"><a href="#allclose-1373"><span class="linenos">1373</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="allclose-1374"><a href="#allclose-1374"><span class="linenos">1374</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;2 inputs only&quot;</span><span class="p">)</span>
</span><span id="allclose-1375"><a href="#allclose-1375"><span class="linenos">1375</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span>
</span><span id="allclose-1376"><a href="#allclose-1376"><span class="linenos">1376</span></a>    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
</span><span id="allclose-1377"><a href="#allclose-1377"><span class="linenos">1377</span></a>        <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="n">axes</span><span class="p">,</span> <span class="s2">&quot;all axes must be same&quot;</span>
</span><span id="allclose-1378"><a href="#allclose-1378"><span class="linenos">1378</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_axes_ordered</span>
</span><span id="allclose-1379"><a href="#allclose-1379"><span class="linenos">1379</span></a>    <span class="n">numpy_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">numpy_broadcasted</span><span class="p">(</span><span class="o">*</span><span class="n">axes</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
</span><span id="allclose-1380"><a href="#allclose-1380"><span class="linenos">1380</span></a>    <span class="n">rez</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="o">*</span><span class="n">numpy_arrays</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span> <span class="n">equal_nan</span><span class="o">=</span><span class="n">equal_nan</span><span class="p">)</span>
</span><span id="allclose-1381"><a href="#allclose-1381"><span class="linenos">1381</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="allclose-1382"><a href="#allclose-1382"><span class="linenos">1382</span></a>        <span class="k">return</span> <span class="n">rez</span>
</span><span id="allclose-1383"><a href="#allclose-1383"><span class="linenos">1383</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="allclose-1384"><a href="#allclose-1384"><span class="linenos">1384</span></a>        <span class="k">assert</span> <span class="n">rez</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="allclose-1385"><a href="#allclose-1385"><span class="linenos">1385</span></a>        <span class="k">assert</span> <span class="n">rez</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span>
</span><span id="allclose-1386"><a href="#allclose-1386"><span class="linenos">1386</span></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">rez</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="ones">
                            <input id="ones-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ones</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dtype</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">axes</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="ones-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ones"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ones-1391"><a href="#ones-1391"><span class="linenos">1391</span></a><span class="k">def</span> <span class="nf">ones</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="ones-1392"><a href="#ones-1392"><span class="linenos">1392</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function, over just using `np.ones` and then `ntensor`.</span>
</span><span id="ones-1393"><a href="#ones-1393"><span class="linenos">1393</span></a>
</span><span id="ones-1394"><a href="#ones-1394"><span class="linenos">1394</span></a><span class="sd">    Parameters</span>
</span><span id="ones-1395"><a href="#ones-1395"><span class="linenos">1395</span></a><span class="sd">    ----------</span>
</span><span id="ones-1396"><a href="#ones-1396"><span class="linenos">1396</span></a><span class="sd">    **axes: Dict[str,int]</span>
</span><span id="ones-1397"><a href="#ones-1397"><span class="linenos">1397</span></a><span class="sd">        Mapping from axes to sizes. Will be converted to axes.</span>
</span><span id="ones-1398"><a href="#ones-1398"><span class="linenos">1398</span></a>
</span><span id="ones-1399"><a href="#ones-1399"><span class="linenos">1399</span></a><span class="sd">    Returns</span>
</span><span id="ones-1400"><a href="#ones-1400"><span class="linenos">1400</span></a><span class="sd">    -------</span>
</span><span id="ones-1401"><a href="#ones-1401"><span class="linenos">1401</span></a><span class="sd">    A: array</span>
</span><span id="ones-1402"><a href="#ones-1402"><span class="linenos">1402</span></a><span class="sd">        Array with given shape</span>
</span><span id="ones-1403"><a href="#ones-1403"><span class="linenos">1403</span></a>
</span><span id="ones-1404"><a href="#ones-1404"><span class="linenos">1404</span></a><span class="sd">    Examples</span>
</span><span id="ones-1405"><a href="#ones-1405"><span class="linenos">1405</span></a><span class="sd">    --------</span>
</span><span id="ones-1406"><a href="#ones-1406"><span class="linenos">1406</span></a><span class="sd">    &gt;&gt;&gt; A = ones(i=5)</span>
</span><span id="ones-1407"><a href="#ones-1407"><span class="linenos">1407</span></a><span class="sd">    &gt;&gt;&gt; print(A.shape)</span>
</span><span id="ones-1408"><a href="#ones-1408"><span class="linenos">1408</span></a><span class="sd">    {i:5}</span>
</span><span id="ones-1409"><a href="#ones-1409"><span class="linenos">1409</span></a><span class="sd">    &gt;&gt;&gt; B = ones(cats=5, dogs=15)</span>
</span><span id="ones-1410"><a href="#ones-1410"><span class="linenos">1410</span></a><span class="sd">    &gt;&gt;&gt; print(B.shape)</span>
</span><span id="ones-1411"><a href="#ones-1411"><span class="linenos">1411</span></a><span class="sd">    {cats:5, dogs:15}</span>
</span><span id="ones-1412"><a href="#ones-1412"><span class="linenos">1412</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ones-1413"><a href="#ones-1413"><span class="linenos">1413</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="ones-1414"><a href="#ones-1414"><span class="linenos">1414</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience function, over just using <code>np.ones</code> and then <code><a href="#ntensor">ntensor</a></code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>**axes</strong> (Dict[str,int]):
Mapping from axes to sizes. Will be converted to axes.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>A</strong> (array):
Array with given shape</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{i:5}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">cats</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dogs</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">{cats:5, dogs:15}</span>
</code></pre>
</div>
</div>


                </section>
                <section id="zeros">
                            <input id="zeros-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zeros</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">**</span><span class="n">axes</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#ntensor">ntensor</a></span>:</span></span>

                <label class="view-source-button" for="zeros-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#zeros"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="zeros-1423"><a href="#zeros-1423"><span class="linenos">1423</span></a><span class="k">def</span> <span class="nf">zeros</span><span class="p">(</span><span class="o">**</span><span class="n">axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ntensor</span><span class="p">:</span>
</span><span id="zeros-1424"><a href="#zeros-1424"><span class="linenos">1424</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function, over just using `np.zeros` and then `array`. Use just like `ones`</span>
</span><span id="zeros-1425"><a href="#zeros-1425"><span class="linenos">1425</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="zeros-1426"><a href="#zeros-1426"><span class="linenos">1426</span></a>
</span><span id="zeros-1427"><a href="#zeros-1427"><span class="linenos">1427</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">])</span>
</span><span id="zeros-1428"><a href="#zeros-1428"><span class="linenos">1428</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience function, over just using <code>np.zeros</code> and then <code>array</code>. Use just like <code><a href="#ones">ones</a></code></p>
</div>


                </section>
                <section id="randn">
                            <input id="randn-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">randn</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="randn-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#randn"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="randn-1430"><a href="#randn-1430"><span class="linenos">1430</span></a><span class="k">def</span> <span class="nf">randn</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="randn-1431"><a href="#randn-1431"><span class="linenos">1431</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function, to call `np.random.randn` and then `ntensor`. Use just like</span>
</span><span id="randn-1432"><a href="#randn-1432"><span class="linenos">1432</span></a><span class="sd">    `ones`</span>
</span><span id="randn-1433"><a href="#randn-1433"><span class="linenos">1433</span></a>
</span><span id="randn-1434"><a href="#randn-1434"><span class="linenos">1434</span></a><span class="sd">    Parameters</span>
</span><span id="randn-1435"><a href="#randn-1435"><span class="linenos">1435</span></a><span class="sd">    ----------</span>
</span><span id="randn-1436"><a href="#randn-1436"><span class="linenos">1436</span></a><span class="sd">    **kwargs: int</span>
</span><span id="randn-1437"><a href="#randn-1437"><span class="linenos">1437</span></a><span class="sd">        keyword arguments mapping strings to ints</span>
</span><span id="randn-1438"><a href="#randn-1438"><span class="linenos">1438</span></a>
</span><span id="randn-1439"><a href="#randn-1439"><span class="linenos">1439</span></a><span class="sd">    Returns</span>
</span><span id="randn-1440"><a href="#randn-1440"><span class="linenos">1440</span></a><span class="sd">    -------</span>
</span><span id="randn-1441"><a href="#randn-1441"><span class="linenos">1441</span></a><span class="sd">    out: `ntensor`</span>
</span><span id="randn-1442"><a href="#randn-1442"><span class="linenos">1442</span></a><span class="sd">        random data with requested shape</span>
</span><span id="randn-1443"><a href="#randn-1443"><span class="linenos">1443</span></a>
</span><span id="randn-1444"><a href="#randn-1444"><span class="linenos">1444</span></a><span class="sd">    Examples</span>
</span><span id="randn-1445"><a href="#randn-1445"><span class="linenos">1445</span></a><span class="sd">    --------</span>
</span><span id="randn-1446"><a href="#randn-1446"><span class="linenos">1446</span></a><span class="sd">    &gt;&gt;&gt; A = randn(i=5, j=10, k=100)</span>
</span><span id="randn-1447"><a href="#randn-1447"><span class="linenos">1447</span></a><span class="sd">    &gt;&gt;&gt; A.shape</span>
</span><span id="randn-1448"><a href="#randn-1448"><span class="linenos">1448</span></a><span class="sd">    ShapeDict(i=5, j=10, k=100)</span>
</span><span id="randn-1449"><a href="#randn-1449"><span class="linenos">1449</span></a>
</span><span id="randn-1450"><a href="#randn-1450"><span class="linenos">1450</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="randn-1451"><a href="#randn-1451"><span class="linenos">1451</span></a>    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
</span><span id="randn-1452"><a href="#randn-1452"><span class="linenos">1452</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Axis</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
</span><span id="randn-1453"><a href="#randn-1453"><span class="linenos">1453</span></a>    <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">sizes</span><span class="p">),</span> <span class="o">*</span><span class="n">axes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience function, to call <code>np.random.randn</code> and then <code><a href="#ntensor">ntensor</a></code>. Use just like
<code><a href="#ones">ones</a></code></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>**kwargs</strong> (int):
keyword arguments mapping strings to ints</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out</strong> (<code><a href="#ntensor">ntensor</a></code>):
random data with requested shape</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">shape</span>
<span class="go">ShapeDict(i=5, j=10, k=100)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="vmap">
                            <input id="vmap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">vmap</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">in_axes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Axis">Axis</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Axis">Axis</a></span><span class="p">]]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">()</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Axis">Axis</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="vmap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#vmap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="vmap-2030"><a href="#vmap-2030"><span class="linenos">2030</span></a><span class="k">def</span> <span class="nf">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">:</span> <span class="n">AxisLike</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AxisLike</span><span class="p">]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(),</span> <span class="n">other</span><span class="p">:</span> <span class="kc">None</span><span class="o">|</span><span class="n">Iterable</span><span class="p">[</span>
</span><span id="vmap-2031"><a href="#vmap-2031"><span class="linenos">2031</span></a>    <span class="n">AxisLike</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
</span><span id="vmap-2032"><a href="#vmap-2032"><span class="linenos">2032</span></a>        <span class="n">Callable</span><span class="p">):</span>
</span><span id="vmap-2033"><a href="#vmap-2033"><span class="linenos">2033</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implements almost all of vmap. The only difference here is that for simplicity we require</span>
</span><span id="vmap-2034"><a href="#vmap-2034"><span class="linenos">2034</span></a><span class="sd">    that in_axes and out_ax are provided in the wrapper call.</span>
</span><span id="vmap-2035"><a href="#vmap-2035"><span class="linenos">2035</span></a>
</span><span id="vmap-2036"><a href="#vmap-2036"><span class="linenos">2036</span></a><span class="sd">    Parameters</span>
</span><span id="vmap-2037"><a href="#vmap-2037"><span class="linenos">2037</span></a><span class="sd">    ----------</span>
</span><span id="vmap-2038"><a href="#vmap-2038"><span class="linenos">2038</span></a><span class="sd">    fun</span>
</span><span id="vmap-2039"><a href="#vmap-2039"><span class="linenos">2039</span></a><span class="sd">        The function to be vmapped</span>
</span><span id="vmap-2040"><a href="#vmap-2040"><span class="linenos">2040</span></a><span class="sd">    in_axes</span>
</span><span id="vmap-2041"><a href="#vmap-2041"><span class="linenos">2041</span></a><span class="sd">        What input axis to map each argument over. If just given a single axis, all arguments that</span>
</span><span id="vmap-2042"><a href="#vmap-2042"><span class="linenos">2042</span></a><span class="sd">        are `array`s and contain that axis are mapped over it and all other arguments are mapped</span>
</span><span id="vmap-2043"><a href="#vmap-2043"><span class="linenos">2043</span></a><span class="sd">        over None.</span>
</span><span id="vmap-2044"><a href="#vmap-2044"><span class="linenos">2044</span></a><span class="sd">    other</span>
</span><span id="vmap-2045"><a href="#vmap-2045"><span class="linenos">2045</span></a><span class="sd">        iterable of other axes or None. If None (default), ignored. Otherwise, used as a check: all axes</span>
</span><span id="vmap-2046"><a href="#vmap-2046"><span class="linenos">2046</span></a><span class="sd">        that appear in any argument must either appear in in_axes or other.</span>
</span><span id="vmap-2047"><a href="#vmap-2047"><span class="linenos">2047</span></a>
</span><span id="vmap-2048"><a href="#vmap-2048"><span class="linenos">2048</span></a><span class="sd">    Returns</span>
</span><span id="vmap-2049"><a href="#vmap-2049"><span class="linenos">2049</span></a><span class="sd">    -------</span>
</span><span id="vmap-2050"><a href="#vmap-2050"><span class="linenos">2050</span></a><span class="sd">    vfun</span>
</span><span id="vmap-2051"><a href="#vmap-2051"><span class="linenos">2051</span></a><span class="sd">        vmapped function</span>
</span><span id="vmap-2052"><a href="#vmap-2052"><span class="linenos">2052</span></a>
</span><span id="vmap-2053"><a href="#vmap-2053"><span class="linenos">2053</span></a><span class="sd">    Examples</span>
</span><span id="vmap-2054"><a href="#vmap-2054"><span class="linenos">2054</span></a><span class="sd">    --------</span>
</span><span id="vmap-2055"><a href="#vmap-2055"><span class="linenos">2055</span></a>
</span><span id="vmap-2056"><a href="#vmap-2056"><span class="linenos">2056</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="vmap-2057"><a href="#vmap-2057"><span class="linenos">2057</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([3,4,5],&#39;i&#39;)</span>
</span><span id="vmap-2058"><a href="#vmap-2058"><span class="linenos">2058</span></a><span class="sd">    &gt;&gt;&gt; vmap(add_scalar, &#39;i&#39;)(A, B)</span>
</span><span id="vmap-2059"><a href="#vmap-2059"><span class="linenos">2059</span></a><span class="sd">    &lt;ntensor {i:3} [3 5 7]&gt;</span>
</span><span id="vmap-2060"><a href="#vmap-2060"><span class="linenos">2060</span></a>
</span><span id="vmap-2061"><a href="#vmap-2061"><span class="linenos">2061</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="vmap-2062"><a href="#vmap-2062"><span class="linenos">2062</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor(3)</span>
</span><span id="vmap-2063"><a href="#vmap-2063"><span class="linenos">2063</span></a><span class="sd">    &gt;&gt;&gt; vmap(add_scalar, &#39;i&#39;)(A, B)</span>
</span><span id="vmap-2064"><a href="#vmap-2064"><span class="linenos">2064</span></a><span class="sd">    &lt;ntensor {i:3} [3 4 5]&gt;</span>
</span><span id="vmap-2065"><a href="#vmap-2065"><span class="linenos">2065</span></a>
</span><span id="vmap-2066"><a href="#vmap-2066"><span class="linenos">2066</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="vmap-2067"><a href="#vmap-2067"><span class="linenos">2067</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([10,20],&#39;j&#39;)</span>
</span><span id="vmap-2068"><a href="#vmap-2068"><span class="linenos">2068</span></a><span class="sd">    &gt;&gt;&gt; vmap(add_scalar, [&#39;i&#39;,&#39;j&#39;])(A, B)</span>
</span><span id="vmap-2069"><a href="#vmap-2069"><span class="linenos">2069</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="vmap-2070"><a href="#vmap-2070"><span class="linenos">2070</span></a><span class="sd">    [[10 20]</span>
</span><span id="vmap-2071"><a href="#vmap-2071"><span class="linenos">2071</span></a><span class="sd">     [11 21]</span>
</span><span id="vmap-2072"><a href="#vmap-2072"><span class="linenos">2072</span></a><span class="sd">     [12 22]]&gt;</span>
</span><span id="vmap-2073"><a href="#vmap-2073"><span class="linenos">2073</span></a>
</span><span id="vmap-2074"><a href="#vmap-2074"><span class="linenos">2074</span></a><span class="sd">    &gt;&gt;&gt; A = ntensor([0,1,2],&#39;i&#39;)</span>
</span><span id="vmap-2075"><a href="#vmap-2075"><span class="linenos">2075</span></a><span class="sd">    &gt;&gt;&gt; B = ntensor([3,4,5],&#39;i&#39;)</span>
</span><span id="vmap-2076"><a href="#vmap-2076"><span class="linenos">2076</span></a><span class="sd">    &gt;&gt;&gt; myfun = lambda a, b: a+b*ntensor([0,10],&#39;j&#39;)</span>
</span><span id="vmap-2077"><a href="#vmap-2077"><span class="linenos">2077</span></a><span class="sd">    &gt;&gt;&gt; vmap(myfun, &#39;i&#39;)(A, B)</span>
</span><span id="vmap-2078"><a href="#vmap-2078"><span class="linenos">2078</span></a><span class="sd">    &lt;ntensor {i:3, j:2}</span>
</span><span id="vmap-2079"><a href="#vmap-2079"><span class="linenos">2079</span></a><span class="sd">    [[ 0 30]</span>
</span><span id="vmap-2080"><a href="#vmap-2080"><span class="linenos">2080</span></a><span class="sd">     [ 1 41]</span>
</span><span id="vmap-2081"><a href="#vmap-2081"><span class="linenos">2081</span></a><span class="sd">     [ 2 52]]&gt;</span>
</span><span id="vmap-2082"><a href="#vmap-2082"><span class="linenos">2082</span></a>
</span><span id="vmap-2083"><a href="#vmap-2083"><span class="linenos">2083</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="vmap-2084"><a href="#vmap-2084"><span class="linenos">2084</span></a>
</span><span id="vmap-2085"><a href="#vmap-2085"><span class="linenos">2085</span></a>    <span class="c1"># if in_axes=={} (a dict), let&#39;s be forgiving</span>
</span><span id="vmap-2086"><a href="#vmap-2086"><span class="linenos">2086</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="n">AxisLike</span><span class="p">):</span>
</span><span id="vmap-2087"><a href="#vmap-2087"><span class="linenos">2087</span></a>        <span class="n">in_axes</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_axes</span><span class="p">,)</span>
</span><span id="vmap-2088"><a href="#vmap-2088"><span class="linenos">2088</span></a>
</span><span id="vmap-2089"><a href="#vmap-2089"><span class="linenos">2089</span></a>    <span class="n">flat_in_axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">in_axes</span><span class="p">)</span>
</span><span id="vmap-2090"><a href="#vmap-2090"><span class="linenos">2090</span></a>
</span><span id="vmap-2091"><a href="#vmap-2091"><span class="linenos">2091</span></a>    <span class="c1">#print(f&quot;vmap called: {in_axes=}&quot;)</span>
</span><span id="vmap-2092"><a href="#vmap-2092"><span class="linenos">2092</span></a>
</span><span id="vmap-2093"><a href="#vmap-2093"><span class="linenos">2093</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="vmap-2094"><a href="#vmap-2094"><span class="linenos">2094</span></a>
</span><span id="vmap-2095"><a href="#vmap-2095"><span class="linenos">2095</span></a>        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
</span><span id="vmap-2096"><a href="#vmap-2096"><span class="linenos">2096</span></a>            <span class="n">remaining</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="vmap-2097"><a href="#vmap-2097"><span class="linenos">2097</span></a>            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="vmap-2098"><a href="#vmap-2098"><span class="linenos">2098</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remaining axes </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="s2"> not equal to provided other=</span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="vmap-2099"><a href="#vmap-2099"><span class="linenos">2099</span></a>
</span><span id="vmap-2100"><a href="#vmap-2100"><span class="linenos">2100</span></a>        <span class="k">if</span> <span class="n">flat_in_axes</span> <span class="o">==</span> <span class="p">():</span>
</span><span id="vmap-2101"><a href="#vmap-2101"><span class="linenos">2101</span></a>            <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="vmap-2102"><a href="#vmap-2102"><span class="linenos">2102</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="vmap-2103"><a href="#vmap-2103"><span class="linenos">2103</span></a>            <span class="n">first</span> <span class="o">=</span> <span class="n">flat_in_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="vmap-2104"><a href="#vmap-2104"><span class="linenos">2104</span></a>            <span class="k">return</span> <span class="n">vmap_eval</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span>
</span><span id="vmap-2105"><a href="#vmap-2105"><span class="linenos">2105</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="vmap-2106"><a href="#vmap-2106"><span class="linenos">2106</span></a>            <span class="n">first</span> <span class="o">=</span> <span class="n">flat_in_axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="vmap-2107"><a href="#vmap-2107"><span class="linenos">2107</span></a>            <span class="n">rest</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">flat_in_axes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="vmap-2108"><a href="#vmap-2108"><span class="linenos">2108</span></a>            <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">first</span><span class="p">),</span> <span class="n">rest</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="vmap-2109"><a href="#vmap-2109"><span class="linenos">2109</span></a>
</span><span id="vmap-2110"><a href="#vmap-2110"><span class="linenos">2110</span></a>    <span class="k">return</span> <span class="n">wrapped</span>
</span></pre></div>


            <div class="docstring"><p>Implements almost all of vmap. The only difference here is that for simplicity we require
that in_axes and out_ax are provided in the wrapper call.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fun</strong>: The function to be vmapped</li>
<li><strong>in_axes</strong>: What input axis to map each argument over. If just given a single axis, all arguments that
are <code>array</code>s and contain that axis are mapped over it and all other arguments are mapped
over None.</li>
<li><strong>other</strong>: iterable of other axes or None. If None (default), ignored. Otherwise, used as a check: all axes
that appear in any argument must either appear in in_axes or other.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>vfun</strong>: vmapped function</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vmap</span><span class="p">(</span><span class="n">add_scalar</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3} [3 5 7]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vmap</span><span class="p">(</span><span class="n">add_scalar</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3} [3 4 5]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vmap</span><span class="p">(</span><span class="n">add_scalar</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">])(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3, j:2}</span>
<span class="go">[[10 20]</span>
<span class="go"> [11 21]</span>
<span class="go"> [12 22]]&gt;</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">ntensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vmap</span><span class="p">(</span><span class="n">myfun</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3, j:2}</span>
<span class="go">[[ 0 30]</span>
<span class="go"> [ 1 41]</span>
<span class="go"> [ 2 52]]&gt;</span>
</code></pre>
</div>
</div>


                </section>
                <section id="batch">
                            <input id="batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">axes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Axis">Axis</a></span><span class="p">]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">()</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Axis">Axis</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="batch-2112"><a href="#batch-2112"><span class="linenos">2112</span></a><span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AxisLike</span><span class="p">]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(),</span> <span class="n">other</span><span class="p">:</span><span class="kc">None</span><span class="o">|</span><span class="n">Iterable</span><span class="p">[</span><span class="n">AxisLike</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
</span><span id="batch-2113"><a href="#batch-2113"><span class="linenos">2113</span></a>        <span class="n">Callable</span><span class="p">):</span>
</span><span id="batch-2114"><a href="#batch-2114"><span class="linenos">2114</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="batch-2115"><a href="#batch-2115"><span class="linenos">2115</span></a><span class="sd">    Create a batched version of a function</span>
</span><span id="batch-2116"><a href="#batch-2116"><span class="linenos">2116</span></a>
</span><span id="batch-2117"><a href="#batch-2117"><span class="linenos">2117</span></a><span class="sd">    Parameters</span>
</span><span id="batch-2118"><a href="#batch-2118"><span class="linenos">2118</span></a><span class="sd">    ----------</span>
</span><span id="batch-2119"><a href="#batch-2119"><span class="linenos">2119</span></a><span class="sd">    fun</span>
</span><span id="batch-2120"><a href="#batch-2120"><span class="linenos">2120</span></a><span class="sd">        function to be batched</span>
</span><span id="batch-2121"><a href="#batch-2121"><span class="linenos">2121</span></a><span class="sd">    axes: Set[Axis|Str]</span>
</span><span id="batch-2122"><a href="#batch-2122"><span class="linenos">2122</span></a><span class="sd">        axes to be batched. Must be an `Axis` or str.</span>
</span><span id="batch-2123"><a href="#batch-2123"><span class="linenos">2123</span></a><span class="sd">    other:</span>
</span><span id="batch-2124"><a href="#batch-2124"><span class="linenos">2124</span></a><span class="sd">        optional: All other axes (for checking only)</span>
</span><span id="batch-2125"><a href="#batch-2125"><span class="linenos">2125</span></a>
</span><span id="batch-2126"><a href="#batch-2126"><span class="linenos">2126</span></a><span class="sd">    Returns</span>
</span><span id="batch-2127"><a href="#batch-2127"><span class="linenos">2127</span></a><span class="sd">    -------</span>
</span><span id="batch-2128"><a href="#batch-2128"><span class="linenos">2128</span></a><span class="sd">    new_fun</span>
</span><span id="batch-2129"><a href="#batch-2129"><span class="linenos">2129</span></a><span class="sd">        batched function</span>
</span><span id="batch-2130"><a href="#batch-2130"><span class="linenos">2130</span></a>
</span><span id="batch-2131"><a href="#batch-2131"><span class="linenos">2131</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="batch-2132"><a href="#batch-2132"><span class="linenos">2132</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="batch-2133"><a href="#batch-2133"><span class="linenos">2133</span></a>
</span><span id="batch-2134"><a href="#batch-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="batch-2135"><a href="#batch-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="batch-2136"><a href="#batch-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="batch-2137"><a href="#batch-2137"><span class="linenos">2137</span></a>
</span><span id="batch-2138"><a href="#batch-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="batch-2139"><a href="#batch-2139"><span class="linenos">2139</span></a>
</span><span id="batch-2140"><a href="#batch-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="batch-2141"><a href="#batch-2141"><span class="linenos">2141</span></a>
</span><span id="batch-2142"><a href="#batch-2142"><span class="linenos">2142</span></a>
</span><span id="batch-2143"><a href="#batch-2143"><span class="linenos">2143</span></a>    <span class="k">return</span> <span class="n">wrapped</span>
</span></pre></div>


            <div class="docstring"><p>Create a batched version of a function</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fun</strong>: function to be batched</li>
<li><strong>axes</strong> (Set[Axis|Str]):
axes to be batched. Must be an <code><a href="#Axis">Axis</a></code> or str.</li>
<li><strong>other:</strong>: optional: All other axes (for checking only)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>new_fun</strong>: batched function</li>
</ul>
</div>


                </section>
                <section id="wrap">
                            <input id="wrap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wrap</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span>, </span><span class="param"><span class="n">kwargs</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="wrap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wrap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wrap-2150"><a href="#wrap-2150"><span class="linenos">2150</span></a><span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="wrap-2151"><a href="#wrap-2151"><span class="linenos">2151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap a function so it can LATER be batched or vmapped by providing `axes` or `vmap_axes`</span>
</span><span id="wrap-2152"><a href="#wrap-2152"><span class="linenos">2152</span></a><span class="sd">    arguments.</span>
</span><span id="wrap-2153"><a href="#wrap-2153"><span class="linenos">2153</span></a>
</span><span id="wrap-2154"><a href="#wrap-2154"><span class="linenos">2154</span></a><span class="sd">    `wrap(fun)(A, B, axes={i,j})` is equivalent to `batch(fun, {i,j})(A, B)`</span>
</span><span id="wrap-2155"><a href="#wrap-2155"><span class="linenos">2155</span></a>
</span><span id="wrap-2156"><a href="#wrap-2156"><span class="linenos">2156</span></a><span class="sd">    `wrap(fun)(A, B, vmap={k,l})` is equivalent to `vmap(fun, {k,l})(A, B)`</span>
</span><span id="wrap-2157"><a href="#wrap-2157"><span class="linenos">2157</span></a>
</span><span id="wrap-2158"><a href="#wrap-2158"><span class="linenos">2158</span></a><span class="sd">    `wrap(fun)(A, B, axes={i,j}, vmap={k,l})` is equivalent to `vmap(fun, {k,l}, other={i,j})(A, B)`</span>
</span><span id="wrap-2159"><a href="#wrap-2159"><span class="linenos">2159</span></a>
</span><span id="wrap-2160"><a href="#wrap-2160"><span class="linenos">2160</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="wrap-2161"><a href="#wrap-2161"><span class="linenos">2161</span></a>
</span><span id="wrap-2162"><a href="#wrap-2162"><span class="linenos">2162</span></a>    <span class="n">vmap_fun</span> <span class="o">=</span> <span class="n">vmap</span>  <span class="c1"># gets shadowed below</span>
</span><span id="wrap-2163"><a href="#wrap-2163"><span class="linenos">2163</span></a>
</span><span id="wrap-2164"><a href="#wrap-2164"><span class="linenos">2164</span></a>    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="wrap-2165"><a href="#wrap-2165"><span class="linenos">2165</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="wrap-2166"><a href="#wrap-2166"><span class="linenos">2166</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="wrap-2167"><a href="#wrap-2167"><span class="linenos">2167</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="wrap-2168"><a href="#wrap-2168"><span class="linenos">2168</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="wrap-2169"><a href="#wrap-2169"><span class="linenos">2169</span></a>
</span><span id="wrap-2170"><a href="#wrap-2170"><span class="linenos">2170</span></a>            <span class="n">fun_with_kwargs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="wrap-2171"><a href="#wrap-2171"><span class="linenos">2171</span></a>
</span><span id="wrap-2172"><a href="#wrap-2172"><span class="linenos">2172</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wrap-2173"><a href="#wrap-2173"><span class="linenos">2173</span></a>                <span class="k">return</span> <span class="n">fun_with_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="wrap-2174"><a href="#wrap-2174"><span class="linenos">2174</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wrap-2175"><a href="#wrap-2175"><span class="linenos">2175</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun_with_kwargs</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="wrap-2176"><a href="#wrap-2176"><span class="linenos">2176</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="wrap-2177"><a href="#wrap-2177"><span class="linenos">2177</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="wrap-2178"><a href="#wrap-2178"><span class="linenos">2178</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun_with_kwargs</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="wrap-2179"><a href="#wrap-2179"><span class="linenos">2179</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="wrap-2180"><a href="#wrap-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="wrap-2181"><a href="#wrap-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="wrap-2182"><a href="#wrap-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="wrap-2183"><a href="#wrap-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="wrap-2184"><a href="#wrap-2184"><span class="linenos">2184</span></a>
</span><span id="wrap-2185"><a href="#wrap-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wrap-2186"><a href="#wrap-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="wrap-2187"><a href="#wrap-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="wrap-2188"><a href="#wrap-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="wrap-2189"><a href="#wrap-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="wrap-2190"><a href="#wrap-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="wrap-2191"><a href="#wrap-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="wrap-2192"><a href="#wrap-2192"><span class="linenos">2192</span></a>
</span><span id="wrap-2193"><a href="#wrap-2193"><span class="linenos">2193</span></a>    <span class="k">return</span> <span class="n">wrapped</span>
</span></pre></div>


            <div class="docstring"><p>Wrap a function so it can LATER be batched or vmapped by providing <code><a href="#axes">axes</a></code> or <code>vmap_axes</code>
arguments.</p>

<p><code>wrap(fun)(A, B, axes={i,j})</code> is equivalent to <code>batch(fun, {i,j})(A, B)</code></p>

<p><code>wrap(fun)(A, B, vmap={k,l})</code> is equivalent to <code>vmap(fun, {k,l})(A, B)</code></p>

<p><code>wrap(fun)(A, B, axes={i,j}, vmap={k,l})</code> is equivalent to <code>vmap(fun, {k,l}, other={i,j})(A, B)</code></p>
</div>


                </section>
                <section id="scan">
                            <input id="scan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">scan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fun</span>, </span><span class="param"><span class="n">init</span>, </span><span class="param"><span class="n">xs</span>, </span><span class="param"><span class="n">in_axis</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="scan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#scan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="scan-2198"><a href="#scan-2198"><span class="linenos">2198</span></a><span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">):</span>
</span><span id="scan-2199"><a href="#scan-2199"><span class="linenos">2199</span></a>    <span class="n">in_axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">in_axis</span><span class="p">)</span>
</span><span id="scan-2200"><a href="#scan-2200"><span class="linenos">2200</span></a>
</span><span id="scan-2201"><a href="#scan-2201"><span class="linenos">2201</span></a>    <span class="c1"># TODO: put in_axes in dimension 0 so scan can handle it</span>
</span><span id="scan-2202"><a href="#scan-2202"><span class="linenos">2202</span></a>    <span class="c1"># TODO: shield arguments that don&#39;t contain given dimension</span>
</span><span id="scan-2203"><a href="#scan-2203"><span class="linenos">2203</span></a>    <span class="n">example_x</span><span class="p">,</span> <span class="n">xs_numpy</span><span class="p">,</span> <span class="n">x_in_axes</span><span class="p">,</span> <span class="n">x_in_axes_numpy</span> <span class="o">=</span> <span class="n">prepare_args</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">)</span>
</span><span id="scan-2204"><a href="#scan-2204"><span class="linenos">2204</span></a>
</span><span id="scan-2205"><a href="#scan-2205"><span class="linenos">2205</span></a>    <span class="n">example_carry</span><span class="p">,</span> <span class="n">example_y</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">example_x</span><span class="p">)</span>
</span><span id="scan-2206"><a href="#scan-2206"><span class="linenos">2206</span></a>
</span><span id="scan-2207"><a href="#scan-2207"><span class="linenos">2207</span></a>    <span class="n">out_axes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">arg</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">,</span> <span class="p">(</span><span class="n">example_carry</span><span class="p">,</span> <span class="n">example_y</span><span class="p">),</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="scan-2208"><a href="#scan-2208"><span class="linenos">2208</span></a>
</span><span id="scan-2209"><a href="#scan-2209"><span class="linenos">2209</span></a>    <span class="k">if</span> <span class="n">builtins</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">in_axis</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)):</span>
</span><span id="scan-2210"><a href="#scan-2210"><span class="linenos">2210</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Init can&#39;t contain scanned Axis&quot;</span><span class="p">)</span>
</span><span id="scan-2211"><a href="#scan-2211"><span class="linenos">2211</span></a>
</span><span id="scan-2212"><a href="#scan-2212"><span class="linenos">2212</span></a>    <span class="n">init_in_axes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="scan-2213"><a href="#scan-2213"><span class="linenos">2213</span></a>    <span class="n">init_numpy</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="scan-2214"><a href="#scan-2214"><span class="linenos">2214</span></a>
</span><span id="scan-2215"><a href="#scan-2215"><span class="linenos">2215</span></a>    <span class="n">in_axes</span> <span class="o">=</span> <span class="p">(</span><span class="n">init_in_axes</span><span class="p">,</span> <span class="n">x_in_axes</span><span class="p">)</span>
</span><span id="scan-2216"><a href="#scan-2216"><span class="linenos">2216</span></a>    <span class="n">numpy_fun</span> <span class="o">=</span> <span class="n">lower_pytree</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="scan-2217"><a href="#scan-2217"><span class="linenos">2217</span></a>    <span class="n">numpy_carry</span><span class="p">,</span> <span class="n">numpy_ys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">numpy_fun</span><span class="p">,</span> <span class="n">init_numpy</span><span class="p">,</span> <span class="n">xs_numpy</span><span class="p">)</span>
</span><span id="scan-2218"><a href="#scan-2218"><span class="linenos">2218</span></a>
</span><span id="scan-2219"><a href="#scan-2219"><span class="linenos">2219</span></a>    <span class="n">carry</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="scan-2220"><a href="#scan-2220"><span class="linenos">2220</span></a>        <span class="k">lambda</span> <span class="n">numpy_c</span><span class="p">,</span> <span class="n">init_leaf</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">numpy_c</span><span class="p">,</span> <span class="o">*</span><span class="n">init_leaf</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">),</span> <span class="n">numpy_carry</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span>
</span><span id="scan-2221"><a href="#scan-2221"><span class="linenos">2221</span></a>
</span><span id="scan-2222"><a href="#scan-2222"><span class="linenos">2222</span></a>    <span class="n">ys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="scan-2223"><a href="#scan-2223"><span class="linenos">2223</span></a>        <span class="k">lambda</span> <span class="n">numpy_o</span><span class="p">,</span> <span class="n">example_o</span><span class="p">:</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">numpy_o</span><span class="p">,</span> <span class="n">in_axis</span><span class="p">,</span> <span class="o">*</span><span class="n">example_o</span><span class="o">.</span><span class="n">_axes_ordered</span><span class="p">),</span>
</span><span id="scan-2224"><a href="#scan-2224"><span class="linenos">2224</span></a>        <span class="n">numpy_ys</span><span class="p">,</span> <span class="n">example_y</span><span class="p">)</span>
</span><span id="scan-2225"><a href="#scan-2225"><span class="linenos">2225</span></a>
</span><span id="scan-2226"><a href="#scan-2226"><span class="linenos">2226</span></a>    <span class="k">return</span> <span class="n">carry</span><span class="p">,</span> <span class="n">ys</span>
</span></pre></div>


    

                </section>
                <section id="lift">
                            <input id="lift-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lift</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">jax_fun</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">axes_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">in_axes</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">out_axes</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">batched</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="lift-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lift"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lift-1659"><a href="#lift-1659"><span class="linenos">1659</span></a><span class="k">def</span> <span class="nf">lift</span><span class="p">(</span><span class="n">jax_fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">axes_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="lift-1660"><a href="#lift-1660"><span class="linenos">1660</span></a>         <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="lift-1661"><a href="#lift-1661"><span class="linenos">1661</span></a>    <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span> <span class="o">=</span> <span class="n">parse_lift_str</span><span class="p">(</span><span class="n">axes_str</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="lift-1662"><a href="#lift-1662"><span class="linenos">1662</span></a>    <span class="n">fun</span> <span class="o">=</span> <span class="n">lift_pytree</span><span class="p">(</span><span class="n">jax_fun</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="lift-1663"><a href="#lift-1663"><span class="linenos">1663</span></a>    <span class="k">if</span> <span class="n">batched</span><span class="p">:</span>
</span><span id="lift-1664"><a href="#lift-1664"><span class="linenos">1664</span></a>        <span class="k">if</span> <span class="n">is_sequence_of_type</span><span class="p">(</span><span class="n">in_axes</span><span class="p">,</span> <span class="n">Axis</span><span class="p">):</span>
</span><span id="lift-1665"><a href="#lift-1665"><span class="linenos">1665</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">in_axes</span><span class="p">)</span>
</span><span id="lift-1666"><a href="#lift-1666"><span class="linenos">1666</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="lift-1667"><a href="#lift-1667"><span class="linenos">1667</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">in_ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">in_ax</span> <span class="ow">in</span> <span class="n">in_axes</span><span class="p">])</span>
</span><span id="lift-1668"><a href="#lift-1668"><span class="linenos">1668</span></a>        <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="lift-1669"><a href="#lift-1669"><span class="linenos">1669</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="lift-1670"><a href="#lift-1670"><span class="linenos">1670</span></a>        <span class="k">return</span> <span class="n">fun</span>
</span></pre></div>


    

                </section>
                <section id="lower">
                            <input id="lower-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lower</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">axes_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">in_axes</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">out_axes</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="lower-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lower"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lower-1742"><a href="#lower-1742"><span class="linenos">1742</span></a><span class="k">def</span> <span class="nf">lower</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">axes_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="lower-1743"><a href="#lower-1743"><span class="linenos">1743</span></a>    <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span> <span class="o">=</span> <span class="n">parse_lift_str</span><span class="p">(</span><span class="n">axes_str</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span><span id="lower-1744"><a href="#lower-1744"><span class="linenos">1744</span></a>    <span class="k">return</span> <span class="n">lower_pytree</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">,</span> <span class="n">out_axes</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="abs">
                            <input id="abs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">abs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="abs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#abs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="abs-2134"><a href="#abs-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="abs-2135"><a href="#abs-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="abs-2136"><a href="#abs-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="abs-2137"><a href="#abs-2137"><span class="linenos">2137</span></a>
</span><span id="abs-2138"><a href="#abs-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="abs-2139"><a href="#abs-2139"><span class="linenos">2139</span></a>
</span><span id="abs-2140"><a href="#abs-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="acos">
                            <input id="acos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">acos</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="acos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#acos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="acos-2134"><a href="#acos-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="acos-2135"><a href="#acos-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="acos-2136"><a href="#acos-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="acos-2137"><a href="#acos-2137"><span class="linenos">2137</span></a>
</span><span id="acos-2138"><a href="#acos-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="acos-2139"><a href="#acos-2139"><span class="linenos">2139</span></a>
</span><span id="acos-2140"><a href="#acos-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="acosh">
                            <input id="acosh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">acosh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="acosh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#acosh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="acosh-2134"><a href="#acosh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="acosh-2135"><a href="#acosh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="acosh-2136"><a href="#acosh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="acosh-2137"><a href="#acosh-2137"><span class="linenos">2137</span></a>
</span><span id="acosh-2138"><a href="#acosh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="acosh-2139"><a href="#acosh-2139"><span class="linenos">2139</span></a>
</span><span id="acosh-2140"><a href="#acosh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="arccos">
                            <input id="arccos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arccos</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="arccos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#arccos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="arccos-2134"><a href="#arccos-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="arccos-2135"><a href="#arccos-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="arccos-2136"><a href="#arccos-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="arccos-2137"><a href="#arccos-2137"><span class="linenos">2137</span></a>
</span><span id="arccos-2138"><a href="#arccos-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="arccos-2139"><a href="#arccos-2139"><span class="linenos">2139</span></a>
</span><span id="arccos-2140"><a href="#arccos-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="arccosh">
                            <input id="arccosh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arccosh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="arccosh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#arccosh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="arccosh-2134"><a href="#arccosh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="arccosh-2135"><a href="#arccosh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="arccosh-2136"><a href="#arccosh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="arccosh-2137"><a href="#arccosh-2137"><span class="linenos">2137</span></a>
</span><span id="arccosh-2138"><a href="#arccosh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="arccosh-2139"><a href="#arccosh-2139"><span class="linenos">2139</span></a>
</span><span id="arccosh-2140"><a href="#arccosh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="arcsin">
                            <input id="arcsin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arcsin</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="arcsin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#arcsin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="arcsin-2134"><a href="#arcsin-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="arcsin-2135"><a href="#arcsin-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="arcsin-2136"><a href="#arcsin-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="arcsin-2137"><a href="#arcsin-2137"><span class="linenos">2137</span></a>
</span><span id="arcsin-2138"><a href="#arcsin-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="arcsin-2139"><a href="#arcsin-2139"><span class="linenos">2139</span></a>
</span><span id="arcsin-2140"><a href="#arcsin-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="arcsinh">
                            <input id="arcsinh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arcsinh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="arcsinh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#arcsinh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="arcsinh-2134"><a href="#arcsinh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="arcsinh-2135"><a href="#arcsinh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="arcsinh-2136"><a href="#arcsinh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="arcsinh-2137"><a href="#arcsinh-2137"><span class="linenos">2137</span></a>
</span><span id="arcsinh-2138"><a href="#arcsinh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="arcsinh-2139"><a href="#arcsinh-2139"><span class="linenos">2139</span></a>
</span><span id="arcsinh-2140"><a href="#arcsinh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="arctan">
                            <input id="arctan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arctan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="arctan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#arctan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="arctan-2134"><a href="#arctan-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="arctan-2135"><a href="#arctan-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="arctan-2136"><a href="#arctan-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="arctan-2137"><a href="#arctan-2137"><span class="linenos">2137</span></a>
</span><span id="arctan-2138"><a href="#arctan-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="arctan-2139"><a href="#arctan-2139"><span class="linenos">2139</span></a>
</span><span id="arctan-2140"><a href="#arctan-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="arctanh">
                            <input id="arctanh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arctanh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="arctanh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#arctanh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="arctanh-2134"><a href="#arctanh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="arctanh-2135"><a href="#arctanh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="arctanh-2136"><a href="#arctanh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="arctanh-2137"><a href="#arctanh-2137"><span class="linenos">2137</span></a>
</span><span id="arctanh-2138"><a href="#arctanh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="arctanh-2139"><a href="#arctanh-2139"><span class="linenos">2139</span></a>
</span><span id="arctanh-2140"><a href="#arctanh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="asin">
                            <input id="asin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">asin</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="asin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#asin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="asin-2134"><a href="#asin-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="asin-2135"><a href="#asin-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="asin-2136"><a href="#asin-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="asin-2137"><a href="#asin-2137"><span class="linenos">2137</span></a>
</span><span id="asin-2138"><a href="#asin-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="asin-2139"><a href="#asin-2139"><span class="linenos">2139</span></a>
</span><span id="asin-2140"><a href="#asin-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="asinh">
                            <input id="asinh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">asinh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="asinh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#asinh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="asinh-2134"><a href="#asinh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="asinh-2135"><a href="#asinh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="asinh-2136"><a href="#asinh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="asinh-2137"><a href="#asinh-2137"><span class="linenos">2137</span></a>
</span><span id="asinh-2138"><a href="#asinh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="asinh-2139"><a href="#asinh-2139"><span class="linenos">2139</span></a>
</span><span id="asinh-2140"><a href="#asinh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="atan">
                            <input id="atan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">atan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="atan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#atan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="atan-2134"><a href="#atan-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="atan-2135"><a href="#atan-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="atan-2136"><a href="#atan-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="atan-2137"><a href="#atan-2137"><span class="linenos">2137</span></a>
</span><span id="atan-2138"><a href="#atan-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="atan-2139"><a href="#atan-2139"><span class="linenos">2139</span></a>
</span><span id="atan-2140"><a href="#atan-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="atanh">
                            <input id="atanh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">atanh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="atanh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#atanh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="atanh-2134"><a href="#atanh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="atanh-2135"><a href="#atanh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="atanh-2136"><a href="#atanh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="atanh-2137"><a href="#atanh-2137"><span class="linenos">2137</span></a>
</span><span id="atanh-2138"><a href="#atanh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="atanh-2139"><a href="#atanh-2139"><span class="linenos">2139</span></a>
</span><span id="atanh-2140"><a href="#atanh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="ceil">
                            <input id="ceil-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ceil</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ceil-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ceil"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ceil-2134"><a href="#ceil-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="ceil-2135"><a href="#ceil-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="ceil-2136"><a href="#ceil-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="ceil-2137"><a href="#ceil-2137"><span class="linenos">2137</span></a>
</span><span id="ceil-2138"><a href="#ceil-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="ceil-2139"><a href="#ceil-2139"><span class="linenos">2139</span></a>
</span><span id="ceil-2140"><a href="#ceil-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="conj">
                            <input id="conj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">conj</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="conj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#conj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="conj-2134"><a href="#conj-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="conj-2135"><a href="#conj-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="conj-2136"><a href="#conj-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="conj-2137"><a href="#conj-2137"><span class="linenos">2137</span></a>
</span><span id="conj-2138"><a href="#conj-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="conj-2139"><a href="#conj-2139"><span class="linenos">2139</span></a>
</span><span id="conj-2140"><a href="#conj-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="cos">
                            <input id="cos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cos</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="cos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cos-2134"><a href="#cos-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="cos-2135"><a href="#cos-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="cos-2136"><a href="#cos-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="cos-2137"><a href="#cos-2137"><span class="linenos">2137</span></a>
</span><span id="cos-2138"><a href="#cos-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="cos-2139"><a href="#cos-2139"><span class="linenos">2139</span></a>
</span><span id="cos-2140"><a href="#cos-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="cosh">
                            <input id="cosh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cosh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="cosh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cosh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cosh-2134"><a href="#cosh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="cosh-2135"><a href="#cosh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="cosh-2136"><a href="#cosh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="cosh-2137"><a href="#cosh-2137"><span class="linenos">2137</span></a>
</span><span id="cosh-2138"><a href="#cosh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="cosh-2139"><a href="#cosh-2139"><span class="linenos">2139</span></a>
</span><span id="cosh-2140"><a href="#cosh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="deg2rad">
                            <input id="deg2rad-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deg2rad</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="deg2rad-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#deg2rad"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="deg2rad-2134"><a href="#deg2rad-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="deg2rad-2135"><a href="#deg2rad-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="deg2rad-2136"><a href="#deg2rad-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="deg2rad-2137"><a href="#deg2rad-2137"><span class="linenos">2137</span></a>
</span><span id="deg2rad-2138"><a href="#deg2rad-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="deg2rad-2139"><a href="#deg2rad-2139"><span class="linenos">2139</span></a>
</span><span id="deg2rad-2140"><a href="#deg2rad-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="exp">
                            <input id="exp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="exp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#exp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="exp-2134"><a href="#exp-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="exp-2135"><a href="#exp-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="exp-2136"><a href="#exp-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="exp-2137"><a href="#exp-2137"><span class="linenos">2137</span></a>
</span><span id="exp-2138"><a href="#exp-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="exp-2139"><a href="#exp-2139"><span class="linenos">2139</span></a>
</span><span id="exp-2140"><a href="#exp-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="exp2">
                            <input id="exp2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exp2</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="exp2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#exp2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="exp2-2134"><a href="#exp2-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="exp2-2135"><a href="#exp2-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="exp2-2136"><a href="#exp2-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="exp2-2137"><a href="#exp2-2137"><span class="linenos">2137</span></a>
</span><span id="exp2-2138"><a href="#exp2-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="exp2-2139"><a href="#exp2-2139"><span class="linenos">2139</span></a>
</span><span id="exp2-2140"><a href="#exp2-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="expm1">
                            <input id="expm1-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">expm1</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="expm1-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#expm1"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="expm1-2134"><a href="#expm1-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="expm1-2135"><a href="#expm1-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="expm1-2136"><a href="#expm1-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="expm1-2137"><a href="#expm1-2137"><span class="linenos">2137</span></a>
</span><span id="expm1-2138"><a href="#expm1-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="expm1-2139"><a href="#expm1-2139"><span class="linenos">2139</span></a>
</span><span id="expm1-2140"><a href="#expm1-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="i0">
                            <input id="i0-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">i0</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="i0-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#i0"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="i0-2134"><a href="#i0-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="i0-2135"><a href="#i0-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="i0-2136"><a href="#i0-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="i0-2137"><a href="#i0-2137"><span class="linenos">2137</span></a>
</span><span id="i0-2138"><a href="#i0-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="i0-2139"><a href="#i0-2139"><span class="linenos">2139</span></a>
</span><span id="i0-2140"><a href="#i0-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="imag">
                            <input id="imag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">imag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="imag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#imag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="imag-2134"><a href="#imag-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="imag-2135"><a href="#imag-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="imag-2136"><a href="#imag-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="imag-2137"><a href="#imag-2137"><span class="linenos">2137</span></a>
</span><span id="imag-2138"><a href="#imag-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="imag-2139"><a href="#imag-2139"><span class="linenos">2139</span></a>
</span><span id="imag-2140"><a href="#imag-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="log">
                            <input id="log-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="log-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#log"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="log-2134"><a href="#log-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="log-2135"><a href="#log-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="log-2136"><a href="#log-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="log-2137"><a href="#log-2137"><span class="linenos">2137</span></a>
</span><span id="log-2138"><a href="#log-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="log-2139"><a href="#log-2139"><span class="linenos">2139</span></a>
</span><span id="log-2140"><a href="#log-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="log10">
                            <input id="log10-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log10</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="log10-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#log10"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="log10-2134"><a href="#log10-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="log10-2135"><a href="#log10-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="log10-2136"><a href="#log10-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="log10-2137"><a href="#log10-2137"><span class="linenos">2137</span></a>
</span><span id="log10-2138"><a href="#log10-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="log10-2139"><a href="#log10-2139"><span class="linenos">2139</span></a>
</span><span id="log10-2140"><a href="#log10-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="log1p">
                            <input id="log1p-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log1p</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="log1p-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#log1p"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="log1p-2134"><a href="#log1p-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="log1p-2135"><a href="#log1p-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="log1p-2136"><a href="#log1p-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="log1p-2137"><a href="#log1p-2137"><span class="linenos">2137</span></a>
</span><span id="log1p-2138"><a href="#log1p-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="log1p-2139"><a href="#log1p-2139"><span class="linenos">2139</span></a>
</span><span id="log1p-2140"><a href="#log1p-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="log2">
                            <input id="log2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log2</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="log2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#log2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="log2-2134"><a href="#log2-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="log2-2135"><a href="#log2-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="log2-2136"><a href="#log2-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="log2-2137"><a href="#log2-2137"><span class="linenos">2137</span></a>
</span><span id="log2-2138"><a href="#log2-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="log2-2139"><a href="#log2-2139"><span class="linenos">2139</span></a>
</span><span id="log2-2140"><a href="#log2-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="rad2deg">
                            <input id="rad2deg-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rad2deg</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="rad2deg-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rad2deg"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rad2deg-2134"><a href="#rad2deg-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="rad2deg-2135"><a href="#rad2deg-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="rad2deg-2136"><a href="#rad2deg-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="rad2deg-2137"><a href="#rad2deg-2137"><span class="linenos">2137</span></a>
</span><span id="rad2deg-2138"><a href="#rad2deg-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="rad2deg-2139"><a href="#rad2deg-2139"><span class="linenos">2139</span></a>
</span><span id="rad2deg-2140"><a href="#rad2deg-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="real">
                            <input id="real-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">real</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="real-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#real"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="real-2134"><a href="#real-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="real-2135"><a href="#real-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="real-2136"><a href="#real-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="real-2137"><a href="#real-2137"><span class="linenos">2137</span></a>
</span><span id="real-2138"><a href="#real-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="real-2139"><a href="#real-2139"><span class="linenos">2139</span></a>
</span><span id="real-2140"><a href="#real-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="reciprocal">
                            <input id="reciprocal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reciprocal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reciprocal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reciprocal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reciprocal-2134"><a href="#reciprocal-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="reciprocal-2135"><a href="#reciprocal-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="reciprocal-2136"><a href="#reciprocal-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="reciprocal-2137"><a href="#reciprocal-2137"><span class="linenos">2137</span></a>
</span><span id="reciprocal-2138"><a href="#reciprocal-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="reciprocal-2139"><a href="#reciprocal-2139"><span class="linenos">2139</span></a>
</span><span id="reciprocal-2140"><a href="#reciprocal-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="rint">
                            <input id="rint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="rint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rint-2134"><a href="#rint-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="rint-2135"><a href="#rint-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="rint-2136"><a href="#rint-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="rint-2137"><a href="#rint-2137"><span class="linenos">2137</span></a>
</span><span id="rint-2138"><a href="#rint-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="rint-2139"><a href="#rint-2139"><span class="linenos">2139</span></a>
</span><span id="rint-2140"><a href="#rint-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="round">
                            <input id="round-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">round</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="round-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#round"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="round-2134"><a href="#round-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="round-2135"><a href="#round-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="round-2136"><a href="#round-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="round-2137"><a href="#round-2137"><span class="linenos">2137</span></a>
</span><span id="round-2138"><a href="#round-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="round-2139"><a href="#round-2139"><span class="linenos">2139</span></a>
</span><span id="round-2140"><a href="#round-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="sign">
                            <input id="sign-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sign</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sign-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sign"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sign-2134"><a href="#sign-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="sign-2135"><a href="#sign-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="sign-2136"><a href="#sign-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="sign-2137"><a href="#sign-2137"><span class="linenos">2137</span></a>
</span><span id="sign-2138"><a href="#sign-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="sign-2139"><a href="#sign-2139"><span class="linenos">2139</span></a>
</span><span id="sign-2140"><a href="#sign-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="sin">
                            <input id="sin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sin</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sin-2134"><a href="#sin-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="sin-2135"><a href="#sin-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="sin-2136"><a href="#sin-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="sin-2137"><a href="#sin-2137"><span class="linenos">2137</span></a>
</span><span id="sin-2138"><a href="#sin-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="sin-2139"><a href="#sin-2139"><span class="linenos">2139</span></a>
</span><span id="sin-2140"><a href="#sin-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="sinc">
                            <input id="sinc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sinc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sinc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sinc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sinc-2134"><a href="#sinc-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="sinc-2135"><a href="#sinc-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="sinc-2136"><a href="#sinc-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="sinc-2137"><a href="#sinc-2137"><span class="linenos">2137</span></a>
</span><span id="sinc-2138"><a href="#sinc-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="sinc-2139"><a href="#sinc-2139"><span class="linenos">2139</span></a>
</span><span id="sinc-2140"><a href="#sinc-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="sinh">
                            <input id="sinh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sinh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sinh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sinh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sinh-2134"><a href="#sinh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="sinh-2135"><a href="#sinh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="sinh-2136"><a href="#sinh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="sinh-2137"><a href="#sinh-2137"><span class="linenos">2137</span></a>
</span><span id="sinh-2138"><a href="#sinh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="sinh-2139"><a href="#sinh-2139"><span class="linenos">2139</span></a>
</span><span id="sinh-2140"><a href="#sinh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="sqrt">
                            <input id="sqrt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sqrt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sqrt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sqrt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sqrt-2134"><a href="#sqrt-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="sqrt-2135"><a href="#sqrt-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="sqrt-2136"><a href="#sqrt-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="sqrt-2137"><a href="#sqrt-2137"><span class="linenos">2137</span></a>
</span><span id="sqrt-2138"><a href="#sqrt-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="sqrt-2139"><a href="#sqrt-2139"><span class="linenos">2139</span></a>
</span><span id="sqrt-2140"><a href="#sqrt-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="square">
                            <input id="square-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">square</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="square-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#square"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="square-2134"><a href="#square-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="square-2135"><a href="#square-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="square-2136"><a href="#square-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="square-2137"><a href="#square-2137"><span class="linenos">2137</span></a>
</span><span id="square-2138"><a href="#square-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="square-2139"><a href="#square-2139"><span class="linenos">2139</span></a>
</span><span id="square-2140"><a href="#square-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="tan">
                            <input id="tan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tan-2134"><a href="#tan-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="tan-2135"><a href="#tan-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="tan-2136"><a href="#tan-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="tan-2137"><a href="#tan-2137"><span class="linenos">2137</span></a>
</span><span id="tan-2138"><a href="#tan-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="tan-2139"><a href="#tan-2139"><span class="linenos">2139</span></a>
</span><span id="tan-2140"><a href="#tan-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="tanh">
                            <input id="tanh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tanh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tanh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tanh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tanh-2134"><a href="#tanh-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="tanh-2135"><a href="#tanh-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="tanh-2136"><a href="#tanh-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="tanh-2137"><a href="#tanh-2137"><span class="linenos">2137</span></a>
</span><span id="tanh-2138"><a href="#tanh-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="tanh-2139"><a href="#tanh-2139"><span class="linenos">2139</span></a>
</span><span id="tanh-2140"><a href="#tanh-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="trunc">
                            <input id="trunc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trunc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="trunc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#trunc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="trunc-2134"><a href="#trunc-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="trunc-2135"><a href="#trunc-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="trunc-2136"><a href="#trunc-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="trunc-2137"><a href="#trunc-2137"><span class="linenos">2137</span></a>
</span><span id="trunc-2138"><a href="#trunc-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="trunc-2139"><a href="#trunc-2139"><span class="linenos">2139</span></a>
</span><span id="trunc-2140"><a href="#trunc-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="relu">
                            <input id="relu-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">relu</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="relu-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#relu"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="relu-2134"><a href="#relu-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="relu-2135"><a href="#relu-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="relu-2136"><a href="#relu-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="relu-2137"><a href="#relu-2137"><span class="linenos">2137</span></a>
</span><span id="relu-2138"><a href="#relu-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="relu-2139"><a href="#relu-2139"><span class="linenos">2139</span></a>
</span><span id="relu-2140"><a href="#relu-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Elementwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.nn.html"><code>jax.nn</code></a>)</p>
</div>


                </section>
                <section id="add">
                            <input id="add-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="add-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#add"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="add-2134"><a href="#add-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="add-2135"><a href="#add-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="add-2136"><a href="#add-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="add-2137"><a href="#add-2137"><span class="linenos">2137</span></a>
</span><span id="add-2138"><a href="#add-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="add-2139"><a href="#add-2139"><span class="linenos">2139</span></a>
</span><span id="add-2140"><a href="#add-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation defined simply as <code>wrap_jax_pairwise(jnp.add)</code>
(see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="arctan2">
                            <input id="arctan2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arctan2</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="arctan2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#arctan2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="arctan2-2134"><a href="#arctan2-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="arctan2-2135"><a href="#arctan2-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="arctan2-2136"><a href="#arctan2-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="arctan2-2137"><a href="#arctan2-2137"><span class="linenos">2137</span></a>
</span><span id="arctan2-2138"><a href="#arctan2-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="arctan2-2139"><a href="#arctan2-2139"><span class="linenos">2139</span></a>
</span><span id="arctan2-2140"><a href="#arctan2-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="atan2">
                            <input id="atan2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">atan2</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="atan2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#atan2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="atan2-2134"><a href="#atan2-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="atan2-2135"><a href="#atan2-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="atan2-2136"><a href="#atan2-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="atan2-2137"><a href="#atan2-2137"><span class="linenos">2137</span></a>
</span><span id="atan2-2138"><a href="#atan2-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="atan2-2139"><a href="#atan2-2139"><span class="linenos">2139</span></a>
</span><span id="atan2-2140"><a href="#atan2-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="divide">
                            <input id="divide-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">divide</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="divide-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#divide"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="divide-2134"><a href="#divide-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="divide-2135"><a href="#divide-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="divide-2136"><a href="#divide-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="divide-2137"><a href="#divide-2137"><span class="linenos">2137</span></a>
</span><span id="divide-2138"><a href="#divide-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="divide-2139"><a href="#divide-2139"><span class="linenos">2139</span></a>
</span><span id="divide-2140"><a href="#divide-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="divmod">
                            <input id="divmod-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">divmod</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="divmod-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#divmod"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="divmod-2134"><a href="#divmod-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="divmod-2135"><a href="#divmod-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="divmod-2136"><a href="#divmod-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="divmod-2137"><a href="#divmod-2137"><span class="linenos">2137</span></a>
</span><span id="divmod-2138"><a href="#divmod-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="divmod-2139"><a href="#divmod-2139"><span class="linenos">2139</span></a>
</span><span id="divmod-2140"><a href="#divmod-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="equal">
                            <input id="equal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">equal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="equal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#equal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="equal-2134"><a href="#equal-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="equal-2135"><a href="#equal-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="equal-2136"><a href="#equal-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="equal-2137"><a href="#equal-2137"><span class="linenos">2137</span></a>
</span><span id="equal-2138"><a href="#equal-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="equal-2139"><a href="#equal-2139"><span class="linenos">2139</span></a>
</span><span id="equal-2140"><a href="#equal-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="floor_divide">
                            <input id="floor_divide-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">floor_divide</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="floor_divide-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#floor_divide"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="floor_divide-2134"><a href="#floor_divide-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="floor_divide-2135"><a href="#floor_divide-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="floor_divide-2136"><a href="#floor_divide-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="floor_divide-2137"><a href="#floor_divide-2137"><span class="linenos">2137</span></a>
</span><span id="floor_divide-2138"><a href="#floor_divide-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="floor_divide-2139"><a href="#floor_divide-2139"><span class="linenos">2139</span></a>
</span><span id="floor_divide-2140"><a href="#floor_divide-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="gcd">
                            <input id="gcd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gcd</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="gcd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#gcd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="gcd-2134"><a href="#gcd-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="gcd-2135"><a href="#gcd-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="gcd-2136"><a href="#gcd-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="gcd-2137"><a href="#gcd-2137"><span class="linenos">2137</span></a>
</span><span id="gcd-2138"><a href="#gcd-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="gcd-2139"><a href="#gcd-2139"><span class="linenos">2139</span></a>
</span><span id="gcd-2140"><a href="#gcd-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="greater">
                            <input id="greater-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">greater</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="greater-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#greater"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="greater-2134"><a href="#greater-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="greater-2135"><a href="#greater-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="greater-2136"><a href="#greater-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="greater-2137"><a href="#greater-2137"><span class="linenos">2137</span></a>
</span><span id="greater-2138"><a href="#greater-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="greater-2139"><a href="#greater-2139"><span class="linenos">2139</span></a>
</span><span id="greater-2140"><a href="#greater-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="greater_equal">
                            <input id="greater_equal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">greater_equal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="greater_equal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#greater_equal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="greater_equal-2134"><a href="#greater_equal-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="greater_equal-2135"><a href="#greater_equal-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="greater_equal-2136"><a href="#greater_equal-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="greater_equal-2137"><a href="#greater_equal-2137"><span class="linenos">2137</span></a>
</span><span id="greater_equal-2138"><a href="#greater_equal-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="greater_equal-2139"><a href="#greater_equal-2139"><span class="linenos">2139</span></a>
</span><span id="greater_equal-2140"><a href="#greater_equal-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="heaviside">
                            <input id="heaviside-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">heaviside</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="heaviside-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#heaviside"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="heaviside-2134"><a href="#heaviside-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="heaviside-2135"><a href="#heaviside-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="heaviside-2136"><a href="#heaviside-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="heaviside-2137"><a href="#heaviside-2137"><span class="linenos">2137</span></a>
</span><span id="heaviside-2138"><a href="#heaviside-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="heaviside-2139"><a href="#heaviside-2139"><span class="linenos">2139</span></a>
</span><span id="heaviside-2140"><a href="#heaviside-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="hypot">
                            <input id="hypot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">hypot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="hypot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#hypot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="hypot-2134"><a href="#hypot-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="hypot-2135"><a href="#hypot-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="hypot-2136"><a href="#hypot-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="hypot-2137"><a href="#hypot-2137"><span class="linenos">2137</span></a>
</span><span id="hypot-2138"><a href="#hypot-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="hypot-2139"><a href="#hypot-2139"><span class="linenos">2139</span></a>
</span><span id="hypot-2140"><a href="#hypot-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="lcm">
                            <input id="lcm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lcm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="lcm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lcm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lcm-2134"><a href="#lcm-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="lcm-2135"><a href="#lcm-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="lcm-2136"><a href="#lcm-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="lcm-2137"><a href="#lcm-2137"><span class="linenos">2137</span></a>
</span><span id="lcm-2138"><a href="#lcm-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="lcm-2139"><a href="#lcm-2139"><span class="linenos">2139</span></a>
</span><span id="lcm-2140"><a href="#lcm-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="ldexp">
                            <input id="ldexp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ldexp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ldexp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ldexp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ldexp-2134"><a href="#ldexp-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="ldexp-2135"><a href="#ldexp-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="ldexp-2136"><a href="#ldexp-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="ldexp-2137"><a href="#ldexp-2137"><span class="linenos">2137</span></a>
</span><span id="ldexp-2138"><a href="#ldexp-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="ldexp-2139"><a href="#ldexp-2139"><span class="linenos">2139</span></a>
</span><span id="ldexp-2140"><a href="#ldexp-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="less">
                            <input id="less-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">less</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="less-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#less"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="less-2134"><a href="#less-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="less-2135"><a href="#less-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="less-2136"><a href="#less-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="less-2137"><a href="#less-2137"><span class="linenos">2137</span></a>
</span><span id="less-2138"><a href="#less-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="less-2139"><a href="#less-2139"><span class="linenos">2139</span></a>
</span><span id="less-2140"><a href="#less-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="less_equal">
                            <input id="less_equal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">less_equal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="less_equal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#less_equal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="less_equal-2134"><a href="#less_equal-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="less_equal-2135"><a href="#less_equal-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="less_equal-2136"><a href="#less_equal-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="less_equal-2137"><a href="#less_equal-2137"><span class="linenos">2137</span></a>
</span><span id="less_equal-2138"><a href="#less_equal-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="less_equal-2139"><a href="#less_equal-2139"><span class="linenos">2139</span></a>
</span><span id="less_equal-2140"><a href="#less_equal-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="logaddexp">
                            <input id="logaddexp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">logaddexp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="logaddexp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#logaddexp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="logaddexp-2134"><a href="#logaddexp-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="logaddexp-2135"><a href="#logaddexp-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="logaddexp-2136"><a href="#logaddexp-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="logaddexp-2137"><a href="#logaddexp-2137"><span class="linenos">2137</span></a>
</span><span id="logaddexp-2138"><a href="#logaddexp-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="logaddexp-2139"><a href="#logaddexp-2139"><span class="linenos">2139</span></a>
</span><span id="logaddexp-2140"><a href="#logaddexp-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="logaddexp2">
                            <input id="logaddexp2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">logaddexp2</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="logaddexp2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#logaddexp2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="logaddexp2-2134"><a href="#logaddexp2-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="logaddexp2-2135"><a href="#logaddexp2-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="logaddexp2-2136"><a href="#logaddexp2-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="logaddexp2-2137"><a href="#logaddexp2-2137"><span class="linenos">2137</span></a>
</span><span id="logaddexp2-2138"><a href="#logaddexp2-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="logaddexp2-2139"><a href="#logaddexp2-2139"><span class="linenos">2139</span></a>
</span><span id="logaddexp2-2140"><a href="#logaddexp2-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="maximum">
                            <input id="maximum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">maximum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="maximum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#maximum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="maximum-2134"><a href="#maximum-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="maximum-2135"><a href="#maximum-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="maximum-2136"><a href="#maximum-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="maximum-2137"><a href="#maximum-2137"><span class="linenos">2137</span></a>
</span><span id="maximum-2138"><a href="#maximum-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="maximum-2139"><a href="#maximum-2139"><span class="linenos">2139</span></a>
</span><span id="maximum-2140"><a href="#maximum-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="minimum">
                            <input id="minimum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">minimum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="minimum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#minimum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="minimum-2134"><a href="#minimum-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="minimum-2135"><a href="#minimum-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="minimum-2136"><a href="#minimum-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="minimum-2137"><a href="#minimum-2137"><span class="linenos">2137</span></a>
</span><span id="minimum-2138"><a href="#minimum-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="minimum-2139"><a href="#minimum-2139"><span class="linenos">2139</span></a>
</span><span id="minimum-2140"><a href="#minimum-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="multiply">
                            <input id="multiply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">multiply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="multiply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#multiply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="multiply-2134"><a href="#multiply-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="multiply-2135"><a href="#multiply-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="multiply-2136"><a href="#multiply-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="multiply-2137"><a href="#multiply-2137"><span class="linenos">2137</span></a>
</span><span id="multiply-2138"><a href="#multiply-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="multiply-2139"><a href="#multiply-2139"><span class="linenos">2139</span></a>
</span><span id="multiply-2140"><a href="#multiply-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="mod">
                            <input id="mod-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mod</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mod-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mod"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mod-2134"><a href="#mod-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="mod-2135"><a href="#mod-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="mod-2136"><a href="#mod-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="mod-2137"><a href="#mod-2137"><span class="linenos">2137</span></a>
</span><span id="mod-2138"><a href="#mod-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="mod-2139"><a href="#mod-2139"><span class="linenos">2139</span></a>
</span><span id="mod-2140"><a href="#mod-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="nextafter">
                            <input id="nextafter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nextafter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="nextafter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#nextafter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="nextafter-2134"><a href="#nextafter-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="nextafter-2135"><a href="#nextafter-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="nextafter-2136"><a href="#nextafter-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="nextafter-2137"><a href="#nextafter-2137"><span class="linenos">2137</span></a>
</span><span id="nextafter-2138"><a href="#nextafter-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="nextafter-2139"><a href="#nextafter-2139"><span class="linenos">2139</span></a>
</span><span id="nextafter-2140"><a href="#nextafter-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="not_equal">
                            <input id="not_equal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">not_equal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="not_equal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#not_equal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="not_equal-2134"><a href="#not_equal-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="not_equal-2135"><a href="#not_equal-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="not_equal-2136"><a href="#not_equal-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="not_equal-2137"><a href="#not_equal-2137"><span class="linenos">2137</span></a>
</span><span id="not_equal-2138"><a href="#not_equal-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="not_equal-2139"><a href="#not_equal-2139"><span class="linenos">2139</span></a>
</span><span id="not_equal-2140"><a href="#not_equal-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="polyadd">
                            <input id="polyadd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">polyadd</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="polyadd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#polyadd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="polyadd-2134"><a href="#polyadd-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="polyadd-2135"><a href="#polyadd-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="polyadd-2136"><a href="#polyadd-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="polyadd-2137"><a href="#polyadd-2137"><span class="linenos">2137</span></a>
</span><span id="polyadd-2138"><a href="#polyadd-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="polyadd-2139"><a href="#polyadd-2139"><span class="linenos">2139</span></a>
</span><span id="polyadd-2140"><a href="#polyadd-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="polymul">
                            <input id="polymul-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">polymul</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="polymul-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#polymul"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="polymul-2134"><a href="#polymul-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="polymul-2135"><a href="#polymul-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="polymul-2136"><a href="#polymul-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="polymul-2137"><a href="#polymul-2137"><span class="linenos">2137</span></a>
</span><span id="polymul-2138"><a href="#polymul-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="polymul-2139"><a href="#polymul-2139"><span class="linenos">2139</span></a>
</span><span id="polymul-2140"><a href="#polymul-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="polysub">
                            <input id="polysub-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">polysub</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="polysub-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#polysub"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="polysub-2134"><a href="#polysub-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="polysub-2135"><a href="#polysub-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="polysub-2136"><a href="#polysub-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="polysub-2137"><a href="#polysub-2137"><span class="linenos">2137</span></a>
</span><span id="polysub-2138"><a href="#polysub-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="polysub-2139"><a href="#polysub-2139"><span class="linenos">2139</span></a>
</span><span id="polysub-2140"><a href="#polysub-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="polyval">
                            <input id="polyval-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">polyval</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="polyval-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#polyval"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="polyval-2134"><a href="#polyval-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="polyval-2135"><a href="#polyval-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="polyval-2136"><a href="#polyval-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="polyval-2137"><a href="#polyval-2137"><span class="linenos">2137</span></a>
</span><span id="polyval-2138"><a href="#polyval-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="polyval-2139"><a href="#polyval-2139"><span class="linenos">2139</span></a>
</span><span id="polyval-2140"><a href="#polyval-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="pow">
                            <input id="pow-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pow</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="pow-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pow"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pow-2134"><a href="#pow-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="pow-2135"><a href="#pow-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="pow-2136"><a href="#pow-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="pow-2137"><a href="#pow-2137"><span class="linenos">2137</span></a>
</span><span id="pow-2138"><a href="#pow-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="pow-2139"><a href="#pow-2139"><span class="linenos">2139</span></a>
</span><span id="pow-2140"><a href="#pow-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="power">
                            <input id="power-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">power</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="power-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#power"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="power-2134"><a href="#power-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="power-2135"><a href="#power-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="power-2136"><a href="#power-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="power-2137"><a href="#power-2137"><span class="linenos">2137</span></a>
</span><span id="power-2138"><a href="#power-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="power-2139"><a href="#power-2139"><span class="linenos">2139</span></a>
</span><span id="power-2140"><a href="#power-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="remainder">
                            <input id="remainder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remainder</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="remainder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#remainder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="remainder-2134"><a href="#remainder-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="remainder-2135"><a href="#remainder-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="remainder-2136"><a href="#remainder-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="remainder-2137"><a href="#remainder-2137"><span class="linenos">2137</span></a>
</span><span id="remainder-2138"><a href="#remainder-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="remainder-2139"><a href="#remainder-2139"><span class="linenos">2139</span></a>
</span><span id="remainder-2140"><a href="#remainder-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="subtract">
                            <input id="subtract-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">subtract</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="subtract-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#subtract"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="subtract-2134"><a href="#subtract-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="subtract-2135"><a href="#subtract-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="subtract-2136"><a href="#subtract-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="subtract-2137"><a href="#subtract-2137"><span class="linenos">2137</span></a>
</span><span id="subtract-2138"><a href="#subtract-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="subtract-2139"><a href="#subtract-2139"><span class="linenos">2139</span></a>
</span><span id="subtract-2140"><a href="#subtract-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="true_divide">
                            <input id="true_divide-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">true_divide</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="true_divide-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#true_divide"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="true_divide-2134"><a href="#true_divide-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="true_divide-2135"><a href="#true_divide-2135"><span class="linenos">2135</span></a>        <span class="c1">#args = [convert_to_0dim_array_if_possible(arg) for arg in args]</span>
</span><span id="true_divide-2136"><a href="#true_divide-2136"><span class="linenos">2136</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_to_0dim_array_if_possible</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">is_leaf</span><span class="o">=</span><span class="n">is_ntensor</span><span class="p">)</span>
</span><span id="true_divide-2137"><a href="#true_divide-2137"><span class="linenos">2137</span></a>
</span><span id="true_divide-2138"><a href="#true_divide-2138"><span class="linenos">2138</span></a>        <span class="n">vmap_axes</span> <span class="o">=</span> <span class="n">other_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="true_divide-2139"><a href="#true_divide-2139"><span class="linenos">2139</span></a>
</span><span id="true_divide-2140"><a href="#true_divide-2140"><span class="linenos">2140</span></a>        <span class="k">return</span> <span class="n">vmap</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap_axes</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pairwise operation (see same operation in <a href="https://docs.jax.dev/en/latest/jax.numpy.html"><code>jax.numpy</code></a>)</p>
</div>


                </section>
                <section id="all">
                            <input id="all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">all</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="all-2180"><a href="#all-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="all-2181"><a href="#all-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="all-2182"><a href="#all-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="all-2183"><a href="#all-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="all-2184"><a href="#all-2184"><span class="linenos">2184</span></a>
</span><span id="all-2185"><a href="#all-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="all-2186"><a href="#all-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="all-2187"><a href="#all-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="all-2188"><a href="#all-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="all-2189"><a href="#all-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="all-2190"><a href="#all-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="all-2191"><a href="#all-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.all.html"><code>jax.numpy.all</code></a>. 
Call with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="any">
                            <input id="any-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">any</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="any-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#any"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="any-2180"><a href="#any-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="any-2181"><a href="#any-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="any-2182"><a href="#any-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="any-2183"><a href="#any-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="any-2184"><a href="#any-2184"><span class="linenos">2184</span></a>
</span><span id="any-2185"><a href="#any-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="any-2186"><a href="#any-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="any-2187"><a href="#any-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="any-2188"><a href="#any-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="any-2189"><a href="#any-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="any-2190"><a href="#any-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="any-2191"><a href="#any-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.any.html"><code>jax.numpy.any</code></a>. Call 
with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="logsumexp">
                            <input id="logsumexp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">logsumexp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="logsumexp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#logsumexp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="logsumexp-2180"><a href="#logsumexp-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="logsumexp-2181"><a href="#logsumexp-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="logsumexp-2182"><a href="#logsumexp-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="logsumexp-2183"><a href="#logsumexp-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="logsumexp-2184"><a href="#logsumexp-2184"><span class="linenos">2184</span></a>
</span><span id="logsumexp-2185"><a href="#logsumexp-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="logsumexp-2186"><a href="#logsumexp-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="logsumexp-2187"><a href="#logsumexp-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="logsumexp-2188"><a href="#logsumexp-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="logsumexp-2189"><a href="#logsumexp-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="logsumexp-2190"><a href="#logsumexp-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="logsumexp-2191"><a href="#logsumexp-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.nn.logsumexp.html"><code>jax.nn.logsumexp</code></a>. 
Call with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="max">
                            <input id="max-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="max-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#max"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="max-2180"><a href="#max-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="max-2181"><a href="#max-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="max-2182"><a href="#max-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="max-2183"><a href="#max-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="max-2184"><a href="#max-2184"><span class="linenos">2184</span></a>
</span><span id="max-2185"><a href="#max-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="max-2186"><a href="#max-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="max-2187"><a href="#max-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="max-2188"><a href="#max-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="max-2189"><a href="#max-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="max-2190"><a href="#max-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="max-2191"><a href="#max-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.max.html"><code>jax.numpy.max</code></a>. Call 
with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="mean">
                            <input id="mean-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mean</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mean-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mean"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mean-2180"><a href="#mean-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="mean-2181"><a href="#mean-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="mean-2182"><a href="#mean-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="mean-2183"><a href="#mean-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="mean-2184"><a href="#mean-2184"><span class="linenos">2184</span></a>
</span><span id="mean-2185"><a href="#mean-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="mean-2186"><a href="#mean-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="mean-2187"><a href="#mean-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="mean-2188"><a href="#mean-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="mean-2189"><a href="#mean-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="mean-2190"><a href="#mean-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="mean-2191"><a href="#mean-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.mean.html"><code>jax.numpy.mean</code></a>. 
Call with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="median">
                            <input id="median-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="median-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#median"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="median-2180"><a href="#median-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="median-2181"><a href="#median-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="median-2182"><a href="#median-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="median-2183"><a href="#median-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="median-2184"><a href="#median-2184"><span class="linenos">2184</span></a>
</span><span id="median-2185"><a href="#median-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="median-2186"><a href="#median-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="median-2187"><a href="#median-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="median-2188"><a href="#median-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="median-2189"><a href="#median-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="median-2190"><a href="#median-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="median-2191"><a href="#median-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.median.html"><code>jax.numpy.median</code></a>. 
Call with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="min">
                            <input id="min-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="min-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#min"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="min-2180"><a href="#min-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="min-2181"><a href="#min-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="min-2182"><a href="#min-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="min-2183"><a href="#min-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="min-2184"><a href="#min-2184"><span class="linenos">2184</span></a>
</span><span id="min-2185"><a href="#min-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="min-2186"><a href="#min-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="min-2187"><a href="#min-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="min-2188"><a href="#min-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="min-2189"><a href="#min-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="min-2190"><a href="#min-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="min-2191"><a href="#min-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.min.html"><code>jax.numpy.min</code></a>. Call 
with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="prod">
                            <input id="prod-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prod</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="prod-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#prod"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="prod-2180"><a href="#prod-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="prod-2181"><a href="#prod-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="prod-2182"><a href="#prod-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="prod-2183"><a href="#prod-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="prod-2184"><a href="#prod-2184"><span class="linenos">2184</span></a>
</span><span id="prod-2185"><a href="#prod-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="prod-2186"><a href="#prod-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="prod-2187"><a href="#prod-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="prod-2188"><a href="#prod-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="prod-2189"><a href="#prod-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="prod-2190"><a href="#prod-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="prod-2191"><a href="#prod-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.prod.html"><code>jax.numpy.prod</code></a>. 
Call with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="sum">
                            <input id="sum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sum-2180"><a href="#sum-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="sum-2181"><a href="#sum-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="sum-2182"><a href="#sum-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="sum-2183"><a href="#sum-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="sum-2184"><a href="#sum-2184"><span class="linenos">2184</span></a>
</span><span id="sum-2185"><a href="#sum-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="sum-2186"><a href="#sum-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="sum-2187"><a href="#sum-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="sum-2188"><a href="#sum-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="sum-2189"><a href="#sum-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="sum-2190"><a href="#sum-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="sum-2191"><a href="#sum-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.sum.html"><code>jax.numpy.sum</code></a>. Call 
with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="std">
                            <input id="std-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">std</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="std-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#std"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="std-2180"><a href="#std-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="std-2181"><a href="#std-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="std-2182"><a href="#std-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="std-2183"><a href="#std-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="std-2184"><a href="#std-2184"><span class="linenos">2184</span></a>
</span><span id="std-2185"><a href="#std-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="std-2186"><a href="#std-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="std-2187"><a href="#std-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="std-2188"><a href="#std-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="std-2189"><a href="#std-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="std-2190"><a href="#std-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="std-2191"><a href="#std-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.std.html"><code>jax.numpy.std</code></a>. 
Call with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="var">
                            <input id="var-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">var</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="var-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#var"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="var-2180"><a href="#var-2180"><span class="linenos">2180</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="var-2181"><a href="#var-2181"><span class="linenos">2181</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="var-2182"><a href="#var-2182"><span class="linenos">2182</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="var-2183"><a href="#var-2183"><span class="linenos">2183</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="var-2184"><a href="#var-2184"><span class="linenos">2184</span></a>
</span><span id="var-2185"><a href="#var-2185"><span class="linenos">2185</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="var-2186"><a href="#var-2186"><span class="linenos">2186</span></a>                <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="var-2187"><a href="#var-2187"><span class="linenos">2187</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="var-2188"><a href="#var-2188"><span class="linenos">2188</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="var-2189"><a href="#var-2189"><span class="linenos">2189</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="var-2190"><a href="#var-2190"><span class="linenos">2190</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="var-2191"><a href="#var-2191"><span class="linenos">2191</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wraps <a href="https://docs.jax.dev/en/latest/_autosummary/jax.numpy.var.html"><code>jax.numpy.var</code></a>. 
Call with <code><a href="#axes">axes</a></code> to reduce or <code>vmap_axes</code> to <em>not</em> reduce.</p>
</div>


                </section>
                <section id="grad">
                            <input id="grad-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grad</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fun</span>, </span><span class="param"><span class="n">argnums</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="grad-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#grad"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="grad-2786"><a href="#grad-2786"><span class="linenos">2786</span></a><span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="grad-2787"><a href="#grad-2787"><span class="linenos">2787</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A thin wrapper around [`jax.grad`](https://docs.jax.dev/en/latest/_autosummary/jax.grad.html). All</span>
</span><span id="grad-2788"><a href="#grad-2788"><span class="linenos">2788</span></a><span class="sd">    this really does is convert the final `NTensor` output to a jax value.</span>
</span><span id="grad-2789"><a href="#grad-2789"><span class="linenos">2789</span></a>
</span><span id="grad-2790"><a href="#grad-2790"><span class="linenos">2790</span></a><span class="sd">    Parameters</span>
</span><span id="grad-2791"><a href="#grad-2791"><span class="linenos">2791</span></a><span class="sd">    ----------</span>
</span><span id="grad-2792"><a href="#grad-2792"><span class="linenos">2792</span></a><span class="sd">    fun</span>
</span><span id="grad-2793"><a href="#grad-2793"><span class="linenos">2793</span></a><span class="sd">        The function you will take the gradient of</span>
</span><span id="grad-2794"><a href="#grad-2794"><span class="linenos">2794</span></a><span class="sd">    argnums</span>
</span><span id="grad-2795"><a href="#grad-2795"><span class="linenos">2795</span></a><span class="sd">        Optional, integer or sequence of integers, specifying what arguments to take gradient with respect</span>
</span><span id="grad-2796"><a href="#grad-2796"><span class="linenos">2796</span></a><span class="sd">        to. Defaults to 0.</span>
</span><span id="grad-2797"><a href="#grad-2797"><span class="linenos">2797</span></a>
</span><span id="grad-2798"><a href="#grad-2798"><span class="linenos">2798</span></a><span class="sd">    Returns</span>
</span><span id="grad-2799"><a href="#grad-2799"><span class="linenos">2799</span></a><span class="sd">    -------</span>
</span><span id="grad-2800"><a href="#grad-2800"><span class="linenos">2800</span></a><span class="sd">    grad_fun</span>
</span><span id="grad-2801"><a href="#grad-2801"><span class="linenos">2801</span></a><span class="sd">        Gradient function</span>
</span><span id="grad-2802"><a href="#grad-2802"><span class="linenos">2802</span></a>
</span><span id="grad-2803"><a href="#grad-2803"><span class="linenos">2803</span></a><span class="sd">    Examples</span>
</span><span id="grad-2804"><a href="#grad-2804"><span class="linenos">2804</span></a><span class="sd">    --------</span>
</span><span id="grad-2805"><a href="#grad-2805"><span class="linenos">2805</span></a><span class="sd">    &gt;&gt;&gt; x = ntensor([0., 1., 2.],&#39;i&#39;)</span>
</span><span id="grad-2806"><a href="#grad-2806"><span class="linenos">2806</span></a><span class="sd">    &gt;&gt;&gt; grad_sum = grad(sum)</span>
</span><span id="grad-2807"><a href="#grad-2807"><span class="linenos">2807</span></a><span class="sd">    &gt;&gt;&gt; grad_sum(x)</span>
</span><span id="grad-2808"><a href="#grad-2808"><span class="linenos">2808</span></a><span class="sd">    &lt;ntensor {i:3} [1. 1. 1.]&gt;</span>
</span><span id="grad-2809"><a href="#grad-2809"><span class="linenos">2809</span></a>
</span><span id="grad-2810"><a href="#grad-2810"><span class="linenos">2810</span></a><span class="sd">    You can use regular jax grad if you really want to (this is effectively all this function does).</span>
</span><span id="grad-2811"><a href="#grad-2811"><span class="linenos">2811</span></a>
</span><span id="grad-2812"><a href="#grad-2812"><span class="linenos">2812</span></a><span class="sd">    &gt;&gt;&gt; x = ntensor([0., 1., 2.],&#39;i&#39;)</span>
</span><span id="grad-2813"><a href="#grad-2813"><span class="linenos">2813</span></a><span class="sd">    &gt;&gt;&gt; mysum = lambda arg: sum(arg).numpy() # converts to jax float</span>
</span><span id="grad-2814"><a href="#grad-2814"><span class="linenos">2814</span></a><span class="sd">    &gt;&gt;&gt; sum(x)</span>
</span><span id="grad-2815"><a href="#grad-2815"><span class="linenos">2815</span></a><span class="sd">    &lt;ntensor {} 3.0&gt;</span>
</span><span id="grad-2816"><a href="#grad-2816"><span class="linenos">2816</span></a><span class="sd">    &gt;&gt;&gt; mysum(x)</span>
</span><span id="grad-2817"><a href="#grad-2817"><span class="linenos">2817</span></a><span class="sd">    Array(3., dtype=float32)</span>
</span><span id="grad-2818"><a href="#grad-2818"><span class="linenos">2818</span></a><span class="sd">    &gt;&gt;&gt; grad_sum = jax.grad(mysum)</span>
</span><span id="grad-2819"><a href="#grad-2819"><span class="linenos">2819</span></a><span class="sd">    &gt;&gt;&gt; grad_sum(x)</span>
</span><span id="grad-2820"><a href="#grad-2820"><span class="linenos">2820</span></a><span class="sd">    &lt;ntensor {i:3} [1. 1. 1.]&gt;</span>
</span><span id="grad-2821"><a href="#grad-2821"><span class="linenos">2821</span></a>
</span><span id="grad-2822"><a href="#grad-2822"><span class="linenos">2822</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="grad-2823"><a href="#grad-2823"><span class="linenos">2823</span></a>
</span><span id="grad-2824"><a href="#grad-2824"><span class="linenos">2824</span></a>    <span class="k">def</span> <span class="nf">myfun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="grad-2825"><a href="#grad-2825"><span class="linenos">2825</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="grad-2826"><a href="#grad-2826"><span class="linenos">2826</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">{}):</span>
</span><span id="grad-2827"><a href="#grad-2827"><span class="linenos">2827</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gradient can only be taken of scalar functions (got </span><span class="si">{</span><span class="n">out</span><span class="si">=}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="grad-2828"><a href="#grad-2828"><span class="linenos">2828</span></a>        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">_data</span>
</span><span id="grad-2829"><a href="#grad-2829"><span class="linenos">2829</span></a>
</span><span id="grad-2830"><a href="#grad-2830"><span class="linenos">2830</span></a>    <span class="n">mygrad</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">myfun</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="n">argnums</span><span class="p">)</span>
</span><span id="grad-2831"><a href="#grad-2831"><span class="linenos">2831</span></a>
</span><span id="grad-2832"><a href="#grad-2832"><span class="linenos">2832</span></a>    <span class="k">def</span> <span class="nf">wrapped_grad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="grad-2833"><a href="#grad-2833"><span class="linenos">2833</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="grad-2834"><a href="#grad-2834"><span class="linenos">2834</span></a>        <span class="k">return</span> <span class="n">mygrad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="grad-2835"><a href="#grad-2835"><span class="linenos">2835</span></a>
</span><span id="grad-2836"><a href="#grad-2836"><span class="linenos">2836</span></a>    <span class="k">return</span> <span class="n">wrapped_grad</span>
</span></pre></div>


            <div class="docstring"><p>A thin wrapper around <a href="https://docs.jax.dev/en/latest/_autosummary/jax.grad.html"><code>jax.grad</code></a>. All
this really does is convert the final <code>NTensor</code> output to a jax value.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fun</strong>: The function you will take the gradient of</li>
<li><strong>argnums</strong>: Optional, integer or sequence of integers, specifying what arguments to take gradient with respect
to. Defaults to 0.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>grad_fun</strong>: Gradient function</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grad_sum</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grad_sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3} [1. 1. 1.]&gt;</span>
</code></pre>
</div>

<p>You can use regular jax grad if you really want to (this is effectively all this function does).</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mysum</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="c1"># converts to jax float</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;ntensor {} 3.0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mysum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">Array(3., dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grad_sum</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">mysum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grad_sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;ntensor {i:3} [1. 1. 1.]&gt;</span>
</code></pre>
</div>
</div>


                </section>
                <section id="value_and_grad">
                            <input id="value_and_grad-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">value_and_grad</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fun</span>, </span><span class="param"><span class="n">argnums</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="value_and_grad-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#value_and_grad"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="value_and_grad-2839"><a href="#value_and_grad-2839"><span class="linenos">2839</span></a><span class="k">def</span> <span class="nf">value_and_grad</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="value_and_grad-2840"><a href="#value_and_grad-2840"><span class="linenos">2840</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A thin wrapper around</span>
</span><span id="value_and_grad-2841"><a href="#value_and_grad-2841"><span class="linenos">2841</span></a><span class="sd">    [`jax.value_and_grad`](https://docs.jax.dev/en/latest/_autosummary/jax.value_and_grad.html).</span>
</span><span id="value_and_grad-2842"><a href="#value_and_grad-2842"><span class="linenos">2842</span></a>
</span><span id="value_and_grad-2843"><a href="#value_and_grad-2843"><span class="linenos">2843</span></a>
</span><span id="value_and_grad-2844"><a href="#value_and_grad-2844"><span class="linenos">2844</span></a><span class="sd">    Parameters</span>
</span><span id="value_and_grad-2845"><a href="#value_and_grad-2845"><span class="linenos">2845</span></a><span class="sd">    ----------</span>
</span><span id="value_and_grad-2846"><a href="#value_and_grad-2846"><span class="linenos">2846</span></a><span class="sd">    fun</span>
</span><span id="value_and_grad-2847"><a href="#value_and_grad-2847"><span class="linenos">2847</span></a><span class="sd">        The function you will take the gradient of</span>
</span><span id="value_and_grad-2848"><a href="#value_and_grad-2848"><span class="linenos">2848</span></a><span class="sd">    argnums</span>
</span><span id="value_and_grad-2849"><a href="#value_and_grad-2849"><span class="linenos">2849</span></a><span class="sd">        Optional, integer or sequence of integers, specifying what arguments to take gradient with respect</span>
</span><span id="value_and_grad-2850"><a href="#value_and_grad-2850"><span class="linenos">2850</span></a><span class="sd">        to. Defaults to 0.</span>
</span><span id="value_and_grad-2851"><a href="#value_and_grad-2851"><span class="linenos">2851</span></a>
</span><span id="value_and_grad-2852"><a href="#value_and_grad-2852"><span class="linenos">2852</span></a><span class="sd">    Returns</span>
</span><span id="value_and_grad-2853"><a href="#value_and_grad-2853"><span class="linenos">2853</span></a><span class="sd">    -------</span>
</span><span id="value_and_grad-2854"><a href="#value_and_grad-2854"><span class="linenos">2854</span></a><span class="sd">    value_and_grad_fun</span>
</span><span id="value_and_grad-2855"><a href="#value_and_grad-2855"><span class="linenos">2855</span></a><span class="sd">        Function that returns the value and the gradient</span>
</span><span id="value_and_grad-2856"><a href="#value_and_grad-2856"><span class="linenos">2856</span></a>
</span><span id="value_and_grad-2857"><a href="#value_and_grad-2857"><span class="linenos">2857</span></a><span class="sd">    Examples</span>
</span><span id="value_and_grad-2858"><a href="#value_and_grad-2858"><span class="linenos">2858</span></a><span class="sd">    --------</span>
</span><span id="value_and_grad-2859"><a href="#value_and_grad-2859"><span class="linenos">2859</span></a><span class="sd">    &gt;&gt;&gt; x = ntensor([0., 1., 2.],&#39;i&#39;)</span>
</span><span id="value_and_grad-2860"><a href="#value_and_grad-2860"><span class="linenos">2860</span></a><span class="sd">    &gt;&gt;&gt; value_and_grad_sum = value_and_grad(sum)</span>
</span><span id="value_and_grad-2861"><a href="#value_and_grad-2861"><span class="linenos">2861</span></a><span class="sd">    &gt;&gt;&gt; value_and_grad_sum(x)</span>
</span><span id="value_and_grad-2862"><a href="#value_and_grad-2862"><span class="linenos">2862</span></a><span class="sd">    (&lt;ntensor {} 3.0&gt;, &lt;ntensor {i:3} [1. 1. 1.]&gt;)</span>
</span><span id="value_and_grad-2863"><a href="#value_and_grad-2863"><span class="linenos">2863</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="value_and_grad-2864"><a href="#value_and_grad-2864"><span class="linenos">2864</span></a>
</span><span id="value_and_grad-2865"><a href="#value_and_grad-2865"><span class="linenos">2865</span></a>    <span class="k">def</span> <span class="nf">myfun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="value_and_grad-2866"><a href="#value_and_grad-2866"><span class="linenos">2866</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="value_and_grad-2867"><a href="#value_and_grad-2867"><span class="linenos">2867</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ntensor</span><span class="p">)</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">{}):</span>
</span><span id="value_and_grad-2868"><a href="#value_and_grad-2868"><span class="linenos">2868</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gradient can only be taken of scalar functions (got </span><span class="si">{</span><span class="n">out</span><span class="si">=}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="value_and_grad-2869"><a href="#value_and_grad-2869"><span class="linenos">2869</span></a>        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">_data</span>
</span><span id="value_and_grad-2870"><a href="#value_and_grad-2870"><span class="linenos">2870</span></a>
</span><span id="value_and_grad-2871"><a href="#value_and_grad-2871"><span class="linenos">2871</span></a>    <span class="n">my_value_and_grad</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">value_and_grad</span><span class="p">(</span><span class="n">myfun</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="n">argnums</span><span class="p">)</span>
</span><span id="value_and_grad-2872"><a href="#value_and_grad-2872"><span class="linenos">2872</span></a>
</span><span id="value_and_grad-2873"><a href="#value_and_grad-2873"><span class="linenos">2873</span></a>    <span class="k">def</span> <span class="nf">wrapped_value_and_grad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="value_and_grad-2874"><a href="#value_and_grad-2874"><span class="linenos">2874</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="value_and_grad-2875"><a href="#value_and_grad-2875"><span class="linenos">2875</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">my_value_and_grad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="value_and_grad-2876"><a href="#value_and_grad-2876"><span class="linenos">2876</span></a>        <span class="k">return</span> <span class="n">ntensor</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="value_and_grad-2877"><a href="#value_and_grad-2877"><span class="linenos">2877</span></a>
</span><span id="value_and_grad-2878"><a href="#value_and_grad-2878"><span class="linenos">2878</span></a>    <span class="k">return</span> <span class="n">wrapped_value_and_grad</span>
</span></pre></div>


            <div class="docstring"><p>A thin wrapper around
<a href="https://docs.jax.dev/en/latest/_autosummary/jax.value_and_grad.html"><code>jax.value_and_grad</code></a>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fun</strong>: The function you will take the gradient of</li>
<li><strong>argnums</strong>: Optional, integer or sequence of integers, specifying what arguments to take gradient with respect
to. Defaults to 0.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>value_and_grad_fun</strong>: Function that returns the value and the gradient</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">value_and_grad_sum</span> <span class="o">=</span> <span class="n">value_and_grad</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">value_and_grad_sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">(&lt;ntensor {} 3.0&gt;, &lt;ntensor {i:3} [1. 1. 1.]&gt;)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="solve">
                            <input id="solve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">solve</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="solve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#solve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="solve-2165"><a href="#solve-2165"><span class="linenos">2165</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="solve-2166"><a href="#solve-2166"><span class="linenos">2166</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="solve-2167"><a href="#solve-2167"><span class="linenos">2167</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="solve-2168"><a href="#solve-2168"><span class="linenos">2168</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="solve-2169"><a href="#solve-2169"><span class="linenos">2169</span></a>
</span><span id="solve-2170"><a href="#solve-2170"><span class="linenos">2170</span></a>            <span class="n">fun_with_kwargs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="solve-2171"><a href="#solve-2171"><span class="linenos">2171</span></a>
</span><span id="solve-2172"><a href="#solve-2172"><span class="linenos">2172</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="solve-2173"><a href="#solve-2173"><span class="linenos">2173</span></a>                <span class="k">return</span> <span class="n">fun_with_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="solve-2174"><a href="#solve-2174"><span class="linenos">2174</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="solve-2175"><a href="#solve-2175"><span class="linenos">2175</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun_with_kwargs</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="solve-2176"><a href="#solve-2176"><span class="linenos">2176</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="solve-2177"><a href="#solve-2177"><span class="linenos">2177</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="solve-2178"><a href="#solve-2178"><span class="linenos">2178</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun_with_kwargs</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="inv">
                            <input id="inv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">inv</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">axes</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vmap</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="inv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#inv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="inv-2165"><a href="#inv-2165"><span class="linenos">2165</span></a>        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="inv-2166"><a href="#inv-2166"><span class="linenos">2166</span></a>            <span class="n">args</span> <span class="o">=</span> <span class="n">ensure_ntensor_tree</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="inv-2167"><a href="#inv-2167"><span class="linenos">2167</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="inv-2168"><a href="#inv-2168"><span class="linenos">2168</span></a>            <span class="n">vmap</span> <span class="o">=</span> <span class="n">convert_empty_dict</span><span class="p">(</span><span class="n">vmap</span><span class="p">)</span>
</span><span id="inv-2169"><a href="#inv-2169"><span class="linenos">2169</span></a>
</span><span id="inv-2170"><a href="#inv-2170"><span class="linenos">2170</span></a>            <span class="n">fun_with_kwargs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="inv-2171"><a href="#inv-2171"><span class="linenos">2171</span></a>
</span><span id="inv-2172"><a href="#inv-2172"><span class="linenos">2172</span></a>            <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="inv-2173"><a href="#inv-2173"><span class="linenos">2173</span></a>                <span class="k">return</span> <span class="n">fun_with_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="inv-2174"><a href="#inv-2174"><span class="linenos">2174</span></a>            <span class="k">elif</span> <span class="n">vmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="inv-2175"><a href="#inv-2175"><span class="linenos">2175</span></a>                <span class="k">return</span> <span class="n">vmap_fun</span><span class="p">(</span><span class="n">fun_with_kwargs</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="inv-2176"><a href="#inv-2176"><span class="linenos">2176</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="inv-2177"><a href="#inv-2177"><span class="linenos">2177</span></a>                <span class="k">assert</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="inv-2178"><a href="#inv-2178"><span class="linenos">2178</span></a>                <span class="k">return</span> <span class="n">batch</span><span class="p">(</span><span class="n">fun_with_kwargs</span><span class="p">,</span> <span class="n">axes</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Take an inverse</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong>: 2-D NTensor</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>b</strong>: Inverse NTensor</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([[</span><span class="mf">2.</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">&lt;ntensor {j:2 i:2}</span>
<span class="go">[[0.5 0. ]</span>
<span class="go"> [0.  1. ]]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">ntensor</span><span class="p">([</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">@</span> <span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">&lt;ntensor {j:2} [2.5 3. ]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">@</span> <span class="n">x</span>
<span class="go">&lt;ntensor {i:2} [5. 3.]&gt;</span>
</code></pre>
</div>
</div>


                </section>
    </main>
</body>
</html>